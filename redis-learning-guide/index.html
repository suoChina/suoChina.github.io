<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜ | SuoL's Blog</title><meta name="author" content="SuoL"><meta name="copyright" content="SuoL"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="å…¨é¢å­¦ä¹ Redisä¸­é—´ä»¶ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°å®æˆ˜åº”ç”¨ï¼ŒæŒæ¡ç¼“å­˜ã€åˆ†å¸ƒå¼é”ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æ ¸å¿ƒåŠŸèƒ½"><meta property="og:type" content="article"><meta property="og:title" content="Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜"><meta property="og:url" content="https://suochina.github.io/redis-learning-guide/index.html"><meta property="og:site_name" content="SuoL&#39;s Blog"><meta property="og:description" content="å…¨é¢å­¦ä¹ Redisä¸­é—´ä»¶ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°å®æˆ˜åº”ç”¨ï¼ŒæŒæ¡ç¼“å­˜ã€åˆ†å¸ƒå¼é”ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æ ¸å¿ƒåŠŸèƒ½"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://suochina.github.io/images/redis/cover.png"><meta property="article:published_time" content="2025-11-09T15:30:00.000Z"><meta property="article:modified_time" content="2025-11-09T15:30:00.000Z"><meta property="article:author" content="SuoL"><meta property="article:tag" content="Redis"><meta property="article:tag" content="ä¸­é—´ä»¶"><meta property="article:tag" content="ç¼“å­˜"><meta property="article:tag" content="NoSQL"><meta property="article:tag" content="æ•°æ®åº“"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://suochina.github.io/images/redis/cover.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜",
  "url": "https://suochina.github.io/redis-learning-guide/",
  "image": "https://suochina.github.io/images/redis/cover.png",
  "datePublished": "2025-11-09T15:30:00.000Z",
  "dateModified": "2025-11-09T15:30:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "SuoL",
      "url": "https://suochina.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://suochina.github.io/redis-learning-guide/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>(()=>{const e={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:e,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const t=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},o=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=t,btf.activateLightMode=o;const a=e.get("theme");"dark"===a?t():"light"===a&&o();const n=e.get("aside-status");void 0!==n&&document.documentElement.classList.toggle("hide-aside","hide"===n);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;family=JetBrains+Mono:wght@400;500;600&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:1,unescape:!1,pagination:{enable:!1,hitsPerPage:8},languages:{hits_empty:"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}",hits_stats:"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!1,highlightMacStyle:!0},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶å¤±è´¥",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!0,post:!0},runtime:"å¤©",dateSuffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:void 0,lightbox:"null",Snackbar:void 0,infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js",buttonText:"åŠ è½½æ›´å¤š"},isPhotoFigcaption:!1,islazyloadPlugin:!0,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><style>.post-content{line-height:1.8;font-size:16px;font-family:"PingFang SC","Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei","Helvetica Neue",Arial,sans-serif;font-weight:400;color:#2c3e50}.post-content p{margin-bottom:1.2em;text-align:justify}.post-content ol,.post-content ul{margin-bottom:1.2em;padding-left:1.5em}.post-content li{margin-bottom:.5em;line-height:1.7}.post-content h1,.post-content h2,.post-content h3,.post-content h4,.post-content h5,.post-content h6{margin-top:2rem;margin-bottom:1rem;font-weight:600;line-height:1.4}.post-content pre{border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1);font-family:"JetBrains Mono","Fira Code",Consolas,Monaco,"Courier New",monospace;font-size:14px;line-height:1.6}.post-content code{font-family:"JetBrains Mono","Fira Code",Consolas,Monaco,"Courier New",monospace}.click-effect{position:fixed;pointer-events:none;z-index:9999;font-size:14px;color:#49b1f5;font-weight:700;animation:clickEffect 1s ease-out forwards;user-select:none}@keyframes clickEffect{0%{opacity:1;transform:scale(.8) translateY(0)}50%{opacity:.8;transform:scale(1.2) translateY(-20px)}100%{opacity:0;transform:scale(1) translateY(-40px)}}.ripple{position:absolute;border-radius:50%;background:rgba(73,177,245,.3);transform:scale(0);animation:ripple .6s linear;pointer-events:none}@keyframes ripple{to{transform:scale(4);opacity:0}}.post-content blockquote{border-left:4px solid #49b1f5;background:#f8f9fa;padding:1rem 1.5rem;margin:1.5rem 0;border-radius:0 8px 8px 0}.post-content table{border-collapse:collapse;width:100%;margin:1.5rem 0;box-shadow:0 2px 8px rgba(0,0,0,.1);border-radius:8px;overflow:hidden}.post-content td,.post-content th{padding:12px 16px;text-align:left;border-bottom:1px solid #e9ecef}.post-content th{background-color:#f8f9fa;font-weight:600}.post-content ol,.post-content ul{padding-left:2rem;margin:1rem 0}.post-content li{margin:.5rem 0;line-height:1.6}.post-content a{color:#49b1f5;text-decoration:none;border-bottom:1px solid transparent;transition:all .3s ease}.post-content a:hover{border-bottom-color:#49b1f5}.post-meta .post-meta-date{display:flex;flex-direction:column;gap:4px}.post-meta .post-meta-date .post-meta-date-created,.post-meta .post-meta-date .post-meta-date-updated{display:flex;align-items:center;gap:8px}.post-meta .post-meta-date .post-meta-date-updated{color:#666;font-size:.9em}.post-meta .post-meta-date .post-meta-date-updated::before{content:"ğŸ“… "}.recent-post-item .post-meta .post-meta-date{margin-bottom:8px}.recent-post-item .post-meta .post-meta-date .post-meta-date-updated{color:#999;font-size:.85em}.avatar-img{transition:transform .3s ease}.avatar-img:hover{transform:rotate(360deg)}</style><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="SuoL's Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/my_cat.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">32</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/%E5%8F%8B%E9%93%BE/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/%E5%85%B3%E4%BA%8E%E6%88%91/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/images/redis/cover.png)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">SuoL's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/%E5%8F%8B%E9%93%BE/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/%E5%85%B3%E4%BA%8E%E6%88%91/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-11-09T15:30:00.000Z" title="å‘è¡¨äº 2025-11-09 23:30:00">2025-11-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-11-09T15:30:00.000Z" title="æ›´æ–°äº 2025-11-09 23:30:00">2025-11-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java%E6%8A%80%E6%9C%AF/">JavaæŠ€æœ¯</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">39.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>160åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å—-ä»å…¥é—¨åˆ°å®æˆ˜-ğŸš€"><a href="#Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å—-ä»å…¥é—¨åˆ°å®æˆ˜-ğŸš€" class="headerlink" title="Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜ ğŸš€"></a>Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜ ğŸš€</h1><blockquote><p>Redisï¼ˆRemote Dictionary Serverï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„ã€åŸºäºå†…å­˜çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚æœ¬æŒ‡å—å°†å¸¦ä½ å…¨é¢å­¦ä¹ Redisï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°å®æˆ˜åº”ç”¨ï¼ŒæŒæ¡è¿™ä¸ªå¼ºå¤§çš„ä¸­é—´ä»¶ï¼ğŸ’¾</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/cover.png" alt="Rediså­¦ä¹ æŒ‡å—"></p><h2 id="ğŸ“‹-ç›®å½•"><a href="#ğŸ“‹-ç›®å½•" class="headerlink" title="ğŸ“‹ ç›®å½•"></a>ğŸ“‹ ç›®å½•</h2><ul><li><p><a href="#1-redis%E7%AE%80%E4%BB%8B">1. Redisç®€ä»‹</a></p><ul><li><a href="#11-%E4%BB%80%E4%B9%88%E6%98%AFredis">1.1 ä»€ä¹ˆæ˜¯Redis</a></li><li><a href="#12-redis%E7%9A%84%E7%89%B9%E7%82%B9">1.2 Redisçš„ç‰¹ç‚¹</a></li><li><a href="#13-redis%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">1.3 Redisçš„åº”ç”¨åœºæ™¯</a></li><li><a href="#14-redis-vs-%E5%85%B6%E4%BB%96%E7%BC%93%E5%AD%98">1.4 Redis vs å…¶ä»–ç¼“å­˜</a></li></ul></li><li><p><a href="#2-redis%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE">2. Rediså®‰è£…ä¸é…ç½®</a></p><ul><li><a href="#21-linux%E5%AE%89%E8%A3%85">2.1 Linuxå®‰è£…</a></li><li><a href="#22-%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE">2.2 åŸºç¡€é…ç½®</a></li></ul></li><li><p><a href="#3-redis%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">3. RedisåŸºç¡€æ•°æ®ç±»å‹</a></p><ul><li><a href="#31-redis%E9%94%AEkey%E9%80%9A%E7%94%A8%E5%91%BD%E4%BB%A4">3.1 Redisé”®(key)é€šç”¨å‘½ä»¤</a></li><li><a href="#32-string%E5%AD%97%E7%AC%A6%E4%B8%B2">3.2 Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</a></li><li><a href="#33-hash%E5%93%88%E5%B8%8C">3.3 Hashï¼ˆå“ˆå¸Œï¼‰</a></li><li><a href="#34-list%E5%88%97%E8%A1%A8">3.4 Listï¼ˆåˆ—è¡¨ï¼‰</a></li><li><a href="#35-set%E9%9B%86%E5%90%88">3.5 Setï¼ˆé›†åˆï¼‰</a></li><li><a href="#36-zset%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88">3.6 ZSetï¼ˆæœ‰åºé›†åˆï¼‰</a></li></ul></li><li><p><a href="#4-redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3">4. Redisé…ç½®æ–‡ä»¶è¯¦è§£</a></p><ul><li><a href="#41-units%E5%8D%95%E4%BD%8D">4.1 Unitsï¼ˆå•ä½ï¼‰</a></li><li><a href="#42-includes%E5%8C%85%E5%90%AB">4.2 INCLUDESï¼ˆåŒ…å«ï¼‰</a></li><li><a href="#43-network%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE">4.3 NETWORKï¼ˆç½‘ç»œé…ç½®ï¼‰</a></li><li><a href="#44-general%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE">4.4 GENERALï¼ˆé€šç”¨é…ç½®ï¼‰</a></li><li><a href="#45-security%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE">4.5 SECURITYï¼ˆå®‰å…¨é…ç½®ï¼‰</a></li><li><a href="#46-limits%E9%99%90%E5%88%B6%E9%85%8D%E7%BD%AE">4.6 LIMITSï¼ˆé™åˆ¶é…ç½®ï¼‰</a></li></ul></li><li><p><a href="#5-redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85pubsub">5. Rediså‘å¸ƒè®¢é˜…ï¼ˆPub&#x2F;Subï¼‰</a></p><ul><li><a href="#51-%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85">5.1 ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…</a></li><li><a href="#52-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F">5.2 å‘å¸ƒè®¢é˜…æ¨¡å¼</a></li><li><a href="#53-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">5.3 å¸¸ç”¨å‘½ä»¤</a></li><li><a href="#54-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">5.4 ä½¿ç”¨ç¤ºä¾‹</a></li><li><a href="#55-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">5.5 åº”ç”¨åœºæ™¯</a></li><li><a href="#56-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">5.6 æ³¨æ„äº‹é¡¹</a></li><li><a href="#57-%E5%AF%B9%E6%AF%94%E5%85%B6%E4%BB%96%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6">5.7 å¯¹æ¯”å…¶ä»–æ¶ˆæ¯æœºåˆ¶</a></li><li><a href="#58-%E5%AE%9E%E6%88%98%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8Bjava">5.8 å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰</a></li></ul></li><li><p><a href="#6-redis%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">6. Redisé«˜çº§æ•°æ®ç±»å‹</a></p><ul><li><a href="#61-bitmap%E4%BD%8D%E5%9B%BE">6.1 Bitmapï¼ˆä½å›¾ï¼‰</a></li><li><a href="#62-hyperloglog%E5%9F%BA%E6%95%B0%E7%BB%9F%E8%AE%A1">6.2 HyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰</a></li><li><a href="#63-geo%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE">6.3 GEOï¼ˆåœ°ç†ä½ç½®ï¼‰</a></li><li><a href="#64-stream%E6%B5%81">6.4 Streamï¼ˆæµï¼‰</a></li></ul></li><li><p><a href="#7-redis%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81%E6%9C%BA%E5%88%B6">7. Redisäº‹åŠ¡ä¸é”æœºåˆ¶</a></p><ul><li><a href="#71-%E4%BB%80%E4%B9%88%E6%98%AFredis%E4%BA%8B%E5%8A%A1">7.1 ä»€ä¹ˆæ˜¯Redisäº‹åŠ¡</a></li><li><a href="#72-redis%E4%BA%8B%E5%8A%A1%E5%91%BD%E4%BB%A4">7.2 Redisäº‹åŠ¡å‘½ä»¤</a></li><li><a href="#73-redis%E4%BA%8B%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B">7.3 Redisäº‹åŠ¡æ‰§è¡Œæµç¨‹</a></li><li><a href="#74-%E4%BA%8B%E5%8A%A1%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">7.4 äº‹åŠ¡é”™è¯¯å¤„ç†</a></li><li><a href="#75-%E4%BA%8B%E5%8A%A1%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">7.5 äº‹åŠ¡å†²çªé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</a></li><li><a href="#76-redis%E4%BA%8B%E5%8A%A1%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7">7.6 Redisäº‹åŠ¡ä¸‰å¤§ç‰¹æ€§</a></li><li><a href="#77-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8Bredis%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F">7.7 å®æˆ˜æ¡ˆä¾‹ï¼šRedisç§’æ€ç³»ç»Ÿ</a></li><li><a href="#78-redis%E4%BA%8B%E5%8A%A1%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">7.8 Redisäº‹åŠ¡æœ€ä½³å®è·µ</a></li><li><a href="#79-%E6%80%BB%E7%BB%93">7.9 æ€»ç»“</a></li></ul></li><li><p><a href="#8-redis%E6%8C%81%E4%B9%85%E5%8C%96">8. RedisæŒä¹…åŒ–</a></p><ul><li><a href="#81-%E4%BB%80%E4%B9%88%E6%98%AF%E6%8C%81%E4%B9%85%E5%8C%96">8.1 ä»€ä¹ˆæ˜¯æŒä¹…åŒ–</a></li><li><a href="#82-rdb%E6%8C%81%E4%B9%85%E5%8C%96">8.2 RDBæŒä¹…åŒ–</a><ul><li><a href="#821-%E4%BB%80%E4%B9%88%E6%98%AFrdb">8.2.1 ä»€ä¹ˆæ˜¯RDB</a></li><li><a href="#822-rdb%E6%8C%81%E4%B9%85%E5%8C%96%E6%B5%81%E7%A8%8B">8.2.2 RDBæŒä¹…åŒ–æµç¨‹</a></li><li><a href="#823-fork%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3">8.2.3 Forkæœºåˆ¶è¯¦è§£</a></li><li><a href="#824-rdb%E8%A7%A6%E5%8F%91%E6%96%B9%E5%BC%8F">8.2.4 RDBè§¦å‘æ–¹å¼</a></li><li><a href="#825-rdb%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3">8.2.5 RDBé…ç½®è¯¦è§£</a></li><li><a href="#826-rdb%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D">8.2.6 RDBå¤‡ä»½ä¸æ¢å¤</a></li><li><a href="#827-rdb%E4%BC%98%E7%BC%BA%E7%82%B9%E5%88%86%E6%9E%90">8.2.7 RDBä¼˜ç¼ºç‚¹åˆ†æ</a></li><li><a href="#828-%E5%8A%A8%E6%80%81%E5%81%9C%E6%AD%A2rdb">8.2.8 åŠ¨æ€åœæ­¢RDB</a></li></ul></li><li><a href="#83-aof%E6%8C%81%E4%B9%85%E5%8C%96">8.3 AOFæŒä¹…åŒ–</a><ul><li><a href="#831-%E4%BB%80%E4%B9%88%E6%98%AFaof">8.3.1 ä»€ä¹ˆæ˜¯AOF</a></li><li><a href="#832-aof%E6%8C%81%E4%B9%85%E5%8C%96%E6%B5%81%E7%A8%8B">8.3.2 AOFæŒä¹…åŒ–æµç¨‹</a></li><li><a href="#833-aof%E9%85%8D%E7%BD%AE">8.3.3 AOFé…ç½®</a></li><li><a href="#834-aof%E9%87%8D%E5%86%99rewrite">8.3.4 AOFé‡å†™ï¼ˆRewriteï¼‰</a></li><li><a href="#835-aof%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D">8.3.5 AOFå¤‡ä»½ä¸æ¢å¤</a></li><li><a href="#836-aof%E4%BC%98%E7%BC%BA%E7%82%B9%E5%88%86%E6%9E%90">8.3.6 AOFä¼˜ç¼ºç‚¹åˆ†æ</a></li></ul></li><li><a href="#84-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96redis-40">8.4 æ··åˆæŒä¹…åŒ–ï¼ˆRedis 4.0+ï¼‰</a><ul><li><a href="#841-%E4%BB%80%E4%B9%88%E6%98%AF%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96">8.4.1 ä»€ä¹ˆæ˜¯æ··åˆæŒä¹…åŒ–</a></li><li><a href="#842-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE">8.4.2 æ··åˆæŒä¹…åŒ–é…ç½®</a></li><li><a href="#843-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">8.4.3 æ··åˆæŒä¹…åŒ–å·¥ä½œæµç¨‹</a></li><li><a href="#844-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E4%BC%98%E5%8A%BF">8.4.4 æ··åˆæŒä¹…åŒ–ä¼˜åŠ¿</a></li></ul></li><li><a href="#85-%E6%8C%81%E4%B9%85%E5%8C%96%E7%AD%96%E7%95%A5%E9%80%89%E6%8B%A9">8.5 æŒä¹…åŒ–ç­–ç•¥é€‰æ‹©</a><ul><li><a href="#851-rdb-vs-aof-vs-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96">8.5.1 RDB vs AOF vs æ··åˆæŒä¹…åŒ–</a></li><li><a href="#852-%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE">8.5.2 é€‰æ‹©å»ºè®®</a></li><li><a href="#853-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%8E%A8%E8%8D%90%E9%85%8D%E7%BD%AE">8.5.3 ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®</a></li><li><a href="#854-%E6%8C%81%E4%B9%85%E5%8C%96%E7%9B%91%E6%8E%A7">8.5.4 æŒä¹…åŒ–ç›‘æ§</a></li><li><a href="#855-%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">8.5.5 æŒä¹…åŒ–æœ€ä½³å®è·µ</a></li></ul></li><li><a href="#86-%E6%80%BB%E7%BB%93">8.6 æ€»ç»“</a></li></ul></li><li><p><a href="#9-redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6">9. Redisä¸»ä»å¤åˆ¶</a></p><ul><li><a href="#91-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86">9.1 ä¸»ä»å¤åˆ¶åŸç†</a></li><li><a href="#92-%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6">9.2 é…ç½®ä¸»ä»å¤åˆ¶</a></li><li><a href="#93-%E5%85%A8%E9%87%8F%E5%A4%8D%E5%88%B6%E4%B8%8E%E5%A2%9E%E9%87%8F%E5%A4%8D%E5%88%B6">9.3 å…¨é‡å¤åˆ¶ä¸å¢é‡å¤åˆ¶</a></li><li><a href="#94-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">9.4 ä¸»ä»å¤åˆ¶æ³¨æ„äº‹é¡¹</a></li></ul></li><li><p><a href="#10-redis%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F">10. Rediså“¨å…µæ¨¡å¼</a></p><ul><li><a href="#101-%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D">10.1 å“¨å…µæ¨¡å¼ä»‹ç»</a></li><li><a href="#102-%E5%93%A8%E5%85%B5%E9%85%8D%E7%BD%AE">10.2 å“¨å…µé…ç½®</a></li><li><a href="#103-%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB">10.3 æ•…éšœè½¬ç§»</a></li><li><a href="#104-%E5%93%A8%E5%85%B5%E9%9B%86%E7%BE%A4">10.4 å“¨å…µé›†ç¾¤</a></li></ul></li><li><p><a href="#11-redis%E9%9B%86%E7%BE%A4">11. Redisé›†ç¾¤</a></p><ul><li><a href="#111-%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84">11.1 é›†ç¾¤æ¶æ„</a></li><li><a href="#112-%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87">11.2 æ•°æ®åˆ†ç‰‡</a></li><li><a href="#113-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA">11.3 é›†ç¾¤æ­å»º</a></li><li><a href="#114-%E9%9B%86%E7%BE%A4%E6%89%A9%E5%AE%B9%E4%B8%8E%E7%BC%A9%E5%AE%B9">11.4 é›†ç¾¤æ‰©å®¹ä¸ç¼©å®¹</a></li></ul></li><li><p><a href="#12-redis%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8">12. Rediså®æˆ˜åº”ç”¨</a></p><ul><li><a href="#121-%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1">12.1 ç¼“å­˜è®¾è®¡</a></li><li><a href="#122-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">12.2 åˆ†å¸ƒå¼é”</a></li><li><a href="#123-%E5%BB%B6%E6%97%B6%E9%98%9F%E5%88%97">12.3 å»¶æ—¶é˜Ÿåˆ—</a></li><li><a href="#124-%E6%8E%92%E8%A1%8C%E6%A6%9C">12.4 æ’è¡Œæ¦œ</a></li><li><a href="#125-%E9%99%90%E6%B5%81">12.5 é™æµ</a></li></ul></li><li><p><a href="#13-redis%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">13. Redisæ€§èƒ½ä¼˜åŒ–</a></p><ul><li><a href="#131-%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96">13.1 å†…å­˜ä¼˜åŒ–</a></li><li><a href="#132-%E5%91%BD%E4%BB%A4%E4%BC%98%E5%8C%96">13.2 å‘½ä»¤ä¼˜åŒ–</a></li><li><a href="#133-%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96">13.3 ç½‘ç»œä¼˜åŒ–</a></li><li><a href="#134-%E6%85%A2%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90">13.4 æ…¢æŸ¥è¯¢åˆ†æ</a></li></ul></li><li><p><a href="#14-redis%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">14. Rediså¸¸è§é—®é¢˜</a></p><ul><li><a href="#141-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F">14.1 ç¼“å­˜ç©¿é€</a></li><li><a href="#142-%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF">14.2 ç¼“å­˜å‡»ç©¿</a></li><li><a href="#143-%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9">14.3 ç¼“å­˜é›ªå´©</a></li><li><a href="#144-%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7">14.4 æ•°æ®ä¸€è‡´æ€§</a></li></ul></li><li><p><a href="#15-java%E6%95%B4%E5%90%88redis">15. Javaæ•´åˆRedis</a></p><ul><li><a href="#151-jedis%E5%AE%A2%E6%88%B7%E7%AB%AF">15.1 Jediså®¢æˆ·ç«¯</a></li><li><a href="#152-lettuce%E5%AE%A2%E6%88%B7%E7%AB%AF">15.2 Lettuceå®¢æˆ·ç«¯</a></li><li><a href="#153-spring-data-redis">15.3 Spring Data Redis</a></li><li><a href="#154-redistemplate%E4%BD%BF%E7%94%A8">15.4 RedisTemplateä½¿ç”¨</a></li></ul></li></ul><hr><h2 id="1-Redisç®€ä»‹"><a href="#1-Redisç®€ä»‹" class="headerlink" title="1. Redisç®€ä»‹"></a>1. Redisç®€ä»‹</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯Redis"><a href="#1-1-ä»€ä¹ˆæ˜¯Redis" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯Redis"></a>1.1 ä»€ä¹ˆæ˜¯Redis</h3><p>Redisï¼ˆRemote Dictionary Serverï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„ã€åŸºäºå†…å­˜çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿã€‚<br>Redisæ˜¯ä¸€ä¸ªå¼€æºçš„key-valueå­˜å‚¨ç³»ç»Ÿã€‚<br>å’ŒMemcachedç±»ä¼¼ï¼Œå®ƒæ”¯æŒå­˜å‚¨çš„valueç±»å‹ç›¸å¯¹æ›´å¤šï¼ŒåŒ…æ‹¬string(å­—ç¬¦ä¸²)ã€list(é“¾è¡¨)ã€set(é›†åˆ)ã€zset(sorted set â€“æœ‰åºé›†åˆ)å’Œhashï¼ˆå“ˆå¸Œç±»å‹ï¼‰ã€‚<br>è¿™äº›æ•°æ®ç±»å‹éƒ½æ”¯æŒpush&#x2F;popã€add&#x2F;removeåŠå–äº¤é›†å¹¶é›†å’Œå·®é›†åŠæ›´ä¸°å¯Œçš„æ“ä½œï¼Œè€Œä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚<br>æ­¤åŸºç¡€ä¸Šï¼ŒRedisæ”¯æŒå„ç§ä¸åŒæ–¹å¼çš„æ’åºã€‚<br>ä¸memcachedä¸€æ ·ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œæ•°æ®éƒ½æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚<br>åŒºåˆ«çš„æ˜¯Redisä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ã€‚<br>å¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº†master-slave(ä¸»ä»)åŒæ­¥ã€‚</p><p><strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p><ul><li>åŸºäºå†…å­˜è¿è¡Œï¼Œè¯»å†™é€Ÿåº¦æå¿«</li><li>æ”¯æŒå¤šç§æ•°æ®ç»“æ„</li><li>æ”¯æŒæ•°æ®æŒä¹…åŒ–</li><li>æ”¯æŒä¸»ä»å¤åˆ¶å’Œé›†ç¾¤</li></ul><h3 id="1-2-Redisçš„ç‰¹ç‚¹"><a href="#1-2-Redisçš„ç‰¹ç‚¹" class="headerlink" title="1.2 Redisçš„ç‰¹ç‚¹"></a>1.2 Redisçš„ç‰¹ç‚¹</h3><h4 id="æ€§èƒ½ä¼˜åŠ¿"><a href="#æ€§èƒ½ä¼˜åŠ¿" class="headerlink" title="æ€§èƒ½ä¼˜åŠ¿"></a>æ€§èƒ½ä¼˜åŠ¿</h4><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>é«˜æ€§èƒ½</strong></td><td>åŸºäºå†…å­˜ï¼Œè¯»å†™é€Ÿåº¦å¯è¾¾10ä¸‡+QPS</td></tr><tr><td><strong>ä¸°å¯Œçš„æ•°æ®ç±»å‹</strong></td><td>Stringã€Hashã€Listã€Setã€ZSetç­‰</td></tr><tr><td><strong>åŸå­æ€§æ“ä½œ</strong></td><td>æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„</td></tr><tr><td><strong>æŒä¹…åŒ–</strong></td><td>æ”¯æŒRDBå’ŒAOFä¸¤ç§æŒä¹…åŒ–æ–¹å¼</td></tr><tr><td><strong>é«˜å¯ç”¨</strong></td><td>æ”¯æŒä¸»ä»å¤åˆ¶ã€å“¨å…µã€é›†ç¾¤</td></tr></tbody></table><h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>å¾…è¡¥å……â€¦</p><h3 id="1-3-Redisçš„åº”ç”¨åœºæ™¯"><a href="#1-3-Redisçš„åº”ç”¨åœºæ™¯" class="headerlink" title="1.3 Redisçš„åº”ç”¨åœºæ™¯"></a>1.3 Redisçš„åº”ç”¨åœºæ™¯</h3><h4 id="å¸¸è§åº”ç”¨åœºæ™¯"><a href="#å¸¸è§åº”ç”¨åœºæ™¯" class="headerlink" title="å¸¸è§åº”ç”¨åœºæ™¯"></a>å¸¸è§åº”ç”¨åœºæ™¯</h4><ol><li><strong>ç¼“å­˜</strong>ï¼šæœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯</li><li><strong>åˆ†å¸ƒå¼é”</strong>ï¼šè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¹¶å‘é—®é¢˜</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šå‘å¸ƒè®¢é˜…ã€å»¶æ—¶é˜Ÿåˆ—</li><li><strong>æ’è¡Œæ¦œ</strong>ï¼šåˆ©ç”¨ZSetå®ç°</li><li><strong>è®¡æ•°å™¨</strong>ï¼šç½‘ç«™è®¿é—®é‡ã€ç‚¹èµæ•°ç­‰</li><li><strong>Sessionå…±äº«</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„sessionå­˜å‚¨</li></ol><h3 id="1-4-Redis-vs-å…¶ä»–ç¼“å­˜"><a href="#1-4-Redis-vs-å…¶ä»–ç¼“å­˜" class="headerlink" title="1.4 Redis vs å…¶ä»–ç¼“å­˜"></a>1.4 Redis vs å…¶ä»–ç¼“å­˜</h3><h4 id="Redis-vs-Memcached"><a href="#Redis-vs-Memcached" class="headerlink" title="Redis vs Memcached"></a>Redis vs Memcached</h4><table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>Redis</th><th>Memcached</th></tr></thead><tbody><tr><td><strong>æ•°æ®ç±»å‹</strong></td><td>æ”¯æŒStringã€Hashã€Listã€Setã€ZSetç­‰å¤šç§æ•°æ®ç»“æ„</td><td>ä»…æ”¯æŒç®€å•çš„key-valueå­—ç¬¦ä¸²</td></tr><tr><td><strong>æŒä¹…åŒ–</strong></td><td>æ”¯æŒRDBå’ŒAOFæŒä¹…åŒ–</td><td>ä¸æ”¯æŒæŒä¹…åŒ–ï¼Œæ•°æ®ä»…å­˜åœ¨äºå†…å­˜</td></tr><tr><td><strong>å†…å­˜ç®¡ç†</strong></td><td>è‡ªå·±å®ç°å†…å­˜æ± ï¼Œå¯ä»¥è®¾ç½®è¿‡æœŸç­–ç•¥</td><td>ä½¿ç”¨Slab Allocationæœºåˆ¶</td></tr><tr><td><strong>çº¿ç¨‹æ¨¡å‹</strong></td><td>å•çº¿ç¨‹ï¼ˆ6.0åæ”¯æŒå¤šçº¿ç¨‹IOï¼‰</td><td>å¤šçº¿ç¨‹</td></tr><tr><td><strong>é›†ç¾¤æ”¯æŒ</strong></td><td>åŸç”Ÿæ”¯æŒé›†ç¾¤</td><td>éœ€è¦å®¢æˆ·ç«¯å®ç°åˆ†ç‰‡</td></tr><tr><td><strong>æ•°æ®å¤‡ä»½</strong></td><td>æ”¯æŒä¸»ä»å¤åˆ¶</td><td>ä¸æ”¯æŒ</td></tr><tr><td><strong>åº”ç”¨åœºæ™¯</strong></td><td>ç¼“å­˜ã€é˜Ÿåˆ—ã€æ’è¡Œæ¦œã€åˆ†å¸ƒå¼é”ç­‰</td><td>çº¯ç¼“å­˜åœºæ™¯</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>å•æ ¸æ€§èƒ½æé«˜ï¼ˆ10ä¸‡+QPSï¼‰</td><td>å¤šæ ¸æ€§èƒ½æ›´å¥½</td></tr><tr><td><strong>å†…å­˜åˆ©ç”¨ç‡</strong></td><td>è¾ƒé«˜ï¼ˆå‹ç¼©åˆ—è¡¨ç­‰ä¼˜åŒ–ï¼‰</td><td>è¾ƒä½ï¼ˆå›ºå®šchunkå¤§å°ï¼‰</td></tr></tbody></table><p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p><ul><li>éœ€è¦æŒä¹…åŒ–ã€å¤æ‚æ•°æ®ç»“æ„ã€åˆ†å¸ƒå¼é”ç­‰åœºæ™¯ â†’ <strong>Redis</strong></li><li>çº¯ç²¹çš„ç®€å•ç¼“å­˜ï¼Œè¿½æ±‚æè‡´å¤šæ ¸æ€§èƒ½ â†’ <strong>Memcached</strong></li></ul><h4 id="Redis-vs-Ehcache"><a href="#Redis-vs-Ehcache" class="headerlink" title="Redis vs Ehcache"></a>Redis vs Ehcache</h4><table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>Redis</th><th>Ehcache</th></tr></thead><tbody><tr><td><strong>éƒ¨ç½²æ–¹å¼</strong></td><td>ç‹¬ç«‹æœåŠ¡ï¼Œæ”¯æŒåˆ†å¸ƒå¼</td><td>åµŒå…¥å¼ï¼Œä¸åº”ç”¨åŒè¿›ç¨‹</td></tr><tr><td><strong>æ•°æ®å…±äº«</strong></td><td>å¯è·¨åº”ç”¨å…±äº«æ•°æ®</td><td>ä»…é™å½“å‰åº”ç”¨ä½¿ç”¨</td></tr><tr><td><strong>è¯­è¨€æ”¯æŒ</strong></td><td>æ”¯æŒå¤šç§è¯­è¨€å®¢æˆ·ç«¯</td><td>ä¸»è¦ç”¨äºJavaåº”ç”¨</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>ç½‘ç»œIOå¼€é”€ï¼Œä½†å¯åˆ†å¸ƒå¼</td><td>æœ¬åœ°ç¼“å­˜ï¼Œé€Ÿåº¦æœ€å¿«</td></tr><tr><td><strong>å®¹é‡é™åˆ¶</strong></td><td>å—æœåŠ¡å™¨å†…å­˜é™åˆ¶ï¼Œå¯æ‰©å±•</td><td>å—JVMå †å†…å­˜é™åˆ¶</td></tr><tr><td><strong>æŒä¹…åŒ–</strong></td><td>æ”¯æŒRDBå’ŒAOF</td><td>æ”¯æŒç£ç›˜å­˜å‚¨ï¼ˆå¯é€‰ï¼‰</td></tr><tr><td><strong>é›†ç¾¤</strong></td><td>åŸç”Ÿæ”¯æŒé›†ç¾¤</td><td>æ”¯æŒTerracottaé›†ç¾¤</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>åˆ†å¸ƒå¼ç³»ç»Ÿã€å¤§æ•°æ®é‡ç¼“å­˜</td><td>å•æœºåº”ç”¨ã€å°æ•°æ®é‡ç¼“å­˜</td></tr></tbody></table><p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p><ul><li>åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œéœ€è¦è·¨åº”ç”¨å…±äº«æ•°æ® â†’ <strong>Redis</strong></li><li>å•æœºJavaåº”ç”¨ï¼Œè¿½æ±‚æè‡´æœ¬åœ°ç¼“å­˜æ€§èƒ½ â†’ <strong>Ehcache</strong></li><li>ä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ï¼šEhcacheä½œä¸ºä¸€çº§ç¼“å­˜ï¼ˆæœ¬åœ°ï¼‰ï¼ŒRedisä½œä¸ºäºŒçº§ç¼“å­˜ï¼ˆåˆ†å¸ƒå¼ï¼‰</li></ul><h4 id="å…¶ä»–ç¼“å­˜æ–¹æ¡ˆå¯¹æ¯”"><a href="#å…¶ä»–ç¼“å­˜æ–¹æ¡ˆå¯¹æ¯”" class="headerlink" title="å…¶ä»–ç¼“å­˜æ–¹æ¡ˆå¯¹æ¯”"></a>å…¶ä»–ç¼“å­˜æ–¹æ¡ˆå¯¹æ¯”</h4><table><thead><tr><th>ç¼“å­˜æ–¹æ¡ˆ</th><th>ç‰¹ç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Redis</strong></td><td>åŠŸèƒ½ä¸°å¯Œã€æ”¯æŒæŒä¹…åŒ–ã€é«˜å¯ç”¨</td><td>é€šç”¨åˆ†å¸ƒå¼ç¼“å­˜ï¼ŒåŠŸèƒ½éœ€æ±‚å¤š</td></tr><tr><td><strong>Memcached</strong></td><td>ç®€å•é«˜æ•ˆã€å¤šçº¿ç¨‹</td><td>çº¯ç¼“å­˜åœºæ™¯ï¼Œå¤§è§„æ¨¡ç®€å•æ•°æ®</td></tr><tr><td><strong>Ehcache</strong></td><td>è¿›ç¨‹å†…ç¼“å­˜ã€é›¶ç½‘ç»œå¼€é”€</td><td>Javaå•æœºåº”ç”¨</td></tr><tr><td><strong>Caffeine</strong></td><td>é«˜æ€§èƒ½æœ¬åœ°ç¼“å­˜ã€ç°ä»£åŒ–API</td><td>Javaåº”ç”¨æœ¬åœ°ç¼“å­˜ï¼ˆæ¨èï¼‰</td></tr><tr><td><strong>Guava Cache</strong></td><td>Googleå¼€æºã€ä½¿ç”¨ç®€å•</td><td>è½»é‡çº§æœ¬åœ°ç¼“å­˜</td></tr><tr><td><strong>Hazelcast</strong></td><td>åˆ†å¸ƒå¼å†…å­˜æ•°æ®ç½‘æ ¼</td><td>å¤§è§„æ¨¡åˆ†å¸ƒå¼è®¡ç®—</td></tr></tbody></table><h4 id="å¤šçº§ç¼“å­˜æ¶æ„"><a href="#å¤šçº§ç¼“å­˜æ¶æ„" class="headerlink" title="å¤šçº§ç¼“å­˜æ¶æ„"></a>å¤šçº§ç¼“å­˜æ¶æ„</h4><p>å®é™…é¡¹ç›®ä¸­ï¼Œé€šå¸¸é‡‡ç”¨<strong>å¤šçº§ç¼“å­˜</strong>ç­–ç•¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å®¢æˆ·ç«¯è¯·æ±‚</span><br><span class="line">    â†“</span><br><span class="line">[è¿›ç¨‹å†…ç¼“å­˜] (Caffeine/Ehcache)</span><br><span class="line">    â†“ æœªå‘½ä¸­</span><br><span class="line">[åˆ†å¸ƒå¼ç¼“å­˜] (Redis)</span><br><span class="line">    â†“ æœªå‘½ä¸­</span><br><span class="line">[æ•°æ®åº“] (MySQL)</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li><strong>L1ç¼“å­˜ï¼ˆæœ¬åœ°ï¼‰</strong>ï¼šé€Ÿåº¦æœ€å¿«ï¼Œæ— ç½‘ç»œå¼€é”€</li><li><strong>L2ç¼“å­˜ï¼ˆRedisï¼‰</strong>ï¼šè·¨åº”ç”¨å…±äº«ï¼Œå®¹é‡æ›´å¤§</li><li><strong>L3å­˜å‚¨ï¼ˆDBï¼‰</strong>ï¼šæŒä¹…åŒ–æ•°æ®ï¼Œæœ€ç»ˆæ•°æ®æº</li></ul><hr><h2 id="2-Rediså®‰è£…ä¸é…ç½®"><a href="#2-Rediså®‰è£…ä¸é…ç½®" class="headerlink" title="2. Rediså®‰è£…ä¸é…ç½®"></a>2. Rediså®‰è£…ä¸é…ç½®</h2><h3 id="2-1-Linuxå®‰è£…"><a href="#2-1-Linuxå®‰è£…" class="headerlink" title="2.1 Linuxå®‰è£…"></a>2.1 Linuxå®‰è£…</h3><h4 id="æ­¥éª¤1ï¼šå®‰è£…GCCç¼–è¯‘å™¨"><a href="#æ­¥éª¤1ï¼šå®‰è£…GCCç¼–è¯‘å™¨" class="headerlink" title="æ­¥éª¤1ï¼šå®‰è£…GCCç¼–è¯‘å™¨"></a>æ­¥éª¤1ï¼šå®‰è£…GCCç¼–è¯‘å™¨</h4><p>Redisæ˜¯Cè¯­è¨€å¼€å‘çš„ï¼Œéœ€è¦å…ˆå®‰è£…ç¼–è¯‘ç¯å¢ƒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…Cè¯­è¨€ç¼–è¯‘ç¯å¢ƒ</span></span><br><span class="line">yum install centos-release-scl scl-utils-build</span><br><span class="line">yum install -y devtoolset-8-toolchain</span><br><span class="line">scl <span class="built_in">enable</span> devtoolset-8 bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•gccç‰ˆæœ¬</span></span><br><span class="line">gcc --version</span><br></pre></td></tr></table></figure><p><strong>éªŒè¯ç»“æœ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@chad /]# gcc --version</span><br><span class="line">gcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-36)</span><br><span class="line">Copyright (C) 2015 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤2ï¼šä¸‹è½½å¹¶è§£å‹Redis"><a href="#æ­¥éª¤2ï¼šä¸‹è½½å¹¶è§£å‹Redis" class="headerlink" title="æ­¥éª¤2ï¼šä¸‹è½½å¹¶è§£å‹Redis"></a>æ­¥éª¤2ï¼šä¸‹è½½å¹¶è§£å‹Redis</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½Rediså®‰è£…åŒ…åˆ°/optç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">wget http://download.redis.io/releases/redis-6.2.1.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹</span></span><br><span class="line">tar -zxvf redis-6.2.1.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥è§£å‹åçš„ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> redis-6.2.1</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤3ï¼šç¼–è¯‘å®‰è£…"><a href="#æ­¥éª¤3ï¼šç¼–è¯‘å®‰è£…" class="headerlink" title="æ­¥éª¤3ï¼šç¼–è¯‘å®‰è£…"></a>æ­¥éª¤3ï¼šç¼–è¯‘å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘ï¼ˆåªæ˜¯ç¼–è¯‘ï¼Œä¸å®‰è£…ï¼‰</span></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…åˆ°é»˜è®¤ç›®å½•/usr/local/bin</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤4ï¼šæŸ¥çœ‹å®‰è£…æ–‡ä»¶"><a href="#æ­¥éª¤4ï¼šæŸ¥çœ‹å®‰è£…æ–‡ä»¶" class="headerlink" title="æ­¥éª¤4ï¼šæŸ¥çœ‹å®‰è£…æ–‡ä»¶"></a>æ­¥éª¤4ï¼šæŸ¥çœ‹å®‰è£…æ–‡ä»¶</h4><p>å®‰è£…å®Œæˆåï¼Œå¯åœ¨ <code>/usr/local/bin</code> ç›®å½•ä¸‹çœ‹åˆ°ä»¥ä¸‹å¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@chad bin]# <span class="built_in">ls</span> -l</span><br><span class="line">total 18848</span><br><span class="line">-rw-r--r--. 1 root root      92 Nov 12 08:19 dump.rdb</span><br><span class="line">-rwxr-xr-x. 1 root root 4833352 Nov 12 08:12 redis-benchmark</span><br><span class="line">lrwxrwxrwx. 1 root root      12 Nov 12 08:12 redis-check-aof -&gt; redis-server</span><br><span class="line">lrwxrwxrwx. 1 root root      12 Nov 12 08:12 redis-check-rdb -&gt; redis-server</span><br><span class="line">-rwxr-xr-x. 1 root root 5003400 Nov 12 08:12 redis-cli</span><br><span class="line">lrwxrwxrwx. 1 root root      12 Nov 12 08:12 redis-sentinel -&gt; redis-server</span><br><span class="line">-rwxr-xr-x. 1 root root 9450232 Nov 12 08:12 redis-server</span><br></pre></td></tr></table></figure><p><strong>å„æ–‡ä»¶è¯´æ˜</strong>ï¼š</p><table><thead><tr><th>æ–‡ä»¶å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>redis-server</code></td><td>RedisæœåŠ¡å™¨å¯åŠ¨ç¨‹åº</td></tr><tr><td><code>redis-cli</code></td><td>Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯</td></tr><tr><td><code>redis-benchmark</code></td><td>æ€§èƒ½æµ‹è¯•å·¥å…·</td></tr><tr><td><code>redis-check-aof</code></td><td>AOFæ–‡ä»¶ä¿®å¤å·¥å…·</td></tr><tr><td><code>redis-check-rdb</code></td><td>RDBæ–‡ä»¶ä¿®å¤å·¥å…·</td></tr><tr><td><code>redis-sentinel</code></td><td>å“¨å…µæ¨¡å¼å¯åŠ¨ç¨‹åºï¼ˆç”¨äºé›†ç¾¤ï¼‰</td></tr></tbody></table><h4 id="æ­¥éª¤5ï¼šå¯åŠ¨Redis"><a href="#æ­¥éª¤5ï¼šå¯åŠ¨Redis" class="headerlink" title="æ­¥éª¤5ï¼šå¯åŠ¨Redis"></a>æ­¥éª¤5ï¼šå¯åŠ¨Redis</h4><h5 id="æ–¹å¼1ï¼šå‰å°å¯åŠ¨ï¼ˆä¸æ¨èï¼‰"><a href="#æ–¹å¼1ï¼šå‰å°å¯åŠ¨ï¼ˆä¸æ¨èï¼‰" class="headerlink" title="æ–¹å¼1ï¼šå‰å°å¯åŠ¨ï¼ˆä¸æ¨èï¼‰"></a>æ–¹å¼1ï¼šå‰å°å¯åŠ¨ï¼ˆä¸æ¨èï¼‰</h5><p>å‰å°å¯åŠ¨ä¼šå ç”¨å½“å‰å‘½ä»¤è¡Œçª—å£ï¼Œçª—å£å…³é—­åˆ™æœåŠ¡åœæ­¢ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥å¯åŠ¨</span></span><br><span class="line">redis-server</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/image.png" alt="å‰å°å¯åŠ¨"></p><h5 id="æ–¹å¼2ï¼šåå°å¯åŠ¨ï¼ˆæ¨èï¼‰"><a href="#æ–¹å¼2ï¼šåå°å¯åŠ¨ï¼ˆæ¨èï¼‰" class="headerlink" title="æ–¹å¼2ï¼šåå°å¯åŠ¨ï¼ˆæ¨èï¼‰"></a>æ–¹å¼2ï¼šåå°å¯åŠ¨ï¼ˆæ¨èï¼‰</h5><p><strong>é…ç½®æ­¥éª¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> /myredis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å¤åˆ¶é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cp</span> /opt/redis-6.2.1/redis.conf /myredis/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">vim /myredis/redis.conf</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ° <code>daemonize</code> é…ç½®é¡¹ï¼Œä¿®æ”¹ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># å°† no æ”¹ä¸º yesï¼Œå¯ç”¨åå°è¿è¡Œ</span><br><span class="line">daemonize yes</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="é…ç½®æ–‡ä»¶ä¿®æ”¹"></p><p><strong>å¯åŠ¨æœåŠ¡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨</span></span><br><span class="line">redis-server /myredis/redis.conf</span><br></pre></td></tr></table></figure><p><strong>è¿æ¥æµ‹è¯•</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥åˆ°é»˜è®¤ç«¯å£6379</span></span><br><span class="line">redis-cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–æŒ‡å®šç«¯å£è¿æ¥</span></span><br><span class="line">redis-cli -p 6379</span><br></pre></td></tr></table></figure><p><strong>éªŒè¯è¿æ¥</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤6ï¼šå…³é—­Redis"><a href="#æ­¥éª¤6ï¼šå…³é—­Redis" class="headerlink" title="æ­¥éª¤6ï¼šå…³é—­Redis"></a>æ­¥éª¤6ï¼šå…³é—­Redis</h4><h5 id="å•å®ä¾‹å…³é—­"><a href="#å•å®ä¾‹å…³é—­" class="headerlink" title="å•å®ä¾‹å…³é—­"></a>å•å®ä¾‹å…³é—­</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1ï¼šç›´æ¥å…³é—­</span></span><br><span class="line">redis-cli shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2ï¼šè¿›å…¥å®¢æˆ·ç«¯åå…³é—­</span></span><br><span class="line">redis-cli</span><br><span class="line">127.0.0.1:6379&gt; shutdown</span><br><span class="line">not connected&gt;</span><br></pre></td></tr></table></figure><h5 id="å¤šå®ä¾‹å…³é—­"><a href="#å¤šå®ä¾‹å…³é—­" class="headerlink" title="å¤šå®ä¾‹å…³é—­"></a>å¤šå®ä¾‹å…³é—­</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šç«¯å£å…³é—­</span></span><br><span class="line">redis-cli -p 6379 shutdown</span><br></pre></td></tr></table></figure><p><strong>å®Œæ•´æ“ä½œç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@chad bin]# redis-server /myredis/redis.conf</span><br><span class="line">[root@chad bin]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt; shutdown</span><br><span class="line">not connected&gt;</span><br></pre></td></tr></table></figure><h3 id="2-2-åŸºç¡€é…ç½®"><a href="#2-2-åŸºç¡€é…ç½®" class="headerlink" title="2.2 åŸºç¡€é…ç½®"></a>2.2 åŸºç¡€é…ç½®</h3><h4 id="é»˜è®¤ç«¯å£"><a href="#é»˜è®¤ç«¯å£" class="headerlink" title="é»˜è®¤ç«¯å£"></a>é»˜è®¤ç«¯å£</h4><p>Redisé»˜è®¤ä½¿ç”¨ <strong>6379</strong> ç«¯å£ã€‚</p><blockquote><p><strong>å°çŸ¥è¯†</strong>ï¼š6379åœ¨æ‰‹æœºæŒ‰é”®ä¸Šå¯¹åº”MERZï¼Œæ˜¯æ„å¤§åˆ©æ­Œå¥³Alessia Merzçš„åå­—ï¼ŒRedisä½œè€…antirezæ˜¯å¥¹çš„ç²‰ä¸ã€‚</p></blockquote><h4 id="æ•°æ®åº“é…ç½®"><a href="#æ•°æ®åº“é…ç½®" class="headerlink" title="æ•°æ®åº“é…ç½®"></a>æ•°æ®åº“é…ç½®</h4><p>Redisé»˜è®¤æœ‰ <strong>16ä¸ªæ•°æ®åº“</strong>ï¼ˆç¼–å·0-15ï¼‰ï¼Œåˆå§‹é»˜è®¤ä½¿ç”¨ <strong>0å·åº“</strong>ã€‚</p><p><strong>å¸¸ç”¨å‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ°æŒ‡å®šæ•°æ®åº“</span></span><br><span class="line">SELECT &lt;dbid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šåˆ‡æ¢åˆ°8å·åº“</span></span><br><span class="line">SELECT 8</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æ•°æ®åº“keyçš„æ•°é‡</span></span><br><span class="line">DBSIZE</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç©ºå½“å‰åº“</span></span><br><span class="line">FLUSHDB</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç©ºæ‰€æœ‰åº“ï¼ˆæ…ç”¨ï¼ï¼‰</span></span><br><span class="line">FLUSHALL</span><br></pre></td></tr></table></figure><p><strong>æ“ä½œç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SELECT 8</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[8]&gt; DBSIZE</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379[8]&gt; SET mykey <span class="string">&quot;test&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[8]&gt; DBSIZE</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><h4 id="å¯†ç é…ç½®"><a href="#å¯†ç é…ç½®" class="headerlink" title="å¯†ç é…ç½®"></a>å¯†ç é…ç½®</h4><p>Redisé‡‡ç”¨<strong>ç»Ÿä¸€å¯†ç ç®¡ç†</strong>ï¼Œæ‰€æœ‰æ•°æ®åº“ä½¿ç”¨ç›¸åŒçš„å¯†ç ã€‚</p><p><strong>è®¾ç½®å¯†ç </strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1ï¼šå‘½ä»¤è¡Œä¸´æ—¶è®¾ç½®ï¼ˆé‡å¯å¤±æ•ˆï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET requirepass <span class="string">&quot;your_password&quot;</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2ï¼šé…ç½®æ–‡ä»¶æ°¸ä¹…è®¾ç½®</span></span><br><span class="line">vim /myredis/redis.conf</span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°å¹¶ä¿®æ”¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># å–æ¶ˆæ³¨é‡Šå¹¶è®¾ç½®å¯†ç </span><br><span class="line">requirepass your_password</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨å¯†ç è¿æ¥</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1ï¼šè¿æ¥æ—¶æŒ‡å®šå¯†ç </span></span><br><span class="line">redis-cli -a your_password</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2ï¼šè¿æ¥åè®¤è¯</span></span><br><span class="line">redis-cli</span><br><span class="line">127.0.0.1:6379&gt; AUTH your_password</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h4 id="å…¶ä»–é‡è¦é…ç½®"><a href="#å…¶ä»–é‡è¦é…ç½®" class="headerlink" title="å…¶ä»–é‡è¦é…ç½®"></a>å…¶ä»–é‡è¦é…ç½®</h4><table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th><th>æ¨èå€¼</th></tr></thead><tbody><tr><td><code>bind</code></td><td>ç»‘å®šIPåœ°å€</td><td><code>127.0.0.1</code></td><td><code>0.0.0.0</code>ï¼ˆå…è®¸è¿œç¨‹è¿æ¥ï¼‰</td></tr><tr><td><code>port</code></td><td>ç›‘å¬ç«¯å£</td><td><code>6379</code></td><td>æŒ‰éœ€ä¿®æ”¹</td></tr><tr><td><code>daemonize</code></td><td>åå°è¿è¡Œ</td><td><code>no</code></td><td><code>yes</code></td></tr><tr><td><code>databases</code></td><td>æ•°æ®åº“æ•°é‡</td><td><code>16</code></td><td>æŒ‰éœ€è°ƒæ•´</td></tr><tr><td><code>maxmemory</code></td><td>æœ€å¤§å†…å­˜é™åˆ¶</td><td>æ— é™åˆ¶</td><td>å»ºè®®è®¾ç½®ï¼ˆå¦‚<code>2gb</code>ï¼‰</td></tr><tr><td><code>maxmemory-policy</code></td><td>å†…å­˜æ·˜æ±°ç­–ç•¥</td><td><code>noeviction</code></td><td><code>allkeys-lru</code></td></tr><tr><td><code>logfile</code></td><td>æ—¥å¿—æ–‡ä»¶è·¯å¾„</td><td><code>&quot;&quot;</code></td><td><code>/var/log/redis/redis.log</code></td></tr></tbody></table><p><strong>é…ç½®ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># å…è®¸è¿œç¨‹è®¿é—®ï¼ˆæ³¨æ„å®‰å…¨ï¼‰</span><br><span class="line">bind 0.0.0.0</span><br><span class="line"></span><br><span class="line"># ç«¯å£</span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"># åå°è¿è¡Œ</span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"># æ•°æ®åº“æ•°é‡</span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line"># æœ€å¤§å†…å­˜2GB</span><br><span class="line">maxmemory 2gb</span><br><span class="line"></span><br><span class="line"># å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šä¼˜å…ˆåˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„key</span><br><span class="line">maxmemory-policy allkeys-lru</span><br><span class="line"></span><br><span class="line"># æ—¥å¿—æ–‡ä»¶</span><br><span class="line">logfile &quot;/var/log/redis/redis.log&quot;</span><br><span class="line"></span><br><span class="line"># æŒä¹…åŒ–æ–‡ä»¶ç›®å½•</span><br><span class="line">dir /var/lib/redis/</span><br></pre></td></tr></table></figure><blockquote><p><strong>å®‰å…¨æç¤º</strong>ï¼šå¦‚æœè®¾ç½®äº† <code>bind 0.0.0.0</code> å…è®¸è¿œç¨‹è®¿é—®ï¼ŒåŠ¡å¿…è®¾ç½®å¼ºå¯†ç å¹¶é…ç½®é˜²ç«å¢™è§„åˆ™ï¼</p></blockquote><hr><h2 id="3-RedisåŸºç¡€æ•°æ®ç±»å‹"><a href="#3-RedisåŸºç¡€æ•°æ®ç±»å‹" class="headerlink" title="3. RedisåŸºç¡€æ•°æ®ç±»å‹"></a>3. RedisåŸºç¡€æ•°æ®ç±»å‹</h2><h3 id="Redisé”®-key-é€šç”¨å‘½ä»¤"><a href="#Redisé”®-key-é€šç”¨å‘½ä»¤" class="headerlink" title="Redisé”®(key)é€šç”¨å‘½ä»¤"></a>Redisé”®(key)é€šç”¨å‘½ä»¤</h3><p>åœ¨å­¦ä¹ å„ç§æ•°æ®ç±»å‹ä¹‹å‰ï¼Œå…ˆäº†è§£Redisä¸­<strong>æ‰€æœ‰æ•°æ®ç±»å‹é€šç”¨çš„keyæ“ä½œå‘½ä»¤</strong>ã€‚</p><h4 id="å¸¸ç”¨Keyå‘½ä»¤"><a href="#å¸¸ç”¨Keyå‘½ä»¤" class="headerlink" title="å¸¸ç”¨Keyå‘½ä»¤"></a>å¸¸ç”¨Keyå‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>KEYS pattern</code></td><td>æŸ¥çœ‹ç¬¦åˆæ¨¡æ¿çš„æ‰€æœ‰key</td><td><code>KEYS *</code>ï¼ˆæŸ¥çœ‹æ‰€æœ‰ï¼‰<br><code>KEYS *1</code>ï¼ˆæŸ¥çœ‹ä»¥1ç»“å°¾çš„ï¼‰</td></tr><tr><td><code>EXISTS key</code></td><td>åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</td><td><code>EXISTS name</code><br>è¿”å›1è¡¨ç¤ºå­˜åœ¨ï¼Œ0è¡¨ç¤ºä¸å­˜åœ¨</td></tr><tr><td><code>TYPE key</code></td><td>æŸ¥çœ‹keyçš„æ•°æ®ç±»å‹</td><td><code>TYPE name</code><br>è¿”å›ï¼šstring&#x2F;list&#x2F;hash&#x2F;set&#x2F;zset</td></tr><tr><td><code>DEL key [key ...]</code></td><td>åˆ é™¤æŒ‡å®šçš„keyï¼ˆé˜»å¡ï¼‰</td><td><code>DEL name age</code><br>è¿”å›åˆ é™¤çš„keyæ•°é‡</td></tr><tr><td><code>UNLINK key [key ...]</code></td><td>éé˜»å¡åˆ é™¤key</td><td><code>UNLINK name age</code><br>å¼‚æ­¥åˆ é™¤ï¼Œæ€§èƒ½æ›´å¥½</td></tr><tr><td><code>EXPIRE key seconds</code></td><td>è®¾ç½®keyçš„è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</td><td><code>EXPIRE name 10</code><br>10ç§’åè¿‡æœŸ</td></tr><tr><td><code>TTL key</code></td><td>æŸ¥çœ‹keyå‰©ä½™è¿‡æœŸæ—¶é—´</td><td><code>TTL name</code><br>-1ï¼šæ°¸ä¸è¿‡æœŸ<br>-2ï¼šå·²è¿‡æœŸ</td></tr><tr><td><code>RENAME key newkey</code></td><td>é‡å‘½åkey</td><td><code>RENAME oldname newname</code></td></tr><tr><td><code>MOVE key db</code></td><td>ç§»åŠ¨keyåˆ°å…¶ä»–æ•°æ®åº“</td><td><code>MOVE name 1</code>ï¼ˆç§»åŠ¨åˆ°1å·åº“ï¼‰</td></tr></tbody></table><p><strong>æ“ä½œç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SET name <span class="string">&quot;Redis&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET age <span class="string">&quot;5&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; KEYS *</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;age&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; EXISTS name</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; TYPE name</span><br><span class="line">string</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; EXPIRE name 60</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; TTL name</span><br><span class="line">(<span class="built_in">integer</span>) 57</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; TTL name</span><br><span class="line">(<span class="built_in">integer</span>) -2</span><br><span class="line">127.0.0.1:6379&gt; EXISTS name</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong>ï¼š<code>DEL</code> æ˜¯é˜»å¡åˆ é™¤ï¼Œåˆ é™¤å¤§keyæ—¶ä¼šé˜»å¡RedisæœåŠ¡ï¼›<code>UNLINK</code> æ˜¯éé˜»å¡åˆ é™¤ï¼Œä»…å°†keyä»keyspaceå…ƒæ•°æ®ä¸­åˆ é™¤ï¼ŒçœŸæ­£çš„åˆ é™¤åœ¨åç»­å¼‚æ­¥æ“ä½œä¸­å®Œæˆï¼Œæ¨èä½¿ç”¨ï¼</p></blockquote><h3 id="3-1-Stringï¼ˆå­—ç¬¦ä¸²ï¼‰"><a href="#3-1-Stringï¼ˆå­—ç¬¦ä¸²ï¼‰" class="headerlink" title="3.1 Stringï¼ˆå­—ç¬¦ä¸²ï¼‰"></a>3.1 Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</h3><h4 id="ç±»å‹ä»‹ç»"><a href="#ç±»å‹ä»‹ç»" class="headerlink" title="ç±»å‹ä»‹ç»"></a>ç±»å‹ä»‹ç»</h4><p>Stringæ˜¯Redis<strong>æœ€åŸºæœ¬</strong>çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>ä¸Memcachedçš„ç±»å‹ä¸€è‡´ï¼Œéƒ½æ˜¯ç®€å•çš„key-valueå­˜å‚¨</li><li><strong>äºŒè¿›åˆ¶å®‰å…¨</strong>ï¼šå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ï¼Œå¦‚æ–‡æœ¬ã€æ•°å­—ã€jpgå›¾ç‰‡ã€åºåˆ—åŒ–å¯¹è±¡ç­‰</li><li><strong>æœ€å¤§å€¼</strong>ï¼šå•ä¸ªvalueæœ€å¤šå¯ä»¥å­˜å‚¨ <strong>512MB</strong></li></ul><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>ç¼“å­˜ï¼šç¼“å­˜ç”¨æˆ·ä¿¡æ¯ã€å•†å“è¯¦æƒ…ç­‰</li><li>è®¡æ•°å™¨ï¼šç‚¹èµæ•°ã€æµè§ˆé‡ã€åº“å­˜æ•°é‡</li><li>åˆ†å¸ƒå¼é”ï¼šåˆ©ç”¨SETNXå®ç°</li><li>é™æµï¼šè®°å½•æ¥å£è°ƒç”¨æ¬¡æ•°</li></ul><h4 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h4><h5 id="1-åŸºç¡€æ“ä½œ"><a href="#1-åŸºç¡€æ“ä½œ" class="headerlink" title="1. åŸºç¡€æ“ä½œ"></a>1. åŸºç¡€æ“ä½œ</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>SET key value [EX seconds] [NX|XX]</code></td><td>è®¾ç½®é”®å€¼</td><td><code>SET name &quot;Redis&quot;</code></td><td>OK</td></tr><tr><td><code>GET key</code></td><td>è·å–å€¼</td><td><code>GET name</code></td><td>â€œRedisâ€</td></tr><tr><td><code>APPEND key value</code></td><td>è¿½åŠ å€¼åˆ°æœ«å°¾</td><td><code>APPEND name &quot;DB&quot;</code></td><td>æ–°å­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td><code>STRLEN key</code></td><td>è·å–å€¼çš„é•¿åº¦</td><td><code>STRLEN name</code></td><td>å­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td><code>SETNX key value</code></td><td>ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®</td><td><code>SETNX lock &quot;1&quot;</code></td><td>1æˆåŠŸï¼Œ0å¤±è´¥</td></tr><tr><td><code>SETEX key seconds value</code></td><td>è®¾ç½®å€¼+è¿‡æœŸæ—¶é—´</td><td><code>SETEX code 60 &quot;123456&quot;</code></td><td>OK</td></tr><tr><td><code>GETSET key value</code></td><td>è®¾ç½®æ–°å€¼å¹¶è¿”å›æ—§å€¼</td><td><code>GETSET name &quot;MySQL&quot;</code></td><td>æ—§å€¼</td></tr></tbody></table><p><strong>SETå‘½ä»¤çš„å¯é€‰å‚æ•°</strong>ï¼š</p><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>EX seconds</code></td><td>è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</td></tr><tr><td><code>PX milliseconds</code></td><td>è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</td></tr><tr><td><code>NX</code></td><td>ä»…å½“keyä¸å­˜åœ¨æ—¶æ‰è®¾ç½®ï¼ˆNot eXistsï¼‰</td></tr><tr><td><code>XX</code></td><td>ä»…å½“keyå­˜åœ¨æ—¶æ‰è®¾ç½®ï¼ˆeXistsï¼‰</td></tr></tbody></table><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SET name <span class="string">&quot;Redis&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; GET name</span><br><span class="line"><span class="string">&quot;Redis&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; APPEND name <span class="string">&quot; Database&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 14</span><br><span class="line">127.0.0.1:6379&gt; GET name</span><br><span class="line"><span class="string">&quot;Redis Database&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; STRLEN name</span><br><span class="line">(<span class="built_in">integer</span>) 14</span><br><span class="line"></span><br><span class="line"><span class="comment"># NXå‚æ•°ï¼škeyä¸å­˜åœ¨æ—¶æ‰è®¾ç½®</span></span><br><span class="line">127.0.0.1:6379&gt; SET lock <span class="string">&quot;user123&quot;</span> NX EX 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET lock <span class="string">&quot;user456&quot;</span> NX</span><br><span class="line">(nil)  <span class="comment"># è®¾ç½®å¤±è´¥ï¼Œå› ä¸ºkeyå·²å­˜åœ¨</span></span><br></pre></td></tr></table></figure><h5 id="2-æ•°å€¼æ“ä½œ"><a href="#2-æ•°å€¼æ“ä½œ" class="headerlink" title="2. æ•°å€¼æ“ä½œ"></a>2. æ•°å€¼æ“ä½œ</h5><p>Stringç±»å‹æ”¯æŒå¯¹æ•°å­—è¿›è¡ŒåŸå­æ€§çš„é€’å¢&#x2F;é€’å‡æ“ä½œã€‚</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>INCR key</code></td><td>å€¼è‡ªå¢1</td><td><code>INCR counter</code></td><td>è‡ªå¢åçš„å€¼</td></tr><tr><td><code>DECR key</code></td><td>å€¼è‡ªå‡1</td><td><code>DECR counter</code></td><td>è‡ªå‡åçš„å€¼</td></tr><tr><td><code>INCRBY key increment</code></td><td>å€¼å¢åŠ æŒ‡å®šæ­¥é•¿</td><td><code>INCRBY counter 10</code></td><td>å¢åŠ åçš„å€¼</td></tr><tr><td><code>DECRBY key decrement</code></td><td>å€¼å‡å°‘æŒ‡å®šæ­¥é•¿</td><td><code>DECRBY counter 5</code></td><td>å‡å°‘åçš„å€¼</td></tr><tr><td><code>INCRBYFLOAT key increment</code></td><td>æµ®ç‚¹æ•°å¢åŠ </td><td><code>INCRBYFLOAT price 0.5</code></td><td>å¢åŠ åçš„å€¼</td></tr></tbody></table><p><strong>ç‰¹æ€§</strong>ï¼š</p><ul><li>åªèƒ½å¯¹<strong>æ•°å­—å€¼</strong>æ“ä½œ</li><li>å¦‚æœkeyä¸å­˜åœ¨ï¼Œä¼šå…ˆåˆå§‹åŒ–ä¸º0ï¼Œå†æ‰§è¡Œæ“ä½œ</li><li>æ“ä½œæ˜¯<strong>åŸå­æ€§</strong>çš„ï¼Œçº¿ç¨‹å®‰å…¨</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SET counter 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; INCR counter</span><br><span class="line">(<span class="built_in">integer</span>) 101</span><br><span class="line">127.0.0.1:6379&gt; INCRBY counter 10</span><br><span class="line">(<span class="built_in">integer</span>) 111</span><br><span class="line">127.0.0.1:6379&gt; DECR counter</span><br><span class="line">(<span class="built_in">integer</span>) 110</span><br><span class="line">127.0.0.1:6379&gt; DECRBY counter 5</span><br><span class="line">(<span class="built_in">integer</span>) 105</span><br><span class="line"></span><br><span class="line"><span class="comment"># keyä¸å­˜åœ¨æ—¶ï¼Œä»0å¼€å§‹</span></span><br><span class="line">127.0.0.1:6379&gt; INCR newCounter</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><h5 id="3-æ‰¹é‡æ“ä½œ"><a href="#3-æ‰¹é‡æ“ä½œ" class="headerlink" title="3. æ‰¹é‡æ“ä½œ"></a>3. æ‰¹é‡æ“ä½œ</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>MSET key1 value1 key2 value2 ...</code></td><td>åŒæ—¶è®¾ç½®å¤šä¸ªé”®å€¼å¯¹</td><td><code>MSET name &quot;Redis&quot; age &quot;5&quot;</code></td></tr><tr><td><code>MGET key1 key2 key3 ...</code></td><td>åŒæ—¶è·å–å¤šä¸ªå€¼</td><td><code>MGET name age</code></td></tr><tr><td><code>MSETNX key1 value1 key2 value2 ...</code></td><td>æ‰¹é‡è®¾ç½®ï¼ˆä»…å½“æ‰€æœ‰keyéƒ½ä¸å­˜åœ¨ï¼‰</td><td><code>MSETNX k1 &quot;v1&quot; k2 &quot;v2&quot;</code></td></tr></tbody></table><p><strong>MSETNXç‰¹æ€§</strong>ï¼š</p><ul><li><strong>åŸå­æ€§</strong>ï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥</li><li>åªè¦æœ‰ä¸€ä¸ªkeyå­˜åœ¨ï¼Œæ‰€æœ‰è®¾ç½®éƒ½ä¼šå¤±è´¥</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MSET name <span class="string">&quot;Redis&quot;</span> <span class="built_in">type</span> <span class="string">&quot;NoSQL&quot;</span> version <span class="string">&quot;6.2&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MGET name <span class="built_in">type</span> version</span><br><span class="line">1) <span class="string">&quot;Redis&quot;</span></span><br><span class="line">2) <span class="string">&quot;NoSQL&quot;</span></span><br><span class="line">3) <span class="string">&quot;6.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MSETNX - åŸå­æ€§æ“ä½œ</span></span><br><span class="line">127.0.0.1:6379&gt; MSETNX k1 <span class="string">&quot;v1&quot;</span> k2 <span class="string">&quot;v2&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1  <span class="comment"># æˆåŠŸ</span></span><br><span class="line">127.0.0.1:6379&gt; MSETNX k1 <span class="string">&quot;v1_new&quot;</span> k3 <span class="string">&quot;v3&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 0  <span class="comment"># å¤±è´¥ï¼Œå› ä¸ºk1å·²å­˜åœ¨ï¼Œk3ä¹Ÿä¸ä¼šè®¾ç½®</span></span><br><span class="line">127.0.0.1:6379&gt; GET k3</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><h5 id="4-èŒƒå›´æ“ä½œ"><a href="#4-èŒƒå›´æ“ä½œ" class="headerlink" title="4. èŒƒå›´æ“ä½œ"></a>4. èŒƒå›´æ“ä½œ</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>GETRANGE key start end</code></td><td>è·å–æŒ‡å®šèŒƒå›´çš„å­ä¸²</td><td><code>GETRANGE name 0 4</code></td></tr><tr><td><code>SETRANGE key offset value</code></td><td>ä»æŒ‡å®šä½ç½®å¼€å§‹è¦†å†™</td><td><code>SETRANGE name 0 &quot;MySQL&quot;</code></td></tr></tbody></table><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>ç´¢å¼•ä»<strong>0</strong>å¼€å§‹</li><li><code>GETRANGE</code> åŒ…å«èµ·å§‹å’Œç»“æŸä½ç½®ï¼ˆç±»ä¼¼Javaçš„substringï¼Œä½†æ˜¯<strong>å‰åŒ…ååŒ…</strong>ï¼‰</li><li>æ”¯æŒè´Ÿæ•°ç´¢å¼•ï¼š-1è¡¨ç¤ºæœ€åä¸€ä¸ªå­—ç¬¦ï¼Œ-2è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ª</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SET greeting <span class="string">&quot;Hello Redis&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; GETRANGE greeting 0 4</span><br><span class="line"><span class="string">&quot;Hello&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; GETRANGE greeting 6 -1</span><br><span class="line"><span class="string">&quot;Redis&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SETRANGE greeting 6 <span class="string">&quot;World&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 11</span><br><span class="line">127.0.0.1:6379&gt; GET greeting</span><br><span class="line"><span class="string">&quot;Hello World&quot;</span></span><br></pre></td></tr></table></figure><h4 id="åŸå­æ€§è¯´æ˜"><a href="#åŸå­æ€§è¯´æ˜" class="headerlink" title="åŸå­æ€§è¯´æ˜"></a>åŸå­æ€§è¯´æ˜</h4><p>Redisçš„<strong>å•æ¡å‘½ä»¤</strong>éƒ½æ˜¯åŸå­æ€§çš„ï¼Œè¿™æ˜¯ç”±Redisçš„<strong>å•çº¿ç¨‹</strong>ç‰¹æ€§å†³å®šçš„ã€‚</p><p><strong>åŸå­æ“ä½œå®šä¹‰</strong>ï¼š</p><ul><li>ä¸ä¼šè¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­çš„æ“ä½œ</li><li>ä¸€æ—¦å¼€å§‹å°±ä¼šè¿è¡Œåˆ°ç»“æŸï¼Œä¸­é—´ä¸ä¼šæœ‰ä»»ä½•ä¸Šä¸‹æ–‡åˆ‡æ¢</li></ul><p><strong>å®ç°åŸç†</strong>ï¼š</p><ol><li><strong>å•çº¿ç¨‹ç¯å¢ƒ</strong>ï¼šåœ¨å•æ¡æŒ‡ä»¤ä¸­å®Œæˆçš„æ“ä½œéƒ½æ˜¯åŸå­çš„ï¼Œå› ä¸ºä¸­æ–­åªèƒ½å‘ç”Ÿåœ¨æŒ‡ä»¤ä¹‹é—´</li><li><strong>å¤šçº¿ç¨‹ç¯å¢ƒ</strong>ï¼šä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹&#x2F;çº¿ç¨‹æ‰“æ–­çš„æ“ä½œæ‰æ˜¯åŸå­çš„</li><li><strong>Redisä¿è¯</strong>ï¼šå•å‘½ä»¤çš„åŸå­æ€§ä¸»è¦å¾—ç›ŠäºRedisçš„å•çº¿ç¨‹æ¨¡å‹</li></ol><p><strong>å¯¹æ¯”ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Javaä¸­çš„i++ä¸æ˜¯åŸå­æ“ä½œ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«å¯¹iè¿›è¡Œ++100æ¬¡</span></span><br><span class="line"><span class="comment">// æœ€ç»ˆç»“æœå¯èƒ½æ˜¯ï¼š102ã€150ã€198ç­‰ï¼Œä¸ä¸€å®šæ˜¯200</span></span><br><span class="line"><span class="comment">// å› ä¸ºi++åŒ…å«ä¸‰æ­¥ï¼šè¯»å–ã€è®¡ç®—ã€å†™å…¥ï¼Œå¯èƒ½è¢«æ‰“æ–­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Redisä¸­çš„INCRæ˜¯åŸå­æ“ä½œ</span></span><br><span class="line">INCR counter  <span class="comment">// è¯»å–ã€è®¡ç®—ã€å†™å…¥ä¸€æ¬¡æ€§å®Œæˆï¼Œä¸ä¼šè¢«æ‰“æ–­</span></span><br></pre></td></tr></table></figure><h4 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h4><p>Stringç±»å‹çš„åº•å±‚å®ç°æ˜¯<strong>SDSï¼ˆSimple Dynamic Stringï¼Œç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰</strong>ã€‚</p><p><strong>SDS vs Cå­—ç¬¦ä¸²</strong>ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th>SDS</th><th>Cå­—ç¬¦ä¸²</th></tr></thead><tbody><tr><td>è·å–é•¿åº¦</td><td>O(1)</td><td>O(n)</td></tr><tr><td>ç¼“å†²åŒºæº¢å‡º</td><td>ä¸ä¼šæº¢å‡ºï¼ˆè‡ªåŠ¨æ‰©å®¹ï¼‰</td><td>å¯èƒ½æº¢å‡º</td></tr><tr><td>äºŒè¿›åˆ¶å®‰å…¨</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>å†…å­˜é‡åˆ†é…</td><td>ç©ºé—´é¢„åˆ†é…+æƒ°æ€§é‡Šæ”¾</td><td>æ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦</td></tr></tbody></table><p><strong>SDSç»“æ„</strong>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sdshdr</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> len;        <span class="comment">// å·²ä½¿ç”¨é•¿åº¦</span></span><br><span class="line">    <span class="type">int</span> <span class="built_in">free</span>;       <span class="comment">// æœªä½¿ç”¨é•¿åº¦</span></span><br><span class="line">    <span class="type">char</span> buf[];     <span class="comment">// å­—èŠ‚æ•°ç»„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–ç­–ç•¥</strong>ï¼š</p><ul><li><strong>ç©ºé—´é¢„åˆ†é…</strong>ï¼šæ‰©å®¹æ—¶é¢„ç•™é¢å¤–ç©ºé—´ï¼Œå‡å°‘é‡åˆ†é…æ¬¡æ•°</li><li><strong>æƒ°æ€§é‡Šæ”¾</strong>ï¼šç¼©çŸ­æ—¶ä¸ç«‹å³é‡Šæ”¾å†…å­˜ï¼Œç•™å¾…åç”¨</li><li><strong>é•¿åº¦ç¼“å­˜</strong>ï¼šè®°å½•å­—ç¬¦ä¸²é•¿åº¦ï¼Œè·å–é•¿åº¦O(1)</li></ul><h3 id="3-2-Hashï¼ˆå“ˆå¸Œï¼‰"><a href="#3-2-Hashï¼ˆå“ˆå¸Œï¼‰" class="headerlink" title="3.2 Hashï¼ˆå“ˆå¸Œï¼‰"></a>3.2 Hashï¼ˆå“ˆå¸Œï¼‰</h3><h4 id="ç±»å‹ä»‹ç»-1"><a href="#ç±»å‹ä»‹ç»-1" class="headerlink" title="ç±»å‹ä»‹ç»"></a>ç±»å‹ä»‹ç»</h4><p>Hashæ˜¯ä¸€ä¸ª<strong>é”®å€¼å¯¹é›†åˆ</strong>ï¼Œæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>ç±»ä¼¼Javaä¸­çš„ <code>Map&lt;String, Object&gt;</code> ç»“æ„</li><li>ç‰¹åˆ«é€‚åˆå­˜å‚¨<strong>å¯¹è±¡</strong></li><li>å¯ä»¥é€šè¿‡ <code>key + field</code> ç²¾ç¡®å®šä½åˆ°å…·ä½“å±æ€§</li><li>æ—¢ä¸éœ€è¦é‡å¤å­˜å‚¨æ•°æ®ï¼Œä¹Ÿé¿å…äº†åºåˆ—åŒ–å’Œå¹¶å‘ä¿®æ”¹é—®é¢˜</li></ul><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>ç”¨æˆ·ä¿¡æ¯å­˜å‚¨</strong>ï¼šç”¨æˆ·IDä½œä¸ºkeyï¼Œå§“åã€å¹´é¾„ã€ç”Ÿæ—¥ç­‰ä½œä¸ºfield</li><li><strong>å•†å“ä¿¡æ¯</strong>ï¼šå•†å“IDä½œä¸ºkeyï¼Œåç§°ã€ä»·æ ¼ã€åº“å­˜ç­‰ä½œä¸ºfield</li><li><strong>è´­ç‰©è½¦</strong>ï¼šç”¨æˆ·IDä½œä¸ºkeyï¼Œå•†å“IDä½œä¸ºfieldï¼Œæ•°é‡ä½œä¸ºvalue</li><li><strong>ä¼šè¯ç¼“å­˜</strong>ï¼šsession IDä½œä¸ºkeyï¼Œå„ç§sessionå±æ€§ä½œä¸ºfield</li></ul><p><strong>å­˜å‚¨ç»“æ„ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¼ ç»ŸStringæ–¹å¼ï¼šéœ€è¦åºåˆ—åŒ–æ•´ä¸ªå¯¹è±¡</span></span><br><span class="line">user:1001 -&gt; &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;å¼ ä¸‰&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="string">&quot;25&quot;</span>,<span class="string">&quot;city&quot;</span>:<span class="string">&quot;åŒ—äº¬&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hashæ–¹å¼ï¼šå¯ä»¥å•ç‹¬æ“ä½œæ¯ä¸ªå±æ€§</span></span><br><span class="line">user:1001</span><br><span class="line">    â”œâ”€ name: <span class="string">&quot;å¼ ä¸‰&quot;</span></span><br><span class="line">    â”œâ”€ age: <span class="string">&quot;25&quot;</span></span><br><span class="line">    â””â”€ city: <span class="string">&quot;åŒ—äº¬&quot;</span></span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>HSET key field value</code></td><td>è®¾ç½®å•ä¸ªå­—æ®µ</td><td><code>HSET user:1001 name &quot;å¼ ä¸‰&quot;</code></td><td>1ï¼ˆæ–°å¢ï¼‰æˆ–0ï¼ˆæ›´æ–°ï¼‰</td></tr><tr><td><code>HGET key field</code></td><td>è·å–å•ä¸ªå­—æ®µ</td><td><code>HGET user:1001 name</code></td><td>â€œå¼ ä¸‰â€</td></tr><tr><td><code>HMSET key f1 v1 f2 v2 ...</code></td><td>æ‰¹é‡è®¾ç½®å¤šä¸ªå­—æ®µ</td><td><code>HMSET user:1001 name &quot;å¼ ä¸‰&quot; age &quot;25&quot;</code></td><td>OK</td></tr><tr><td><code>HMGET key field1 field2 ...</code></td><td>æ‰¹é‡è·å–å¤šä¸ªå­—æ®µ</td><td><code>HMGET user:1001 name age</code></td><td>[â€œå¼ ä¸‰â€, â€œ25â€]</td></tr><tr><td><code>HGETALL key</code></td><td>è·å–æ‰€æœ‰å­—æ®µå’Œå€¼</td><td><code>HGETALL user:1001</code></td><td>field1, value1, field2, value2â€¦</td></tr><tr><td><code>HEXISTS key field</code></td><td>åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨</td><td><code>HEXISTS user:1001 name</code></td><td>1ï¼ˆå­˜åœ¨ï¼‰æˆ–0ï¼ˆä¸å­˜åœ¨ï¼‰</td></tr><tr><td><code>HKEYS key</code></td><td>è·å–æ‰€æœ‰å­—æ®µå</td><td><code>HKEYS user:1001</code></td><td>[â€œnameâ€, â€œageâ€, â€œcityâ€]</td></tr><tr><td><code>HVALS key</code></td><td>è·å–æ‰€æœ‰å€¼</td><td><code>HVALS user:1001</code></td><td>[â€œå¼ ä¸‰â€, â€œ25â€, â€œåŒ—äº¬â€]</td></tr><tr><td><code>HLEN key</code></td><td>è·å–å­—æ®µæ•°é‡</td><td><code>HLEN user:1001</code></td><td>3</td></tr><tr><td><code>HDEL key field1 field2 ...</code></td><td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µ</td><td><code>HDEL user:1001 age</code></td><td>åˆ é™¤çš„å­—æ®µæ•°é‡</td></tr><tr><td><code>HINCRBY key field increment</code></td><td>å­—æ®µå€¼å¢åŠ æŒ‡å®šæ•°å€¼</td><td><code>HINCRBY user:1001 age 1</code></td><td>å¢åŠ åçš„å€¼</td></tr><tr><td><code>HINCRBYFLOAT key field increment</code></td><td>å­—æ®µå€¼å¢åŠ æµ®ç‚¹æ•°</td><td><code>HINCRBYFLOAT user:1001 score 0.5</code></td><td>å¢åŠ åçš„å€¼</td></tr><tr><td><code>HSETNX key field value</code></td><td>å­—æ®µä¸å­˜åœ¨æ—¶æ‰è®¾ç½®</td><td><code>HSETNX user:1001 email &quot;xx@qq.com&quot;</code></td><td>1ï¼ˆæˆåŠŸï¼‰æˆ–0ï¼ˆå¤±è´¥ï¼‰</td></tr></tbody></table><h4 id="æ“ä½œç¤ºä¾‹"><a href="#æ“ä½œç¤ºä¾‹" class="headerlink" title="æ“ä½œç¤ºä¾‹"></a>æ“ä½œç¤ºä¾‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">127.0.0.1:6379&gt; HMSET user:1001 name <span class="string">&quot;å¼ ä¸‰&quot;</span> age <span class="string">&quot;25&quot;</span> city <span class="string">&quot;åŒ—äº¬&quot;</span> salary <span class="string">&quot;15000&quot;</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å•ä¸ªå­—æ®µ</span></span><br><span class="line">127.0.0.1:6379&gt; HGET user:1001 name</span><br><span class="line"><span class="string">&quot;å¼ ä¸‰&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å¤šä¸ªå­—æ®µ</span></span><br><span class="line">127.0.0.1:6379&gt; HMGET user:1001 name age city</span><br><span class="line">1) <span class="string">&quot;å¼ ä¸‰&quot;</span></span><br><span class="line">2) <span class="string">&quot;25&quot;</span></span><br><span class="line">3) <span class="string">&quot;åŒ—äº¬&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰å­—æ®µ</span></span><br><span class="line">127.0.0.1:6379&gt; HGETALL user:1001</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;å¼ ä¸‰&quot;</span></span><br><span class="line">3) <span class="string">&quot;age&quot;</span></span><br><span class="line">4) <span class="string">&quot;25&quot;</span></span><br><span class="line">5) <span class="string">&quot;city&quot;</span></span><br><span class="line">6) <span class="string">&quot;åŒ—äº¬&quot;</span></span><br><span class="line">7) <span class="string">&quot;salary&quot;</span></span><br><span class="line">8) <span class="string">&quot;15000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨</span></span><br><span class="line">127.0.0.1:6379&gt; HEXISTS user:1001 email</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ å¹´é¾„</span></span><br><span class="line">127.0.0.1:6379&gt; HINCRBY user:1001 age 1</span><br><span class="line">(<span class="built_in">integer</span>) 26</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰å­—æ®µå</span></span><br><span class="line">127.0.0.1:6379&gt; HKEYS user:1001</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;age&quot;</span></span><br><span class="line">3) <span class="string">&quot;city&quot;</span></span><br><span class="line">4) <span class="string">&quot;salary&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤å­—æ®µ</span></span><br><span class="line">127.0.0.1:6379&gt; HDEL user:1001 salary</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><h4 id="æ•°æ®ç»“æ„-1"><a href="#æ•°æ®ç»“æ„-1" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h4><p>Hashç±»å‹çš„åº•å±‚å®ç°æœ‰<strong>ä¸¤ç§</strong>æ•°æ®ç»“æ„ï¼š</p><table><thead><tr><th>æ•°æ®ç»“æ„</th><th>ä½¿ç”¨æ¡ä»¶</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong>ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰</strong></td><td>â€¢ field-valueé•¿åº¦è¾ƒçŸ­<br>â€¢ å…ƒç´ ä¸ªæ•°è¾ƒå°‘</td><td>ç´§å‡‘å­˜å‚¨ï¼ŒèŠ‚çœå†…å­˜</td></tr><tr><td><strong>hashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰</strong></td><td>â€¢ field-valueé•¿åº¦è¾ƒé•¿<br>â€¢ å…ƒç´ ä¸ªæ•°è¾ƒå¤š</td><td>å¿«é€ŸæŸ¥æ‰¾ï¼ŒO(1)å¤æ‚åº¦</td></tr></tbody></table><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼ˆå¯åœ¨redis.confä¸­é…ç½®ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶æ—¶ï¼Œä»ziplistè½¬ä¸ºhashtable</span></span><br><span class="line">hash-max-ziplist-entries 512   <span class="comment"># å…ƒç´ ä¸ªæ•°è¶…è¿‡512</span></span><br><span class="line">hash-max-ziplist-value 64      <span class="comment"># å•ä¸ªå…ƒç´ å¤§å°è¶…è¿‡64å­—èŠ‚</span></span><br></pre></td></tr></table></figure><p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼š</p><ul><li><strong>ziplist</strong>ï¼šå†…å­˜å ç”¨å°ï¼Œä½†æŸ¥æ‰¾æ€§èƒ½O(n)</li><li><strong>hashtable</strong>ï¼šæŸ¥æ‰¾æ€§èƒ½O(1)ï¼Œä½†å†…å­˜å ç”¨è¾ƒå¤§</li></ul><h3 id="3-3-Listï¼ˆåˆ—è¡¨ï¼‰"><a href="#3-3-Listï¼ˆåˆ—è¡¨ï¼‰" class="headerlink" title="3.3 Listï¼ˆåˆ—è¡¨ï¼‰"></a>3.3 Listï¼ˆåˆ—è¡¨ï¼‰</h3><h4 id="ç±»å‹ä»‹ç»-2"><a href="#ç±»å‹ä»‹ç»-2" class="headerlink" title="ç±»å‹ä»‹ç»"></a>ç±»å‹ä»‹ç»</h4><p>Listæ˜¯ä¸€ä¸ª<strong>ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨</strong>ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œæ”¯æŒä»å¤´éƒ¨æˆ–å°¾éƒ¨æ“ä½œã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li><strong>å•é”®å¤šå€¼</strong>ï¼šä¸€ä¸ªkeyå¯¹åº”å¤šä¸ªvalue</li><li><strong>æœ‰åº</strong>ï¼šæŒ‰ç…§æ’å…¥é¡ºåºæ’åº</li><li><strong>åŒå‘æ“ä½œ</strong>ï¼šå¯ä»¥ä»å·¦è¾¹ï¼ˆå¤´éƒ¨ï¼‰æˆ–å³è¾¹ï¼ˆå°¾éƒ¨ï¼‰æ“ä½œ</li><li><strong>åº•å±‚ç»“æ„</strong>ï¼šåŒå‘é“¾è¡¨ï¼Œä¸¤ç«¯æ“ä½œæ€§èƒ½é«˜O(1)ï¼Œä¸­é—´æ“ä½œæ€§èƒ½è¾ƒå·®O(n)</li><li><strong>å¯é‡å¤</strong>ï¼šå…è®¸å­˜å‚¨é‡å¤å…ƒç´ </li></ul><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šLPUSH + RPOP &#x3D; é˜Ÿåˆ—ï¼ŒLPUSH + LPOP &#x3D; æ ˆ</li><li><strong>æœ€æ–°åˆ—è¡¨</strong>ï¼šæ–‡ç« åˆ—è¡¨ã€è¯„è®ºåˆ—è¡¨ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰</li><li><strong>ç²‰ä¸åˆ—è¡¨</strong>ï¼šæŒ‰ç…§å…³æ³¨æ—¶é—´æ’åº</li><li><strong>Timelineæ—¶é—´è½´</strong>ï¼šå¾®åšã€æœ‹å‹åœˆç­‰ç¤¾äº¤åº”ç”¨</li></ul><p><strong>å­˜å‚¨ç»“æ„ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»å·¦è¾¹æ’å…¥</span></span><br><span class="line">LPUSH mylist <span class="string">&quot;c&quot;</span> <span class="string">&quot;b&quot;</span> <span class="string">&quot;a&quot;</span></span><br><span class="line">ç»“æœï¼š[<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»å³è¾¹æ’å…¥</span></span><br><span class="line">RPUSH mylist <span class="string">&quot;d&quot;</span> <span class="string">&quot;e&quot;</span></span><br><span class="line">ç»“æœï¼š[<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>]</span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨å‘½ä»¤-1"><a href="#å¸¸ç”¨å‘½ä»¤-1" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><h5 id="1-æ’å…¥æ“ä½œ"><a href="#1-æ’å…¥æ“ä½œ" class="headerlink" title="1. æ’å…¥æ“ä½œ"></a>1. æ’å…¥æ“ä½œ</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>LPUSH key value1 value2 ...</code></td><td>ä»å·¦è¾¹æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼</td><td><code>LPUSH list &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></td><td>åˆ—è¡¨é•¿åº¦</td></tr><tr><td><code>RPUSH key value1 value2 ...</code></td><td>ä»å³è¾¹æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼</td><td><code>RPUSH list &quot;x&quot; &quot;y&quot; &quot;z&quot;</code></td><td>åˆ—è¡¨é•¿åº¦</td></tr><tr><td><code>LPUSHX key value</code></td><td>keyå­˜åœ¨æ—¶ä»å·¦è¾¹æ’å…¥</td><td><code>LPUSHX list &quot;0&quot;</code></td><td>åˆ—è¡¨é•¿åº¦</td></tr><tr><td><code>RPUSHX key value</code></td><td>keyå­˜åœ¨æ—¶ä»å³è¾¹æ’å…¥</td><td><code>RPUSHX list &quot;9&quot;</code></td><td>åˆ—è¡¨é•¿åº¦</td></tr><tr><td><code>LINSERT key BEFORE|AFTER pivot value</code></td><td>åœ¨æŒ‡å®šå…ƒç´ å‰&#x2F;åæ’å…¥</td><td><code>LINSERT list BEFORE &quot;b&quot; &quot;new&quot;</code></td><td>åˆ—è¡¨é•¿åº¦</td></tr></tbody></table><h5 id="2-å¼¹å‡ºæ“ä½œ"><a href="#2-å¼¹å‡ºæ“ä½œ" class="headerlink" title="2. å¼¹å‡ºæ“ä½œ"></a>2. å¼¹å‡ºæ“ä½œ</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>LPOP key</code></td><td>ä»å·¦è¾¹å¼¹å‡ºä¸€ä¸ªå€¼</td><td><code>LPOP list</code></td><td>å¼¹å‡ºçš„å€¼</td></tr><tr><td><code>RPOP key</code></td><td>ä»å³è¾¹å¼¹å‡ºä¸€ä¸ªå€¼</td><td><code>RPOP list</code></td><td>å¼¹å‡ºçš„å€¼</td></tr><tr><td><code>BLPOP key1 key2 ... timeout</code></td><td>é˜»å¡å¼å·¦è¾¹å¼¹å‡º</td><td><code>BLPOP list 10</code></td><td>[key, value]</td></tr><tr><td><code>BRPOP key1 key2 ... timeout</code></td><td>é˜»å¡å¼å³è¾¹å¼¹å‡º</td><td><code>BRPOP list 10</code></td><td>[key, value]</td></tr><tr><td><code>RPOPLPUSH source destination</code></td><td>ä»sourceå³è¾¹å¼¹å‡ºæ’å…¥destinationå·¦è¾¹</td><td><code>RPOPLPUSH list1 list2</code></td><td>ç§»åŠ¨çš„å€¼</td></tr></tbody></table><blockquote><p><strong>å€¼åœ¨é”®åœ¨ï¼Œå€¼å…‰é”®äº¡</strong>ï¼šå½“åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ è¢«å¼¹å‡ºæ—¶ï¼Œè¯¥keyä¼šè‡ªåŠ¨åˆ é™¤</p></blockquote><h5 id="3-æŸ¥è¯¢æ“ä½œ"><a href="#3-æŸ¥è¯¢æ“ä½œ" class="headerlink" title="3. æŸ¥è¯¢æ“ä½œ"></a>3. æŸ¥è¯¢æ“ä½œ</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>LRANGE key start stop</code></td><td>è·å–æŒ‡å®šèŒƒå›´çš„å…ƒç´ </td><td><code>LRANGE list 0 -1</code></td><td>å…ƒç´ åˆ—è¡¨</td></tr><tr><td><code>LINDEX key index</code></td><td>è·å–æŒ‡å®šç´¢å¼•çš„å…ƒç´ </td><td><code>LINDEX list 0</code></td><td>å…ƒç´ å€¼</td></tr><tr><td><code>LLEN key</code></td><td>è·å–åˆ—è¡¨é•¿åº¦</td><td><code>LLEN list</code></td><td>åˆ—è¡¨é•¿åº¦</td></tr></tbody></table><blockquote><p><strong>ç´¢å¼•è¯´æ˜</strong>ï¼š</p><ul><li>0 è¡¨ç¤ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆæœ€å·¦è¾¹ï¼‰</li><li>-1 è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ï¼ˆæœ€å³è¾¹ï¼‰</li><li><code>LRANGE list 0 -1</code> è¡¨ç¤ºè·å–æ‰€æœ‰å…ƒç´ </li></ul></blockquote><h5 id="4-ä¿®æ”¹-åˆ é™¤æ“ä½œ"><a href="#4-ä¿®æ”¹-åˆ é™¤æ“ä½œ" class="headerlink" title="4. ä¿®æ”¹&#x2F;åˆ é™¤æ“ä½œ"></a>4. ä¿®æ”¹&#x2F;åˆ é™¤æ“ä½œ</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>LSET key index value</code></td><td>ä¿®æ”¹æŒ‡å®šç´¢å¼•çš„å€¼</td><td><code>LSET list 0 &quot;new&quot;</code></td><td>OK</td></tr><tr><td><code>LREM key count value</code></td><td>åˆ é™¤countä¸ªæŒ‡å®šå€¼</td><td><code>LREM list 2 &quot;a&quot;</code></td><td>åˆ é™¤çš„æ•°é‡</td></tr><tr><td><code>LTRIM key start stop</code></td><td>ä¿ç•™æŒ‡å®šèŒƒå›´ï¼Œåˆ é™¤å…¶ä»–</td><td><code>LTRIM list 0 2</code></td><td>OK</td></tr></tbody></table><p><strong>LREMçš„countå‚æ•°</strong>ï¼š</p><ul><li><code>count &gt; 0</code>ï¼šä»å·¦è¾¹åˆ é™¤countä¸ªvalue</li><li><code>count &lt; 0</code>ï¼šä»å³è¾¹åˆ é™¤|count|ä¸ªvalue</li><li><code>count = 0</code>ï¼šåˆ é™¤æ‰€æœ‰value</li></ul><h4 id="æ“ä½œç¤ºä¾‹-1"><a href="#æ“ä½œç¤ºä¾‹-1" class="headerlink" title="æ“ä½œç¤ºä¾‹"></a>æ“ä½œç¤ºä¾‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»å·¦è¾¹æ’å…¥</span></span><br><span class="line">127.0.0.1:6379&gt; LPUSH mylist <span class="string">&quot;c&quot;</span> <span class="string">&quot;b&quot;</span> <span class="string">&quot;a&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;a&quot;</span></span><br><span class="line">2) <span class="string">&quot;b&quot;</span></span><br><span class="line">3) <span class="string">&quot;c&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»å³è¾¹æ’å…¥</span></span><br><span class="line">127.0.0.1:6379&gt; RPUSH mylist <span class="string">&quot;d&quot;</span> <span class="string">&quot;e&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;a&quot;</span></span><br><span class="line">2) <span class="string">&quot;b&quot;</span></span><br><span class="line">3) <span class="string">&quot;c&quot;</span></span><br><span class="line">4) <span class="string">&quot;d&quot;</span></span><br><span class="line">5) <span class="string">&quot;e&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æŒ‡å®šå…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; LINDEX mylist 0</span><br><span class="line"><span class="string">&quot;a&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LINDEX mylist -1</span><br><span class="line"><span class="string">&quot;e&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–åˆ—è¡¨é•¿åº¦</span></span><br><span class="line">127.0.0.1:6379&gt; LLEN mylist</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»å·¦è¾¹å¼¹å‡º</span></span><br><span class="line">127.0.0.1:6379&gt; LPOP mylist</span><br><span class="line"><span class="string">&quot;a&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;b&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;d&quot;</span></span><br><span class="line">4) <span class="string">&quot;e&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æŒ‡å®šå…ƒç´ å‰æ’å…¥</span></span><br><span class="line">127.0.0.1:6379&gt; LINSERT mylist BEFORE <span class="string">&quot;c&quot;</span> <span class="string">&quot;new&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;b&quot;</span></span><br><span class="line">2) <span class="string">&quot;new&quot;</span></span><br><span class="line">3) <span class="string">&quot;c&quot;</span></span><br><span class="line">4) <span class="string">&quot;d&quot;</span></span><br><span class="line">5) <span class="string">&quot;e&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æŒ‡å®šå€¼</span></span><br><span class="line">127.0.0.1:6379&gt; LREM mylist 1 <span class="string">&quot;new&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹æŒ‡å®šç´¢å¼•çš„å€¼</span></span><br><span class="line">127.0.0.1:6379&gt; LSET mylist 0 <span class="string">&quot;B&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;B&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;d&quot;</span></span><br><span class="line">4) <span class="string">&quot;e&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RPOPLPUSH å®ç°é˜Ÿåˆ—è½®è½¬</span></span><br><span class="line">127.0.0.1:6379&gt; RPOPLPUSH mylist mylist</span><br><span class="line"><span class="string">&quot;e&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;e&quot;</span></span><br><span class="line">2) <span class="string">&quot;B&quot;</span></span><br><span class="line">3) <span class="string">&quot;c&quot;</span></span><br><span class="line">4) <span class="string">&quot;d&quot;</span></span><br></pre></td></tr></table></figure><h4 id="æ•°æ®ç»“æ„-2"><a href="#æ•°æ®ç»“æ„-2" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h4><p>Listçš„åº•å±‚å®ç°æ˜¯ <strong>quickListï¼ˆå¿«é€Ÿé“¾è¡¨ï¼‰</strong>ã€‚</p><p><strong>æ¼”è¿›è¿‡ç¨‹</strong>ï¼š</p><table><thead><tr><th>ç‰ˆæœ¬</th><th>æ•°æ®ç»“æ„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ—©æœŸç‰ˆæœ¬</strong></td><td>ziplist æˆ– linkedlist</td><td>å…ƒç´ å°‘ç”¨ziplistï¼Œå…ƒç´ å¤šç”¨linkedlist</td></tr><tr><td><strong>Redis 3.2+</strong></td><td><strong>quicklist</strong></td><td>ç»“åˆziplistå’Œlinkedlistçš„ä¼˜ç‚¹</td></tr></tbody></table><p><strong>quicklistç»“æ„</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">quicklist = ziplist + linkedlist</span><br><span class="line"></span><br><span class="line">[ziplist1] &lt;-&gt; [ziplist2] &lt;-&gt; [ziplist3] &lt;-&gt; [ziplist4]</span><br><span class="line">    â†“              â†“              â†“              â†“</span><br><span class="line"> [a,b,c]       [d,e,f]       [g,h,i]       [j,k,l]</span><br></pre></td></tr></table></figure><p><strong>è®¾è®¡ç†å¿µ</strong>ï¼š</p><ul><li>å°†å¤šä¸ª <strong>ziplist</strong> ä½¿ç”¨<strong>åŒå‘æŒ‡é’ˆ</strong>ä¸²èµ·æ¥</li><li>æ¯ä¸ªziplistå­˜å‚¨ä¸€éƒ¨åˆ†è¿ç»­çš„å…ƒç´ </li><li>æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆé¿å…äº†å¤§é‡æŒ‡é’ˆç©ºé—´æµªè´¹</li></ul><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ol><li><strong>ziplist</strong>ï¼šç´§å‡‘å­˜å‚¨ï¼ŒèŠ‚çœå†…å­˜</li><li><strong>linkedlist</strong>ï¼šåŒå‘é“¾è¡¨ï¼Œæ’å…¥åˆ é™¤å¿«O(1)</li><li><strong>quicklist</strong>ï¼šç»“åˆä¸¤è€…ä¼˜ç‚¹ï¼Œå¹³è¡¡æ€§èƒ½å’Œå†…å­˜</li></ol><p><strong>å¯¹æ¯”æ™®é€šé“¾è¡¨</strong>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ™®é€šé“¾è¡¨ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰prevå’ŒnextæŒ‡é’ˆ</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> *<span class="title">prev</span>;</span>  <span class="comment">// 8å­—èŠ‚</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> *<span class="title">next</span>;</span>  <span class="comment">// 8å­—èŠ‚</span></span><br><span class="line">    <span class="type">void</span> *value;            <span class="comment">// 8å­—èŠ‚</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å­˜å‚¨ä¸€ä¸ªint(4å­—èŠ‚)éœ€è¦24å­—èŠ‚ï¼Œç©ºé—´æµªè´¹ä¸¥é‡ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// quicklistï¼šå¤šä¸ªå…ƒç´ å…±äº«ä¸€ç»„æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">// å­˜å‚¨12ä¸ªintï¼Œåªéœ€è¦2ä¸ªæŒ‡é’ˆï¼Œç©ºé—´åˆ©ç”¨ç‡å¤§å¹…æå‡</span></span><br></pre></td></tr></table></figure><h3 id="3-4-Setï¼ˆé›†åˆï¼‰"><a href="#3-4-Setï¼ˆé›†åˆï¼‰" class="headerlink" title="3.4 Setï¼ˆé›†åˆï¼‰"></a>3.4 Setï¼ˆé›†åˆï¼‰</h3><h4 id="ç±»å‹ä»‹ç»-3"><a href="#ç±»å‹ä»‹ç»-3" class="headerlink" title="ç±»å‹ä»‹ç»"></a>ç±»å‹ä»‹ç»</h4><p>Setæ˜¯ä¸€ä¸ª<strong>æ— åºã€ä¸é‡å¤</strong>çš„å­—ç¬¦ä¸²é›†åˆã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li><strong>è‡ªåŠ¨å»é‡</strong>ï¼šä¸å…è®¸é‡å¤å…ƒç´ </li><li><strong>æ— åºæ€§</strong>ï¼šå…ƒç´ æ²¡æœ‰é¡ºåº</li><li><strong>é«˜æ•ˆæ€§</strong>ï¼šæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯ <strong>O(1)</strong></li><li><strong>åº•å±‚ç»“æ„</strong>ï¼švalueä¸ºnullçš„hashè¡¨</li></ul><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>æ ‡ç­¾ç³»ç»Ÿ</strong>ï¼šä¸€ç¯‡æ–‡ç« çš„æ ‡ç­¾ã€ä¸€ä¸ªç”¨æˆ·çš„å…´è¶£æ ‡ç­¾</li><li><strong>å…±åŒå¥½å‹</strong>ï¼šåˆ©ç”¨äº¤é›†æ“ä½œ</li><li><strong>æŠ½å¥–ç³»ç»Ÿ</strong>ï¼šSPOPéšæœºæŠ½å–ï¼Œè‡ªåŠ¨å»é‡</li><li><strong>ç‚¹èµ&#x2F;æ”¶è—</strong>ï¼šè®°å½•ç‚¹èµç”¨æˆ·IDï¼Œè‡ªåŠ¨å»é‡</li><li><strong>é»‘åå•&#x2F;ç™½åå•</strong>ï¼šå¿«é€Ÿåˆ¤æ–­ç”¨æˆ·æ˜¯å¦åœ¨åå•ä¸­</li></ul><p><strong>å¯¹æ¯”List</strong>ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th>Set</th><th>List</th></tr></thead><tbody><tr><td>é‡å¤</td><td>ä¸å…è®¸é‡å¤</td><td>å…è®¸é‡å¤</td></tr><tr><td>é¡ºåº</td><td>æ— åº</td><td>æœ‰åºï¼ˆæ’å…¥é¡ºåºï¼‰</td></tr><tr><td>æŸ¥æ‰¾æˆå‘˜</td><td>O(1)</td><td>O(n)</td></tr><tr><td>é›†åˆè¿ç®—</td><td>æ”¯æŒï¼ˆäº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼‰</td><td>ä¸æ”¯æŒ</td></tr></tbody></table><h4 id="å¸¸ç”¨å‘½ä»¤-2"><a href="#å¸¸ç”¨å‘½ä»¤-2" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><h5 id="1-åŸºç¡€æ“ä½œ-1"><a href="#1-åŸºç¡€æ“ä½œ-1" class="headerlink" title="1. åŸºç¡€æ“ä½œ"></a>1. åŸºç¡€æ“ä½œ</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>SADD key member1 member2 ...</code></td><td>æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td><td><code>SADD tags &quot;Java&quot; &quot;Redis&quot;</code></td><td>æˆåŠŸæ·»åŠ çš„æ•°é‡</td></tr><tr><td><code>SMEMBERS key</code></td><td>è·å–æ‰€æœ‰å…ƒç´ </td><td><code>SMEMBERS tags</code></td><td>å…ƒç´ åˆ—è¡¨</td></tr><tr><td><code>SISMEMBER key member</code></td><td>åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</td><td><code>SISMEMBER tags &quot;Java&quot;</code></td><td>1ï¼ˆå­˜åœ¨ï¼‰æˆ–0ï¼ˆä¸å­˜åœ¨ï¼‰</td></tr><tr><td><code>SCARD key</code></td><td>è·å–å…ƒç´ ä¸ªæ•°</td><td><code>SCARD tags</code></td><td>å…ƒç´ æ•°é‡</td></tr><tr><td><code>SREM key member1 member2 ...</code></td><td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td><td><code>SREM tags &quot;Java&quot;</code></td><td>æˆåŠŸåˆ é™¤çš„æ•°é‡</td></tr><tr><td><code>SPOP key [count]</code></td><td>éšæœºå¼¹å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td><td><code>SPOP tags 2</code></td><td>å¼¹å‡ºçš„å…ƒç´ </td></tr><tr><td><code>SRANDMEMBER key [count]</code></td><td>éšæœºè·å–å…ƒç´ ï¼ˆä¸åˆ é™¤ï¼‰</td><td><code>SRANDMEMBER tags 3</code></td><td>éšæœºå…ƒç´ åˆ—è¡¨</td></tr></tbody></table><blockquote><p><strong>SADDè‡ªåŠ¨å»é‡</strong>ï¼šå·²å­˜åœ¨çš„å…ƒç´ ä¼šè¢«è‡ªåŠ¨å¿½ç•¥ï¼Œä¸ä¼šé‡å¤æ·»åŠ </p></blockquote><h5 id="2-é›†åˆè¿ç®—"><a href="#2-é›†åˆè¿ç®—" class="headerlink" title="2. é›†åˆè¿ç®—"></a>2. é›†åˆè¿ç®—</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>SINTER key1 key2 ...</code></td><td>äº¤é›†</td><td><code>SINTER set1 set2</code></td><td>äº¤é›†å…ƒç´ åˆ—è¡¨</td></tr><tr><td><code>SINTERSTORE dest key1 key2 ...</code></td><td>äº¤é›†å¹¶å­˜å‚¨</td><td><code>SINTERSTORE result set1 set2</code></td><td>äº¤é›†å…ƒç´ æ•°é‡</td></tr><tr><td><code>SUNION key1 key2 ...</code></td><td>å¹¶é›†</td><td><code>SUNION set1 set2</code></td><td>å¹¶é›†å…ƒç´ åˆ—è¡¨</td></tr><tr><td><code>SUNIONSTORE dest key1 key2 ...</code></td><td>å¹¶é›†å¹¶å­˜å‚¨</td><td><code>SUNIONSTORE result set1 set2</code></td><td>å¹¶é›†å…ƒç´ æ•°é‡</td></tr><tr><td><code>SDIFF key1 key2 ...</code></td><td>å·®é›†</td><td><code>SDIFF set1 set2</code></td><td>å·®é›†å…ƒç´ åˆ—è¡¨</td></tr><tr><td><code>SDIFFSTORE dest key1 key2 ...</code></td><td>å·®é›†å¹¶å­˜å‚¨</td><td><code>SDIFFSTORE result set1 set2</code></td><td>å·®é›†å…ƒç´ æ•°é‡</td></tr><tr><td><code>SMOVE source dest member</code></td><td>ç§»åŠ¨å…ƒç´ </td><td><code>SMOVE set1 set2 &quot;Java&quot;</code></td><td>1ï¼ˆæˆåŠŸï¼‰æˆ–0ï¼ˆå¤±è´¥ï¼‰</td></tr></tbody></table><p><strong>é›†åˆè¿ç®—è¯´æ˜</strong>ï¼š</p><ul><li><strong>äº¤é›†ï¼ˆSINTERï¼‰</strong>ï¼šA âˆ© Bï¼Œä¸¤ä¸ªé›†åˆéƒ½æœ‰çš„å…ƒç´ </li><li><strong>å¹¶é›†ï¼ˆSUNIONï¼‰</strong>ï¼šA âˆª Bï¼Œä¸¤ä¸ªé›†åˆçš„æ‰€æœ‰å…ƒç´ ï¼ˆå»é‡ï¼‰</li><li><strong>å·®é›†ï¼ˆSDIFFï¼‰</strong>ï¼šA - Bï¼Œåœ¨Aä¸­ä½†ä¸åœ¨Bä¸­çš„å…ƒç´ </li></ul><h4 id="æ“ä½œç¤ºä¾‹-2"><a href="#æ“ä½œç¤ºä¾‹-2" class="headerlink" title="æ“ä½œç¤ºä¾‹"></a>æ“ä½œç¤ºä¾‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; SADD tags <span class="string">&quot;Java&quot;</span> <span class="string">&quot;Redis&quot;</span> <span class="string">&quot;MySQL&quot;</span> <span class="string">&quot;Spring&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS tags</span><br><span class="line">1) <span class="string">&quot;Java&quot;</span></span><br><span class="line">2) <span class="string">&quot;Redis&quot;</span></span><br><span class="line">3) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line">4) <span class="string">&quot;Spring&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER tags <span class="string">&quot;Java&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER tags <span class="string">&quot;Python&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">127.0.0.1:6379&gt; SCARD tags</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºè·å–å…ƒç´ ï¼ˆä¸åˆ é™¤ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER tags 2</span><br><span class="line">1) <span class="string">&quot;Redis&quot;</span></span><br><span class="line">2) <span class="string">&quot;Java&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºå¼¹å‡ºå…ƒç´ ï¼ˆåˆ é™¤ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; SPOP tags</span><br><span class="line"><span class="string">&quot;MySQL&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS tags</span><br><span class="line">1) <span class="string">&quot;Java&quot;</span></span><br><span class="line">2) <span class="string">&quot;Redis&quot;</span></span><br><span class="line">3) <span class="string">&quot;Spring&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é›†åˆè¿ç®—ç¤ºä¾‹</span></span><br><span class="line">127.0.0.1:6379&gt; SADD user:1:tags <span class="string">&quot;Java&quot;</span> <span class="string">&quot;Redis&quot;</span> <span class="string">&quot;MySQL&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; SADD user:2:tags <span class="string">&quot;Java&quot;</span> <span class="string">&quot;Python&quot;</span> <span class="string">&quot;Redis&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># äº¤é›†ï¼šå…±åŒæ ‡ç­¾</span></span><br><span class="line">127.0.0.1:6379&gt; SINTER user:1:tags user:2:tags</span><br><span class="line">1) <span class="string">&quot;Java&quot;</span></span><br><span class="line">2) <span class="string">&quot;Redis&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¹¶é›†ï¼šæ‰€æœ‰æ ‡ç­¾</span></span><br><span class="line">127.0.0.1:6379&gt; SUNION user:1:tags user:2:tags</span><br><span class="line">1) <span class="string">&quot;Java&quot;</span></span><br><span class="line">2) <span class="string">&quot;Redis&quot;</span></span><br><span class="line">3) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line">4) <span class="string">&quot;Python&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å·®é›†ï¼šuser1ç‹¬æœ‰çš„æ ‡ç­¾</span></span><br><span class="line">127.0.0.1:6379&gt; SDIFF user:1:tags user:2:tags</span><br><span class="line">1) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»åŠ¨å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; SMOVE user:1:tags user:2:tags <span class="string">&quot;MySQL&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><h4 id="å®é™…åº”ç”¨æ¡ˆä¾‹"><a href="#å®é™…åº”ç”¨æ¡ˆä¾‹" class="headerlink" title="å®é™…åº”ç”¨æ¡ˆä¾‹"></a>å®é™…åº”ç”¨æ¡ˆä¾‹</h4><h5 id="æ¡ˆä¾‹1ï¼šå…±åŒå¥½å‹"><a href="#æ¡ˆä¾‹1ï¼šå…±åŒå¥½å‹" class="headerlink" title="æ¡ˆä¾‹1ï¼šå…±åŒå¥½å‹"></a>æ¡ˆä¾‹1ï¼šå…±åŒå¥½å‹</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨æˆ·Açš„å¥½å‹</span></span><br><span class="line">SADD user:A:friends <span class="string">&quot;userB&quot;</span> <span class="string">&quot;userC&quot;</span> <span class="string">&quot;userD&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·Eçš„å¥½å‹</span></span><br><span class="line">SADD user:E:friends <span class="string">&quot;userC&quot;</span> <span class="string">&quot;userD&quot;</span> <span class="string">&quot;userF&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾Aå’ŒEçš„å…±åŒå¥½å‹</span></span><br><span class="line">SINTER user:A:friends user:E:friends</span><br><span class="line"><span class="comment"># ç»“æœï¼š[&quot;userC&quot;, &quot;userD&quot;]</span></span><br></pre></td></tr></table></figure><h5 id="æ¡ˆä¾‹2ï¼šæŠ½å¥–ç³»ç»Ÿ"><a href="#æ¡ˆä¾‹2ï¼šæŠ½å¥–ç³»ç»Ÿ" class="headerlink" title="æ¡ˆä¾‹2ï¼šæŠ½å¥–ç³»ç»Ÿ"></a>æ¡ˆä¾‹2ï¼šæŠ½å¥–ç³»ç»Ÿ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ å‚ä¸æŠ½å¥–çš„ç”¨æˆ·</span></span><br><span class="line">SADD lottery:2024 <span class="string">&quot;user1&quot;</span> <span class="string">&quot;user2&quot;</span> <span class="string">&quot;user3&quot;</span> <span class="string">&quot;user4&quot;</span> <span class="string">&quot;user5&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠ½å–1ä¸ªä¸€ç­‰å¥–</span></span><br><span class="line">SPOP lottery:2024 1</span><br><span class="line"><span class="comment"># ç»“æœï¼š[&quot;user3&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠ½å–2ä¸ªäºŒç­‰å¥–</span></span><br><span class="line">SPOP lottery:2024 2</span><br><span class="line"><span class="comment"># ç»“æœï¼š[&quot;user1&quot;, &quot;user5&quot;]</span></span><br></pre></td></tr></table></figure><h5 id="æ¡ˆä¾‹3ï¼šæ ‡ç­¾ç³»ç»Ÿ"><a href="#æ¡ˆä¾‹3ï¼šæ ‡ç­¾ç³»ç»Ÿ" class="headerlink" title="æ¡ˆä¾‹3ï¼šæ ‡ç­¾ç³»ç»Ÿ"></a>æ¡ˆä¾‹3ï¼šæ ‡ç­¾ç³»ç»Ÿ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»™æ–‡ç« æ·»åŠ æ ‡ç­¾</span></span><br><span class="line">SADD article:1001:tags <span class="string">&quot;Java&quot;</span> <span class="string">&quot;åç«¯&quot;</span> <span class="string">&quot;Redis&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢æŸä¸ªæ ‡ç­¾æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">SISMEMBER article:1001:tags <span class="string">&quot;Java&quot;</span></span><br><span class="line"><span class="comment"># ç»“æœï¼š1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ–‡ç« çš„æ‰€æœ‰æ ‡ç­¾</span></span><br><span class="line">SMEMBERS article:1001:tags</span><br><span class="line"><span class="comment"># ç»“æœï¼š[&quot;Java&quot;, &quot;åç«¯&quot;, &quot;Redis&quot;]</span></span><br></pre></td></tr></table></figure><h4 id="æ•°æ®ç»“æ„-3"><a href="#æ•°æ®ç»“æ„-3" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h4><p>Setçš„åº•å±‚å®ç°æ˜¯ <strong>dictå­—å…¸</strong>ï¼ˆå“ˆå¸Œè¡¨ï¼‰ã€‚</p><p><strong>å®ç°åŸç†</strong>ï¼š</p><ul><li>ç±»ä¼¼Javaä¸­çš„ <code>HashSet</code></li><li>Javaçš„ <code>HashSet</code> å†…éƒ¨ä½¿ç”¨ <code>HashMap</code> å®ç°ï¼Œæ‰€æœ‰valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡</li><li>Redisçš„Setä¹Ÿæ˜¯ä½¿ç”¨hashç»“æ„ï¼Œ<strong>æ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå†…éƒ¨å€¼ï¼ˆNULLï¼‰</strong></li></ul><p><strong>ç»“æ„å¯¹æ¯”</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java HashSetå®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HashSet</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;E, Object&gt; map;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">PRESENT</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> map.put(e, PRESENT) == <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Redis Setå®ç°ï¼ˆä¼ªä»£ç ï¼‰</span></span><br><span class="line">struct set &#123;</span><br><span class="line">    dict *dict;  <span class="comment">// å“ˆå¸Œè¡¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ·»åŠ å…ƒç´ æ—¶ï¼šdict[member] = NULL</span></span><br></pre></td></tr></table></figure><p><strong>æ€§èƒ½ç‰¹ç‚¹</strong>ï¼š</p><table><thead><tr><th>æ“ä½œ</th><th>æ—¶é—´å¤æ‚åº¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>SADD</td><td>O(1)</td><td>å“ˆå¸Œè¡¨ç›´æ¥å®šä½</td></tr><tr><td>SREM</td><td>O(1)</td><td>å“ˆå¸Œè¡¨ç›´æ¥å®šä½</td></tr><tr><td>SISMEMBER</td><td>O(1)</td><td>å“ˆå¸Œè¡¨ç›´æ¥åˆ¤æ–­</td></tr><tr><td>SMEMBERS</td><td>O(n)</td><td>éœ€è¦éå†æ‰€æœ‰å…ƒç´ </td></tr><tr><td>SINTER</td><td>O(n*m)</td><td>nä¸ºæœ€å°é›†åˆå…ƒç´ æ•°ï¼Œmä¸ºé›†åˆä¸ªæ•°</td></tr></tbody></table><p><strong>ä¼˜åŒ–ç­–ç•¥</strong>ï¼š</p><ul><li>å½“Setä¸­åªåŒ…å«<strong>æ•´æ•°å€¼</strong>ä¸”<strong>å…ƒç´ æ•°é‡è¾ƒå°‘</strong>æ—¶ï¼Œä½¿ç”¨ <strong>intset</strong>ï¼ˆæ•´æ•°é›†åˆï¼‰</li><li>å…¶ä»–æƒ…å†µä½¿ç”¨ <strong>hashtable</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># intsetè§¦å‘æ¡ä»¶ï¼ˆå¯åœ¨redis.confä¸­é…ç½®ï¼‰</span></span><br><span class="line">set-max-intset-entries 512  <span class="comment"># å…ƒç´ ä¸ªæ•°ä¸è¶…è¿‡512æ—¶ä½¿ç”¨intset</span></span><br></pre></td></tr></table></figure><h3 id="3-5-ZSetï¼ˆæœ‰åºé›†åˆï¼‰"><a href="#3-5-ZSetï¼ˆæœ‰åºé›†åˆï¼‰" class="headerlink" title="3.5 ZSetï¼ˆæœ‰åºé›†åˆï¼‰"></a>3.5 ZSetï¼ˆæœ‰åºé›†åˆï¼‰</h3><h4 id="ç±»å‹ä»‹ç»-4"><a href="#ç±»å‹ä»‹ç»-4" class="headerlink" title="ç±»å‹ä»‹ç»"></a>ç±»å‹ä»‹ç»</h4><p>ZSetï¼ˆSorted Setï¼‰æ˜¯ä¸€ä¸ª<strong>æœ‰åºã€ä¸é‡å¤</strong>çš„å­—ç¬¦ä¸²é›†åˆï¼Œæ¯ä¸ªæˆå‘˜éƒ½å…³è”ä¸€ä¸ª<strong>åˆ†æ•°ï¼ˆscoreï¼‰</strong>ã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li><strong>æœ‰åºæ€§</strong>ï¼šæŒ‰ç…§scoreä»ä½åˆ°é«˜æ’åº</li><li><strong>ä¸é‡å¤</strong>ï¼šmemberå”¯ä¸€ï¼Œä½†scoreå¯ä»¥é‡å¤</li><li><strong>åŒé‡ç´¢å¼•</strong>ï¼šæ—¢å¯ä»¥é€šè¿‡memberæŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥é€šè¿‡scoreèŒƒå›´æŸ¥è¯¢</li><li><strong>é«˜æ•ˆæ€§</strong>ï¼šæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾éƒ½å¾ˆå¿«</li></ul><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>æ’è¡Œæ¦œ</strong>ï¼šæ¸¸æˆæ’è¡Œã€é”€é‡æ’è¡Œã€çƒ­æœæ¦œ</li><li><strong>å»¶è¿Ÿé˜Ÿåˆ—</strong>ï¼šä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºscore</li><li><strong>ä¼˜å…ˆçº§é˜Ÿåˆ—</strong>ï¼šä¸åŒä¼˜å…ˆçº§çš„ä»»åŠ¡</li><li><strong>è®¿é—®ç»Ÿè®¡</strong>ï¼šæ–‡ç« æµè§ˆé‡ã€ç‚¹å‡»é‡æ’åº</li><li><strong>èŒƒå›´æŸ¥æ‰¾</strong>ï¼šå·¥èµ„èŒƒå›´æŸ¥è¯¢ã€å¹´é¾„èŒƒå›´æŸ¥è¯¢</li></ul><p><strong>å¯¹æ¯”å…¶ä»–é›†åˆ</strong>ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th>Set</th><th>ZSet</th></tr></thead><tbody><tr><td>æ’åº</td><td>æ— åº</td><td>æœ‰åºï¼ˆæŒ‰scoreï¼‰</td></tr><tr><td>é‡å¤</td><td>ä¸å…è®¸</td><td>memberä¸é‡å¤ï¼Œscoreå¯é‡å¤</td></tr><tr><td>ç´¢å¼•</td><td>ä»…member</td><td>member + scoreåŒé‡ç´¢å¼•</td></tr><tr><td>åº”ç”¨</td><td>æ ‡ç­¾ã€å»é‡</td><td>æ’è¡Œæ¦œã€ä¼˜å…ˆçº§é˜Ÿåˆ—</td></tr></tbody></table><p><strong>å­˜å‚¨ç»“æ„ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¸¸æˆæ’è¡Œæ¦œ</span></span><br><span class="line">player_rank</span><br><span class="line">    â”œâ”€ (<span class="string">&quot;Alice&quot;</span>, 1500)    <span class="comment"># member: Alice, score: 1500</span></span><br><span class="line">    â”œâ”€ (<span class="string">&quot;Bob&quot;</span>, 2000)      <span class="comment"># member: Bob, score: 2000</span></span><br><span class="line">    â””â”€ (<span class="string">&quot;Charlie&quot;</span>, 2500)  <span class="comment"># member: Charlie, score: 2500</span></span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨å‘½ä»¤-3"><a href="#å¸¸ç”¨å‘½ä»¤-3" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><h5 id="1-åŸºç¡€æ“ä½œ-2"><a href="#1-åŸºç¡€æ“ä½œ-2" class="headerlink" title="1. åŸºç¡€æ“ä½œ"></a>1. åŸºç¡€æ“ä½œ</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>ZADD key score1 member1 score2 member2 ...</code></td><td>æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td><td><code>ZADD rank 100 &quot;Alice&quot;</code></td><td>æˆåŠŸæ·»åŠ çš„æ•°é‡</td></tr><tr><td><code>ZCARD key</code></td><td>è·å–å…ƒç´ ä¸ªæ•°</td><td><code>ZCARD rank</code></td><td>å…ƒç´ æ•°é‡</td></tr><tr><td><code>ZSCORE key member</code></td><td>è·å–å…ƒç´ çš„åˆ†æ•°</td><td><code>ZSCORE rank &quot;Alice&quot;</code></td><td>åˆ†æ•°å€¼</td></tr><tr><td><code>ZINCRBY key increment member</code></td><td>ç»™å…ƒç´ çš„åˆ†æ•°å¢åŠ increment</td><td><code>ZINCRBY rank 10 &quot;Alice&quot;</code></td><td>å¢åŠ åçš„åˆ†æ•°</td></tr><tr><td><code>ZREM key member1 member2 ...</code></td><td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td><td><code>ZREM rank &quot;Alice&quot;</code></td><td>æˆåŠŸåˆ é™¤çš„æ•°é‡</td></tr><tr><td><code>ZCOUNT key min max</code></td><td>ç»Ÿè®¡åˆ†æ•°åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•°</td><td><code>ZCOUNT rank 0 100</code></td><td>å…ƒç´ æ•°é‡</td></tr></tbody></table><h5 id="2-èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰ç´¢å¼•ï¼‰"><a href="#2-èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰ç´¢å¼•ï¼‰" class="headerlink" title="2. èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰ç´¢å¼•ï¼‰"></a>2. èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰ç´¢å¼•ï¼‰</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>ZRANGE key start stop [WITHSCORES]</code></td><td>æŒ‰ç´¢å¼•è·å–å…ƒç´ ï¼ˆå‡åºï¼‰</td><td><code>ZRANGE rank 0 9 WITHSCORES</code></td><td>å…ƒç´ åˆ—è¡¨</td></tr><tr><td><code>ZREVRANGE key start stop [WITHSCORES]</code></td><td>æŒ‰ç´¢å¼•è·å–å…ƒç´ ï¼ˆé™åºï¼‰</td><td><code>ZREVRANGE rank 0 9 WITHSCORES</code></td><td>å…ƒç´ åˆ—è¡¨</td></tr><tr><td><code>ZRANK key member</code></td><td>è·å–å…ƒç´ æ’åï¼ˆå‡åºï¼Œä»0å¼€å§‹ï¼‰</td><td><code>ZRANK rank &quot;Alice&quot;</code></td><td>æ’å</td></tr><tr><td><code>ZREVRANK key member</code></td><td>è·å–å…ƒç´ æ’åï¼ˆé™åºï¼Œä»0å¼€å§‹ï¼‰</td><td><code>ZREVRANK rank &quot;Alice&quot;</code></td><td>æ’å</td></tr></tbody></table><blockquote><p><strong>WITHSCORESå‚æ•°</strong>ï¼šåŠ ä¸Šæ­¤å‚æ•°å¯ä»¥åŒæ—¶è¿”å›åˆ†æ•°</p></blockquote><h5 id="3-èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åˆ†æ•°ï¼‰"><a href="#3-èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åˆ†æ•°ï¼‰" class="headerlink" title="3. èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åˆ†æ•°ï¼‰"></a>3. èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åˆ†æ•°ï¼‰</h5><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code></td><td>æŒ‰åˆ†æ•°èŒƒå›´è·å–ï¼ˆå‡åºï¼‰</td><td><code>ZRANGEBYSCORE rank 0 100</code></td><td>å…ƒç´ åˆ—è¡¨</td></tr><tr><td><code>ZREVRANGEBYSCORE key max min [WITHSCORES] [LIMIT offset count]</code></td><td>æŒ‰åˆ†æ•°èŒƒå›´è·å–ï¼ˆé™åºï¼‰</td><td><code>ZREVRANGEBYSCORE rank 100 0</code></td><td>å…ƒç´ åˆ—è¡¨</td></tr><tr><td><code>ZREMRANGEBYRANK key start stop</code></td><td>åˆ é™¤æŒ‡å®šæ’åèŒƒå›´çš„å…ƒç´ </td><td><code>ZREMRANGEBYRANK rank 0 2</code></td><td>åˆ é™¤çš„æ•°é‡</td></tr><tr><td><code>ZREMRANGEBYSCORE key min max</code></td><td>åˆ é™¤æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ </td><td><code>ZREMRANGEBYSCORE rank 0 100</code></td><td>åˆ é™¤çš„æ•°é‡</td></tr></tbody></table><p><strong>åˆ†æ•°èŒƒå›´è¯­æ³•</strong>ï¼š</p><ul><li><code>ZRANGEBYSCORE key 0 100</code>ï¼š0 â‰¤ score â‰¤ 100</li><li><code>ZRANGEBYSCORE key (0 (100</code>ï¼š0 &lt; score &lt; 100ï¼ˆæ‹¬å·è¡¨ç¤ºå¼€åŒºé—´ï¼‰</li><li><code>ZRANGEBYSCORE key -inf +inf</code>ï¼šæ‰€æœ‰å…ƒç´ ï¼ˆ-infè¡¨ç¤ºè´Ÿæ— ç©·ï¼Œ+infè¡¨ç¤ºæ­£æ— ç©·ï¼‰</li></ul><h4 id="æ“ä½œç¤ºä¾‹-3"><a href="#æ“ä½œç¤ºä¾‹-3" class="headerlink" title="æ“ä½œç¤ºä¾‹"></a>æ“ä½œç¤ºä¾‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ æ¸¸æˆç©å®¶åˆ†æ•°</span></span><br><span class="line">127.0.0.1:6379&gt; ZADD game:rank 1500 <span class="string">&quot;Alice&quot;</span> 2000 <span class="string">&quot;Bob&quot;</span> 1800 <span class="string">&quot;Charlie&quot;</span> 2200 <span class="string">&quot;David&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰ç©å®¶ï¼ˆå‡åºï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGE game:rank 0 -1 WITHSCORES</span><br><span class="line">1) <span class="string">&quot;Alice&quot;</span></span><br><span class="line">2) <span class="string">&quot;1500&quot;</span></span><br><span class="line">3) <span class="string">&quot;Charlie&quot;</span></span><br><span class="line">4) <span class="string">&quot;1800&quot;</span></span><br><span class="line">5) <span class="string">&quot;Bob&quot;</span></span><br><span class="line">6) <span class="string">&quot;2000&quot;</span></span><br><span class="line">7) <span class="string">&quot;David&quot;</span></span><br><span class="line">8) <span class="string">&quot;2200&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‰3åï¼ˆé™åºï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGE game:rank 0 2 WITHSCORES</span><br><span class="line">1) <span class="string">&quot;David&quot;</span></span><br><span class="line">2) <span class="string">&quot;2200&quot;</span></span><br><span class="line">3) <span class="string">&quot;Bob&quot;</span></span><br><span class="line">4) <span class="string">&quot;2000&quot;</span></span><br><span class="line">5) <span class="string">&quot;Charlie&quot;</span></span><br><span class="line">6) <span class="string">&quot;1800&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–Aliceçš„åˆ†æ•°</span></span><br><span class="line">127.0.0.1:6379&gt; ZSCORE game:rank <span class="string">&quot;Alice&quot;</span></span><br><span class="line"><span class="string">&quot;1500&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™AliceåŠ 100åˆ†</span></span><br><span class="line">127.0.0.1:6379&gt; ZINCRBY game:rank 100 <span class="string">&quot;Alice&quot;</span></span><br><span class="line"><span class="string">&quot;1600&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹Aliceçš„æ’åï¼ˆå‡åºï¼Œä»0å¼€å§‹ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANK game:rank <span class="string">&quot;Alice&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹Aliceçš„æ’åï¼ˆé™åºï¼Œä»0å¼€å§‹ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; ZREVRANK game:rank <span class="string">&quot;Alice&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹1800-2000åˆ†çš„ç©å®¶</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE game:rank 1800 2000 WITHSCORES</span><br><span class="line">1) <span class="string">&quot;Alice&quot;</span></span><br><span class="line">2) <span class="string">&quot;1600&quot;</span></span><br><span class="line">3) <span class="string">&quot;Charlie&quot;</span></span><br><span class="line">4) <span class="string">&quot;1800&quot;</span></span><br><span class="line">5) <span class="string">&quot;Bob&quot;</span></span><br><span class="line">6) <span class="string">&quot;2000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡1500-2000åˆ†çš„ç©å®¶æ•°é‡</span></span><br><span class="line">127.0.0.1:6379&gt; ZCOUNT game:rank 1500 2000</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åˆ†æ•°ä½äº1600çš„ç©å®¶</span></span><br><span class="line">127.0.0.1:6379&gt; ZREMRANGEBYSCORE game:rank -inf 1600</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å…ƒç´ æ€»æ•°</span></span><br><span class="line">127.0.0.1:6379&gt; ZCARD game:rank</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><h4 id="å®é™…åº”ç”¨æ¡ˆä¾‹-1"><a href="#å®é™…åº”ç”¨æ¡ˆä¾‹-1" class="headerlink" title="å®é™…åº”ç”¨æ¡ˆä¾‹"></a>å®é™…åº”ç”¨æ¡ˆä¾‹</h4><h5 id="æ¡ˆä¾‹1ï¼šæ–‡ç« è®¿é—®é‡æ’è¡Œæ¦œ"><a href="#æ¡ˆä¾‹1ï¼šæ–‡ç« è®¿é—®é‡æ’è¡Œæ¦œ" class="headerlink" title="æ¡ˆä¾‹1ï¼šæ–‡ç« è®¿é—®é‡æ’è¡Œæ¦œ"></a>æ¡ˆä¾‹1ï¼šæ–‡ç« è®¿é—®é‡æ’è¡Œæ¦œ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–æ–‡ç« è®¿é—®é‡</span></span><br><span class="line">ZADD article:views 100 <span class="string">&quot;article:1001&quot;</span> 230 <span class="string">&quot;article:1002&quot;</span> 85 <span class="string">&quot;article:1003&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ç« è¢«è®¿é—®ï¼Œè®¿é—®é‡+1</span></span><br><span class="line">ZINCRBY article:views 1 <span class="string">&quot;article:1001&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–è®¿é—®é‡æœ€é«˜çš„10ç¯‡æ–‡ç« </span></span><br><span class="line">ZREVRANGE article:views 0 9 WITHSCORES</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æŸç¯‡æ–‡ç« çš„è®¿é—®é‡</span></span><br><span class="line">ZSCORE article:views <span class="string">&quot;article:1001&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æŸç¯‡æ–‡ç« çš„æ’åï¼ˆç¬¬å‡ åï¼‰</span></span><br><span class="line">ZREVRANK article:views <span class="string">&quot;article:1001&quot;</span></span><br></pre></td></tr></table></figure><h5 id="æ¡ˆä¾‹2ï¼šå»¶è¿Ÿé˜Ÿåˆ—"><a href="#æ¡ˆä¾‹2ï¼šå»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="æ¡ˆä¾‹2ï¼šå»¶è¿Ÿé˜Ÿåˆ—"></a>æ¡ˆä¾‹2ï¼šå»¶è¿Ÿé˜Ÿåˆ—</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ å»¶è¿Ÿä»»åŠ¡ï¼ˆä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºscoreï¼‰</span></span><br><span class="line">ZADD delay:queue 1699999999 <span class="string">&quot;task:1&quot;</span> 1700000100 <span class="string">&quot;task:2&quot;</span> 1700000200 <span class="string">&quot;task:3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰æ—¶é—´æˆ³ä¹‹å‰çš„æ‰€æœ‰ä»»åŠ¡ï¼ˆåˆ°æœŸçš„ä»»åŠ¡ï¼‰</span></span><br><span class="line">ZRANGEBYSCORE delay:queue -inf 1700000000</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œä»»åŠ¡ååˆ é™¤</span></span><br><span class="line">ZREM delay:queue <span class="string">&quot;task:1&quot;</span></span><br></pre></td></tr></table></figure><h5 id="æ¡ˆä¾‹3ï¼šå·¥èµ„èŒƒå›´æŸ¥è¯¢"><a href="#æ¡ˆä¾‹3ï¼šå·¥èµ„èŒƒå›´æŸ¥è¯¢" class="headerlink" title="æ¡ˆä¾‹3ï¼šå·¥èµ„èŒƒå›´æŸ¥è¯¢"></a>æ¡ˆä¾‹3ï¼šå·¥èµ„èŒƒå›´æŸ¥è¯¢</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ å‘˜å·¥å·¥èµ„ä¿¡æ¯</span></span><br><span class="line">ZADD employee:salary 5000 <span class="string">&quot;emp:1001&quot;</span> 8000 <span class="string">&quot;emp:1002&quot;</span> 12000 <span class="string">&quot;emp:1003&quot;</span> 15000 <span class="string">&quot;emp:1004&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢å·¥èµ„åœ¨8000-12000ä¹‹é—´çš„å‘˜å·¥</span></span><br><span class="line">ZRANGEBYSCORE employee:salary 8000 12000</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢å·¥èµ„è¶…è¿‡10000çš„å‘˜å·¥æ•°é‡</span></span><br><span class="line">ZCOUNT employee:salary 10000 +inf</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å·¥èµ„æœ€é«˜çš„5åå‘˜å·¥</span></span><br><span class="line">ZREVRANGE employee:salary 0 4 WITHSCORES</span><br></pre></td></tr></table></figure><h4 id="æ•°æ®ç»“æ„-4"><a href="#æ•°æ®ç»“æ„-4" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h4><p>ZSetçš„åº•å±‚å®ç°ä½¿ç”¨äº†<strong>ä¸¤ä¸ªæ•°æ®ç»“æ„</strong>ï¼š</p><h5 id="1-Hashï¼ˆå“ˆå¸Œè¡¨ï¼‰"><a href="#1-Hashï¼ˆå“ˆå¸Œè¡¨ï¼‰" class="headerlink" title="1. Hashï¼ˆå“ˆå¸Œè¡¨ï¼‰"></a>1. Hashï¼ˆå“ˆå¸Œè¡¨ï¼‰</h5><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>å…³è” <strong>member</strong> å’Œ <strong>score</strong></li><li>ä¿éšœmemberçš„å”¯ä¸€æ€§</li><li>é€šè¿‡memberå¿«é€Ÿæ‰¾åˆ°scoreï¼š<strong>O(1)</strong></li></ul><h5 id="2-Skip-Listï¼ˆè·³è·ƒè¡¨ï¼‰"><a href="#2-Skip-Listï¼ˆè·³è·ƒè¡¨ï¼‰" class="headerlink" title="2. Skip Listï¼ˆè·³è·ƒè¡¨ï¼‰"></a>2. Skip Listï¼ˆè·³è·ƒè¡¨ï¼‰</h5><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>æŒ‰ç…§scoreç»™memberæ’åº</li><li>æ”¯æŒæŒ‰scoreèŒƒå›´æŸ¥è¯¢</li><li>æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ï¼š<strong>O(log n)</strong></li></ul><p><strong>è·³è·ƒè¡¨åŸç†</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å±‚çº§4:  1 --------------------------------&gt; 50</span><br><span class="line">å±‚çº§3:  1 ----------&gt; 20 -----------------&gt; 50</span><br><span class="line">å±‚çº§2:  1 -----&gt; 10 -&gt; 20 -&gt; 30 ----------&gt; 50</span><br><span class="line">å±‚çº§1:  1 -&gt; 5 -&gt; 10 -&gt; 20 -&gt; 30 -&gt; 40 -&gt; 50  (åŸå§‹é“¾è¡¨)</span><br></pre></td></tr></table></figure><p><strong>è·³è·ƒè¡¨ä¼˜åŠ¿</strong>ï¼š</p><ul><li><strong>æŸ¥æ‰¾æ•ˆç‡</strong>ï¼šæ¥è¿‘äºŒåˆ†æŸ¥æ‰¾ï¼ŒO(log n)</li><li><strong>å®ç°ç®€å•</strong>ï¼šæ¯”çº¢é»‘æ ‘ç®€å•</li><li><strong>åŒºé—´æŸ¥è¯¢</strong>ï¼šå¤©ç„¶æ”¯æŒèŒƒå›´æŸ¥è¯¢</li></ul><p><strong>å¯¹æ¯”å…¶ä»–ç»“æ„</strong>ï¼š</p><table><thead><tr><th>æ•°æ®ç»“æ„</th><th>æ’å…¥&#x2F;åˆ é™¤</th><th>æŸ¥æ‰¾</th><th>èŒƒå›´æŸ¥è¯¢</th><th>å®ç°å¤æ‚åº¦</th></tr></thead><tbody><tr><td><strong>è·³è·ƒè¡¨</strong></td><td>O(log n)</td><td>O(log n)</td><td>âœ… æ”¯æŒ</td><td>ç®€å•</td></tr><tr><td><strong>çº¢é»‘æ ‘</strong></td><td>O(log n)</td><td>O(log n)</td><td>âœ… æ”¯æŒ</td><td>å¤æ‚</td></tr><tr><td><strong>å“ˆå¸Œè¡¨</strong></td><td>O(1)</td><td>O(1)</td><td>âŒ ä¸æ”¯æŒ</td><td>ç®€å•</td></tr><tr><td><strong>æ•°ç»„</strong></td><td>O(n)</td><td>O(n)</td><td>âœ… æ”¯æŒ</td><td>ç®€å•</td></tr></tbody></table><p><strong>ZSet &#x3D; Hash + Skip List</strong>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ZSetç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zset</span> &#123;</span></span><br><span class="line">    dict *dict;         <span class="comment">// å“ˆå¸Œè¡¨ï¼šmember -&gt; score</span></span><br><span class="line">    zskiplist *zsl;     <span class="comment">// è·³è·ƒè¡¨ï¼šæŒ‰scoreæ’åº</span></span><br><span class="line">&#125; zset;</span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼Ÿ</strong></p><ol><li><p><strong>Hash</strong>ï¼šé€šè¿‡memberå¿«é€Ÿè·å–scoreï¼ˆO(1)ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSCORE key member  <span class="comment"># éœ€è¦å“ˆå¸Œè¡¨</span></span><br></pre></td></tr></table></figure></li><li><p><strong>Skip List</strong>ï¼šæŒ‰scoreæ’åºå’ŒèŒƒå›´æŸ¥è¯¢ï¼ˆO(log n)ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZRANGE key 0 10           <span class="comment"># éœ€è¦è·³è·ƒè¡¨</span></span><br><span class="line">ZRANGEBYSCORE key 0 100   <span class="comment"># éœ€è¦è·³è·ƒè¡¨</span></span><br></pre></td></tr></table></figure></li></ol><p><strong>æ€§èƒ½æ€»ç»“</strong>ï¼š</p><table><thead><tr><th>æ“ä½œ</th><th>æ—¶é—´å¤æ‚åº¦</th><th>ä½¿ç”¨çš„ç»“æ„</th></tr></thead><tbody><tr><td>ZADD</td><td>O(log n)</td><td>Hash + Skip List</td></tr><tr><td>ZREM</td><td>O(log n)</td><td>Hash + Skip List</td></tr><tr><td>ZSCORE</td><td>O(1)</td><td>Hash</td></tr><tr><td>ZRANK</td><td>O(log n)</td><td>Skip List</td></tr><tr><td>ZRANGE</td><td>O(log n + m)</td><td>Skip Listï¼ˆmä¸ºè¿”å›å…ƒç´ æ•°ï¼‰</td></tr><tr><td>ZRANGEBYSCORE</td><td>O(log n + m)</td><td>Skip List</td></tr></tbody></table><hr><h2 id="4-Redisé…ç½®æ–‡ä»¶è¯¦è§£"><a href="#4-Redisé…ç½®æ–‡ä»¶è¯¦è§£" class="headerlink" title="4. Redisé…ç½®æ–‡ä»¶è¯¦è§£"></a>4. Redisé…ç½®æ–‡ä»¶è¯¦è§£</h2><p>Redisçš„é…ç½®æ–‡ä»¶ï¼ˆredis.confï¼‰æ˜¯RedisæœåŠ¡å™¨çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œåˆç†é…ç½®å¯ä»¥å¤§å¹…æå‡Redisçš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚</p><blockquote><p><strong>é…ç½®æ–‡ä»¶ä½ç½®</strong>ï¼š</p><ul><li>é»˜è®¤è·¯å¾„ï¼š<code>/etc/redis/redis.conf</code></li><li>è‡ªå®šä¹‰è·¯å¾„ï¼š<code>/myredis/redis.conf</code>ï¼ˆå¯è‡ªå®šä¹‰ï¼‰</li><li>å¯åŠ¨æ—¶æŒ‡å®šï¼š<code>redis-server /path/to/redis.conf</code></li></ul></blockquote><h3 id="4-1-Unitsï¼ˆå•ä½ï¼‰"><a href="#4-1-Unitsï¼ˆå•ä½ï¼‰" class="headerlink" title="4.1 Unitsï¼ˆå•ä½ï¼‰"></a>4.1 Unitsï¼ˆå•ä½ï¼‰</h3><p>é…ç½®æ–‡ä»¶å¼€å¤´å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„åº¦é‡å•ä½ã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>åªæ”¯æŒ <strong>bytes</strong>ï¼ˆå­—èŠ‚ï¼‰ï¼Œä¸æ”¯æŒ <strong>bit</strong>ï¼ˆä½ï¼‰</li><li><strong>å¤§å°å†™ä¸æ•æ„Ÿ</strong>ï¼ˆ1GB &#x3D; 1gb &#x3D; 1Gbï¼‰</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å•ä½æ¢ç®—</span></span><br><span class="line">1k =&gt; 1000 bytes</span><br><span class="line">1kb =&gt; 1024 bytes</span><br><span class="line">1m =&gt; 1000000 bytes</span><br><span class="line">1mb =&gt; 1024*1024 bytes</span><br><span class="line">1g =&gt; 1000000000 bytes</span><br><span class="line">1gb =&gt; 1024*1024*1024 bytes</span><br></pre></td></tr></table></figure><h3 id="4-2-INCLUDESï¼ˆåŒ…å«ï¼‰"><a href="#4-2-INCLUDESï¼ˆåŒ…å«ï¼‰" class="headerlink" title="4.2 INCLUDESï¼ˆåŒ…å«ï¼‰"></a>4.2 INCLUDESï¼ˆåŒ…å«ï¼‰</h3><p>æ”¯æŒåŒ…å«å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œç±»ä¼¼äºJSPä¸­çš„includeã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>å¤šå®ä¾‹éƒ¨ç½²</strong>ï¼šæå–å…¬å…±é…ç½®</li><li><strong>é…ç½®æ¨¡å—åŒ–</strong>ï¼šæŒ‰åŠŸèƒ½æ‹†åˆ†é…ç½®æ–‡ä»¶</li><li><strong>ç¯å¢ƒéš”ç¦»</strong>ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚åŒ–é…ç½®</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–é…ç½®æ–‡ä»¶</span></span><br><span class="line">include /path/to/common.conf</span><br><span class="line">include /path/to/redis-common.conf</span><br></pre></td></tr></table></figure><h3 id="4-3-NETWORKï¼ˆç½‘ç»œé…ç½®ï¼‰"><a href="#4-3-NETWORKï¼ˆç½‘ç»œé…ç½®ï¼‰" class="headerlink" title="4.3 NETWORKï¼ˆç½‘ç»œé…ç½®ï¼‰"></a>4.3 NETWORKï¼ˆç½‘ç»œé…ç½®ï¼‰</h3><h4 id="å¸¸ç”¨ç½‘ç»œé…ç½®é¡¹"><a href="#å¸¸ç”¨ç½‘ç»œé…ç½®é¡¹" class="headerlink" title="å¸¸ç”¨ç½‘ç»œé…ç½®é¡¹"></a>å¸¸ç”¨ç½‘ç»œé…ç½®é¡¹</h4><table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th><th>æ¨èé…ç½®</th></tr></thead><tbody><tr><td><code>bind</code></td><td>ç»‘å®šçš„IPåœ°å€</td><td>127.0.0.1</td><td>ç”Ÿäº§ç¯å¢ƒé…ç½®åº”ç”¨æœåŠ¡å™¨IP</td></tr><tr><td><code>protected-mode</code></td><td>ä¿æŠ¤æ¨¡å¼</td><td>yes</td><td>è¿œç¨‹è®¿é—®è®¾ç½®ä¸ºno</td></tr><tr><td><code>port</code></td><td>ç›‘å¬ç«¯å£</td><td>6379</td><td>ä¿æŒé»˜è®¤æˆ–è‡ªå®šä¹‰</td></tr><tr><td><code>tcp-backlog</code></td><td>TCPè¿æ¥é˜Ÿåˆ—é•¿åº¦</td><td>511</td><td>é«˜å¹¶å‘åœºæ™¯å¢å¤§</td></tr><tr><td><code>timeout</code></td><td>å®¢æˆ·ç«¯ç©ºé—²è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰</td><td>0ï¼ˆæ°¸ä¸è¶…æ—¶ï¼‰</td><td>300ï¼ˆ5åˆ†é’Ÿï¼‰</td></tr><tr><td><code>tcp-keepalive</code></td><td>TCPå¿ƒè·³æ£€æµ‹é—´éš”ï¼ˆç§’ï¼‰</td><td>300</td><td>60</td></tr></tbody></table><h4 id="è¯¦ç»†è¯´æ˜"><a href="#è¯¦ç»†è¯´æ˜" class="headerlink" title="è¯¦ç»†è¯´æ˜"></a>è¯¦ç»†è¯´æ˜</h4><h5 id="bindï¼ˆIPç»‘å®šï¼‰"><a href="#bindï¼ˆIPç»‘å®šï¼‰" class="headerlink" title="bindï¼ˆIPç»‘å®šï¼‰"></a>bindï¼ˆIPç»‘å®šï¼‰</h5><p><strong>ä½œç”¨</strong>ï¼šæŒ‡å®šRedisç›‘å¬çš„IPåœ°å€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªå…è®¸æœ¬æœºè®¿é—®</span></span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸æŒ‡å®šIPè®¿é—®</span></span><br><span class="line"><span class="built_in">bind</span> 192.168.1.100</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸å¤šä¸ªIPè®¿é—®</span></span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1 192.168.1.100</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸æ‰€æœ‰IPè®¿é—®ï¼ˆæ³¨é‡Šæ‰bindæˆ–ä¸é…ç½®ï¼‰</span></span><br><span class="line"><span class="comment"># bind 127.0.0.1</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>é»˜è®¤ <code>bind 127.0.0.1</code>ï¼Œåªèƒ½æœ¬æœºè®¿é—®</li><li>ä¸é…ç½®bindï¼Œåˆ™æ— é™åˆ¶æ¥å—ä»»ä½•IPè®¿é—®ï¼ˆ<strong>ä¸å®‰å…¨</strong>ï¼‰</li><li>ç”Ÿäº§ç¯å¢ƒå»ºè®®ç»‘å®šåº”ç”¨æœåŠ¡å™¨çš„IP</li><li>å¦‚æœéœ€è¦è¿œç¨‹è®¿é—®ï¼Œéœ€è¦æ³¨é‡Šæ‰bindé…ç½®</li></ul><h5 id="protected-modeï¼ˆä¿æŠ¤æ¨¡å¼ï¼‰"><a href="#protected-modeï¼ˆä¿æŠ¤æ¨¡å¼ï¼‰" class="headerlink" title="protected-modeï¼ˆä¿æŠ¤æ¨¡å¼ï¼‰"></a>protected-modeï¼ˆä¿æŠ¤æ¨¡å¼ï¼‰</h5><p><strong>ä½œç”¨</strong>ï¼šRedis 3.2ä»¥åçš„å®‰å…¨ä¿æŠ¤åŠŸèƒ½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯ä¿æŠ¤æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">protected-mode <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­ä¿æŠ¤æ¨¡å¼ï¼ˆå…è®¸è¿œç¨‹è®¿é—®ï¼‰</span></span><br><span class="line">protected-mode no</span><br></pre></td></tr></table></figure><p><strong>ä¿æŠ¤é€»è¾‘</strong>ï¼š</p><ul><li>å½“ <code>protected-mode yes</code> æ—¶ï¼Œå¦‚æœ<strong>æ²¡æœ‰bind IP</strong>ä¸”<strong>æ²¡æœ‰è®¾ç½®å¯†ç </strong>ï¼ŒRedisåªå…è®¸æœ¬æœºè®¿é—®</li><li>å¦‚æœéœ€è¦è¿œç¨‹è®¿é—®ï¼Œå¿…é¡»ï¼š<ul><li>è®¾ç½® <code>protected-mode no</code>ï¼Œ<strong>æˆ–</strong></li><li>é…ç½® <code>bind</code> æŒ‡å®šIPï¼Œ<strong>æˆ–</strong></li><li>è®¾ç½®è®¿é—®å¯†ç </li></ul></li></ul><h5 id="portï¼ˆç«¯å£ï¼‰"><a href="#portï¼ˆç«¯å£ï¼‰" class="headerlink" title="portï¼ˆç«¯å£ï¼‰"></a>portï¼ˆç«¯å£ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£</span></span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰ç«¯å£</span></span><br><span class="line">port 6380</span><br></pre></td></tr></table></figure><h5 id="tcp-backlogï¼ˆTCPè¿æ¥é˜Ÿåˆ—ï¼‰"><a href="#tcp-backlogï¼ˆTCPè¿æ¥é˜Ÿåˆ—ï¼‰" class="headerlink" title="tcp-backlogï¼ˆTCPè¿æ¥é˜Ÿåˆ—ï¼‰"></a>tcp-backlogï¼ˆTCPè¿æ¥é˜Ÿåˆ—ï¼‰</h5><p><strong>ä½œç”¨</strong>ï¼šè®¾ç½®TCPè¿æ¥é˜Ÿåˆ—é•¿åº¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp-backlog 511</span><br></pre></td></tr></table></figure><p><strong>è¿æ¥é˜Ÿåˆ—ç»„æˆ</strong>ï¼š</p><ul><li><strong>æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ—</strong>ï¼ˆSYNé˜Ÿåˆ—ï¼‰</li><li><strong>å·²å®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ—</strong>ï¼ˆAccepté˜Ÿåˆ—ï¼‰</li><li><strong>æ€»é˜Ÿåˆ— &#x3D; æœªå®Œæˆ + å·²å®Œæˆ</strong></li></ul><p><strong>é«˜å¹¶å‘ä¼˜åŒ–</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. ä¿®æ”¹Redisé…ç½®</span></span><br><span class="line">tcp-backlog 2048</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ä¿®æ”¹Linuxå†…æ ¸å‚æ•°</span></span><br><span class="line"><span class="comment"># /etc/sysctl.conf</span></span><br><span class="line">net.core.somaxconn = 2048</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 2048</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ä½¿é…ç½®ç”Ÿæ•ˆ</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong>ï¼šLinuxå†…æ ¸ä¼šå°†backlogå€¼é™åˆ¶ä¸º <code>/proc/sys/net/core/somaxconn</code> çš„å€¼ï¼ˆé»˜è®¤128ï¼‰ï¼Œéœ€è¦åŒæ—¶è°ƒæ•´å†…æ ¸å‚æ•°ã€‚</p></blockquote><h5 id="timeoutï¼ˆå®¢æˆ·ç«¯è¶…æ—¶ï¼‰"><a href="#timeoutï¼ˆå®¢æˆ·ç«¯è¶…æ—¶ï¼‰" class="headerlink" title="timeoutï¼ˆå®¢æˆ·ç«¯è¶…æ—¶ï¼‰"></a>timeoutï¼ˆå®¢æˆ·ç«¯è¶…æ—¶ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0è¡¨ç¤ºæ°¸ä¸è¶…æ—¶</span></span><br><span class="line"><span class="built_in">timeout</span> 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰æ— æ“ä½œè‡ªåŠ¨æ–­å¼€</span></span><br><span class="line"><span class="built_in">timeout</span> 300</span><br></pre></td></tr></table></figure><p><strong>å»ºè®®</strong>ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…å¤§é‡ç©ºé—²è¿æ¥å ç”¨èµ„æºã€‚</p><h5 id="tcp-keepaliveï¼ˆå¿ƒè·³æ£€æµ‹ï¼‰"><a href="#tcp-keepaliveï¼ˆå¿ƒè·³æ£€æµ‹ï¼‰" class="headerlink" title="tcp-keepaliveï¼ˆå¿ƒè·³æ£€æµ‹ï¼‰"></a>tcp-keepaliveï¼ˆå¿ƒè·³æ£€æµ‹ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯60ç§’æ£€æµ‹ä¸€æ¬¡å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">tcp-keepalive 60</span><br></pre></td></tr></table></figure><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>æ£€æµ‹æ­»è¿æ¥ï¼ˆå®¢æˆ·ç«¯å´©æºƒã€ç½‘ç»œæ–­å¼€ç­‰ï¼‰</li><li>åŠæ—¶é‡Šæ”¾æ— æ•ˆè¿æ¥</li><li>0è¡¨ç¤ºä¸æ£€æµ‹ï¼ˆä¸æ¨èï¼‰</li></ul><h3 id="4-4-GENERALï¼ˆé€šç”¨é…ç½®ï¼‰"><a href="#4-4-GENERALï¼ˆé€šç”¨é…ç½®ï¼‰" class="headerlink" title="4.4 GENERALï¼ˆé€šç”¨é…ç½®ï¼‰"></a>4.4 GENERALï¼ˆé€šç”¨é…ç½®ï¼‰</h3><h4 id="å¸¸ç”¨é€šç”¨é…ç½®é¡¹"><a href="#å¸¸ç”¨é€šç”¨é…ç½®é¡¹" class="headerlink" title="å¸¸ç”¨é€šç”¨é…ç½®é¡¹"></a>å¸¸ç”¨é€šç”¨é…ç½®é¡¹</h4><table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th><th>æ¨èé…ç½®</th></tr></thead><tbody><tr><td><code>daemonize</code></td><td>æ˜¯å¦åå°è¿è¡Œ</td><td>no</td><td>yes</td></tr><tr><td><code>pidfile</code></td><td>PIDæ–‡ä»¶è·¯å¾„</td><td>&#x2F;var&#x2F;run&#x2F;redis.pid</td><td>è‡ªå®šä¹‰è·¯å¾„</td></tr><tr><td><code>loglevel</code></td><td>æ—¥å¿—çº§åˆ«</td><td>notice</td><td>notice&#x2F;warning</td></tr><tr><td><code>logfile</code></td><td>æ—¥å¿—æ–‡ä»¶è·¯å¾„</td><td>â€œâ€</td><td>&#x2F;var&#x2F;log&#x2F;redis&#x2F;redis.log</td></tr><tr><td><code>databases</code></td><td>æ•°æ®åº“æ•°é‡</td><td>16</td><td>16</td></tr></tbody></table><h4 id="è¯¦ç»†è¯´æ˜-1"><a href="#è¯¦ç»†è¯´æ˜-1" class="headerlink" title="è¯¦ç»†è¯´æ˜"></a>è¯¦ç»†è¯´æ˜</h4><h5 id="daemonizeï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰"><a href="#daemonizeï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰" class="headerlink" title="daemonizeï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰"></a>daemonizeï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰å°è¿è¡Œï¼ˆè°ƒè¯•ç”¨ï¼‰</span></span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line"><span class="comment"># åå°è¿è¡Œï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰</span></span><br><span class="line">daemonize <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><h5 id="pidfileï¼ˆè¿›ç¨‹IDæ–‡ä»¶ï¼‰"><a href="#pidfileï¼ˆè¿›ç¨‹IDæ–‡ä»¶ï¼‰" class="headerlink" title="pidfileï¼ˆè¿›ç¨‹IDæ–‡ä»¶ï¼‰"></a>pidfileï¼ˆè¿›ç¨‹IDæ–‡ä»¶ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å­˜æ”¾Redisè¿›ç¨‹ID</span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br></pre></td></tr></table></figure><p><strong>å¤šå®ä¾‹éƒ¨ç½²</strong>ï¼šæ¯ä¸ªå®ä¾‹ä½¿ç”¨ä¸åŒçš„pidfileã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®ä¾‹1</span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹2</span></span><br><span class="line">pidfile /var/run/redis_6380.pid</span><br></pre></td></tr></table></figure><h5 id="loglevelï¼ˆæ—¥å¿—çº§åˆ«ï¼‰"><a href="#loglevelï¼ˆæ—¥å¿—çº§åˆ«ï¼‰" class="headerlink" title="loglevelï¼ˆæ—¥å¿—çº§åˆ«ï¼‰"></a>loglevelï¼ˆæ—¥å¿—çº§åˆ«ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å››ä¸ªçº§åˆ«ï¼ˆä»è¯¦ç»†åˆ°ç®€ç•¥ï¼‰</span></span><br><span class="line">loglevel debug      <span class="comment"># è°ƒè¯•ä¿¡æ¯ï¼ˆå¼€å‘ç¯å¢ƒï¼‰</span></span><br><span class="line">loglevel verbose    <span class="comment"># è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">loglevel notice     <span class="comment"># é€šçŸ¥ä¿¡æ¯ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰</span></span><br><span class="line">loglevel warning    <span class="comment"># è­¦å‘Šä¿¡æ¯ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰</span></span><br></pre></td></tr></table></figure><p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p><ul><li><strong>å¼€å‘&#x2F;æµ‹è¯•</strong>ï¼šdebug æˆ– verbose</li><li><strong>ç”Ÿäº§ç¯å¢ƒ</strong>ï¼šnotice æˆ– warning</li></ul><h5 id="logfileï¼ˆæ—¥å¿—æ–‡ä»¶ï¼‰"><a href="#logfileï¼ˆæ—¥å¿—æ–‡ä»¶ï¼‰" class="headerlink" title="logfileï¼ˆæ—¥å¿—æ–‡ä»¶ï¼‰"></a>logfileï¼ˆæ—¥å¿—æ–‡ä»¶ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ‡å‡†è¾“å‡ºï¼ˆä¸è®°å½•æ–‡ä»¶ï¼‰</span></span><br><span class="line">logfile <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®°å½•åˆ°æ–‡ä»¶</span></span><br><span class="line">logfile /var/log/redis/redis.log</span><br></pre></td></tr></table></figure><h5 id="databasesï¼ˆæ•°æ®åº“æ•°é‡ï¼‰"><a href="#databasesï¼ˆæ•°æ®åº“æ•°é‡ï¼‰" class="headerlink" title="databasesï¼ˆæ•°æ®åº“æ•°é‡ï¼‰"></a>databasesï¼ˆæ•°æ®åº“æ•°é‡ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤16ä¸ªæ•°æ®åº“ï¼ˆç¼–å·0-15ï¼‰</span></span><br><span class="line">databases 16</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ°æŒ‡å®šæ•°æ®åº“</span></span><br><span class="line">SELECT 0   <span class="comment"># åˆ‡æ¢åˆ°0å·åº“</span></span><br><span class="line">SELECT 8   <span class="comment"># åˆ‡æ¢åˆ°8å·åº“</span></span><br></pre></td></tr></table></figure><h3 id="4-5-SECURITYï¼ˆå®‰å…¨é…ç½®ï¼‰"><a href="#4-5-SECURITYï¼ˆå®‰å…¨é…ç½®ï¼‰" class="headerlink" title="4.5 SECURITYï¼ˆå®‰å…¨é…ç½®ï¼‰"></a>4.5 SECURITYï¼ˆå®‰å…¨é…ç½®ï¼‰</h3><h4 id="å¯†ç è®¾ç½®"><a href="#å¯†ç è®¾ç½®" class="headerlink" title="å¯†ç è®¾ç½®"></a>å¯†ç è®¾ç½®</h4><p><strong>ä¸´æ—¶è®¾ç½®</strong>ï¼ˆé‡å¯åå¤±æ•ˆï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨Rediså‘½ä»¤è¡Œä¸­è®¾ç½®</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET requirepass <span class="string">&quot;your_password&quot;</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯†ç </span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET requirepass</span><br><span class="line">1) <span class="string">&quot;requirepass&quot;</span></span><br><span class="line">2) <span class="string">&quot;your_password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å¯†ç ç™»å½•</span></span><br><span class="line">127.0.0.1:6379&gt; AUTH your_password</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p><strong>æ°¸ä¹…è®¾ç½®</strong>ï¼ˆé…ç½®æ–‡ä»¶ä¸­ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line">requirepass your_strong_password_here</span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯è¿æ¥ä½¿ç”¨å¯†ç </strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1ï¼šå¯åŠ¨æ—¶æŒ‡å®š</span></span><br><span class="line">redis-cli -a your_password</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2ï¼šè¿æ¥åè®¤è¯</span></span><br><span class="line">redis-cli</span><br><span class="line">127.0.0.1:6379&gt; AUTH your_password</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><blockquote><p><strong>å®‰å…¨å»ºè®®</strong>ï¼š</p><ul><li>ä½¿ç”¨å¤æ‚å¯†ç ï¼ˆå­—æ¯+æ•°å­—+ç‰¹æ®Šå­—ç¬¦ï¼‰</li><li>å®šæœŸæ›´æ¢å¯†ç </li><li>ç»“åˆbindå’Œprotected-modeä½¿ç”¨</li></ul></blockquote><h3 id="4-6-LIMITSï¼ˆé™åˆ¶é…ç½®ï¼‰"><a href="#4-6-LIMITSï¼ˆé™åˆ¶é…ç½®ï¼‰" class="headerlink" title="4.6 LIMITSï¼ˆé™åˆ¶é…ç½®ï¼‰"></a>4.6 LIMITSï¼ˆé™åˆ¶é…ç½®ï¼‰</h3><h4 id="å¸¸ç”¨é™åˆ¶é…ç½®é¡¹"><a href="#å¸¸ç”¨é™åˆ¶é…ç½®é¡¹" class="headerlink" title="å¸¸ç”¨é™åˆ¶é…ç½®é¡¹"></a>å¸¸ç”¨é™åˆ¶é…ç½®é¡¹</h4><table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th><th>å»ºè®®å€¼</th></tr></thead><tbody><tr><td><code>maxclients</code></td><td>æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°</td><td>10000</td><td>æ ¹æ®å®é™…è°ƒæ•´</td></tr><tr><td><code>maxmemory</code></td><td>æœ€å¤§å†…å­˜ä½¿ç”¨é‡</td><td>0ï¼ˆæ— é™åˆ¶ï¼‰</td><td><strong>å¿…é¡»è®¾ç½®</strong></td></tr><tr><td><code>maxmemory-policy</code></td><td>å†…å­˜æ·˜æ±°ç­–ç•¥</td><td>noeviction</td><td>æ ¹æ®åœºæ™¯é€‰æ‹©</td></tr><tr><td><code>maxmemory-samples</code></td><td>LRUé‡‡æ ·æ•°é‡</td><td>5</td><td>3-7</td></tr></tbody></table><h4 id="è¯¦ç»†è¯´æ˜-2"><a href="#è¯¦ç»†è¯´æ˜-2" class="headerlink" title="è¯¦ç»†è¯´æ˜"></a>è¯¦ç»†è¯´æ˜</h4><h5 id="maxclientsï¼ˆæœ€å¤§è¿æ¥æ•°ï¼‰"><a href="#maxclientsï¼ˆæœ€å¤§è¿æ¥æ•°ï¼‰" class="headerlink" title="maxclientsï¼ˆæœ€å¤§è¿æ¥æ•°ï¼‰"></a>maxclientsï¼ˆæœ€å¤§è¿æ¥æ•°ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ€å¤šå…è®¸10000ä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥</span></span><br><span class="line">maxclients 10000</span><br></pre></td></tr></table></figure><p><strong>è¶…å‡ºé™åˆ¶çš„è¡¨ç°</strong>ï¼š</p><ul><li>æ‹’ç»æ–°çš„è¿æ¥è¯·æ±‚</li><li>è¿”å›é”™è¯¯ï¼š<code>&quot;max number of clients reached&quot;</code></li></ul><h5 id="maxmemoryï¼ˆæœ€å¤§å†…å­˜ï¼‰"><a href="#maxmemoryï¼ˆæœ€å¤§å†…å­˜ï¼‰" class="headerlink" title="maxmemoryï¼ˆæœ€å¤§å†…å­˜ï¼‰"></a>maxmemoryï¼ˆæœ€å¤§å†…å­˜ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸é™åˆ¶ï¼ˆå±é™©ï¼ï¼‰</span></span><br><span class="line">maxmemory 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™åˆ¶ä¸º1GB</span></span><br><span class="line">maxmemory 1gb</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™åˆ¶ä¸º512MB</span></span><br><span class="line">maxmemory 512mb</span><br></pre></td></tr></table></figure><blockquote><p><strong>é‡è¦æç¤º</strong>ï¼š</p><ul><li><strong>ç”Ÿäº§ç¯å¢ƒå¿…é¡»è®¾ç½®</strong>ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å†…å­˜å æ»¡ã€æœåŠ¡å™¨å®•æœº</li><li>å»ºè®®è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„ <strong>70-80%</strong></li><li>å¦‚æœæ˜¯ä¸»ä»æ¶æ„ï¼Œéœ€è¦é¢„ç•™å†…å­˜ç»™åŒæ­¥ç¼“å†²åŒº</li></ul></blockquote><p><strong>å†…å­˜è¾¾åˆ°ä¸Šé™åçš„è¡Œä¸º</strong>ï¼š</p><ul><li>æ ¹æ® <code>maxmemory-policy</code> ç­–ç•¥ç§»é™¤æ•°æ®</li><li>å¦‚æœæ— æ³•ç§»é™¤æˆ–è®¾ç½®äº† <code>noeviction</code>ï¼Œå†™æ“ä½œï¼ˆå¦‚SETã€LPUSHï¼‰ä¼šè¿”å›é”™è¯¯</li><li>è¯»æ“ä½œï¼ˆå¦‚GETï¼‰ä»ç„¶æ­£å¸¸å“åº”</li></ul><h5 id="maxmemory-policyï¼ˆå†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰"><a href="#maxmemory-policyï¼ˆå†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰" class="headerlink" title="maxmemory-policyï¼ˆå†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰"></a>maxmemory-policyï¼ˆå†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰</h5><p>å½“å†…å­˜è¾¾åˆ°ä¸Šé™æ—¶ï¼ŒRediså¦‚ä½•å¤„ç†æ–°çš„å†™å…¥è¯·æ±‚ï¼Ÿ</p><p><strong>8ç§æ·˜æ±°ç­–ç•¥</strong>ï¼š</p><table><thead><tr><th>ç­–ç•¥</th><th>è¯´æ˜</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>volatile-lru</code></td><td>å¯¹<strong>è®¾ç½®äº†è¿‡æœŸæ—¶é—´</strong>çš„keyä½¿ç”¨LRUç®—æ³•æ·˜æ±°</td><td>éƒ¨åˆ†keyéœ€è¦æŒä¹…åŒ–</td></tr><tr><td><code>allkeys-lru</code></td><td>å¯¹<strong>æ‰€æœ‰key</strong>ä½¿ç”¨LRUç®—æ³•æ·˜æ±°</td><td><strong>é€šç”¨ç¼“å­˜</strong>ï¼ˆæ¨èï¼‰</td></tr><tr><td><code>volatile-lfu</code></td><td>å¯¹<strong>è®¾ç½®äº†è¿‡æœŸæ—¶é—´</strong>çš„keyä½¿ç”¨LFUç®—æ³•æ·˜æ±°</td><td>Redis 4.0+</td></tr><tr><td><code>allkeys-lfu</code></td><td>å¯¹<strong>æ‰€æœ‰key</strong>ä½¿ç”¨LFUç®—æ³•æ·˜æ±°</td><td>Redis 4.0+</td></tr><tr><td><code>volatile-random</code></td><td>å¯¹<strong>è®¾ç½®äº†è¿‡æœŸæ—¶é—´</strong>çš„keyéšæœºæ·˜æ±°</td><td>æµ‹è¯•ç¯å¢ƒ</td></tr><tr><td><code>allkeys-random</code></td><td>å¯¹<strong>æ‰€æœ‰key</strong>éšæœºæ·˜æ±°</td><td>ä¸æ¨è</td></tr><tr><td><code>volatile-ttl</code></td><td>æ·˜æ±°<strong>TTLæœ€å°</strong>çš„keyï¼ˆå³å°†è¿‡æœŸï¼‰</td><td>åŸºäºè¿‡æœŸæ—¶é—´</td></tr><tr><td><code>noeviction</code></td><td><strong>ä¸æ·˜æ±°</strong>ï¼Œå†™æ“ä½œè¿”å›é”™è¯¯</td><td>ä¸¥æ ¼çš„æ•°æ®æŒä¹…åŒ–</td></tr></tbody></table><p><strong>é…ç½®ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨èï¼šå¯¹æ‰€æœ‰keyä½¿ç”¨LRUç®—æ³•</span></span><br><span class="line">maxmemory-policy allkeys-lru</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªå¯¹å¸¦è¿‡æœŸæ—¶é—´çš„keyä½¿ç”¨LRU</span></span><br><span class="line">maxmemory-policy volatile-lru</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ·˜æ±°ï¼Œå†™æ»¡è¿”å›é”™è¯¯</span></span><br><span class="line">maxmemory-policy noeviction</span><br></pre></td></tr></table></figure><p><strong>æ·˜æ±°ç­–ç•¥é€‰æ‹©å»ºè®®</strong>ï¼š</p><ul><li><strong>åœºæ™¯1ï¼šçº¯ç¼“å­˜åœºæ™¯</strong> â†’ <code>allkeys-lru</code></li><li><strong>åœºæ™¯2ï¼šéƒ¨åˆ†æ•°æ®éœ€è¦æŒä¹…åŒ–</strong> â†’ <code>volatile-lru</code></li><li><strong>åœºæ™¯3ï¼šä¸å…è®¸æ•°æ®ä¸¢å¤±</strong> â†’ <code>noeviction</code></li></ul><p><strong>LRU vs LFU</strong>ï¼š</p><ul><li><strong>LRUï¼ˆLeast Recently Usedï¼‰</strong>ï¼šæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œæ·˜æ±°æœ€ä¹…æœªè®¿é—®çš„</li><li><strong>LFUï¼ˆLeast Frequently Usedï¼‰</strong>ï¼šæœ€ä¸ç»å¸¸ä½¿ç”¨ï¼Œæ·˜æ±°è®¿é—®é¢‘ç‡æœ€ä½çš„</li></ul><h5 id="maxmemory-samplesï¼ˆLRUé‡‡æ ·æ•°é‡ï¼‰"><a href="#maxmemory-samplesï¼ˆLRUé‡‡æ ·æ•°é‡ï¼‰" class="headerlink" title="maxmemory-samplesï¼ˆLRUé‡‡æ ·æ•°é‡ï¼‰"></a>maxmemory-samplesï¼ˆLRUé‡‡æ ·æ•°é‡ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤æ£€æŸ¥5ä¸ªkey</span></span><br><span class="line">maxmemory-samples 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># æé«˜ç²¾ç¡®åº¦</span></span><br><span class="line">maxmemory-samples 7</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™ä½æ€§èƒ½æ¶ˆè€—</span></span><br><span class="line">maxmemory-samples 3</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼š</p><ul><li>LRUå’ŒTTLç®—æ³•éƒ½æ˜¯<strong>ä¼°ç®—å€¼</strong>ï¼Œä¸æ˜¯ç²¾ç¡®ç®—æ³•</li><li>Redisä¼šéšæœºæŠ½å–æŒ‡å®šæ•°é‡çš„keyï¼Œä»ä¸­é€‰æ‹©æœ€é€‚åˆæ·˜æ±°çš„</li><li>é‡‡æ ·æ•°é‡è¶Šå¤§ï¼Œç»“æœè¶Šç²¾ç¡®ï¼Œä½†æ€§èƒ½æ¶ˆè€—è¶Šå¤§</li><li>æ¨èå€¼ï¼š<strong>3-7</strong></li></ul><p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th>é‡‡æ ·æ•°é‡</th><th>ç²¾ç¡®åº¦</th><th>æ€§èƒ½æ¶ˆè€—</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>3</td><td>ä½</td><td>ä½</td><td>é«˜å¹¶å‘åœºæ™¯</td></tr><tr><td>5</td><td>ä¸­</td><td>ä¸­</td><td>é€šç”¨åœºæ™¯ï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td>7-10</td><td>é«˜</td><td>é«˜</td><td>å¯¹ç²¾ç¡®åº¦è¦æ±‚é«˜çš„åœºæ™¯</td></tr></tbody></table><h3 id="é…ç½®ç¤ºä¾‹ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰"><a href="#é…ç½®ç¤ºä¾‹ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰" class="headerlink" title="é…ç½®ç¤ºä¾‹ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰"></a>é…ç½®ç¤ºä¾‹ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ========== ç½‘ç»œé…ç½® ==========</span></span><br><span class="line"><span class="built_in">bind</span> 192.168.1.100 192.168.1.200    <span class="comment"># ç»‘å®šRedisæœåŠ¡å™¨å’Œåº”ç”¨æœåŠ¡å™¨IP</span></span><br><span class="line">protected-mode <span class="built_in">yes</span>                   <span class="comment"># å¼€å¯ä¿æŠ¤æ¨¡å¼</span></span><br><span class="line">port 6379</span><br><span class="line">tcp-backlog 2048</span><br><span class="line"><span class="built_in">timeout</span> 300</span><br><span class="line">tcp-keepalive 60</span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== é€šç”¨é…ç½® ==========</span></span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line">loglevel notice</span><br><span class="line">logfile /var/log/redis/redis.log</span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== å®‰å…¨é…ç½® ==========</span></span><br><span class="line">requirepass your_strong_password_2024</span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== é™åˆ¶é…ç½® ==========</span></span><br><span class="line">maxclients 10000</span><br><span class="line">maxmemory 2gb</span><br><span class="line">maxmemory-policy allkeys-lru</span><br><span class="line">maxmemory-samples 5</span><br></pre></td></tr></table></figure><hr><h2 id="5-Rediså‘å¸ƒè®¢é˜…ï¼ˆPub-Subï¼‰"><a href="#5-Rediså‘å¸ƒè®¢é˜…ï¼ˆPub-Subï¼‰" class="headerlink" title="5. Rediså‘å¸ƒè®¢é˜…ï¼ˆPub&#x2F;Subï¼‰"></a>5. Rediså‘å¸ƒè®¢é˜…ï¼ˆPub&#x2F;Subï¼‰</h2><h3 id="5-1-ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…"><a href="#5-1-ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…" class="headerlink" title="5.1 ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…"></a>5.1 ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…</h3><p>Rediså‘å¸ƒè®¢é˜…ï¼ˆPub&#x2F;Subï¼‰æ˜¯ä¸€ç§<strong>æ¶ˆæ¯é€šä¿¡æ¨¡å¼</strong>ã€‚</p><p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>å‘é€è€…ï¼ˆPublisherï¼‰</strong>ï¼šå‘å¸ƒæ¶ˆæ¯</li><li><strong>è®¢é˜…è€…ï¼ˆSubscriberï¼‰</strong>ï¼šæ¥æ”¶æ¶ˆæ¯</li><li><strong>é¢‘é“ï¼ˆChannelï¼‰</strong>ï¼šæ¶ˆæ¯ä¼ é€’çš„ç®¡é“</li></ul><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥è®¢é˜…<strong>ä»»æ„æ•°é‡</strong>çš„é¢‘é“</li><li>æ”¯æŒ<strong>ä¸€å¯¹å¤š</strong>çš„æ¶ˆæ¯å¹¿æ’­</li><li>æ¶ˆæ¯<strong>ä¸æŒä¹…åŒ–</strong>ï¼Œè®¢é˜…å‰çš„æ¶ˆæ¯æ— æ³•æ¥æ”¶</li></ul><h3 id="5-2-å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#5-2-å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="5.2 å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>5.2 å‘å¸ƒè®¢é˜…æ¨¡å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    å‘å¸ƒè€…                       è®¢é˜…è€…</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚Publisherâ”‚                 â”‚Subscriberâ”‚</span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â–²â”€â”€â”€â”€â”˜</span><br><span class="line">     â”‚                           â”‚</span><br><span class="line">     â”‚ PUBLISH channel1 hello    â”‚ SUBSCRIBE channel1</span><br><span class="line">     â”‚                           â”‚</span><br><span class="line">     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºchannel1â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">               é¢‘é“</span><br></pre></td></tr></table></figure><h3 id="5-3-å¸¸ç”¨å‘½ä»¤"><a href="#5-3-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="5.3 å¸¸ç”¨å‘½ä»¤"></a>5.3 å¸¸ç”¨å‘½ä»¤</h3><h4 id="è®¢é˜…å‘½ä»¤"><a href="#è®¢é˜…å‘½ä»¤" class="headerlink" title="è®¢é˜…å‘½ä»¤"></a>è®¢é˜…å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>SUBSCRIBE channel [channel ...]</code></td><td>è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“</td><td><code>SUBSCRIBE channel1</code></td></tr><tr><td><code>PSUBSCRIBE pattern [pattern ...]</code></td><td>è®¢é˜…ç¬¦åˆæ¨¡å¼çš„é¢‘é“</td><td><code>PSUBSCRIBE news.*</code></td></tr><tr><td><code>UNSUBSCRIBE [channel ...]</code></td><td>å–æ¶ˆè®¢é˜…é¢‘é“</td><td><code>UNSUBSCRIBE channel1</code></td></tr><tr><td><code>PUNSUBSCRIBE [pattern ...]</code></td><td>å–æ¶ˆè®¢é˜…æ¨¡å¼</td><td><code>PUNSUBSCRIBE news.*</code></td></tr></tbody></table><h4 id="å‘å¸ƒå‘½ä»¤"><a href="#å‘å¸ƒå‘½ä»¤" class="headerlink" title="å‘å¸ƒå‘½ä»¤"></a>å‘å¸ƒå‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>PUBLISH channel message</code></td><td>å‘é¢‘é“å‘é€æ¶ˆæ¯</td><td><code>PUBLISH channel1 &quot;hello&quot;</code></td><td>æ¥æ”¶æ¶ˆæ¯çš„è®¢é˜…è€…æ•°é‡</td></tr></tbody></table><h4 id="æŸ¥è¯¢å‘½ä»¤"><a href="#æŸ¥è¯¢å‘½ä»¤" class="headerlink" title="æŸ¥è¯¢å‘½ä»¤"></a>æŸ¥è¯¢å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>PUBSUB CHANNELS [pattern]</code></td><td>æŸ¥çœ‹æ´»è·ƒçš„é¢‘é“</td><td><code>PUBSUB CHANNELS</code></td></tr><tr><td><code>PUBSUB NUMSUB [channel ...]</code></td><td>æŸ¥çœ‹é¢‘é“è®¢é˜…è€…æ•°é‡</td><td><code>PUBSUB NUMSUB channel1</code></td></tr><tr><td><code>PUBSUB NUMPAT</code></td><td>æŸ¥çœ‹æ¨¡å¼è®¢é˜…æ•°é‡</td><td><code>PUBSUB NUMPAT</code></td></tr></tbody></table><h3 id="5-4-ä½¿ç”¨ç¤ºä¾‹"><a href="#5-4-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="5.4 ä½¿ç”¨ç¤ºä¾‹"></a>5.4 ä½¿ç”¨ç¤ºä¾‹</h3><h4 id="åŸºç¡€ç¤ºä¾‹ï¼šå•é¢‘é“é€šä¿¡"><a href="#åŸºç¡€ç¤ºä¾‹ï¼šå•é¢‘é“é€šä¿¡" class="headerlink" title="åŸºç¡€ç¤ºä¾‹ï¼šå•é¢‘é“é€šä¿¡"></a>åŸºç¡€ç¤ºä¾‹ï¼šå•é¢‘é“é€šä¿¡</h4><p><strong>æ­¥éª¤1ï¼šå®¢æˆ·ç«¯1 - è®¢é˜…é¢‘é“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»ˆç«¯1ï¼šè®¢é˜…channel1</span></span><br><span class="line">127.0.0.1:6379&gt; SUBSCRIBE channel1</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;channel1&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤2ï¼šå®¢æˆ·ç«¯2 - å‘å¸ƒæ¶ˆæ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»ˆç«¯2ï¼šå‘channel1å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">127.0.0.1:6379&gt; PUBLISH channel1 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1    <span class="comment"># è¿”å›1è¡¨ç¤ºæœ‰1ä¸ªè®¢é˜…è€…æ”¶åˆ°æ¶ˆæ¯</span></span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤3ï¼šå®¢æˆ·ç«¯1 - æ¥æ”¶æ¶ˆæ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»ˆç«¯1ï¼šæ”¶åˆ°æ¶ˆæ¯</span></span><br><span class="line">1) <span class="string">&quot;message&quot;</span></span><br><span class="line">2) <span class="string">&quot;channel1&quot;</span></span><br><span class="line">3) <span class="string">&quot;hello&quot;</span></span><br></pre></td></tr></table></figure><h4 id="è¿›é˜¶ç¤ºä¾‹ï¼šå¤šé¢‘é“è®¢é˜…"><a href="#è¿›é˜¶ç¤ºä¾‹ï¼šå¤šé¢‘é“è®¢é˜…" class="headerlink" title="è¿›é˜¶ç¤ºä¾‹ï¼šå¤šé¢‘é“è®¢é˜…"></a>è¿›é˜¶ç¤ºä¾‹ï¼šå¤šé¢‘é“è®¢é˜…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¢é˜…å¤šä¸ªé¢‘é“</span></span><br><span class="line">127.0.0.1:6379&gt; SUBSCRIBE channel1 channel2 channel3</span><br><span class="line">Reading messages...</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;channel1&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;channel2&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 2</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;channel3&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><h4 id="æ¨¡å¼åŒ¹é…ç¤ºä¾‹"><a href="#æ¨¡å¼åŒ¹é…ç¤ºä¾‹" class="headerlink" title="æ¨¡å¼åŒ¹é…ç¤ºä¾‹"></a>æ¨¡å¼åŒ¹é…ç¤ºä¾‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¢é˜…æ‰€æœ‰ä»¥newså¼€å¤´çš„é¢‘é“</span></span><br><span class="line">127.0.0.1:6379&gt; PSUBSCRIBE news.*</span><br><span class="line">Reading messages...</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å¦ä¸€ä¸ªå®¢æˆ·ç«¯å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">127.0.0.1:6379&gt; PUBLISH news.sports <span class="string">&quot;NBA Finals&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; PUBLISH news.tech <span class="string">&quot;AI Breakthrough&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¢é˜…è€…ä¼šæ”¶åˆ°æ‰€æœ‰åŒ¹é…çš„æ¶ˆæ¯</span></span><br><span class="line">1) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line">2) <span class="string">&quot;news.*&quot;</span></span><br><span class="line">3) <span class="string">&quot;news.sports&quot;</span></span><br><span class="line">4) <span class="string">&quot;NBA Finals&quot;</span></span><br><span class="line"></span><br><span class="line">1) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line">2) <span class="string">&quot;news.*&quot;</span></span><br><span class="line">3) <span class="string">&quot;news.tech&quot;</span></span><br><span class="line">4) <span class="string">&quot;AI Breakthrough&quot;</span></span><br></pre></td></tr></table></figure><h3 id="5-5-åº”ç”¨åœºæ™¯"><a href="#5-5-åº”ç”¨åœºæ™¯" class="headerlink" title="5.5 åº”ç”¨åœºæ™¯"></a>5.5 åº”ç”¨åœºæ™¯</h3><h4 id="1-å®æ—¶æ¶ˆæ¯ç³»ç»Ÿ"><a href="#1-å®æ—¶æ¶ˆæ¯ç³»ç»Ÿ" class="headerlink" title="1. å®æ—¶æ¶ˆæ¯ç³»ç»Ÿ"></a>1. å®æ—¶æ¶ˆæ¯ç³»ç»Ÿ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># èŠå¤©å®¤åœºæ™¯</span></span><br><span class="line"><span class="comment"># ç”¨æˆ·åŠ å…¥èŠå¤©å®¤</span></span><br><span class="line">SUBSCRIBE chatroom:1001</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·å‘é€æ¶ˆæ¯</span></span><br><span class="line">PUBLISH chatroom:1001 <span class="string">&quot;å¼ ä¸‰: å¤§å®¶å¥½ï¼&quot;</span></span><br><span class="line">PUBLISH chatroom:1001 <span class="string">&quot;æå››: ä½ å¥½ï¼&quot;</span></span><br></pre></td></tr></table></figure><h4 id="2-å®æ—¶é€šçŸ¥"><a href="#2-å®æ—¶é€šçŸ¥" class="headerlink" title="2. å®æ—¶é€šçŸ¥"></a>2. å®æ—¶é€šçŸ¥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¢å•çŠ¶æ€é€šçŸ¥</span></span><br><span class="line"><span class="comment"># ç”¨æˆ·è®¢é˜…è‡ªå·±çš„è®¢å•é€šçŸ¥</span></span><br><span class="line">SUBSCRIBE order:user123</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç³»ç»Ÿå‘é€è®¢å•çŠ¶æ€å˜æ›´</span></span><br><span class="line">PUBLISH order:user123 <span class="string">&quot;æ‚¨çš„è®¢å•å·²å‘è´§&quot;</span></span><br><span class="line">PUBLISH order:user123 <span class="string">&quot;æ‚¨çš„è®¢å•å·²ç­¾æ”¶&quot;</span></span><br></pre></td></tr></table></figure><h4 id="3-æ—¥å¿—ç›‘æ§"><a href="#3-æ—¥å¿—ç›‘æ§" class="headerlink" title="3. æ—¥å¿—ç›‘æ§"></a>3. æ—¥å¿—ç›‘æ§</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¢é˜…æ‰€æœ‰é”™è¯¯æ—¥å¿—</span></span><br><span class="line">PSUBSCRIBE log.error.*</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸åŒæœåŠ¡å‘å¸ƒé”™è¯¯æ—¥å¿—</span></span><br><span class="line">PUBLISH log.error.api <span class="string">&quot;APIæœåŠ¡å¼‚å¸¸&quot;</span></span><br><span class="line">PUBLISH log.error.db <span class="string">&quot;æ•°æ®åº“è¿æ¥å¤±è´¥&quot;</span></span><br></pre></td></tr></table></figure><h3 id="5-6-æ³¨æ„äº‹é¡¹"><a href="#5-6-æ³¨æ„äº‹é¡¹" class="headerlink" title="5.6 æ³¨æ„äº‹é¡¹"></a>5.6 æ³¨æ„äº‹é¡¹</h3><h4 id="é‡è¦ç‰¹æ€§"><a href="#é‡è¦ç‰¹æ€§" class="headerlink" title="é‡è¦ç‰¹æ€§"></a>é‡è¦ç‰¹æ€§</h4><blockquote><p><strong>âš ï¸ æ¶ˆæ¯ä¸æŒä¹…åŒ–</strong>ï¼š</p><ul><li>å‘å¸ƒçš„æ¶ˆæ¯<strong>ä¸ä¼šè¢«ä¿å­˜</strong></li><li>è®¢é˜…è€…<strong>åªèƒ½æ¥æ”¶è®¢é˜…åå‘å¸ƒçš„æ¶ˆæ¯</strong></li><li>å¦‚æœè®¢é˜…è€…ä¸åœ¨çº¿ï¼Œæ¶ˆæ¯ä¼š<strong>ä¸¢å¤±</strong></li></ul></blockquote><p><strong>ç¤ºä¾‹è¯´æ˜</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. å…ˆå‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">PUBLISH channel1 <span class="string">&quot;ç¬¬ä¸€æ¡æ¶ˆæ¯&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. åè®¢é˜…é¢‘é“</span></span><br><span class="line">SUBSCRIBE channel1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“æœï¼šæ— æ³•æ”¶åˆ°&quot;ç¬¬ä¸€æ¡æ¶ˆæ¯&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å†æ¬¡å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">PUBLISH channel1 <span class="string">&quot;ç¬¬äºŒæ¡æ¶ˆæ¯&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“æœï¼šå¯ä»¥æ”¶åˆ°&quot;ç¬¬äºŒæ¡æ¶ˆæ¯&quot;</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨å»ºè®®"><a href="#ä½¿ç”¨å»ºè®®" class="headerlink" title="ä½¿ç”¨å»ºè®®"></a>ä½¿ç”¨å»ºè®®</h4><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>âœ… å®æ—¶æ€§å¼ºï¼Œå»¶è¿Ÿä½</li><li>âœ… å®ç°ç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿</li><li>âœ… æ”¯æŒå¤šæ’­ï¼ˆä¸€å¯¹å¤šï¼‰</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>âŒ æ¶ˆæ¯ä¸æŒä¹…åŒ–ï¼Œå¯èƒ½ä¸¢å¤±</li><li>âŒ è®¢é˜…è€…å¿…é¡»åœ¨çº¿æ‰èƒ½æ¥æ”¶</li><li>âŒ æ²¡æœ‰æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>âœ… å®æ—¶èŠå¤©ã€å¼¹å¹•</li><li>âœ… å®æ—¶é€šçŸ¥ã€æ¨é€</li><li>âœ… å®æ—¶ç›‘æ§ã€æ—¥å¿—</li></ul><p><strong>ä¸é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>âŒ éœ€è¦æ¶ˆæ¯æŒä¹…åŒ–</li><li>âŒ éœ€è¦æ¶ˆæ¯ç¡®è®¤</li><li>âŒ è®¢é˜…è€…å¯èƒ½ç¦»çº¿</li></ul><p><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>å¦‚æœéœ€è¦æ¶ˆæ¯æŒä¹…åŒ–å’Œç¡®è®¤ï¼Œå»ºè®®ä½¿ç”¨ï¼š<ul><li><strong>Redis Stream</strong>ï¼ˆRedis 5.0+ï¼‰</li><li><strong>RabbitMQ</strong>ã€<strong>Kafka</strong> ç­‰ä¸“ä¸šæ¶ˆæ¯é˜Ÿåˆ—</li></ul></li></ul><h3 id="5-7-å¯¹æ¯”å…¶ä»–æ¶ˆæ¯æœºåˆ¶"><a href="#5-7-å¯¹æ¯”å…¶ä»–æ¶ˆæ¯æœºåˆ¶" class="headerlink" title="5.7 å¯¹æ¯”å…¶ä»–æ¶ˆæ¯æœºåˆ¶"></a>5.7 å¯¹æ¯”å…¶ä»–æ¶ˆæ¯æœºåˆ¶</h3><table><thead><tr><th>ç‰¹æ€§</th><th>Pub&#x2F;Sub</th><th>Stream</th><th>Listï¼ˆLPUSH&#x2F;RPOPï¼‰</th></tr></thead><tbody><tr><td>æ¶ˆæ¯æŒä¹…åŒ–</td><td>âŒ å¦</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td></tr><tr><td>æ¶ˆæ¯ç¡®è®¤</td><td>âŒ æ— </td><td>âœ… æœ‰</td><td>âš ï¸ æ‰‹åŠ¨</td></tr><tr><td>å¤šæ¶ˆè´¹è€…</td><td>âœ… æ”¯æŒ</td><td>âœ… æ”¯æŒ</td><td>âš ï¸ ç«äº‰æ¶ˆè´¹</td></tr><tr><td>æ¶ˆæ¯é‡æ’­</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td><td>âŒ ä¸æ”¯æŒ</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>å®æ—¶é€šçŸ¥</td><td>æ¶ˆæ¯é˜Ÿåˆ—</td><td>ç®€å•é˜Ÿåˆ—</td></tr></tbody></table><h3 id="å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰"><a href="#å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰" class="headerlink" title="å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰"></a>å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPubSub;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisSubscriber</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ›å»ºè®¢é˜…ç›‘å¬å™¨</span></span><br><span class="line">        <span class="type">JedisPubSub</span> <span class="variable">listener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPubSub</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String channel, String message)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯ - é¢‘é“: &quot;</span> + channel + <span class="string">&quot;, æ¶ˆæ¯: &quot;</span> + message);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSubscribe</span><span class="params">(String channel, <span class="type">int</span> subscribedChannels)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è®¢é˜…é¢‘é“: &quot;</span> + channel);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¢é˜…é¢‘é“ï¼ˆé˜»å¡ï¼‰</span></span><br><span class="line">        jedis.subscribe(listener, <span class="string">&quot;channel1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘å¸ƒè€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisPublisher</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">subscribers</span> <span class="operator">=</span> jedis.publish(<span class="string">&quot;channel1&quot;</span>, <span class="string">&quot;Hello Redis!&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€ç»™ &quot;</span> + subscribers + <span class="string">&quot; ä¸ªè®¢é˜…è€…&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-Redisé«˜çº§æ•°æ®ç±»å‹"><a href="#6-Redisé«˜çº§æ•°æ®ç±»å‹" class="headerlink" title="6. Redisé«˜çº§æ•°æ®ç±»å‹"></a>6. Redisé«˜çº§æ•°æ®ç±»å‹</h2><h3 id="6-1-Bitmapï¼ˆä½å›¾ï¼‰"><a href="#6-1-Bitmapï¼ˆä½å›¾ï¼‰" class="headerlink" title="6.1 Bitmapï¼ˆä½å›¾ï¼‰"></a>6.1 Bitmapï¼ˆä½å›¾ï¼‰</h3><h4 id="ä»€ä¹ˆæ˜¯Bitmap"><a href="#ä»€ä¹ˆæ˜¯Bitmap" class="headerlink" title="ä»€ä¹ˆæ˜¯Bitmap"></a>ä»€ä¹ˆæ˜¯Bitmap</h4><p><strong>Bitmapï¼ˆä½å›¾ï¼‰</strong> æ˜¯Redisæä¾›çš„ä¸€ç§ç‰¹æ®Šæ•°æ®ç»“æ„ï¼Œç”¨äºé«˜æ•ˆåœ°è¿›è¡Œä½æ“ä½œã€‚</p><p><strong>è®¡ç®—æœºåŸºç¡€çŸ¥è¯†</strong>ï¼š</p><ul><li>ç°ä»£è®¡ç®—æœºç”¨<strong>äºŒè¿›åˆ¶ï¼ˆä½ï¼‰</strong> ä½œä¸ºä¿¡æ¯çš„åŸºç¡€å•ä½</li><li>1ä¸ªå­—èŠ‚ï¼ˆByteï¼‰&#x3D; 8ä½ï¼ˆbitï¼‰</li><li>ä¾‹å¦‚å­—ç¬¦ä¸² <code>&quot;abc&quot;</code> ç”±3ä¸ªå­—èŠ‚ç»„æˆï¼š<ul><li><code>&#39;a&#39;</code> â†’ ASCIIç  <code>97</code> â†’ äºŒè¿›åˆ¶ <code>01100001</code></li><li><code>&#39;b&#39;</code> â†’ ASCIIç  <code>98</code> â†’ äºŒè¿›åˆ¶ <code>01100010</code></li><li><code>&#39;c&#39;</code> â†’ ASCIIç  <code>99</code> â†’ äºŒè¿›åˆ¶ <code>01100011</code></li></ul></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/bitmaps.png" alt="BitmapäºŒè¿›åˆ¶å­˜å‚¨"></p><p><strong>Bitmapçš„æœ¬è´¨</strong>ï¼š</p><ol><li><p><strong>Bitmapæœ¬èº«ä¸æ˜¯ä¸€ç§ç‹¬ç«‹çš„æ•°æ®ç±»å‹</strong></p><ul><li>å®é™…ä¸Šå®ƒå°±æ˜¯Stringç±»å‹ï¼ˆkey-valueï¼‰</li><li>ä½†å¯ä»¥å¯¹å­—ç¬¦ä¸²çš„<strong>ä½</strong>è¿›è¡Œæ“ä½œ</li></ul></li><li><p><strong>Bitmapæä¾›äº†ç‹¬ç«‹çš„å‘½ä»¤é›†</strong></p><ul><li>å¯ä»¥æŠŠBitmapæƒ³è±¡æˆä¸€ä¸ª<strong>ä»¥ä½ä¸ºå•ä½çš„æ•°ç»„</strong></li><li>æ•°ç»„çš„æ¯ä¸ªå•å…ƒåªèƒ½å­˜å‚¨ <code>0</code> æˆ– <code>1</code></li><li>æ•°ç»„çš„ä¸‹æ ‡åœ¨Bitmapä¸­å«åš<strong>åç§»é‡ï¼ˆoffsetï¼‰</strong></li></ul></li></ol><p><strong>Bitmapç»“æ„ç¤ºæ„å›¾</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åç§»é‡:  0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15</span><br><span class="line">ä½å€¼:   [0][1][0][0][1][1][0][0][1][0][0][1][0][0][1][1]</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/bitmaps2.png" alt="Bitmapç»“æ„"></p><p><strong>ä¼˜åŠ¿</strong>ï¼šåˆç†ä½¿ç”¨ä½æ“ä½œå¯ä»¥<strong>æœ‰æ•ˆæé«˜å†…å­˜ä½¿ç”¨ç‡å’Œå¼€å‘æ•ˆç‡</strong>ã€‚</p><h4 id="Bitmapå¸¸ç”¨å‘½ä»¤"><a href="#Bitmapå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Bitmapå¸¸ç”¨å‘½ä»¤"></a>Bitmapå¸¸ç”¨å‘½ä»¤</h4><h5 id="1-SETBIT-è®¾ç½®ä½å€¼"><a href="#1-SETBIT-è®¾ç½®ä½å€¼" class="headerlink" title="1. SETBIT - è®¾ç½®ä½å€¼"></a>1. SETBIT - è®¾ç½®ä½å€¼</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SETBIT key offset value</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>å–å€¼</th></tr></thead><tbody><tr><td><code>key</code></td><td>é”®å</td><td>å­—ç¬¦ä¸²</td></tr><tr><td><code>offset</code></td><td>åç§»é‡ï¼ˆä»0å¼€å§‹ï¼‰</td><td>éè´Ÿæ•´æ•°</td></tr><tr><td><code>value</code></td><td>ä½å€¼</td><td>0 æˆ– 1</td></tr></tbody></table><p><strong>è¿”å›å€¼</strong>ï¼šåŸå§‹ä½çš„å€¼ï¼ˆ0æˆ–1ï¼‰</p><p><strong>åº”ç”¨åœºæ™¯ï¼šç”¨æˆ·è®¿é—®ç»Ÿè®¡</strong></p><p>æ¯ä¸ªç‹¬ç«‹ç”¨æˆ·æ˜¯å¦è®¿é—®è¿‡ç½‘ç«™å­˜æ”¾åœ¨Bitmapä¸­ï¼š</p><ul><li>è®¿é—®çš„ç”¨æˆ·è®°ä¸º <code>1</code></li><li>æœªè®¿é—®çš„ç”¨æˆ·è®°ä¸º <code>0</code></li><li>ç”¨åç§»é‡ä½œä¸ºç”¨æˆ·çš„ID</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>å‡è®¾ç°åœ¨æœ‰20ä¸ªç”¨æˆ·ï¼Œuseridä¸º <code>1, 6, 11, 15, 19</code> çš„ç”¨æˆ·è®¿é—®äº†ç½‘ç«™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># unique:users:20201106 ä»£è¡¨2020-11-06è¿™å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·</span></span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201106 1 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201106 6 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201106 11 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201106 15 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201106 19 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure><p><strong>BitmapçŠ¶æ€å¦‚ä¸‹</strong>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/bitmaps%E5%AE%9E%E4%BE%8B.png" alt="Bitmapç”¨æˆ·è®¿é—®ç¤ºä¾‹"></p><p><strong>âš ï¸ æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ol><li><p><strong>ç”¨æˆ·IDä¼˜åŒ–</strong>ï¼š</p><ul><li>å¾ˆå¤šåº”ç”¨çš„ç”¨æˆ·IDä»¥æŒ‡å®šæ•°å­—å¼€å¤´ï¼ˆä¾‹å¦‚10000ï¼‰</li><li>ç›´æ¥ä½¿ç”¨ç”¨æˆ·IDä½œä¸ºåç§»é‡ä¼šé€ æˆç©ºé—´æµªè´¹</li><li><strong>æ¨èåšæ³•</strong>ï¼šæ¯æ¬¡åšSETBITæ—¶å°†ç”¨æˆ·IDå‡å»èµ·å§‹æ•°å­—</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾ç”¨æˆ·IDä»10000å¼€å§‹</span></span><br><span class="line">SETBIT unique:<span class="built_in">users</span>:20201106 $((<span class="number">10001</span> - <span class="number">10000</span>)) 1  <span class="comment"># ç”¨æˆ·10001</span></span><br><span class="line">SETBIT unique:<span class="built_in">users</span>:20201106 $((<span class="number">10086</span> - <span class="number">10000</span>)) 1  <span class="comment"># ç”¨æˆ·10086</span></span><br></pre></td></tr></table></figure></li><li><p><strong>åˆå§‹åŒ–æ€§èƒ½</strong>ï¼š</p><ul><li>åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–Bitmapæ—¶ï¼Œå¦‚æœåç§»é‡éå¸¸å¤§ï¼ˆå¦‚åƒä¸‡çº§ï¼‰</li><li>æ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œä¼šæ¯”è¾ƒæ…¢</li><li>å¯èƒ½ä¼šé€ æˆRedisçš„<strong>é˜»å¡</strong></li><li>å»ºè®®åˆ†æ‰¹åˆå§‹åŒ–æˆ–ä½¿ç”¨ç®¡é“ï¼ˆPipelineï¼‰</li></ul></li></ol><h5 id="2-GETBIT-è·å–ä½å€¼"><a href="#2-GETBIT-è·å–ä½å€¼" class="headerlink" title="2. GETBIT - è·å–ä½å€¼"></a>2. GETBIT - è·å–ä½å€¼</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GETBIT key offset</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>å–å€¼</th></tr></thead><tbody><tr><td><code>key</code></td><td>é”®å</td><td>å­—ç¬¦ä¸²</td></tr><tr><td><code>offset</code></td><td>åç§»é‡ï¼ˆä»0å¼€å§‹ï¼‰</td><td>éè´Ÿæ•´æ•°</td></tr></tbody></table><p><strong>è¿”å›å€¼</strong>ï¼šä½å€¼ï¼ˆ0æˆ–1ï¼‰ï¼Œå¦‚æœoffsetè¶…å‡ºèŒƒå›´åˆ™è¿”å›0</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢userid=1çš„ç”¨æˆ·æ˜¯å¦è®¿é—®è¿‡</span></span><br><span class="line">127.0.0.1:6379&gt; GETBIT unique:<span class="built_in">users</span>:20201106 1</span><br><span class="line">(<span class="built_in">integer</span>) 1    <span class="comment"># è¿”å›1è¡¨ç¤ºè®¿é—®è¿‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢userid=8çš„ç”¨æˆ·æ˜¯å¦è®¿é—®è¿‡</span></span><br><span class="line">127.0.0.1:6379&gt; GETBIT unique:<span class="built_in">users</span>:20201106 8</span><br><span class="line">(<span class="built_in">integer</span>) 0    <span class="comment"># è¿”å›0è¡¨ç¤ºæœªè®¿é—®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ä¸å­˜åœ¨çš„åç§»é‡</span></span><br><span class="line">127.0.0.1:6379&gt; GETBIT unique:<span class="built_in">users</span>:20201106 100</span><br><span class="line">(<span class="built_in">integer</span>) 0    <span class="comment"># è¶…å‡ºèŒƒå›´ä¹Ÿè¿”å›0</span></span><br></pre></td></tr></table></figure><h5 id="3-BITCOUNT-ç»Ÿè®¡ä½å€¼ä¸º1çš„æ•°é‡"><a href="#3-BITCOUNT-ç»Ÿè®¡ä½å€¼ä¸º1çš„æ•°é‡" class="headerlink" title="3. BITCOUNT - ç»Ÿè®¡ä½å€¼ä¸º1çš„æ•°é‡"></a>3. BITCOUNT - ç»Ÿè®¡ä½å€¼ä¸º1çš„æ•°é‡</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITCOUNT key [start end]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>å–å€¼</th><th>æ˜¯å¦å¿…éœ€</th></tr></thead><tbody><tr><td><code>key</code></td><td>é”®å</td><td>å­—ç¬¦ä¸²</td><td>å¿…éœ€</td></tr><tr><td><code>start</code></td><td>èµ·å§‹å­—èŠ‚ç´¢å¼•</td><td>æ•´æ•°ï¼ˆå¯ä¸ºè´Ÿæ•°ï¼‰</td><td>å¯é€‰</td></tr><tr><td><code>end</code></td><td>ç»“æŸå­—èŠ‚ç´¢å¼•</td><td>æ•´æ•°ï¼ˆå¯ä¸ºè´Ÿæ•°ï¼‰</td><td>å¯é€‰</td></tr></tbody></table><p><strong>åŠŸèƒ½è¯´æ˜</strong>ï¼š</p><ul><li>ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­ä½å€¼ä¸º <code>1</code> çš„bitæ•°é‡</li><li>ä¸æŒ‡å®š<code>start</code>å’Œ<code>end</code>æ—¶ï¼Œç»Ÿè®¡æ•´ä¸ªå­—ç¬¦ä¸²</li><li><code>start</code>å’Œ<code>end</code>æ˜¯<strong>å­—èŠ‚ç´¢å¼•</strong>ï¼ˆä¸æ˜¯ä½ç´¢å¼•ï¼‰ï¼Œä»0å¼€å§‹</li><li>æ”¯æŒè´Ÿæ•°ç´¢å¼•ï¼š<code>-1</code>è¡¨ç¤ºæœ€åä¸€ä¸ªå­—èŠ‚ï¼Œ<code>-2</code>è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªå­—èŠ‚</li></ul><p><strong>è¿”å›å€¼</strong>ï¼šä½å€¼ä¸º1çš„æ•°é‡</p><p><strong>ç¤ºä¾‹1ï¼šç»Ÿè®¡å…¨éƒ¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—2020-11-06è¿™å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·æ•°é‡</span></span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT unique:<span class="built_in">users</span>:20201106</span><br><span class="line">(<span class="built_in">integer</span>) 5    <span class="comment"># æœ‰5ä¸ªç”¨æˆ·è®¿é—®è¿‡ï¼ˆuserid=1,6,11,15,19ï¼‰</span></span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹2ï¼šæŒ‰å­—èŠ‚èŒƒå›´ç»Ÿè®¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾æœ‰ä¸€ä¸ªkey K1ï¼Œå†…å®¹ä¸ºï¼š</span></span><br><span class="line"><span class="comment"># K1 = [01000001 01000000 00000000 00100001]</span></span><br><span class="line"><span class="comment">#      [ å­—èŠ‚0 ][ å­—èŠ‚1 ][ å­—èŠ‚2 ][ å­—èŠ‚3 ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡å­—èŠ‚1å’Œå­—èŠ‚2ï¼ˆå³ 01000000 00000000ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT K1 1 2</span><br><span class="line">(<span class="built_in">integer</span>) 1    <span class="comment"># åªæœ‰1ä¸ªbitä¸º1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡å­—èŠ‚1åˆ°å­—èŠ‚3ï¼ˆå³ 01000000 00000000 00100001ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT K1 1 3</span><br><span class="line">(<span class="built_in">integer</span>) 3    <span class="comment"># æœ‰3ä¸ªbitä¸º1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡å­—èŠ‚0åˆ°å€’æ•°ç¬¬2ä¸ªå­—èŠ‚ï¼ˆå³ 01000001 01000000 00000000ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT K1 0 -2</span><br><span class="line">(<span class="built_in">integer</span>) 3    <span class="comment"># æœ‰3ä¸ªbitä¸º1</span></span><br></pre></td></tr></table></figure><p><strong>âš ï¸ é‡è¦æé†’</strong>ï¼š</p><ul><li><code>SETBIT</code> æ“ä½œçš„æ˜¯<strong>bitä½ç½®</strong>ï¼ˆåç§»é‡ï¼‰</li><li><code>BITCOUNT</code> çš„ <code>start/end</code> å‚æ•°æ˜¯<strong>byteä½ç½®</strong>ï¼ˆå­—èŠ‚ç´¢å¼•ï¼‰</li></ul><p><strong>å®é™…åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»Ÿè®¡ç¬¬1ä¸ªå­—èŠ‚åˆ°ç¬¬3ä¸ªå­—èŠ‚ä¹‹é—´çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·æ•°</span></span><br><span class="line"><span class="comment"># å¯¹åº”çš„ç”¨æˆ·idæ˜¯ 11, 15, 19</span></span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT unique:<span class="built_in">users</span>:20201106 1 3</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><h5 id="4-BITOP-ä½è¿ç®—"><a href="#4-BITOP-ä½è¿ç®—" class="headerlink" title="4. BITOP - ä½è¿ç®—"></a>4. BITOP - ä½è¿ç®—</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITOP operation destkey key [key ...]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>å–å€¼</th></tr></thead><tbody><tr><td><code>operation</code></td><td>ä½è¿ç®—æ“ä½œ</td><td>ANDï¼ˆäº¤é›†ï¼‰ã€ORï¼ˆå¹¶é›†ï¼‰ã€NOTï¼ˆéï¼‰ã€XORï¼ˆå¼‚æˆ–ï¼‰</td></tr><tr><td><code>destkey</code></td><td>ç»“æœä¿å­˜çš„ç›®æ ‡é”®</td><td>å­—ç¬¦ä¸²</td></tr><tr><td><code>key</code></td><td>å‚ä¸è¿ç®—çš„é”®</td><td>ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²</td></tr></tbody></table><p><strong>åŠŸèƒ½è¯´æ˜</strong>ï¼šå¯¹å¤šä¸ªBitmapè¿›è¡Œä½è¿ç®—ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°<code>destkey</code>ä¸­ã€‚</p><p><strong>è¿”å›å€¼</strong>ï¼šä¿å­˜åˆ°<code>destkey</code>çš„å­—ç¬¦ä¸²é•¿åº¦</p><p><strong>æ”¯æŒçš„æ“ä½œ</strong>ï¼š</p><table><thead><tr><th>æ“ä½œ</th><th>è¯´æ˜</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><code>AND</code></td><td>äº¤é›†</td><td>æ‰¾å‡ºåŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶çš„å…ƒç´ </td></tr><tr><td><code>OR</code></td><td>å¹¶é›†</td><td>æ‰¾å‡ºæ»¡è¶³ä»»æ„æ¡ä»¶çš„å…ƒç´ </td></tr><tr><td><code>NOT</code></td><td>é</td><td>åè½¬æ‰€æœ‰ä½ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªæºkeyï¼‰</td></tr><tr><td><code>XOR</code></td><td>å¼‚æˆ–</td><td>æ‰¾å‡ºåªæ»¡è¶³å…¶ä¸­ä¸€ä¸ªæ¡ä»¶çš„å…ƒç´ </td></tr></tbody></table><p><strong>åº”ç”¨åœºæ™¯ç¤ºä¾‹</strong>ï¼š</p><p><strong>åœºæ™¯1ï¼šè®¡ç®—ä¸¤å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·ï¼ˆANDäº¤é›†ï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2020-11-04è®¿é—®çš„ç”¨æˆ·ï¼šuserid=1,2,5,9</span></span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201104 1 1</span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201104 2 1</span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201104 5 1</span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201104 9 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2020-11-03è®¿é—®çš„ç”¨æˆ·ï¼šuserid=0,1,4,9</span></span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201103 0 1</span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201103 1 1</span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201103 4 1</span><br><span class="line">127.0.0.1:6379&gt; SETBIT unique:<span class="built_in">users</span>:20201103 9 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—ä¸¤å¤©éƒ½è®¿é—®è¿‡çš„ç”¨æˆ·ï¼ˆäº¤é›†ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; BITOP AND unique:<span class="built_in">users</span>:and:20201104_03 unique:<span class="built_in">users</span>:20201103 unique:<span class="built_in">users</span>:20201104</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç»“æœ</span></span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT unique:<span class="built_in">users</span>:and:20201104_03</span><br><span class="line">(<span class="built_in">integer</span>) 2    <span class="comment"># ç”¨æˆ·1å’Œ9ä¸¤å¤©éƒ½è®¿é—®è¿‡</span></span><br></pre></td></tr></table></figure><p><strong>åœºæ™¯2ï¼šè®¡ç®—ä»»æ„ä¸€å¤©è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·ï¼ˆORå¹¶é›†ï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—è‡³å°‘è®¿é—®è¿‡ä¸€å¤©çš„ç”¨æˆ·ï¼ˆå¹¶é›†ï¼‰- å¯ç”¨äºç»Ÿè®¡æœˆæ´»</span></span><br><span class="line">127.0.0.1:6379&gt; BITOP OR unique:<span class="built_in">users</span>:or:20201104_03 unique:<span class="built_in">users</span>:20201103 unique:<span class="built_in">users</span>:20201104</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç»“æœ</span></span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT unique:<span class="built_in">users</span>:or:20201104_03</span><br><span class="line">(<span class="built_in">integer</span>) 6    <span class="comment"># ç”¨æˆ·0,1,2,4,5,9è‡³å°‘è®¿é—®è¿‡ä¸€å¤©</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/bitmapAnd%E7%A4%BA%E4%BE%8B.png" alt="Bitmapä½è¿ç®—ç¤ºä¾‹"></p><p><strong>åœºæ™¯3ï¼šè®¡ç®—æœªè®¿é—®è¿‡çš„ç”¨æˆ·ï¼ˆNOTï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åè½¬æ‰€æœ‰ä½ï¼Œæ‰¾å‡ºæœªè®¿é—®çš„ç”¨æˆ·</span></span><br><span class="line">127.0.0.1:6379&gt; BITOP NOT unique:<span class="built_in">users</span>:not:20201104 unique:<span class="built_in">users</span>:20201104</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><h4 id="Bitmapä¸Setå¯¹æ¯”"><a href="#Bitmapä¸Setå¯¹æ¯”" class="headerlink" title="Bitmapä¸Setå¯¹æ¯”"></a>Bitmapä¸Setå¯¹æ¯”</h4><h5 id="åœºæ™¯1ï¼šå¤§é‡æ´»è·ƒç”¨æˆ·ï¼ˆBitmapä¼˜åŠ¿æ˜æ˜¾ï¼‰"><a href="#åœºæ™¯1ï¼šå¤§é‡æ´»è·ƒç”¨æˆ·ï¼ˆBitmapä¼˜åŠ¿æ˜æ˜¾ï¼‰" class="headerlink" title="åœºæ™¯1ï¼šå¤§é‡æ´»è·ƒç”¨æˆ·ï¼ˆBitmapä¼˜åŠ¿æ˜æ˜¾ï¼‰"></a>åœºæ™¯1ï¼šå¤§é‡æ´»è·ƒç”¨æˆ·ï¼ˆBitmapä¼˜åŠ¿æ˜æ˜¾ï¼‰</h5><p><strong>å‡è®¾</strong>ï¼š</p><ul><li>ç½‘ç«™æ€»ç”¨æˆ·æ•°ï¼š<strong>1äº¿</strong></li><li>æ¯å¤©ç‹¬ç«‹è®¿é—®ç”¨æˆ·ï¼š<strong>5åƒä¸‡</strong></li></ul><p><strong>å­˜å‚¨å¯¹æ¯”è¡¨</strong>ï¼š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>æ¯ä¸ªuseridå ç”¨ç©ºé—´</th><th>éœ€è¦å­˜å‚¨çš„ç”¨æˆ·é‡</th><th>å…¨éƒ¨å†…å­˜é‡</th></tr></thead><tbody><tr><td><strong>Seté›†åˆ</strong></td><td>64ä½ï¼ˆ8å­—èŠ‚ï¼‰</td><td>50,000,000</td><td>64ä½ Ã— 50,000,000 &#x3D; <strong>400MB</strong></td></tr><tr><td><strong>Bitmap</strong></td><td>1ä½</td><td>100,000,000</td><td>1ä½ Ã— 100,000,000 &#x3D; <strong>12.5MB</strong></td></tr></tbody></table><p><strong>èŠ‚çœç©ºé—´</strong>ï¼š400MB - 12.5MB &#x3D; <strong>387.5MB</strong>ï¼ˆèŠ‚çœ96.88%ï¼‰</p><p><strong>é•¿æœŸå­˜å‚¨å¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>ä¸€å¤©</th><th>ä¸€ä¸ªæœˆï¼ˆ30å¤©ï¼‰</th><th>ä¸€å¹´ï¼ˆ365å¤©ï¼‰</th></tr></thead><tbody><tr><td><strong>Seté›†åˆ</strong></td><td>400MB</td><td>12GB</td><td>144GB</td></tr><tr><td><strong>Bitmap</strong></td><td>12.5MB</td><td>375MB</td><td>4.5GB</td></tr></tbody></table><blockquote><p>âœ… <strong>ç»“è®º</strong>ï¼šåœ¨å¤§é‡æ´»è·ƒç”¨æˆ·åœºæ™¯ä¸‹ï¼ŒBitmapèƒ½èŠ‚çœ<strong>å¤§é‡å†…å­˜ç©ºé—´</strong>ï¼Œå°¤å…¶æ˜¯éšç€æ—¶é—´æ¨ç§»ï¼Œä¼˜åŠ¿éå¸¸æ˜æ˜¾ã€‚</p></blockquote><h5 id="åœºæ™¯2ï¼šå°‘é‡æ´»è·ƒç”¨æˆ·ï¼ˆBitmapåŠ£åŠ¿æ˜æ˜¾ï¼‰"><a href="#åœºæ™¯2ï¼šå°‘é‡æ´»è·ƒç”¨æˆ·ï¼ˆBitmapåŠ£åŠ¿æ˜æ˜¾ï¼‰" class="headerlink" title="åœºæ™¯2ï¼šå°‘é‡æ´»è·ƒç”¨æˆ·ï¼ˆBitmapåŠ£åŠ¿æ˜æ˜¾ï¼‰"></a>åœºæ™¯2ï¼šå°‘é‡æ´»è·ƒç”¨æˆ·ï¼ˆBitmapåŠ£åŠ¿æ˜æ˜¾ï¼‰</h5><p><strong>å‡è®¾</strong>ï¼š</p><ul><li>ç½‘ç«™æ€»ç”¨æˆ·æ•°ï¼š<strong>1äº¿</strong></li><li>æ¯å¤©ç‹¬ç«‹è®¿é—®ç”¨æˆ·ï¼š<strong>10ä¸‡</strong>ï¼ˆå¤§é‡åƒµå°¸ç”¨æˆ·ï¼‰</li></ul><p><strong>å­˜å‚¨å¯¹æ¯”è¡¨</strong>ï¼š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>æ¯ä¸ªuseridå ç”¨ç©ºé—´</th><th>éœ€è¦å­˜å‚¨çš„ç”¨æˆ·é‡</th><th>å…¨éƒ¨å†…å­˜é‡</th></tr></thead><tbody><tr><td><strong>Seté›†åˆ</strong></td><td>64ä½ï¼ˆ8å­—èŠ‚ï¼‰</td><td>100,000</td><td>64ä½ Ã— 100,000 &#x3D; <strong>800KB</strong></td></tr><tr><td><strong>Bitmap</strong></td><td>1ä½</td><td>100,000,000</td><td>1ä½ Ã— 100,000,000 &#x3D; <strong>12.5MB</strong></td></tr></tbody></table><p><strong>ç©ºé—´æµªè´¹</strong>ï¼š12.5MB - 800KB &#x3D; <strong>11.7MB</strong>ï¼ˆBitmapå¤šå ç”¨15.6å€ç©ºé—´ï¼‰</p><blockquote><p>âŒ <strong>ç»“è®º</strong>ï¼šåœ¨å°‘é‡æ´»è·ƒç”¨æˆ·åœºæ™¯ä¸‹ï¼Œä½¿ç”¨Bitmap<strong>ä¸åˆé€‚</strong>ï¼Œå› ä¸ºå¤§éƒ¨åˆ†ä½éƒ½æ˜¯0ï¼Œé€ æˆç©ºé—´æµªè´¹ã€‚</p></blockquote><h4 id="ä½¿ç”¨å»ºè®®-1"><a href="#ä½¿ç”¨å»ºè®®-1" class="headerlink" title="ä½¿ç”¨å»ºè®®"></a>ä½¿ç”¨å»ºè®®</h4><p><strong>âœ… Bitmapé€‚ç”¨åœºæ™¯</strong>ï¼š</p><ol><li><p><strong>å¤§é‡ç”¨æˆ·ï¼Œé«˜æ´»è·ƒåº¦</strong>ï¼ˆæ´»è·ƒç‡ &gt; 10%ï¼‰</p><ul><li>ç”¨æˆ·ç­¾åˆ°ç»Ÿè®¡</li><li>æ—¥æ´»&#x2F;æœˆæ´»ç»Ÿè®¡</li><li>åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡</li></ul></li><li><p><strong>äºŒå€¼çŠ¶æ€æ ‡è®°</strong></p><ul><li>æ˜¯å¦å®Œæˆä»»åŠ¡ï¼ˆ0&#x2F;1ï¼‰</li><li>æ˜¯å¦å·²è¯»æ¶ˆæ¯ï¼ˆ0&#x2F;1ï¼‰</li><li>æƒé™æ§åˆ¶ï¼ˆæœ‰&#x2F;æ— ï¼‰</li></ul></li><li><p><strong>éœ€è¦ä½è¿ç®—</strong></p><ul><li>å¤šæ¡ä»¶äº¤é›†&#x2F;å¹¶é›†æŸ¥è¯¢</li><li>è¿ç»­ç­¾åˆ°ç»Ÿè®¡</li><li>ç”¨æˆ·ç”»åƒæ ‡ç­¾</li></ul></li></ol><p><strong>âŒ Bitmapä¸é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ol><li><p><strong>ç”¨æˆ·é‡å¤§ï¼Œæ´»è·ƒåº¦ä½</strong>ï¼ˆæ´»è·ƒç‡ &lt; 1%ï¼‰</p><ul><li>å»ºè®®ä½¿ç”¨Setæˆ–Hash</li></ul></li><li><p><strong>éœ€è¦å­˜å‚¨å¤šä¸ªçŠ¶æ€</strong>ï¼ˆä¸åªæ˜¯0&#x2F;1ï¼‰</p><ul><li>å»ºè®®ä½¿ç”¨Hashæˆ–String</li></ul></li><li><p><strong>ç”¨æˆ·IDä¸è¿ç»­æˆ–éæ•°å­—</strong></p><ul><li>å»ºè®®ä½¿ç”¨Hashæ˜ å°„</li></ul></li></ol><p><strong>æ€§èƒ½å¯¹æ¯”æ€»ç»“</strong>ï¼š</p><table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>Set</th><th>Bitmap</th></tr></thead><tbody><tr><td>å†…å­˜å ç”¨ï¼ˆé«˜æ´»è·ƒï¼‰</td><td>å¤§</td><td>å°</td></tr><tr><td>å†…å­˜å ç”¨ï¼ˆä½æ´»è·ƒï¼‰</td><td>å°</td><td>å¤§</td></tr><tr><td>æŸ¥è¯¢é€Ÿåº¦</td><td>O(1)</td><td>O(1)</td></tr><tr><td>ç»Ÿè®¡é€Ÿåº¦</td><td>O(N)</td><td>O(N&#x2F;8)</td></tr><tr><td>é›†åˆè¿ç®—</td><td>æ”¯æŒ</td><td>æ”¯æŒï¼ˆæ›´å¿«ï¼‰</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>å°‘é‡æ´»è·ƒç”¨æˆ·</td><td>å¤§é‡æ´»è·ƒç”¨æˆ·</td></tr></tbody></table><h4 id="å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰-1"><a href="#å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰-1" class="headerlink" title="å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰"></a>å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BitmapExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;unique:users:20201106&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. è®°å½•ç”¨æˆ·è®¿é—®</span></span><br><span class="line">        jedis.setbit(key, <span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line">        jedis.setbit(key, <span class="number">6</span>, <span class="literal">true</span>);</span><br><span class="line">        jedis.setbit(key, <span class="number">11</span>, <span class="literal">true</span>);</span><br><span class="line">        jedis.setbit(key, <span class="number">15</span>, <span class="literal">true</span>);</span><br><span class="line">        jedis.setbit(key, <span class="number">19</span>, <span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦è®¿é—®</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">visited</span> <span class="operator">=</span> jedis.getbit(key, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ·1æ˜¯å¦è®¿é—®: &quot;</span> + visited);  <span class="comment">// true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. ç»Ÿè®¡è®¿é—®ç”¨æˆ·æ•°</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> jedis.bitcount(key);</span><br><span class="line">        System.out.println(<span class="string">&quot;è®¿é—®ç”¨æˆ·æ•°: &quot;</span> + count);  <span class="comment">// 5</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. å¤šå¤©è®¿é—®äº¤é›†ï¼ˆè¿ç»­è®¿é—®ç”¨æˆ·ï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key1</span> <span class="operator">=</span> <span class="string">&quot;unique:users:20201104&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key2</span> <span class="operator">=</span> <span class="string">&quot;unique:users:20201105&quot;</span>;</span><br><span class="line">        jedis.setbit(key1, <span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line">        jedis.setbit(key1, <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">        jedis.setbit(key2, <span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line">        jedis.setbit(key2, <span class="number">3</span>, <span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">destKey</span> <span class="operator">=</span> <span class="string">&quot;unique:users:continuous&quot;</span>;</span><br><span class="line">        jedis.bitop(BitOP.AND, destKey, key1, key2);</span><br><span class="line">        <span class="type">long</span> <span class="variable">continuousUsers</span> <span class="operator">=</span> jedis.bitcount(destKey);</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿ç»­è®¿é—®ç”¨æˆ·æ•°: &quot;</span> + continuousUsers);  <span class="comment">// 1</span></span><br><span class="line">        </span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-HyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰"><a href="#6-2-HyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰" class="headerlink" title="6.2 HyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰"></a>6.2 HyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰</h3><h4 id="ä»€ä¹ˆæ˜¯HyperLogLog"><a href="#ä»€ä¹ˆæ˜¯HyperLogLog" class="headerlink" title="ä»€ä¹ˆæ˜¯HyperLogLog"></a>ä»€ä¹ˆæ˜¯HyperLogLog</h4><p><strong>HyperLogLogï¼ˆHLLï¼‰</strong> æ˜¯Redisæä¾›çš„ä¸€ç§<strong>åŸºæ•°ç»Ÿè®¡ç®—æ³•</strong>ï¼Œç”¨äºè§£å†³å¤§æ•°æ®é‡ä¸‹çš„å»é‡è®¡æ•°é—®é¢˜ã€‚</p><h4 id="ä¸šåŠ¡åœºæ™¯ï¼šç»Ÿè®¡éœ€æ±‚çš„æŒ‘æˆ˜"><a href="#ä¸šåŠ¡åœºæ™¯ï¼šç»Ÿè®¡éœ€æ±‚çš„æŒ‘æˆ˜" class="headerlink" title="ä¸šåŠ¡åœºæ™¯ï¼šç»Ÿè®¡éœ€æ±‚çš„æŒ‘æˆ˜"></a>ä¸šåŠ¡åœºæ™¯ï¼šç»Ÿè®¡éœ€æ±‚çš„æŒ‘æˆ˜</h4><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°å„ç§ç»Ÿè®¡éœ€æ±‚ï¼š</p><table><thead><tr><th>ç»Ÿè®¡ç±»å‹</th><th>è¯´æ˜</th><th>å®ç°æ–¹å¼</th><th>éš¾åº¦</th></tr></thead><tbody><tr><td><strong>PV</strong>ï¼ˆPageViewï¼‰</td><td>é¡µé¢è®¿é—®é‡ï¼ˆå¯é‡å¤è®¡æ•°ï¼‰</td><td><code>INCR</code>ã€<code>INCRBY</code></td><td>â­ ç®€å•</td></tr><tr><td><strong>UV</strong>ï¼ˆUniqueVisitorï¼‰</td><td>ç‹¬ç«‹è®¿å®¢æ•°ï¼ˆéœ€å»é‡ï¼‰</td><td>HyperLogLog &#x2F; Set</td><td>â­â­â­ å¤æ‚</td></tr><tr><td><strong>ç‹¬ç«‹IPæ•°</strong></td><td>ä¸åŒIPè®¿é—®æ•°ï¼ˆéœ€å»é‡ï¼‰</td><td>HyperLogLog &#x2F; Set</td><td>â­â­â­ å¤æ‚</td></tr><tr><td><strong>æœç´¢è®°å½•æ•°</strong></td><td>ä¸åŒæœç´¢å…³é”®è¯æ•°ï¼ˆéœ€å»é‡ï¼‰</td><td>HyperLogLog &#x2F; Set</td><td>â­â­â­ å¤æ‚</td></tr></tbody></table><p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šè¿™äº›éœ€è¦<strong>å»é‡å’Œè®¡æ•°</strong>çš„é—®é¢˜ç§°ä¸º<strong>åŸºæ•°é—®é¢˜ï¼ˆCardinality Problemï¼‰</strong>ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯åŸºæ•°ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åŸºæ•°ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åŸºæ•°ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åŸºæ•°ï¼Ÿ</h4><p><strong>åŸºæ•°ï¼ˆCardinalityï¼‰</strong> &#x3D; é›†åˆä¸­ä¸é‡å¤å…ƒç´ çš„ä¸ªæ•°</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åŸå§‹æ•°æ®é›†ï¼š&#123;1, 3, 5, 7, 5, 7, 8&#125;</span><br><span class="line">åŸºæ•°é›†åˆï¼š  &#123;1, 3, 5, 7, 8&#125;</span><br><span class="line">åŸºæ•°ï¼š      5ï¼ˆä¸é‡å¤å…ƒç´ ä¸ªæ•°ï¼‰</span><br></pre></td></tr></table></figure><p><strong>åŸºæ•°ä¼°è®¡</strong>ï¼šåœ¨<strong>è¯¯å·®å¯æ¥å—</strong>çš„èŒƒå›´å†…ï¼Œ<strong>å¿«é€Ÿè®¡ç®—</strong>åŸºæ•°ã€‚</p><h4 id="ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆçš„é—®é¢˜"><a href="#ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆçš„é—®é¢˜" class="headerlink" title="ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆçš„é—®é¢˜"></a>ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆçš„é—®é¢˜</h4><h5 id="æ–¹æ¡ˆå¯¹æ¯”"><a href="#æ–¹æ¡ˆå¯¹æ¯”" class="headerlink" title="æ–¹æ¡ˆå¯¹æ¯”"></a>æ–¹æ¡ˆå¯¹æ¯”</h5><table><thead><tr><th>æ–¹æ¡ˆ</th><th>å®ç°æ–¹å¼</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>MySQL</strong></td><td><code>SELECT COUNT(DISTINCT user_id)</code></td><td>ç»“æœç²¾ç¡®</td><td>âŒ æ€§èƒ½å·®<br>âŒ æ•°æ®é‡å¤§æ—¶æ…¢</td></tr><tr><td><strong>Redis Set</strong></td><td><code>SADD</code> + <code>SCARD</code></td><td>ç»“æœç²¾ç¡®<br>æŸ¥è¯¢å¿«</td><td>âŒ å†…å­˜å ç”¨å¤§<br>âŒ å…ƒç´ è¶Šå¤šè¶Šå å†…å­˜</td></tr><tr><td><strong>Redis Hash</strong></td><td><code>HSET</code> + <code>HLEN</code></td><td>ç»“æœç²¾ç¡®<br>æŸ¥è¯¢å¿«</td><td>âŒ å†…å­˜å ç”¨å¤§</td></tr><tr><td><strong>Bitmap</strong></td><td><code>SETBIT</code> + <code>BITCOUNT</code></td><td>å†…å­˜å ç”¨å°</td><td>âŒ ä»…é€‚ç”¨äºæ•°å€¼ID<br>âŒ ç¨€ç–æ•°æ®æµªè´¹ç©ºé—´</td></tr></tbody></table><p><strong>æ ¸å¿ƒçŸ›ç›¾</strong>ï¼š</p><ul><li>âœ… ç²¾ç¡®ç»Ÿè®¡ <strong>vs</strong> âŒ å†…å­˜å ç”¨è¿‡å¤§</li><li>éšç€æ•°æ®é‡å¢åŠ ï¼Œå†…å­˜å ç”¨çº¿æ€§å¢é•¿ï¼Œå¯¹äºè¶…å¤§æ•°æ®é›†<strong>ä¸åˆ‡å®é™…</strong></li></ul><p><strong>è§£å†³æ€è·¯</strong>ï¼šèƒ½å¦<strong>é™ä½ä¸€å®šç²¾åº¦</strong>æ¥<strong>å¹³è¡¡å­˜å‚¨ç©ºé—´</strong>ï¼Ÿ</p><h4 id="HyperLogLogçš„ä¼˜åŠ¿"><a href="#HyperLogLogçš„ä¼˜åŠ¿" class="headerlink" title="HyperLogLogçš„ä¼˜åŠ¿"></a>HyperLogLogçš„ä¼˜åŠ¿</h4><p>Redisæ¨å‡ºäº†<strong>HyperLogLogç®—æ³•</strong>ï¼Œå®Œç¾è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å›ºå®šå†…å­˜</strong></td><td>æ¯ä¸ªHLLé”®åªéœ€ <strong>12KB</strong> å†…å­˜</td></tr><tr><td><strong>æµ·é‡æ•°æ®</strong></td><td>å¯ç»Ÿè®¡æ¥è¿‘ <strong>2â¶â´</strong>ï¼ˆçº¦1800ä¸‡äº¿ï¼‰ä¸ªä¸åŒå…ƒç´ </td></tr><tr><td><strong>è¯¯å·®ç‡ä½</strong></td><td>æ ‡å‡†è¯¯å·®ç‡ <strong>0.81%</strong></td></tr><tr><td><strong>ä¸å­˜å‚¨å…ƒç´ </strong></td><td>åªè®¡ç®—åŸºæ•°ï¼Œä¸ä¿å­˜å…ƒç´ æœ¬èº«</td></tr></tbody></table><p><strong>å¯¹æ¯”ä¼˜åŠ¿</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ä¼ ç»ŸSetæ–¹æ¡ˆï¼š</span><br><span class="line">- 1äº¿ç”¨æˆ·UV â†’ éœ€è¦çº¦ 800MB å†…å­˜ï¼ˆæ¯ä¸ªå…ƒç´ 8å­—èŠ‚ï¼‰</span><br><span class="line">- å…ƒç´ è¶Šå¤šï¼Œå†…å­˜è¶Šå¤§ï¼ˆçº¿æ€§å¢é•¿ï¼‰</span><br><span class="line"></span><br><span class="line">HyperLogLogæ–¹æ¡ˆï¼š</span><br><span class="line">- 1äº¿ç”¨æˆ·UV â†’ åªéœ€ 12KB å†…å­˜</span><br><span class="line">- 10äº¿ç”¨æˆ·UV â†’ è¿˜æ˜¯ 12KB å†…å­˜</span><br><span class="line">- 100äº¿ç”¨æˆ·UV â†’ ä¾ç„¶ 12KB å†…å­˜ï¼ˆå›ºå®šä¸å˜ï¼‰</span><br></pre></td></tr></table></figure><p><strong>æƒè¡¡å–èˆ</strong>ï¼š</p><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>Set</th><th>HyperLogLog</th></tr></thead><tbody><tr><td>å†…å­˜å ç”¨</td><td>å¤§ï¼ˆéšæ•°æ®é‡å¢é•¿ï¼‰</td><td>å°ï¼ˆå›ºå®š12KBï¼‰</td></tr><tr><td>ç»Ÿè®¡ç»“æœ</td><td>100%ç²¾ç¡®</td><td>çº¦99.19%ç²¾ç¡®ï¼ˆ0.81%è¯¯å·®ï¼‰</td></tr><tr><td>è¿”å›å…ƒç´ </td><td>âœ… å¯ä»¥ï¼ˆSMEMBERSï¼‰</td><td>âŒ ä¸èƒ½</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>å°æ•°æ®é›†</td><td>å¤§æ•°æ®é›†</td></tr></tbody></table><blockquote><p><strong>âš ï¸ é‡è¦é™åˆ¶</strong>ï¼š</p><ul><li>HyperLogLog <strong>åªæ ¹æ®è¾“å…¥å…ƒç´ è®¡ç®—åŸºæ•°</strong></li><li><strong>ä¸ä¼šå­˜å‚¨è¾“å…¥å…ƒç´ æœ¬èº«</strong></li><li>ä¸èƒ½åƒSeté‚£æ ·è¿”å›å…·ä½“å…ƒç´ </li><li>åªèƒ½å›ç­”â€æœ‰å¤šå°‘ä¸ªä¸åŒçš„å…ƒç´ â€ï¼Œä¸èƒ½å›ç­”â€éƒ½æ˜¯å“ªäº›å…ƒç´ â€</li></ul></blockquote><h4 id="HyperLogLogå¸¸ç”¨å‘½ä»¤"><a href="#HyperLogLogå¸¸ç”¨å‘½ä»¤" class="headerlink" title="HyperLogLogå¸¸ç”¨å‘½ä»¤"></a>HyperLogLogå¸¸ç”¨å‘½ä»¤</h4><h5 id="1-PFADD-æ·»åŠ å…ƒç´ "><a href="#1-PFADD-æ·»åŠ å…ƒç´ " class="headerlink" title="1. PFADD - æ·»åŠ å…ƒç´ "></a>1. PFADD - æ·»åŠ å…ƒç´ </h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PFADD key element [element ...]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç±»å‹</th></tr></thead><tbody><tr><td><code>key</code></td><td>HyperLogLogé”®å</td><td>å­—ç¬¦ä¸²</td></tr><tr><td><code>element</code></td><td>è¦æ·»åŠ çš„å…ƒç´ </td><td>å­—ç¬¦ä¸²ï¼ˆå¯å¤šä¸ªï¼‰</td></tr></tbody></table><p><strong>è¿”å›å€¼</strong>ï¼š</p><ul><li><code>1</code>ï¼šæ·»åŠ ååŸºæ•°ä¼°è®¡å€¼å‘ç”Ÿäº†å˜åŒ–</li><li><code>0</code>ï¼šæ·»åŠ ååŸºæ•°ä¼°è®¡å€¼æ²¡æœ‰å˜åŒ–ï¼ˆå¯èƒ½æ˜¯é‡å¤å…ƒç´ ï¼‰</li></ul><p><strong>åŠŸèƒ½è¯´æ˜</strong>ï¼šå°†æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šçš„HyperLogLogæ•°æ®ç»“æ„ä¸­ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»Ÿè®¡2024-11-14çš„ç½‘ç«™UV</span></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241114 <span class="string">&quot;user1&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1    <span class="comment"># åŸºæ•°å˜åŒ–ï¼Œè¿”å›1</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241114 <span class="string">&quot;user2&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1    <span class="comment"># åŸºæ•°å˜åŒ–ï¼Œè¿”å›1</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241114 <span class="string">&quot;user1&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 0    <span class="comment"># é‡å¤å…ƒç´ ï¼ŒåŸºæ•°æœªå˜åŒ–ï¼Œè¿”å›0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡æ·»åŠ </span></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241114 <span class="string">&quot;user3&quot;</span> <span class="string">&quot;user4&quot;</span> <span class="string">&quot;user5&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1    <span class="comment"># åŸºæ•°å˜åŒ–ï¼Œè¿”å›1</span></span><br></pre></td></tr></table></figure><h5 id="2-PFCOUNT-è®¡ç®—åŸºæ•°"><a href="#2-PFCOUNT-è®¡ç®—åŸºæ•°" class="headerlink" title="2. PFCOUNT - è®¡ç®—åŸºæ•°"></a>2. PFCOUNT - è®¡ç®—åŸºæ•°</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PFCOUNT key [key ...]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç±»å‹</th></tr></thead><tbody><tr><td><code>key</code></td><td>HyperLogLogé”®å</td><td>å­—ç¬¦ä¸²ï¼ˆå¯å¤šä¸ªï¼‰</td></tr></tbody></table><p><strong>è¿”å›å€¼</strong>ï¼šåŸºæ•°çš„ä¼°è®¡å€¼ï¼ˆæ•´æ•°ï¼‰</p><p><strong>åŠŸèƒ½è¯´æ˜</strong>ï¼š</p><ul><li>å•ä¸ªkeyï¼šè¿”å›è¯¥HLLçš„åŸºæ•°ä¼°è®¡å€¼</li><li>å¤šä¸ªkeyï¼šè¿”å›å¤šä¸ªHLLçš„<strong>å¹¶é›†</strong>åŸºæ•°ä¼°è®¡å€¼</li></ul><p><strong>ç¤ºä¾‹1ï¼šå•ä¸ªHLLç»Ÿè®¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢2024-11-14çš„UV</span></span><br><span class="line">127.0.0.1:6379&gt; PFCOUNT uv:20241114</span><br><span class="line">(<span class="built_in">integer</span>) 5    <span class="comment"># æœ‰5ä¸ªä¸åŒçš„è®¿å®¢</span></span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹2ï¼šå¤šä¸ªHLLåˆå¹¶ç»Ÿè®¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»Ÿè®¡ä¸€å‘¨çš„UVï¼ˆå–å¹¶é›†ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241111 <span class="string">&quot;user1&quot;</span> <span class="string">&quot;user2&quot;</span> <span class="string">&quot;user3&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241112 <span class="string">&quot;user2&quot;</span> <span class="string">&quot;user3&quot;</span> <span class="string">&quot;user4&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241113 <span class="string">&quot;user3&quot;</span> <span class="string">&quot;user4&quot;</span> <span class="string">&quot;user5&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—ä¸‰å¤©çš„æ€»UVï¼ˆè‡ªåŠ¨å»é‡ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; PFCOUNT uv:20241111 uv:20241112 uv:20241113</span><br><span class="line">(<span class="built_in">integer</span>) 5    <span class="comment"># user1, user2, user3, user4, user5</span></span><br></pre></td></tr></table></figure><h5 id="3-PFMERGE-åˆå¹¶HLL"><a href="#3-PFMERGE-åˆå¹¶HLL" class="headerlink" title="3. PFMERGE - åˆå¹¶HLL"></a>3. PFMERGE - åˆå¹¶HLL</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PFMERGE destkey sourcekey [sourcekey ...]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç±»å‹</th></tr></thead><tbody><tr><td><code>destkey</code></td><td>ç›®æ ‡HLLé”®åï¼ˆåˆå¹¶ç»“æœï¼‰</td><td>å­—ç¬¦ä¸²</td></tr><tr><td><code>sourcekey</code></td><td>æºHLLé”®å</td><td>å­—ç¬¦ä¸²ï¼ˆå¯å¤šä¸ªï¼‰</td></tr></tbody></table><p><strong>è¿”å›å€¼</strong>ï¼š<code>OK</code></p><p><strong>åŠŸèƒ½è¯´æ˜</strong>ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªHLLåˆå¹¶åçš„ç»“æœå­˜å‚¨åœ¨å¦ä¸€ä¸ªHLLä¸­ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>æ¯å¤©çš„UVåˆå¹¶è®¡ç®—ä¸€å‘¨çš„UV</li><li>æ¯å¤©çš„æ´»è·ƒç”¨æˆ·åˆå¹¶è®¡ç®—æœˆæ´»ï¼ˆMAUï¼‰</li><li>æ¯å°æ—¶çš„ç‹¬ç«‹IPåˆå¹¶è®¡ç®—æ—¥ç‹¬ç«‹IP</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯å¤©è®°å½•UV</span></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241107 <span class="string">&quot;user1&quot;</span> <span class="string">&quot;user2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241108 <span class="string">&quot;user2&quot;</span> <span class="string">&quot;user3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241109 <span class="string">&quot;user3&quot;</span> <span class="string">&quot;user4&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241110 <span class="string">&quot;user4&quot;</span> <span class="string">&quot;user5&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241111 <span class="string">&quot;user5&quot;</span> <span class="string">&quot;user6&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241112 <span class="string">&quot;user6&quot;</span> <span class="string">&quot;user7&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; PFADD uv:20241113 <span class="string">&quot;user7&quot;</span> <span class="string">&quot;user8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå¹¶è®¡ç®—ä¸€å‘¨çš„UV</span></span><br><span class="line">127.0.0.1:6379&gt; PFMERGE uv:week45 uv:20241107 uv:20241108 uv:20241109 uv:20241110 uv:20241111 uv:20241112 uv:20241113</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ä¸€å‘¨çš„æ€»UV</span></span><br><span class="line">127.0.0.1:6379&gt; PFCOUNT uv:week45</span><br><span class="line">(<span class="built_in">integer</span>) 8    <span class="comment"># 8ä¸ªä¸åŒçš„ç”¨æˆ·è®¿é—®è¿‡</span></span><br></pre></td></tr></table></figure><h4 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><h5 id="1-ç½‘ç«™UVç»Ÿè®¡"><a href="#1-ç½‘ç«™UVç»Ÿè®¡" class="headerlink" title="1. ç½‘ç«™UVç»Ÿè®¡"></a>1. ç½‘ç«™UVç»Ÿè®¡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯æ¬¡ç”¨æˆ·è®¿é—®é¡µé¢æ—¶</span></span><br><span class="line">PFADD uv:20241114 <span class="string">&quot;user_id_123&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®æ—¶æŸ¥è¯¢ä»Šæ—¥UV</span></span><br><span class="line">PFCOUNT uv:20241114</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢æœ¬å‘¨UV</span></span><br><span class="line">PFCOUNT uv:20241108 uv:20241109 uv:20241110 uv:20241111 uv:20241112 uv:20241113 uv:20241114</span><br></pre></td></tr></table></figure><h5 id="2-ç‹¬ç«‹IPç»Ÿè®¡"><a href="#2-ç‹¬ç«‹IPç»Ÿè®¡" class="headerlink" title="2. ç‹¬ç«‹IPç»Ÿè®¡"></a>2. ç‹¬ç«‹IPç»Ÿè®¡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®°å½•è®¿é—®IP</span></span><br><span class="line">PFADD ip:20241114 <span class="string">&quot;192.168.1.1&quot;</span></span><br><span class="line">PFADD ip:20241114 <span class="string">&quot;192.168.1.2&quot;</span></span><br><span class="line">PFADD ip:20241114 <span class="string">&quot;192.168.1.1&quot;</span>  <span class="comment"># é‡å¤IPè‡ªåŠ¨å»é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ç‹¬ç«‹IPæ•°</span></span><br><span class="line">PFCOUNT ip:20241114</span><br></pre></td></tr></table></figure><h5 id="3-æœç´¢å…³é”®è¯ç»Ÿè®¡"><a href="#3-æœç´¢å…³é”®è¯ç»Ÿè®¡" class="headerlink" title="3. æœç´¢å…³é”®è¯ç»Ÿè®¡"></a>3. æœç´¢å…³é”®è¯ç»Ÿè®¡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®°å½•æœç´¢å…³é”®è¯</span></span><br><span class="line">PFADD search:20241114 <span class="string">&quot;Redisæ•™ç¨‹&quot;</span></span><br><span class="line">PFADD search:20241114 <span class="string">&quot;Javaé¢è¯•&quot;</span></span><br><span class="line">PFADD search:20241114 <span class="string">&quot;Redisæ•™ç¨‹&quot;</span>  <span class="comment"># é‡å¤å…³é”®è¯è‡ªåŠ¨å»é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ä¸åŒæœç´¢å…³é”®è¯æ•°é‡</span></span><br><span class="line">PFCOUNT search:20241114</span><br></pre></td></tr></table></figure><h5 id="4-APPæ—¥æ´»-æœˆæ´»ç»Ÿè®¡"><a href="#4-APPæ—¥æ´»-æœˆæ´»ç»Ÿè®¡" class="headerlink" title="4. APPæ—¥æ´»&#x2F;æœˆæ´»ç»Ÿè®¡"></a>4. APPæ—¥æ´»&#x2F;æœˆæ´»ç»Ÿè®¡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯æ—¥æ´»è·ƒç”¨æˆ·</span></span><br><span class="line">PFADD dau:20241114 <span class="string">&quot;user_1001&quot;</span> <span class="string">&quot;user_1002&quot;</span> <span class="string">&quot;user_1003&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æ—¥æ´»ï¼ˆDAUï¼‰</span></span><br><span class="line">PFCOUNT dau:20241114</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå¹¶è®¡ç®—æœˆæ´»ï¼ˆMAUï¼‰</span></span><br><span class="line">PFMERGE mau:202411 dau:20241101 dau:20241102 ... dau:20241130</span><br><span class="line">PFCOUNT mau:202411</span><br></pre></td></tr></table></figure><h4 id="HyperLogLog-vs-å…¶ä»–æ–¹æ¡ˆ"><a href="#HyperLogLog-vs-å…¶ä»–æ–¹æ¡ˆ" class="headerlink" title="HyperLogLog vs å…¶ä»–æ–¹æ¡ˆ"></a>HyperLogLog vs å…¶ä»–æ–¹æ¡ˆ</h4><h5 id="å†…å­˜å ç”¨å¯¹æ¯”ï¼ˆ1äº¿ç”¨æˆ·UVç»Ÿè®¡ï¼‰"><a href="#å†…å­˜å ç”¨å¯¹æ¯”ï¼ˆ1äº¿ç”¨æˆ·UVç»Ÿè®¡ï¼‰" class="headerlink" title="å†…å­˜å ç”¨å¯¹æ¯”ï¼ˆ1äº¿ç”¨æˆ·UVç»Ÿè®¡ï¼‰"></a>å†…å­˜å ç”¨å¯¹æ¯”ï¼ˆ1äº¿ç”¨æˆ·UVç»Ÿè®¡ï¼‰</h5><table><thead><tr><th>æ–¹æ¡ˆ</th><th>å†…å­˜å ç”¨</th><th>ç²¾ç¡®åº¦</th><th>æŸ¥è¯¢é€Ÿåº¦</th></tr></thead><tbody><tr><td><strong>MySQL</strong></td><td>çº¦4GBï¼ˆ40äº¿å­—èŠ‚ï¼‰</td><td>100%</td><td>æ…¢ï¼ˆç§’çº§ï¼‰</td></tr><tr><td><strong>Redis Set</strong></td><td>çº¦800MB</td><td>100%</td><td>å¿«ï¼ˆæ¯«ç§’çº§ï¼‰</td></tr><tr><td><strong>Redis Bitmap</strong></td><td>çº¦12MB</td><td>100%</td><td>å¿«ï¼ˆæ¯«ç§’çº§ï¼‰</td></tr><tr><td><strong>Redis HyperLogLog</strong></td><td><strong>12KB</strong></td><td>99.19%</td><td>å¿«ï¼ˆæ¯«ç§’çº§ï¼‰</td></tr></tbody></table><p><strong>å†…å­˜èŠ‚çœæ¯”ä¾‹</strong>ï¼š</p><ul><li>vs Setï¼š800MB &#x2F; 12KB &#x3D; <strong>66,666å€</strong></li><li>vs Bitmapï¼š12MB &#x2F; 12KB &#x3D; <strong>1,000å€</strong></li></ul><h5 id="é€‚ç”¨åœºæ™¯å¯¹æ¯”"><a href="#é€‚ç”¨åœºæ™¯å¯¹æ¯”" class="headerlink" title="é€‚ç”¨åœºæ™¯å¯¹æ¯”"></a>é€‚ç”¨åœºæ™¯å¯¹æ¯”</h5><table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>ç†ç”±</th></tr></thead><tbody><tr><td>æ•°æ®é‡å°ï¼ˆ&lt; 1ä¸‡ï¼‰</td><td>Set</td><td>å†…å­˜å ç”¨å¯æ¥å—ï¼Œç²¾ç¡®ç»Ÿè®¡</td></tr><tr><td>éœ€è¦è¿”å›å…·ä½“å…ƒç´ </td><td>Set</td><td>HyperLogLogä¸å­˜å‚¨å…ƒç´ </td></tr><tr><td>éœ€è¦100%ç²¾ç¡®</td><td>Set &#x2F; Bitmap</td><td>HyperLogLogæœ‰0.81%è¯¯å·®</td></tr><tr><td>æ•°æ®é‡å¤§ï¼ˆ&gt; ç™¾ä¸‡ï¼‰</td><td><strong>HyperLogLog</strong></td><td>å†…å­˜å ç”¨å›ºå®šï¼Œæ€§èƒ½ä¼˜å¼‚</td></tr><tr><td>å¯æ¥å—å°è¯¯å·®</td><td><strong>HyperLogLog</strong></td><td>æ€§ä»·æ¯”æœ€é«˜</td></tr><tr><td>UV&#x2F;DAU&#x2F;MAUç»Ÿè®¡</td><td><strong>HyperLogLog</strong></td><td>ä¸“ä¸ºæ­¤åœºæ™¯è®¾è®¡</td></tr></tbody></table><h4 id="ä½¿ç”¨å»ºè®®-2"><a href="#ä½¿ç”¨å»ºè®®-2" class="headerlink" title="ä½¿ç”¨å»ºè®®"></a>ä½¿ç”¨å»ºè®®</h4><p><strong>âœ… HyperLogLogé€‚ç”¨åœºæ™¯</strong>ï¼š</p><ol><li><p><strong>å¤§æ•°æ®é‡å»é‡ç»Ÿè®¡</strong>ï¼ˆç™¾ä¸‡çº§ä»¥ä¸Šï¼‰</p><ul><li>ç½‘ç«™UVç»Ÿè®¡</li><li>APPæ—¥æ´»&#x2F;æœˆæ´»ï¼ˆDAU&#x2F;MAUï¼‰</li><li>ç‹¬ç«‹IPè®¿é—®ç»Ÿè®¡</li></ul></li><li><p><strong>å¯æ¥å—å°è¯¯å·®</strong>ï¼ˆ0.81%è¯¯å·®ï¼‰</p><ul><li>99.19%çš„ç²¾ç¡®åº¦å·²è¶³å¤Ÿ</li><li>å¦‚ï¼š1äº¿UVï¼Œè¯¯å·®çº¦81ä¸‡</li></ul></li><li><p><strong>ä¸éœ€è¦è·å–å…·ä½“å…ƒç´ </strong></p><ul><li>åªéœ€è¦â€æœ‰å¤šå°‘ä¸ªâ€</li><li>ä¸éœ€è¦â€éƒ½æ˜¯å“ªäº›â€</li></ul></li><li><p><strong>å†…å­˜èµ„æºå—é™</strong></p><ul><li>å›ºå®š12KBå†…å­˜</li><li>ä¸å—æ•°æ®é‡å½±å“</li></ul></li></ol><p><strong>âŒ HyperLogLogä¸é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ol><li><p><strong>éœ€è¦100%ç²¾ç¡®</strong></p><ul><li>é‡‘èè®¡ç®—ã€äº¤æ˜“ç»Ÿè®¡</li><li>å»ºè®®ä½¿ç”¨Set</li></ul></li><li><p><strong>éœ€è¦è¿”å›å…·ä½“å…ƒç´ </strong></p><ul><li>è·å–æ‰€æœ‰è®¿é—®ç”¨æˆ·åˆ—è¡¨</li><li>å»ºè®®ä½¿ç”¨Set</li></ul></li><li><p><strong>æ•°æ®é‡å¾ˆå°</strong>ï¼ˆ&lt; 1ä¸‡ï¼‰</p><ul><li>Setçš„å†…å­˜å ç”¨å¯æ¥å—</li><li>ä¸éœ€è¦ç‰ºç‰²ç²¾ç¡®åº¦</li></ul></li><li><p><strong>éœ€è¦åˆ é™¤æŒ‡å®šå…ƒç´ </strong></p><ul><li>HyperLogLogä¸æ”¯æŒåˆ é™¤</li><li>å»ºè®®ä½¿ç”¨Set</li></ul></li></ol><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><blockquote><p><strong>âš ï¸ è¯¯å·®è¯´æ˜</strong>ï¼š</p><ul><li>æ ‡å‡†è¯¯å·®ç‡ï¼š<strong>0.81%</strong></li><li>å‡†ç¡®ç‡ï¼š<strong>99.19%</strong></li><li>ç¤ºä¾‹ï¼šçœŸå®UV &#x3D; 1,000,000ï¼ŒHLLç»Ÿè®¡ &#x3D; 1,000,000 Â± 8,100</li></ul></blockquote><blockquote><p><strong>âš ï¸ å…ƒç´ ä¸å¯å–å‡º</strong>ï¼š</p><ul><li>HyperLogLogåªè®¡ç®—åŸºæ•°ï¼Œä¸å­˜å‚¨å…ƒç´ </li><li>æ— æ³•ä½¿ç”¨ç±»ä¼¼<code>SMEMBERS</code>çš„å‘½ä»¤è·å–æ‰€æœ‰å…ƒç´ </li><li>æ— æ³•åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</li></ul></blockquote><blockquote><p><strong>âš ï¸ å†…å­˜å›ºå®šä½†ä¸å¯å‹ç¼©</strong>ï¼š</p><ul><li>å³ä½¿åªæœ‰1ä¸ªå…ƒç´ ï¼Œä¹Ÿå ç”¨12KB</li><li>å°æ•°æ®é‡æ—¶ä¸å¦‚SetèŠ‚çœç©ºé—´</li></ul></blockquote><blockquote><p><strong>âš ï¸ æ— æ³•åˆ é™¤å•ä¸ªå…ƒç´ </strong>ï¼š</p><ul><li>åªèƒ½åˆ é™¤æ•´ä¸ªHLL</li><li>ä¸æ”¯æŒç±»ä¼¼<code>SREM</code>çš„æ“ä½œ</li></ul></blockquote><h4 id="å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰-2"><a href="#å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰-2" class="headerlink" title="å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰"></a>å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HyperLogLogExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;uv:20241114&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. æ¨¡æ‹Ÿç”¨æˆ·è®¿é—®ï¼ˆæ·»åŠ å…ƒç´ ï¼‰</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            jedis.pfadd(key, <span class="string">&quot;user_&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ ä¸€äº›é‡å¤ç”¨æˆ·</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            jedis.pfadd(key, <span class="string">&quot;user_&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. ç»Ÿè®¡UVï¼ˆåº”è¯¥æ¥è¿‘10000ï¼Œæœ‰å°è¯¯å·®ï¼‰</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">uv</span> <span class="operator">=</span> jedis.pfcount(key);</span><br><span class="line">        System.out.println(<span class="string">&quot;ä»Šæ—¥UV: &quot;</span> + uv);  <span class="comment">// çº¦10000ï¼ˆè¯¯å·®Â±81ï¼‰</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. å¤šå¤©UVç»Ÿè®¡</span></span><br><span class="line">        jedis.pfadd(<span class="string">&quot;uv:20241112&quot;</span>, <span class="string">&quot;user_1&quot;</span>, <span class="string">&quot;user_2&quot;</span>, <span class="string">&quot;user_3&quot;</span>);</span><br><span class="line">        jedis.pfadd(<span class="string">&quot;uv:20241113&quot;</span>, <span class="string">&quot;user_2&quot;</span>, <span class="string">&quot;user_3&quot;</span>, <span class="string">&quot;user_4&quot;</span>);</span><br><span class="line">        jedis.pfadd(<span class="string">&quot;uv:20241114&quot;</span>, <span class="string">&quot;user_3&quot;</span>, <span class="string">&quot;user_4&quot;</span>, <span class="string">&quot;user_5&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®—ä¸‰å¤©çš„æ€»UVï¼ˆè‡ªåŠ¨å»é‡ï¼‰</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">totalUv</span> <span class="operator">=</span> jedis.pfcount(<span class="string">&quot;uv:20241112&quot;</span>, <span class="string">&quot;uv:20241113&quot;</span>, <span class="string">&quot;uv:20241114&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸‰å¤©æ€»UV: &quot;</span> + totalUv);  <span class="comment">// 5</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. åˆå¹¶è®¡ç®—å‘¨UV</span></span><br><span class="line">        jedis.pfmerge(<span class="string">&quot;uv:week46&quot;</span>, <span class="string">&quot;uv:20241112&quot;</span>, <span class="string">&quot;uv:20241113&quot;</span>, <span class="string">&quot;uv:20241114&quot;</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">weekUv</span> <span class="operator">=</span> jedis.pfcount(<span class="string">&quot;uv:week46&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ¬å‘¨UV: &quot;</span> + weekUv);  <span class="comment">// 5</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. è®¡ç®—æœˆæ´»ï¼ˆMAUï¼‰</span></span><br><span class="line">        <span class="comment">// å‡è®¾æ¯å¤©éƒ½æœ‰è®°å½•</span></span><br><span class="line">        String[] dailyKeys = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">30</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">day</span> <span class="operator">=</span> <span class="number">1</span>; day &lt;= <span class="number">30</span>; day++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">dailyKey</span> <span class="operator">=</span> String.format(<span class="string">&quot;dau:202411%02d&quot;</span>, day);</span><br><span class="line">            dailyKeys[day - <span class="number">1</span>] = dailyKey;</span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿæ¯å¤©100ä¸ªæ´»è·ƒç”¨æˆ·</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">uid</span> <span class="operator">=</span> <span class="number">1</span>; uid &lt;= <span class="number">100</span>; uid++) &#123;</span><br><span class="line">                jedis.pfadd(dailyKey, <span class="string">&quot;user_&quot;</span> + uid);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå¹¶è®¡ç®—MAU</span></span><br><span class="line">        jedis.pfmerge(<span class="string">&quot;mau:202411&quot;</span>, dailyKeys);</span><br><span class="line">        <span class="type">long</span> <span class="variable">mau</span> <span class="operator">=</span> jedis.pfcount(<span class="string">&quot;mau:202411&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;11æœˆMAU: &quot;</span> + mau);  <span class="comment">// çº¦100</span></span><br><span class="line">        </span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®æˆ˜æ¡ˆä¾‹ï¼šå¤§å‹ç½‘ç«™UVç»Ÿè®¡ç³»ç»Ÿ"><a href="#å®æˆ˜æ¡ˆä¾‹ï¼šå¤§å‹ç½‘ç«™UVç»Ÿè®¡ç³»ç»Ÿ" class="headerlink" title="å®æˆ˜æ¡ˆä¾‹ï¼šå¤§å‹ç½‘ç«™UVç»Ÿè®¡ç³»ç»Ÿ"></a>å®æˆ˜æ¡ˆä¾‹ï¼šå¤§å‹ç½‘ç«™UVç»Ÿè®¡ç³»ç»Ÿ</h4><p><strong>éœ€æ±‚</strong>ï¼šç»Ÿè®¡æ—¥UVã€å‘¨UVã€æœˆUVï¼Œæ•°æ®é‡ï¼šæ—¥å‡5000ä¸‡UV</p><p><strong>æ–¹æ¡ˆå¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th>æ–¹æ¡ˆ</th><th>å†…å­˜å ç”¨</th><th>æˆæœ¬ï¼ˆæ¯æœˆï¼‰</th><th>ç²¾ç¡®åº¦</th></tr></thead><tbody><tr><td>Redis Set</td><td>400MB Ã— 30å¤© &#x3D; 12GB</td><td>é«˜</td><td>100%</td></tr><tr><td>HyperLogLog</td><td>12KB Ã— 30å¤© &#x3D; 360KB</td><td>æä½</td><td>99.19%</td></tr></tbody></table><p><strong>å®ç°æ¶æ„</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·è®¿é—®</span><br><span class="line">    â†“</span><br><span class="line">WebæœåŠ¡å™¨</span><br><span class="line">    â†“</span><br><span class="line">PFADD uv:20241114 user_id_123</span><br><span class="line">    â†“</span><br><span class="line">Redis HyperLogLog</span><br><span class="line">    â†“</span><br><span class="line">å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å°æ—¶/æ¯å¤©ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">PFMERGEè®¡ç®—å‘¨UVã€æœˆUV</span><br><span class="line">    â†“</span><br><span class="line">æ•°æ®å¯è§†åŒ–å¤§å±</span><br></pre></td></tr></table></figure><p><strong>ä»£ç å®ç°</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UVç»Ÿè®¡æœåŠ¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UVStatService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½•ç”¨æˆ·è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordVisit</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">today</span> <span class="operator">=</span> LocalDate.now().format(DateTimeFormatter.BASIC_ISO_DATE);</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;uv:&quot;</span> + today;</span><br><span class="line">        jedis.pfadd(key, userId);</span><br><span class="line">        <span class="comment">// è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆä¿ç•™90å¤©ï¼‰</span></span><br><span class="line">        jedis.expire(key, <span class="number">90</span> * <span class="number">24</span> * <span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–ä»Šæ—¥UV</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getTodayUV</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">today</span> <span class="operator">=</span> LocalDate.now().format(DateTimeFormatter.BASIC_ISO_DATE);</span><br><span class="line">        <span class="keyword">return</span> jedis.pfcount(<span class="string">&quot;uv:&quot;</span> + today);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æœ¬å‘¨UV</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getWeekUV</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; keys = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> LocalDate.now().minusDays(i)</span><br><span class="line">                .format(DateTimeFormatter.BASIC_ISO_DATE);</span><br><span class="line">            keys.add(<span class="string">&quot;uv:&quot;</span> + date);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jedis.pfcount(keys.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æœ¬æœˆUV</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getMonthUV</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">monthKey</span> <span class="operator">=</span> <span class="string">&quot;uv:month:&quot;</span> + LocalDate.now().format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyMM&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ˜¯å¦å·²è®¡ç®—</span></span><br><span class="line">        <span class="keyword">if</span> (!jedis.exists(monthKey)) &#123;</span><br><span class="line">            <span class="comment">// åˆå¹¶æœ¬æœˆæ‰€æœ‰å¤©çš„æ•°æ®</span></span><br><span class="line">            List&lt;String&gt; keys = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="type">LocalDate</span> <span class="variable">firstDay</span> <span class="operator">=</span> LocalDate.now().withDayOfMonth(<span class="number">1</span>);</span><br><span class="line">            <span class="type">LocalDate</span> <span class="variable">today</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> firstDay; !date.isAfter(today); date = date.plusDays(<span class="number">1</span>)) &#123;</span><br><span class="line">                keys.add(<span class="string">&quot;uv:&quot;</span> + date.format(DateTimeFormatter.BASIC_ISO_DATE));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!keys.isEmpty()) &#123;</span><br><span class="line">                jedis.pfmerge(monthKey, keys.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]));</span><br><span class="line">                jedis.expire(monthKey, <span class="number">90</span> * <span class="number">24</span> * <span class="number">3600</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> jedis.pfcount(monthKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ€§èƒ½æµ‹è¯•ç»“æœ</strong>ï¼š</p><table><thead><tr><th>æŒ‡æ ‡</th><th>æ•°å€¼</th></tr></thead><tbody><tr><td>æ—¥å‡è®¿é—®é‡</td><td>5000ä¸‡</td></tr><tr><td>æ¯æ—¥å†…å­˜å ç”¨</td><td>12KB</td></tr><tr><td>æ¯æœˆå†…å­˜å ç”¨</td><td>360KB</td></tr><tr><td>æŸ¥è¯¢å“åº”æ—¶é—´</td><td>&lt; 1ms</td></tr><tr><td>ç»Ÿè®¡è¯¯å·®</td><td>&lt; 0.81%</td></tr><tr><td>æˆæœ¬èŠ‚çœ</td><td>99.99%</td></tr></tbody></table><h3 id="6-3-GEOï¼ˆåœ°ç†ä½ç½®ï¼‰"><a href="#6-3-GEOï¼ˆåœ°ç†ä½ç½®ï¼‰" class="headerlink" title="6.3 GEOï¼ˆåœ°ç†ä½ç½®ï¼‰"></a>6.3 GEOï¼ˆåœ°ç†ä½ç½®ï¼‰</h3><h4 id="ä»€ä¹ˆæ˜¯GEO"><a href="#ä»€ä¹ˆæ˜¯GEO" class="headerlink" title="ä»€ä¹ˆæ˜¯GEO"></a>ä»€ä¹ˆæ˜¯GEO</h4><p><strong>GEOï¼ˆGeographicï¼‰</strong> æ˜¯Redis 3.2ç‰ˆæœ¬æ–°å¢çš„åœ°ç†ä½ç½®æ•°æ®ç±»å‹ï¼Œç”¨äºå­˜å‚¨å’ŒæŸ¥è¯¢åœ°ç†ç©ºé—´ä¿¡æ¯ã€‚</p><p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p><ul><li>GEO &#x3D; <strong>Geographic</strong>ï¼ˆåœ°ç†ä¿¡æ¯ï¼‰çš„ç¼©å†™</li><li>å­˜å‚¨å…ƒç´ çš„<strong>äºŒç»´åæ ‡</strong>ï¼ˆç»åº¦longitudeã€çº¬åº¦latitudeï¼‰</li><li>åœ¨åœ°å›¾ä¸Šè¡¨ç°ä¸º<strong>ç»çº¬åº¦åæ ‡</strong></li><li>åŸºäº<strong>æœ‰åºé›†åˆï¼ˆZSetï¼‰</strong> å®ç°</li></ul><p><strong>åŠŸèƒ½ç‰¹æ€§</strong>ï¼š</p><ul><li>âœ… ç»çº¬åº¦è®¾ç½®</li><li>âœ… åæ ‡æŸ¥è¯¢</li><li>âœ… èŒƒå›´æŸ¥è¯¢ï¼ˆåŠå¾„å†…å…ƒç´ ï¼‰</li><li>âœ… è·ç¦»è®¡ç®—</li><li>âœ… ç»çº¬åº¦Hashï¼ˆGeoHashç¼–ç ï¼‰</li></ul><p><strong>åº•å±‚å®ç°</strong>ï¼š</p><ul><li>GEOæœ¬è´¨ä¸Šæ˜¯<strong>ZSetï¼ˆæœ‰åºé›†åˆï¼‰</strong></li><li>ä½¿ç”¨<strong>GeoHashç®—æ³•</strong>å°†ç»çº¬åº¦ç¼–ç ä¸º52ä½æ•´æ•°ä½œä¸ºscore</li><li>å¯ä»¥ä½¿ç”¨ZSetçš„å‘½ä»¤æ“ä½œGEOæ•°æ®ï¼ˆå¦‚ZREMåˆ é™¤ï¼‰</li></ul><h4 id="GEOåæ ‡ç³»ç»Ÿè¯´æ˜"><a href="#GEOåæ ‡ç³»ç»Ÿè¯´æ˜" class="headerlink" title="GEOåæ ‡ç³»ç»Ÿè¯´æ˜"></a>GEOåæ ‡ç³»ç»Ÿè¯´æ˜</h4><p><strong>åœ°çƒåæ ‡èŒƒå›´</strong>ï¼š</p><table><thead><tr><th>ç»´åº¦</th><th>æœ€å°å€¼</th><th>æœ€å¤§å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ç»åº¦</strong>ï¼ˆLongitudeï¼‰</td><td>-180Â°</td><td>+180Â°</td><td>ä¸œç»ä¸ºæ­£ï¼Œè¥¿ç»ä¸ºè´Ÿ</td></tr><tr><td><strong>çº¬åº¦</strong>ï¼ˆLatitudeï¼‰</td><td>-85.05112878Â°</td><td>+85.05112878Â°</td><td>åŒ—çº¬ä¸ºæ­£ï¼Œå—çº¬ä¸ºè´Ÿ</td></tr></tbody></table><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>âš ï¸ <strong>ä¸¤ææ— æ³•ç›´æ¥æ·»åŠ </strong>ï¼ˆçº¬åº¦Â±85.05112878Â°ä»¥å¤–ï¼‰</li><li>âš ï¸ åæ ‡è¶…å‡ºèŒƒå›´ä¼šè¿”å›é”™è¯¯</li><li>âš ï¸ å·²æ·»åŠ çš„æ•°æ®æ— æ³•å†æ¬¡æ·»åŠ ï¼ˆä¼šè¢«å¿½ç•¥ï¼‰</li></ul><p><strong>å¸¸è§åŸå¸‚åæ ‡å‚è€ƒ</strong>ï¼š</p><table><thead><tr><th>åŸå¸‚</th><th>ç»åº¦</th><th>çº¬åº¦</th></tr></thead><tbody><tr><td>åŒ—äº¬</td><td>116.38</td><td>39.90</td></tr><tr><td>ä¸Šæµ·</td><td>121.47</td><td>31.23</td></tr><tr><td>æ·±åœ³</td><td>114.05</td><td>22.52</td></tr><tr><td>é‡åº†</td><td>106.50</td><td>29.53</td></tr><tr><td>å¹¿å·</td><td>113.26</td><td>23.13</td></tr></tbody></table><h4 id="GEOå¸¸ç”¨å‘½ä»¤"><a href="#GEOå¸¸ç”¨å‘½ä»¤" class="headerlink" title="GEOå¸¸ç”¨å‘½ä»¤"></a>GEOå¸¸ç”¨å‘½ä»¤</h4><h5 id="1-GEOADD-æ·»åŠ åœ°ç†ä½ç½®"><a href="#1-GEOADD-æ·»åŠ åœ°ç†ä½ç½®" class="headerlink" title="1. GEOADD - æ·»åŠ åœ°ç†ä½ç½®"></a>1. GEOADD - æ·»åŠ åœ°ç†ä½ç½®</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOADD key longitude latitude member [longitude latitude member ...]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç±»å‹</th><th>å¿…éœ€</th></tr></thead><tbody><tr><td><code>key</code></td><td>GEOé›†åˆé”®å</td><td>å­—ç¬¦ä¸²</td><td>âœ…</td></tr><tr><td><code>longitude</code></td><td>ç»åº¦</td><td>æµ®ç‚¹æ•°</td><td>âœ…</td></tr><tr><td><code>latitude</code></td><td>çº¬åº¦</td><td>æµ®ç‚¹æ•°</td><td>âœ…</td></tr><tr><td><code>member</code></td><td>ä½ç½®åç§°</td><td>å­—ç¬¦ä¸²</td><td>âœ…</td></tr></tbody></table><p><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸæ·»åŠ çš„ä½ç½®æ•°é‡ï¼ˆæ•´æ•°ï¼‰</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ å•ä¸ªåŸå¸‚</span></span><br><span class="line">127.0.0.1:6379&gt; GEOADD china:city 121.47 31.23 shanghai</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡æ·»åŠ å¤šä¸ªåŸå¸‚</span></span><br><span class="line">127.0.0.1:6379&gt; GEOADD china:city 106.50 29.53 chongqing 114.05 22.52 shenzhen 116.38 39.90 beijing</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æ›´å¤šåŸå¸‚</span></span><br><span class="line">127.0.0.1:6379&gt; GEOADD china:city 113.26 23.13 guangzhou 120.16 30.29 hangzhou</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><p><strong>âš ï¸ é‡è¦æç¤º</strong>ï¼š</p><ol><li><p><strong>ä¸¤ææ— æ³•æ·»åŠ </strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°è¯•æ·»åŠ åŒ—æç‚¹ï¼ˆä¼šå¤±è´¥ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; GEOADD locations 0 90 north_pole</span><br><span class="line">(error) ERR invalid longitude,latitude pair 0.000000,90.000000</span><br></pre></td></tr></table></figure></li><li><p><strong>åæ ‡èŒƒå›´é™åˆ¶</strong>ï¼š</p><ul><li>ç»åº¦ï¼š-180Â° ~ +180Â°</li><li>çº¬åº¦ï¼š-85.05112878Â° ~ +85.05112878Â°</li></ul></li><li><p><strong>é‡å¤æ·»åŠ å¤„ç†</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–æ¬¡æ·»åŠ </span></span><br><span class="line">127.0.0.1:6379&gt; GEOADD china:city 121.47 31.23 shanghai</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡æ·»åŠ ç›¸åŒåŸå¸‚ï¼ˆè¿”å›0ï¼Œä¸ä¼šé‡å¤æ·»åŠ ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; GEOADD china:city 121.47 31.23 shanghai</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure></li><li><p><strong>æ‰¹é‡å¯¼å…¥å»ºè®®</strong>ï¼š</p><ul><li>å¯¹äºå¤§é‡åŸå¸‚æ•°æ®ï¼ˆå¦‚å…¨å›½æ•°æ®ï¼‰</li><li>å»ºè®®ä¸‹è½½åŸå¸‚æ•°æ®æ–‡ä»¶</li><li>é€šè¿‡Java&#x2F;Pythonç¨‹åºä¸€æ¬¡æ€§æ‰¹é‡å¯¼å…¥</li><li>é¿å…æ‰‹åŠ¨é€ä¸ªæ·»åŠ </li></ul></li></ol><h5 id="2-GEOPOS-è·å–åæ ‡"><a href="#2-GEOPOS-è·å–åæ ‡" class="headerlink" title="2. GEOPOS - è·å–åæ ‡"></a>2. GEOPOS - è·å–åæ ‡</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOPOS key member [member ...]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç±»å‹</th><th>å¿…éœ€</th></tr></thead><tbody><tr><td><code>key</code></td><td>GEOé›†åˆé”®å</td><td>å­—ç¬¦ä¸²</td><td>âœ…</td></tr><tr><td><code>member</code></td><td>ä½ç½®åç§°</td><td>å­—ç¬¦ä¸²</td><td>âœ…</td></tr></tbody></table><p><strong>è¿”å›å€¼</strong>ï¼šç»çº¬åº¦æ•°ç»„ï¼Œæ ¼å¼ä¸º <code>[[ç»åº¦, çº¬åº¦], [ç»åº¦, çº¬åº¦], ...]</code></p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å•ä¸ªåŸå¸‚åæ ‡</span></span><br><span class="line">127.0.0.1:6379&gt; GEOPOS china:city shanghai</span><br><span class="line">1) 1) <span class="string">&quot;121.47000163793563843&quot;</span></span><br><span class="line">   2) <span class="string">&quot;31.22999903975783553&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢å¤šä¸ªåŸå¸‚åæ ‡</span></span><br><span class="line">127.0.0.1:6379&gt; GEOPOS china:city beijing shanghai shenzhen</span><br><span class="line">1) 1) <span class="string">&quot;116.37999743223190308&quot;</span></span><br><span class="line">   2) <span class="string">&quot;39.90000009167092543&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;121.47000163793563843&quot;</span></span><br><span class="line">   2) <span class="string">&quot;31.22999903975783553&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;114.04999762773513794&quot;</span></span><br><span class="line">   2) <span class="string">&quot;22.51999957959539794&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ä¸å­˜åœ¨çš„åŸå¸‚ï¼ˆè¿”å›nilï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; GEOPOS china:city nanjing</span><br><span class="line">1) (nil)</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>è¿”å›çš„åæ ‡å¯èƒ½ä¸è¾“å…¥æ—¶æœ‰ç»†å¾®å·®å¼‚ï¼ˆç²¾åº¦æŸå¤±ï¼‰</li><li>ä¸å­˜åœ¨çš„memberè¿”å›<code>(nil)</code></li></ul><h5 id="3-GEODIST-è®¡ç®—è·ç¦»"><a href="#3-GEODIST-è®¡ç®—è·ç¦»" class="headerlink" title="3. GEODIST - è®¡ç®—è·ç¦»"></a>3. GEODIST - è®¡ç®—è·ç¦»</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEODIST key member1 member2 [unit]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>key</code></td><td>GEOé›†åˆé”®å</td><td>å­—ç¬¦ä¸²</td><td>-</td></tr><tr><td><code>member1</code></td><td>ç¬¬ä¸€ä¸ªä½ç½®</td><td>å­—ç¬¦ä¸²</td><td>-</td></tr><tr><td><code>member2</code></td><td>ç¬¬äºŒä¸ªä½ç½®</td><td>å­—ç¬¦ä¸²</td><td>-</td></tr><tr><td><code>unit</code></td><td>è·ç¦»å•ä½</td><td>m&#x2F;km&#x2F;mi&#x2F;ft</td><td>mï¼ˆç±³ï¼‰</td></tr></tbody></table><p><strong>è·ç¦»å•ä½</strong>ï¼š</p><table><thead><tr><th>å•ä½</th><th>è¯´æ˜</th><th>æ¢ç®—</th></tr></thead><tbody><tr><td><code>m</code></td><td>ç±³ï¼ˆmeterï¼‰</td><td>é»˜è®¤å•ä½</td></tr><tr><td><code>km</code></td><td>åƒç±³&#x2F;å…¬é‡Œï¼ˆkilometerï¼‰</td><td>1km &#x3D; 1000m</td></tr><tr><td><code>mi</code></td><td>è‹±é‡Œï¼ˆmileï¼‰</td><td>1mi â‰ˆ 1.609km</td></tr><tr><td><code>ft</code></td><td>è‹±å°ºï¼ˆfootï¼‰</td><td>1ft â‰ˆ 0.3048m</td></tr></tbody></table><p><strong>è¿”å›å€¼</strong>ï¼šä¸¤åœ°ä¹‹é—´çš„<strong>ç›´çº¿è·ç¦»</strong>ï¼ˆæµ®ç‚¹æ•°ï¼‰ï¼Œå¦‚æœä»»ä¸€ä½ç½®ä¸å­˜åœ¨åˆ™è¿”å›<code>(nil)</code></p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—åŒ—äº¬åˆ°ä¸Šæµ·çš„è·ç¦»ï¼ˆé»˜è®¤ç±³ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing shanghai</span><br><span class="line"><span class="string">&quot;1067597.9668&quot;</span>    <span class="comment"># çº¦1068å…¬é‡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—åŒ—äº¬åˆ°ä¸Šæµ·çš„è·ç¦»ï¼ˆåƒç±³ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing shanghai km</span><br><span class="line"><span class="string">&quot;1067.5980&quot;</span>       <span class="comment"># 1067.6å…¬é‡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æ·±åœ³åˆ°å¹¿å·çš„è·ç¦»ï¼ˆåƒç±³ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city shenzhen guangzhou km</span><br><span class="line"><span class="string">&quot;104.6034&quot;</span>        <span class="comment"># çº¦105å…¬é‡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—ä¸å­˜åœ¨çš„åŸå¸‚ï¼ˆè¿”å›nilï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing nanjing</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>è®¡ç®—çš„æ˜¯<strong>ç›´çº¿è·ç¦»</strong>ï¼ˆå¤§åœ†è·ç¦»ï¼‰ï¼Œä¸æ˜¯å®é™…é“è·¯è·ç¦»</li><li>ç»“æœç²¾åº¦è¾ƒé«˜ï¼Œé€‚åˆå¤§å¤šæ•°åº”ç”¨åœºæ™¯</li></ul><h5 id="4-GEORADIUS-åŠå¾„èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åæ ‡ï¼‰"><a href="#4-GEORADIUS-åŠå¾„èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åæ ‡ï¼‰" class="headerlink" title="4. GEORADIUS - åŠå¾„èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åæ ‡ï¼‰"></a>4. GEORADIUS - åŠå¾„èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åæ ‡ï¼‰</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEORADIUS key longitude latitude radius unit [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç±»å‹</th><th>å¿…éœ€</th></tr></thead><tbody><tr><td><code>key</code></td><td>GEOé›†åˆé”®å</td><td>å­—ç¬¦ä¸²</td><td>âœ…</td></tr><tr><td><code>longitude</code></td><td>ä¸­å¿ƒç‚¹ç»åº¦</td><td>æµ®ç‚¹æ•°</td><td>âœ…</td></tr><tr><td><code>latitude</code></td><td>ä¸­å¿ƒç‚¹çº¬åº¦</td><td>æµ®ç‚¹æ•°</td><td>âœ…</td></tr><tr><td><code>radius</code></td><td>åŠå¾„</td><td>æ•°å­—</td><td>âœ…</td></tr><tr><td><code>unit</code></td><td>è·ç¦»å•ä½</td><td>m&#x2F;km&#x2F;mi&#x2F;ft</td><td>âœ…</td></tr></tbody></table><p><strong>å¯é€‰å‚æ•°</strong>ï¼š</p><table><thead><tr><th>å¯é€‰å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>WITHCOORD</code></td><td>è¿”å›ä½ç½®çš„ç»çº¬åº¦</td></tr><tr><td><code>WITHDIST</code></td><td>è¿”å›ä½ç½®ä¸ä¸­å¿ƒç‚¹çš„è·ç¦»</td></tr><tr><td><code>WITHHASH</code></td><td>è¿”å›ä½ç½®çš„GeoHashå€¼</td></tr><tr><td><code>COUNT count</code></td><td>é™åˆ¶è¿”å›ç»“æœæ•°é‡</td></tr><tr><td><code>ASC</code></td><td>æŒ‰è·ç¦»ä»è¿‘åˆ°è¿œæ’åº</td></tr><tr><td><code>DESC</code></td><td>æŒ‰è·ç¦»ä»è¿œåˆ°è¿‘æ’åº</td></tr></tbody></table><p><strong>è¿”å›å€¼</strong>ï¼šç¬¦åˆæ¡ä»¶çš„ä½ç½®åˆ—è¡¨</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢ä»¥æŒ‡å®šç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œ1000å…¬é‡ŒèŒƒå›´å†…çš„åŸå¸‚</span></span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 30 1000 km</span><br><span class="line">1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">2) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">3) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢å¹¶è¿”å›è·ç¦»ï¼ˆæŒ‰è·ç¦»å‡åºï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 30 1000 km WITHDIST ASC</span><br><span class="line">1) 1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">   2) <span class="string">&quot;341.9374&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line">   2) <span class="string">&quot;810.0662&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">   2) <span class="string">&quot;914.4949&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢å¹¶è¿”å›åæ ‡å’Œè·ç¦»ï¼Œé™åˆ¶3ä¸ªç»“æœ</span></span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 30 1500 km WITHCOORD WITHDIST COUNT 3 ASC</span><br><span class="line">1) 1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">   2) <span class="string">&quot;341.9374&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;106.49999767541885376&quot;</span></span><br><span class="line">      2) <span class="string">&quot;29.52999957900659211&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line">   2) <span class="string">&quot;810.0662&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;113.25999975204467773&quot;</span></span><br><span class="line">      2) <span class="string">&quot;23.12999968251882199&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">   2) <span class="string">&quot;914.4949&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;114.04999762773513794&quot;</span></span><br><span class="line">      2) <span class="string">&quot;22.51999957959539794&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢å¹¶è¿”å›GeoHash</span></span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 30 1000 km WITHHASH</span><br><span class="line">1) 1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">   2) (<span class="built_in">integer</span>) 4026042091628149</span><br><span class="line">2) 1) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line">   2) (<span class="built_in">integer</span>) 4046433733682118</span><br><span class="line">3) 1) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">   2) (<span class="built_in">integer</span>) 4046432193082709</span><br></pre></td></tr></table></figure><h5 id="5-GEORADIUSBYMEMBER-åŠå¾„èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰æˆå‘˜ï¼‰"><a href="#5-GEORADIUSBYMEMBER-åŠå¾„èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰æˆå‘˜ï¼‰" class="headerlink" title="5. GEORADIUSBYMEMBER - åŠå¾„èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰æˆå‘˜ï¼‰"></a>5. GEORADIUSBYMEMBER - åŠå¾„èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰æˆå‘˜ï¼‰</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEORADIUSBYMEMBER key member radius unit [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç±»å‹</th><th>å¿…éœ€</th></tr></thead><tbody><tr><td><code>key</code></td><td>GEOé›†åˆé”®å</td><td>å­—ç¬¦ä¸²</td><td>âœ…</td></tr><tr><td><code>member</code></td><td>ä¸­å¿ƒä½ç½®åç§°</td><td>å­—ç¬¦ä¸²</td><td>âœ…</td></tr><tr><td><code>radius</code></td><td>åŠå¾„</td><td>æ•°å­—</td><td>âœ…</td></tr><tr><td><code>unit</code></td><td>è·ç¦»å•ä½</td><td>m&#x2F;km&#x2F;mi&#x2F;ft</td><td>âœ…</td></tr></tbody></table><p><strong>åŠŸèƒ½è¯´æ˜</strong>ï¼šä¸<code>GEORADIUS</code>ç±»ä¼¼ï¼Œä½†ä½¿ç”¨å·²å­˜åœ¨çš„æˆå‘˜ä½œä¸ºä¸­å¿ƒç‚¹ï¼Œè€Œä¸æ˜¯æŒ‡å®šç»çº¬åº¦ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢ä»¥åŒ—äº¬ä¸ºä¸­å¿ƒï¼Œ1500å…¬é‡ŒèŒƒå›´å†…çš„åŸå¸‚</span></span><br><span class="line">127.0.0.1:6379&gt; GEORADIUSBYMEMBER china:city beijing 1500 km</span><br><span class="line">1) <span class="string">&quot;beijing&quot;</span></span><br><span class="line">2) <span class="string">&quot;shanghai&quot;</span></span><br><span class="line">3) <span class="string">&quot;hangzhou&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ä»¥ä¸Šæµ·ä¸ºä¸­å¿ƒï¼Œ500å…¬é‡ŒèŒƒå›´å†…çš„åŸå¸‚ï¼Œè¿”å›è·ç¦»</span></span><br><span class="line">127.0.0.1:6379&gt; GEORADIUSBYMEMBER china:city shanghai 500 km WITHDIST ASC</span><br><span class="line">1) 1) <span class="string">&quot;shanghai&quot;</span></span><br><span class="line">   2) <span class="string">&quot;0.0000&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;hangzhou&quot;</span></span><br><span class="line">   2) <span class="string">&quot;166.6359&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ä»¥æ·±åœ³ä¸ºä¸­å¿ƒï¼Œ200å…¬é‡ŒèŒƒå›´å†…çš„åŸå¸‚ï¼Œè¿”å›åæ ‡å’Œè·ç¦»</span></span><br><span class="line">127.0.0.1:6379&gt; GEORADIUSBYMEMBER china:city shenzhen 200 km WITHCOORD WITHDIST</span><br><span class="line">1) 1) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">   2) <span class="string">&quot;0.0000&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;114.04999762773513794&quot;</span></span><br><span class="line">      2) <span class="string">&quot;22.51999957959539794&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line">   2) <span class="string">&quot;104.6034&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;113.25999975204467773&quot;</span></span><br><span class="line">      2) <span class="string">&quot;23.12999968251882199&quot;</span></span><br></pre></td></tr></table></figure><h5 id="6-GEOHASH-è·å–GeoHashå€¼"><a href="#6-GEOHASH-è·å–GeoHashå€¼" class="headerlink" title="6. GEOHASH - è·å–GeoHashå€¼"></a>6. GEOHASH - è·å–GeoHashå€¼</h5><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOHASH key member [member ...]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç±»å‹</th><th>å¿…éœ€</th></tr></thead><tbody><tr><td><code>key</code></td><td>GEOé›†åˆé”®å</td><td>å­—ç¬¦ä¸²</td><td>âœ…</td></tr><tr><td><code>member</code></td><td>ä½ç½®åç§°</td><td>å­—ç¬¦ä¸²</td><td>âœ…</td></tr></tbody></table><p><strong>è¿”å›å€¼</strong>ï¼šGeoHashå­—ç¬¦ä¸²ï¼ˆ11ä½Base32ç¼–ç ï¼‰</p><p><strong>GeoHashè¯´æ˜</strong>ï¼š</p><ul><li>GeoHashæ˜¯ä¸€ç§åœ°ç†ä½ç½®ç¼–ç ç®—æ³•</li><li>å°†äºŒç»´ç»çº¬åº¦è½¬æ¢ä¸ºä¸€ç»´å­—ç¬¦ä¸²</li><li>å­—ç¬¦ä¸²è¶Šé•¿ï¼Œç²¾åº¦è¶Šé«˜</li><li>å‰ç¼€ç›¸åŒçš„GeoHashè¡¨ç¤ºä½ç½®æ¥è¿‘</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–å•ä¸ªåŸå¸‚çš„GeoHash</span></span><br><span class="line">127.0.0.1:6379&gt; GEOHASH china:city beijing</span><br><span class="line">1) <span class="string">&quot;wx4g0b7xrt0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å¤šä¸ªåŸå¸‚çš„GeoHash</span></span><br><span class="line">127.0.0.1:6379&gt; GEOHASH china:city beijing shanghai shenzhen</span><br><span class="line">1) <span class="string">&quot;wx4g0b7xrt0&quot;</span></span><br><span class="line">2) <span class="string">&quot;wtw3sj5zbj0&quot;</span></span><br><span class="line">3) <span class="string">&quot;ws10578st80&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†æGeoHashï¼ˆå‰ç¼€ç›¸åŒè¡¨ç¤ºä½ç½®æ¥è¿‘ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; GEOHASH china:city shenzhen guangzhou</span><br><span class="line">1) <span class="string">&quot;ws10578st80&quot;</span></span><br><span class="line">2) <span class="string">&quot;ws0e9cb3v60&quot;</span></span><br><span class="line"><span class="comment"># æ·±åœ³å’Œå¹¿å·çš„GeoHashéƒ½ä»¥&quot;ws&quot;å¼€å¤´ï¼Œè¡¨ç¤ºä½ç½®è¾ƒè¿‘</span></span><br></pre></td></tr></table></figure><h4 id="åº”ç”¨åœºæ™¯-1"><a href="#åº”ç”¨åœºæ™¯-1" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><h5 id="1-é™„è¿‘çš„äºº-åº—é“º-è®¾æ–½"><a href="#1-é™„è¿‘çš„äºº-åº—é“º-è®¾æ–½" class="headerlink" title="1. é™„è¿‘çš„äºº&#x2F;åº—é“º&#x2F;è®¾æ–½"></a>1. é™„è¿‘çš„äºº&#x2F;åº—é“º&#x2F;è®¾æ–½</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœºæ™¯ï¼šæŸ¥æ‰¾æˆ‘é™„è¿‘1å…¬é‡Œå†…çš„é¤å…</span></span><br><span class="line"><span class="comment"># å‡è®¾æˆ‘çš„ä½ç½®ï¼šç»åº¦113.93ï¼Œçº¬åº¦22.54</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢é™„è¿‘çš„é¤å…</span></span><br><span class="line">GEORADIUS restaurants 113.93 22.54 1 km WITHDIST ASC</span><br></pre></td></tr></table></figure><h5 id="2-å¤–å–é…é€èŒƒå›´"><a href="#2-å¤–å–é…é€èŒƒå›´" class="headerlink" title="2. å¤–å–é…é€èŒƒå›´"></a>2. å¤–å–é…é€èŒƒå›´</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœºæ™¯ï¼šæŸ¥æ‰¾æŸé¤å…3å…¬é‡Œé…é€èŒƒå›´å†…çš„ç”¨æˆ·</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ é¤å…ä½ç½®</span></span><br><span class="line">GEOADD restaurants 113.93 22.54 <span class="string">&quot;éº¦å½“åŠ³Â·æ·±åœ³åº—&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢é…é€èŒƒå›´å†…çš„ç”¨æˆ·</span></span><br><span class="line">GEORADIUSBYMEMBER restaurants <span class="string">&quot;éº¦å½“åŠ³Â·æ·±åœ³åº—&quot;</span> 3 km</span><br></pre></td></tr></table></figure><h5 id="3-æ‰“è½¦è·ç¦»è®¡ç®—"><a href="#3-æ‰“è½¦è·ç¦»è®¡ç®—" class="headerlink" title="3. æ‰“è½¦è·ç¦»è®¡ç®—"></a>3. æ‰“è½¦è·ç¦»è®¡ç®—</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœºæ™¯ï¼šè®¡ç®—ä¹˜å®¢å’Œå¸æœºä¹‹é—´çš„è·ç¦»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ä½ç½®</span></span><br><span class="line">GEOADD taxi:locations 113.93 22.54 passenger123</span><br><span class="line">GEOADD taxi:locations 113.95 22.56 driver456</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—è·ç¦»</span></span><br><span class="line">GEODIST taxi:locations passenger123 driver456 km</span><br></pre></td></tr></table></figure><h5 id="4-å…±äº«å•è½¦åˆ†å¸ƒ"><a href="#4-å…±äº«å•è½¦åˆ†å¸ƒ" class="headerlink" title="4. å…±äº«å•è½¦åˆ†å¸ƒ"></a>4. å…±äº«å•è½¦åˆ†å¸ƒ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœºæ™¯ï¼šæŸ¥æ‰¾é™„è¿‘500ç±³å†…çš„å…±äº«å•è½¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å•è½¦ä½ç½®</span></span><br><span class="line">GEOADD bikes 113.93 22.54 bike001</span><br><span class="line">GEOADD bikes 113.94 22.55 bike002</span><br><span class="line">GEOADD bikes 113.92 22.53 bike003</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢é™„è¿‘çš„å•è½¦</span></span><br><span class="line">GEORADIUS bikes 113.93 22.54 0.5 km WITHDIST</span><br></pre></td></tr></table></figure><h5 id="5-ç‰©æµé…é€ä¼˜åŒ–"><a href="#5-ç‰©æµé…é€ä¼˜åŒ–" class="headerlink" title="5. ç‰©æµé…é€ä¼˜åŒ–"></a>5. ç‰©æµé…é€ä¼˜åŒ–</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœºæ™¯ï¼šæŸ¥æ‰¾è·ç¦»é…é€ä¸­å¿ƒæœ€è¿‘çš„10ä¸ªè®¢å•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è®¢å•ä½ç½®</span></span><br><span class="line">GEOADD orders 113.93 22.54 order001</span><br><span class="line">GEOADD orders 113.95 22.56 order002</span><br><span class="line"><span class="comment"># ... æ›´å¤šè®¢å•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢æœ€è¿‘çš„10ä¸ªè®¢å•</span></span><br><span class="line">GEORADIUSBYMEMBER orders warehouse001 50 km COUNT 10 ASC</span><br></pre></td></tr></table></figure><h4 id="GEOåº•å±‚åŸç†"><a href="#GEOåº•å±‚åŸç†" class="headerlink" title="GEOåº•å±‚åŸç†"></a>GEOåº•å±‚åŸç†</h4><p><strong>æ•°æ®ç»“æ„</strong>ï¼š</p><ul><li>GEOåº•å±‚ä½¿ç”¨<strong>ZSetï¼ˆæœ‰åºé›†åˆï¼‰</strong> å­˜å‚¨</li><li>ä½¿ç”¨<strong>GeoHashç®—æ³•</strong>å°†ç»çº¬åº¦ç¼–ç ä¸º52ä½æ•´æ•°</li><li>æ•´æ•°ä½œä¸ºZSetçš„scoreï¼Œä½ç½®åç§°ä½œä¸ºmember</li></ul><p><strong>GeoHashç¼–ç è¿‡ç¨‹</strong>ï¼š</p><ol><li><strong>äº¤å‰ç¼–ç </strong>ï¼šå°†ç»åº¦å’Œçº¬åº¦çš„äºŒè¿›åˆ¶äº¤å‰ç»„åˆ</li><li><strong>Base32ç¼–ç </strong>ï¼šå°†äºŒè¿›åˆ¶è½¬æ¢ä¸ºBase32å­—ç¬¦ä¸²</li><li><strong>ç²¾åº¦æ§åˆ¶</strong>ï¼šå­—ç¬¦ä¸²è¶Šé•¿ï¼Œç²¾åº¦è¶Šé«˜</li></ol><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åŒ—äº¬åæ ‡ï¼š(116.38, 39.90)</span><br><span class="line">â†“ GeoHashç¼–ç </span><br><span class="line">wx4g0b7xrt0</span><br></pre></td></tr></table></figure><p><strong>ç›¸äº’æ“ä½œ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GEOæ•°æ®å¯ä»¥ç”¨ZSetå‘½ä»¤æ“ä½œ</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰åŸå¸‚ï¼ˆZSETå‘½ä»¤ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGE china:city 0 -1</span><br><span class="line">1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">2) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">3) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line">4) <span class="string">&quot;shanghai&quot;</span></span><br><span class="line">5) <span class="string">&quot;hangzhou&quot;</span></span><br><span class="line">6) <span class="string">&quot;beijing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åŸå¸‚ï¼ˆZSETå‘½ä»¤ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; ZREM china:city hangzhou</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ•°æ®é‡</span></span><br><span class="line">127.0.0.1:6379&gt; ZCARD china:city</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure><h4 id="æ³¨æ„äº‹é¡¹-1"><a href="#æ³¨æ„äº‹é¡¹-1" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><blockquote><p><strong>âš ï¸ åæ ‡èŒƒå›´é™åˆ¶</strong>ï¼š</p><ul><li>ç»åº¦ï¼š-180Â° ~ +180Â°</li><li>çº¬åº¦ï¼š-85.05112878Â° ~ +85.05112878Â°</li><li>ä¸¤æï¼ˆÂ±90Â°çº¬åº¦ï¼‰æ— æ³•æ·»åŠ </li></ul></blockquote><blockquote><p><strong>âš ï¸ ç²¾åº¦æŸå¤±</strong>ï¼š</p><ul><li>GeoHashç®—æ³•ä¼šæœ‰ç²¾åº¦æŸå¤±</li><li>è¿”å›çš„åæ ‡å¯èƒ½ä¸è¾“å…¥ç•¥æœ‰å·®å¼‚</li><li>å¯¹äºå¤§å¤šæ•°åº”ç”¨åœºæ™¯ï¼Œç²¾åº¦è¶³å¤Ÿ</li></ul></blockquote><blockquote><p><strong>âš ï¸ è·ç¦»è®¡ç®—</strong>ï¼š</p><ul><li>è®¡ç®—çš„æ˜¯<strong>ç›´çº¿è·ç¦»</strong>ï¼ˆå¤§åœ†è·ç¦»ï¼‰</li><li>ä¸æ˜¯å®é™…é“è·¯è·ç¦»</li><li>å®é™…è·¯ç¨‹é€šå¸¸æ¯”ç›´çº¿è·ç¦»é•¿20%-50%</li></ul></blockquote><blockquote><p><strong>âš ï¸ æ€§èƒ½è€ƒè™‘</strong>ï¼š</p><ul><li><code>GEORADIUS</code>å‘½ä»¤æ—¶é—´å¤æ‚åº¦ï¼šO(N+log(M))</li><li>Næ˜¯åŠå¾„å†…çš„å…ƒç´ æ•°é‡ï¼ŒMæ˜¯æ€»å…ƒç´ æ•°é‡</li><li>å¤§èŒƒå›´æŸ¥è¯¢æˆ–æµ·é‡æ•°æ®æ—¶å¯èƒ½è¾ƒæ…¢</li><li>å»ºè®®ä½¿ç”¨<code>COUNT</code>é™åˆ¶è¿”å›æ•°é‡</li></ul></blockquote><blockquote><p><strong>âš ï¸ Redis 6.2ç‰ˆæœ¬æ›´æ–°</strong>ï¼š</p><ul><li><code>GEORADIUS</code>å’Œ<code>GEORADIUSBYMEMBER</code>åœ¨Redis 6.2ä¸­æ ‡è®°ä¸ºè¿‡æ—¶</li><li>æ¨èä½¿ç”¨æ–°å‘½ä»¤ï¼š<ul><li><code>GEOSEARCH</code>ï¼šæ›¿ä»£GEORADIUS&#x2F;GEORADIUSBYMEMBER</li><li><code>GEOSEARCHSTORE</code>ï¼šå­˜å‚¨æŸ¥è¯¢ç»“æœ</li></ul></li></ul></blockquote><h4 id="å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰-3"><a href="#å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰-3" class="headerlink" title="å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰"></a>å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.GeoCoordinate;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.GeoRadiusResponse;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.GeoUnit;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.params.GeoRadiusParam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GeoExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;china:city&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. æ·»åŠ åŸå¸‚ä½ç½®</span></span><br><span class="line">        Map&lt;String, GeoCoordinate&gt; cities = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        cities.put(<span class="string">&quot;beijing&quot;</span>, <span class="keyword">new</span> <span class="title class_">GeoCoordinate</span>(<span class="number">116.38</span>, <span class="number">39.90</span>));</span><br><span class="line">        cities.put(<span class="string">&quot;shanghai&quot;</span>, <span class="keyword">new</span> <span class="title class_">GeoCoordinate</span>(<span class="number">121.47</span>, <span class="number">31.23</span>));</span><br><span class="line">        cities.put(<span class="string">&quot;shenzhen&quot;</span>, <span class="keyword">new</span> <span class="title class_">GeoCoordinate</span>(<span class="number">114.05</span>, <span class="number">22.52</span>));</span><br><span class="line">        cities.put(<span class="string">&quot;guangzhou&quot;</span>, <span class="keyword">new</span> <span class="title class_">GeoCoordinate</span>(<span class="number">113.26</span>, <span class="number">23.13</span>));</span><br><span class="line">        cities.put(<span class="string">&quot;chongqing&quot;</span>, <span class="keyword">new</span> <span class="title class_">GeoCoordinate</span>(<span class="number">106.50</span>, <span class="number">29.53</span>));</span><br><span class="line">        </span><br><span class="line">        jedis.geoadd(key, cities);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŸå¸‚æ·»åŠ å®Œæˆ&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. è·å–åŸå¸‚åæ ‡</span></span><br><span class="line">        List&lt;GeoCoordinate&gt; coords = jedis.geopos(key, <span class="string">&quot;beijing&quot;</span>, <span class="string">&quot;shanghai&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒ—äº¬åæ ‡: &quot;</span> + coords.get(<span class="number">0</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸Šæµ·åæ ‡: &quot;</span> + coords.get(<span class="number">1</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. è®¡ç®—åŸå¸‚é—´è·ç¦»</span></span><br><span class="line">        <span class="type">Double</span> <span class="variable">distance</span> <span class="operator">=</span> jedis.geodist(key, <span class="string">&quot;beijing&quot;</span>, <span class="string">&quot;shanghai&quot;</span>, GeoUnit.KM);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒ—äº¬åˆ°ä¸Šæµ·è·ç¦»: &quot;</span> + distance + <span class="string">&quot; km&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. æŸ¥è¯¢é™„è¿‘çš„åŸå¸‚ï¼ˆä»¥æŒ‡å®šåæ ‡ä¸ºä¸­å¿ƒï¼‰</span></span><br><span class="line">        <span class="type">GeoRadiusParam</span> <span class="variable">param</span> <span class="operator">=</span> GeoRadiusParam.geoRadiusParam()</span><br><span class="line">            .withCoord()        <span class="comment">// è¿”å›åæ ‡</span></span><br><span class="line">            .withDist()         <span class="comment">// è¿”å›è·ç¦»</span></span><br><span class="line">            .sortAscending()    <span class="comment">// æŒ‰è·ç¦»å‡åº</span></span><br><span class="line">            .count(<span class="number">3</span>);          <span class="comment">// é™åˆ¶3ä¸ªç»“æœ</span></span><br><span class="line">        </span><br><span class="line">        List&lt;GeoRadiusResponse&gt; results = jedis.georadius(</span><br><span class="line">            key, <span class="number">110</span>, <span class="number">30</span>, <span class="number">1000</span>, GeoUnit.KM, param</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;\nä»¥(110, 30)ä¸ºä¸­å¿ƒï¼Œ1000kmèŒƒå›´å†…çš„åŸå¸‚ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (GeoRadiusResponse result : results) &#123;</span><br><span class="line">            System.out.println(String.format(</span><br><span class="line">                <span class="string">&quot;åŸå¸‚: %s, è·ç¦»: %.2f km, åæ ‡: (%.2f, %.2f)&quot;</span>,</span><br><span class="line">                result.getMemberByString(),</span><br><span class="line">                result.getDistance(),</span><br><span class="line">                result.getCoordinate().getLongitude(),</span><br><span class="line">                result.getCoordinate().getLatitude()</span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. æŸ¥è¯¢é™„è¿‘çš„åŸå¸‚ï¼ˆä»¥å·²æœ‰åŸå¸‚ä¸ºä¸­å¿ƒï¼‰</span></span><br><span class="line">        List&lt;GeoRadiusResponse&gt; nearbyShanghai = jedis.georadiusByMember(</span><br><span class="line">            key, <span class="string">&quot;shanghai&quot;</span>, <span class="number">500</span>, GeoUnit.KM, param</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;\nä»¥ä¸Šæµ·ä¸ºä¸­å¿ƒï¼Œ500kmèŒƒå›´å†…çš„åŸå¸‚ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (GeoRadiusResponse result : nearbyShanghai) &#123;</span><br><span class="line">            System.out.println(String.format(</span><br><span class="line">                <span class="string">&quot;åŸå¸‚: %s, è·ç¦»: %.2f km&quot;</span>,</span><br><span class="line">                result.getMemberByString(),</span><br><span class="line">                result.getDistance()</span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 6. è·å–GeoHash</span></span><br><span class="line">        List&lt;String&gt; geoHashes = jedis.geohash(key, <span class="string">&quot;beijing&quot;</span>, <span class="string">&quot;shanghai&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\nåŒ—äº¬GeoHash: &quot;</span> + geoHashes.get(<span class="number">0</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸Šæµ·GeoHash: &quot;</span> + geoHashes.get(<span class="number">1</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 7. é™„è¿‘çš„äººåŠŸèƒ½å®ç°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">locationKey</span> <span class="operator">=</span> <span class="string">&quot;user:locations&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç”¨æˆ·ä¸ŠæŠ¥ä½ç½®</span></span><br><span class="line">        jedis.geoadd(locationKey, <span class="number">113.93</span>, <span class="number">22.54</span>, <span class="string">&quot;user001&quot;</span>);</span><br><span class="line">        jedis.geoadd(locationKey, <span class="number">113.95</span>, <span class="number">22.55</span>, <span class="string">&quot;user002&quot;</span>);</span><br><span class="line">        jedis.geoadd(locationKey, <span class="number">113.92</span>, <span class="number">22.53</span>, <span class="string">&quot;user003&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾user001é™„è¿‘1å…¬é‡Œå†…çš„äºº</span></span><br><span class="line">        List&lt;GeoRadiusResponse&gt; nearbyUsers = jedis.georadiusByMember(</span><br><span class="line">            locationKey, <span class="string">&quot;user001&quot;</span>, <span class="number">1</span>, GeoUnit.KM,</span><br><span class="line">            GeoRadiusParam.geoRadiusParam().withDist().sortAscending()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;\nuser001é™„è¿‘1kmå†…çš„ç”¨æˆ·ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (GeoRadiusResponse user : nearbyUsers) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!user.getMemberByString().equals(<span class="string">&quot;user001&quot;</span>)) &#123;</span><br><span class="line">                System.out.println(String.format(</span><br><span class="line">                    <span class="string">&quot;ç”¨æˆ·: %s, è·ç¦»: %.2f km&quot;</span>,</span><br><span class="line">                    user.getMemberByString(),</span><br><span class="line">                    user.getDistance()</span><br><span class="line">                ));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®æˆ˜æ¡ˆä¾‹ï¼šå¤–å–é…é€ç³»ç»Ÿ"><a href="#å®æˆ˜æ¡ˆä¾‹ï¼šå¤–å–é…é€ç³»ç»Ÿ" class="headerlink" title="å®æˆ˜æ¡ˆä¾‹ï¼šå¤–å–é…é€ç³»ç»Ÿ"></a>å®æˆ˜æ¡ˆä¾‹ï¼šå¤–å–é…é€ç³»ç»Ÿ</h4><p><strong>éœ€æ±‚</strong>ï¼šå®ç°å¤–å–å¹³å°çš„é…é€èŒƒå›´æŸ¥è¯¢å’Œéª‘æ‰‹åˆ†é…</p><p><strong>ç³»ç»Ÿè®¾è®¡</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·ä¸‹å•</span><br><span class="line">    â†“</span><br><span class="line">æŸ¥è¯¢é…é€èŒƒå›´å†…çš„é¤å…</span><br><span class="line">    â†“</span><br><span class="line">è®¡ç®—é¤å…åˆ°ç”¨æˆ·çš„è·ç¦»</span><br><span class="line">    â†“</span><br><span class="line">æŸ¥æ‰¾é™„è¿‘çš„éª‘æ‰‹</span><br><span class="line">    â†“</span><br><span class="line">åˆ†é…æœ€è¿‘çš„éª‘æ‰‹</span><br><span class="line">    â†“</span><br><span class="line">å®æ—¶æ›´æ–°éª‘æ‰‹ä½ç½®</span><br></pre></td></tr></table></figure><p><strong>ä»£ç å®ç°</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeliveryService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RESTAURANT_KEY</span> <span class="operator">=</span> <span class="string">&quot;restaurants&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RIDER_KEY</span> <span class="operator">=</span> <span class="string">&quot;riders&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDER_KEY</span> <span class="operator">=</span> <span class="string">&quot;orders&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. æ·»åŠ é¤å…ä½ç½®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addRestaurant</span><span class="params">(String restaurantId, <span class="type">double</span> longitude, <span class="type">double</span> latitude)</span> &#123;</span><br><span class="line">        jedis.geoadd(RESTAURANT_KEY, longitude, latitude, restaurantId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. æŸ¥æ‰¾ç”¨æˆ·é™„è¿‘çš„é¤å…ï¼ˆ5å…¬é‡Œå†…ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;RestaurantInfo&gt; <span class="title function_">findNearbyRestaurants</span><span class="params">(<span class="type">double</span> userLng, <span class="type">double</span> userLat)</span> &#123;</span><br><span class="line">        List&lt;GeoRadiusResponse&gt; results = jedis.georadius(</span><br><span class="line">            RESTAURANT_KEY, userLng, userLat, <span class="number">5</span>, GeoUnit.KM,</span><br><span class="line">            GeoRadiusParam.geoRadiusParam()</span><br><span class="line">                .withCoord()</span><br><span class="line">                .withDist()</span><br><span class="line">                .sortAscending()</span><br><span class="line">                .count(<span class="number">20</span>)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        List&lt;RestaurantInfo&gt; restaurants = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (GeoRadiusResponse result : results) &#123;</span><br><span class="line">            <span class="type">RestaurantInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestaurantInfo</span>();</span><br><span class="line">            info.setId(result.getMemberByString());</span><br><span class="line">            info.setDistance(result.getDistance());</span><br><span class="line">            info.setLongitude(result.getCoordinate().getLongitude());</span><br><span class="line">            info.setLatitude(result.getCoordinate().getLatitude());</span><br><span class="line">            restaurants.add(info);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> restaurants;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. è®¡ç®—é…é€è·ç¦»</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculateDeliveryDistance</span><span class="params">(String restaurantId, <span class="type">double</span> userLng, <span class="type">double</span> userLat)</span> &#123;</span><br><span class="line">        <span class="comment">// å…ˆå°†ç”¨æˆ·ä½ç½®ä¸´æ—¶æ·»åŠ </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">tempUserId</span> <span class="operator">=</span> <span class="string">&quot;temp_&quot;</span> + System.currentTimeMillis();</span><br><span class="line">        jedis.geoadd(RESTAURANT_KEY, userLng, userLat, tempUserId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®—è·ç¦»</span></span><br><span class="line">        <span class="type">Double</span> <span class="variable">distance</span> <span class="operator">=</span> jedis.geodist(RESTAURANT_KEY, restaurantId, tempUserId, GeoUnit.KM);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ é™¤ä¸´æ—¶ä½ç½®</span></span><br><span class="line">        jedis.zrem(RESTAURANT_KEY, tempUserId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> distance != <span class="literal">null</span> ? distance : -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. æ›´æ–°éª‘æ‰‹ä½ç½®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateRiderLocation</span><span class="params">(String riderId, <span class="type">double</span> longitude, <span class="type">double</span> latitude)</span> &#123;</span><br><span class="line">        jedis.geoadd(RIDER_KEY, longitude, latitude, riderId);</span><br><span class="line">        <span class="comment">// è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆ5åˆ†é’Ÿæœªæ›´æ–°åˆ™è®¤ä¸ºç¦»çº¿ï¼‰</span></span><br><span class="line">        jedis.expire(RIDER_KEY, <span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. æŸ¥æ‰¾é¤å…é™„è¿‘çš„éª‘æ‰‹</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;RiderInfo&gt; <span class="title function_">findNearbyRiders</span><span class="params">(String restaurantId, <span class="type">double</span> maxDistance)</span> &#123;</span><br><span class="line">        List&lt;GeoRadiusResponse&gt; results = jedis.georadiusByMember(</span><br><span class="line">            RIDER_KEY, restaurantId, maxDistance, GeoUnit.KM,</span><br><span class="line">            GeoRadiusParam.geoRadiusParam()</span><br><span class="line">                .withCoord()</span><br><span class="line">                .withDist()</span><br><span class="line">                .sortAscending()</span><br><span class="line">                .count(<span class="number">10</span>)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        List&lt;RiderInfo&gt; riders = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (GeoRadiusResponse result : results) &#123;</span><br><span class="line">            <span class="type">RiderInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RiderInfo</span>();</span><br><span class="line">            info.setId(result.getMemberByString());</span><br><span class="line">            info.setDistance(result.getDistance());</span><br><span class="line">            info.setLongitude(result.getCoordinate().getLongitude());</span><br><span class="line">            info.setLatitude(result.getCoordinate().getLatitude());</span><br><span class="line">            riders.add(info);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> riders;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 6. åˆ†é…è®¢å•ç»™æœ€è¿‘çš„éª‘æ‰‹</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">assignOrderToNearestRider</span><span class="params">(String orderId, String restaurantId)</span> &#123;</span><br><span class="line">        List&lt;RiderInfo&gt; riders = findNearbyRiders(restaurantId, <span class="number">5.0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (riders.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// æ²¡æœ‰å¯ç”¨éª‘æ‰‹</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é€‰æ‹©æœ€è¿‘çš„éª‘æ‰‹</span></span><br><span class="line">        <span class="type">RiderInfo</span> <span class="variable">nearestRider</span> <span class="operator">=</span> riders.get(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®°å½•è®¢å•åˆ†é…</span></span><br><span class="line">        jedis.hset(<span class="string">&quot;order:&quot;</span> + orderId, <span class="string">&quot;riderId&quot;</span>, nearestRider.getId());</span><br><span class="line">        jedis.hset(<span class="string">&quot;order:&quot;</span> + orderId, <span class="string">&quot;distance&quot;</span>, String.valueOf(nearestRider.getDistance()));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> nearestRider.getId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®æ¨¡å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RestaurantInfo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> distance;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> longitude;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> latitude;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RiderInfo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> distance;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> longitude;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> latitude;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeliverySystemDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DeliveryService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliveryService</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ é¤å…</span></span><br><span class="line">        service.addRestaurant(<span class="string">&quot;restaurant001&quot;</span>, <span class="number">113.93</span>, <span class="number">22.54</span>);</span><br><span class="line">        service.addRestaurant(<span class="string">&quot;restaurant002&quot;</span>, <span class="number">113.95</span>, <span class="number">22.56</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç”¨æˆ·ä¸‹å•ï¼ŒæŸ¥æ‰¾é™„è¿‘é¤å…</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">userLng</span> <span class="operator">=</span> <span class="number">113.94</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">userLat</span> <span class="operator">=</span> <span class="number">22.55</span>;</span><br><span class="line">        List&lt;RestaurantInfo&gt; restaurants = service.findNearbyRestaurants(userLng, userLat);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;é™„è¿‘çš„é¤å…ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (RestaurantInfo restaurant : restaurants) &#123;</span><br><span class="line">            System.out.println(String.format(</span><br><span class="line">                <span class="string">&quot;é¤å…ID: %s, è·ç¦»: %.2f km&quot;</span>,</span><br><span class="line">                restaurant.getId(),</span><br><span class="line">                restaurant.getDistance()</span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éª‘æ‰‹ä¸Šçº¿ï¼Œä¸ŠæŠ¥ä½ç½®</span></span><br><span class="line">        service.updateRiderLocation(<span class="string">&quot;rider001&quot;</span>, <span class="number">113.92</span>, <span class="number">22.53</span>);</span><br><span class="line">        service.updateRiderLocation(<span class="string">&quot;rider002&quot;</span>, <span class="number">113.96</span>, <span class="number">22.57</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ†é…è®¢å•ç»™æœ€è¿‘çš„éª‘æ‰‹</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">assignedRider</span> <span class="operator">=</span> service.assignOrderToNearestRider(<span class="string">&quot;order001&quot;</span>, <span class="string">&quot;restaurant001&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;è®¢å•å·²åˆ†é…ç»™éª‘æ‰‹: &quot;</span> + assignedRider);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ€§èƒ½ä¼˜åŒ–å»ºè®®</strong>ï¼š</p><ol><li><p><strong>é™åˆ¶æŸ¥è¯¢èŒƒå›´</strong>ï¼š</p><ul><li>ä½¿ç”¨<code>COUNT</code>é™åˆ¶è¿”å›æ•°é‡</li><li>åˆç†è®¾ç½®æŸ¥è¯¢åŠå¾„ï¼ˆä¸è¦è¿‡å¤§ï¼‰</li></ul></li><li><p><strong>å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®</strong>ï¼š</p><ul><li>ç¦»çº¿ç”¨æˆ·&#x2F;éª‘æ‰‹çš„ä½ç½®</li><li>ä½¿ç”¨TTLè‡ªåŠ¨è¿‡æœŸ</li></ul></li><li><p><strong>åˆ†ç‰‡å­˜å‚¨</strong>ï¼š</p><ul><li>æŒ‰åŸå¸‚&#x2F;åŒºåŸŸåˆ†ç‰‡</li><li>é¿å…å•ä¸ªGEOé›†åˆè¿‡å¤§</li></ul></li><li><p><strong>ç¼“å­˜çƒ­ç‚¹æ•°æ®</strong>ï¼š</p><ul><li>çƒ­é—¨é¤å…&#x2F;åœ°ç‚¹</li><li>é«˜é¢‘æŸ¥è¯¢ç»“æœ</li></ul></li></ol><h2 id="7-Redisäº‹åŠ¡ä¸é”æœºåˆ¶"><a href="#7-Redisäº‹åŠ¡ä¸é”æœºåˆ¶" class="headerlink" title="7. Redisäº‹åŠ¡ä¸é”æœºåˆ¶"></a>7. Redisäº‹åŠ¡ä¸é”æœºåˆ¶</h2><h3 id="7-1-ä»€ä¹ˆæ˜¯Redisäº‹åŠ¡"><a href="#7-1-ä»€ä¹ˆæ˜¯Redisäº‹åŠ¡" class="headerlink" title="7.1 ä»€ä¹ˆæ˜¯Redisäº‹åŠ¡"></a>7.1 ä»€ä¹ˆæ˜¯Redisäº‹åŠ¡</h3><h4 id="äº‹åŠ¡å®šä¹‰"><a href="#äº‹åŠ¡å®šä¹‰" class="headerlink" title="äº‹åŠ¡å®šä¹‰"></a>äº‹åŠ¡å®šä¹‰</h4><p><strong>Redisäº‹åŠ¡</strong>æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼Œå®ƒå°†å¤šä¸ªå‘½ä»¤æ‰“åŒ…æˆä¸€ä¸ªæ•´ä½“ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œã€‚</p><p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p><ul><li>âœ… <strong>å‘½ä»¤åºåˆ—åŒ–</strong>ï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºæ‰§è¡Œ</li><li>âœ… <strong>éš”ç¦»æ‰§è¡Œ</strong>ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘½ä»¤æ‰“æ–­</li><li>âœ… <strong>ä¸²è”å‘½ä»¤</strong>ï¼šä¸»è¦ä½œç”¨æ˜¯ä¸²è”å¤šä¸ªå‘½ä»¤ï¼Œé˜²æ­¢å…¶ä»–å‘½ä»¤æ’é˜Ÿ</li><li>âš ï¸ <strong>éå®Œå…¨åŸå­æ€§</strong>ï¼šä¸åŒäºä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡ï¼ŒRedisäº‹åŠ¡ä¸ä¿è¯å®Œå…¨åŸå­æ€§</li></ul><p><strong>äº‹åŠ¡ vs å•ä¸ªå‘½ä»¤</strong>ï¼š</p><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>å•ä¸ªå‘½ä»¤</th><th>äº‹åŠ¡</th></tr></thead><tbody><tr><td><strong>æ‰§è¡Œæ–¹å¼</strong></td><td>ç«‹å³æ‰§è¡Œ</td><td>å»¶è¿Ÿåˆ°EXECæ—¶æ‰¹é‡æ‰§è¡Œ</td></tr><tr><td><strong>åŸå­æ€§</strong></td><td>å•ä¸ªå‘½ä»¤åŸå­æ€§</td><td>éƒ¨åˆ†åŸå­æ€§ï¼ˆæ— å›æ»šï¼‰</td></tr><tr><td><strong>éš”ç¦»æ€§</strong></td><td>å•çº¿ç¨‹ä¿è¯</td><td>æ‰¹é‡æ“ä½œéš”ç¦»</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>æ¯æ¬¡ç½‘ç»œå¾€è¿”</td><td>å‡å°‘ç½‘ç»œå¾€è¿”</td></tr></tbody></table><h4 id="äº‹åŠ¡çš„åº”ç”¨åœºæ™¯"><a href="#äº‹åŠ¡çš„åº”ç”¨åœºæ™¯" class="headerlink" title="äº‹åŠ¡çš„åº”ç”¨åœºæ™¯"></a>äº‹åŠ¡çš„åº”ç”¨åœºæ™¯</h4><p><strong>1. æ‰¹é‡æ“ä½œ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœºæ™¯ï¼šåŒæ—¶æ›´æ–°å¤šä¸ªå•†å“åº“å­˜</span></span><br><span class="line">MULTI</span><br><span class="line">DECR product:1001:stock</span><br><span class="line">DECR product:1002:stock</span><br><span class="line">DECR product:1003:stock</span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure><p><strong>2. é¿å…ç«æ€æ¡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœºæ™¯ï¼šè½¬è´¦æ“ä½œï¼ˆæ‰£æ¬¾+åŠ æ¬¾ï¼‰</span></span><br><span class="line">MULTI</span><br><span class="line">DECRBY account:A 100</span><br><span class="line">INCRBY account:B 100</span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure><p><strong>3. ç§’æ€åœºæ™¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœºæ™¯ï¼šå•†å“ç§’æ€ï¼Œé˜²æ­¢è¶…å–</span></span><br><span class="line">WATCH product:stock</span><br><span class="line">GET product:stock</span><br><span class="line">MULTI</span><br><span class="line">DECR product:stock</span><br><span class="line">SADD product:buyers user123</span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure><h3 id="7-2-Redisäº‹åŠ¡å‘½ä»¤"><a href="#7-2-Redisäº‹åŠ¡å‘½ä»¤" class="headerlink" title="7.2 Redisäº‹åŠ¡å‘½ä»¤"></a>7.2 Redisäº‹åŠ¡å‘½ä»¤</h3><h4 id="7-2-1-MULTI-å¼€å¯äº‹åŠ¡"><a href="#7-2-1-MULTI-å¼€å¯äº‹åŠ¡" class="headerlink" title="7.2.1 MULTI - å¼€å¯äº‹åŠ¡"></a>7.2.1 MULTI - å¼€å¯äº‹åŠ¡</h4><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MULTI</span><br></pre></td></tr></table></figure><p><strong>åŠŸèƒ½</strong>ï¼šæ ‡è®°ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹ï¼Œåç»­å‘½ä»¤ä¼šè¿›å…¥é˜Ÿåˆ—ï¼Œä¸ä¼šç«‹å³æ‰§è¡Œã€‚</p><p><strong>è¿”å›å€¼</strong>ï¼šæ€»æ˜¯è¿”å› <code>OK</code></p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET key1 value1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; SET key2 value2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; GET key1</span><br><span class="line">QUEUED</span><br></pre></td></tr></table></figure><p><strong>çŠ¶æ€è¯´æ˜</strong>ï¼š</p><ul><li>æ‰§è¡Œ<code>MULTI</code>åï¼ŒRedisè¿›å…¥<strong>äº‹åŠ¡æ¨¡å¼</strong></li><li>åç»­å‘½ä»¤ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¿”å›<code>QUEUED</code></li><li>å‘½ä»¤ä¾æ¬¡è¿›å…¥<strong>å‘½ä»¤é˜Ÿåˆ—</strong>ï¼Œç­‰å¾…<code>EXEC</code>æ‰§è¡Œ</li></ul><h4 id="7-2-2-EXEC-æ‰§è¡Œäº‹åŠ¡"><a href="#7-2-2-EXEC-æ‰§è¡Œäº‹åŠ¡" class="headerlink" title="7.2.2 EXEC - æ‰§è¡Œäº‹åŠ¡"></a>7.2.2 EXEC - æ‰§è¡Œäº‹åŠ¡</h4><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC</span><br></pre></td></tr></table></figure><p><strong>åŠŸèƒ½</strong>ï¼šæ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚</p><p><strong>è¿”å›å€¼</strong>ï¼šäº‹åŠ¡ä¸­æ¯ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœï¼ˆæ•°ç»„ï¼‰</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET key1 value1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; GET key1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCR counter</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) OK                  <span class="comment"># SET key1 value1çš„ç»“æœ</span></span><br><span class="line">2) <span class="string">&quot;value1&quot;</span>            <span class="comment"># GET key1çš„ç»“æœ</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1         <span class="comment"># INCR counterçš„ç»“æœ</span></span><br></pre></td></tr></table></figure><h4 id="7-2-3-DISCARD-å–æ¶ˆäº‹åŠ¡"><a href="#7-2-3-DISCARD-å–æ¶ˆäº‹åŠ¡" class="headerlink" title="7.2.3 DISCARD - å–æ¶ˆäº‹åŠ¡"></a>7.2.3 DISCARD - å–æ¶ˆäº‹åŠ¡</h4><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DISCARD</span><br></pre></td></tr></table></figure><p><strong>åŠŸèƒ½</strong>ï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ¸…ç©ºå‘½ä»¤é˜Ÿåˆ—ï¼Œé€€å‡ºäº‹åŠ¡æ¨¡å¼ã€‚</p><p><strong>è¿”å›å€¼</strong>ï¼šæ€»æ˜¯è¿”å› <code>OK</code></p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET key1 value1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; SET key2 value2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; DISCARD</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; GET key1</span><br><span class="line">(nil)    <span class="comment"># äº‹åŠ¡è¢«å–æ¶ˆï¼Œkey1æœªè¢«è®¾ç½®</span></span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>ä¸šåŠ¡é€»è¾‘åˆ¤æ–­åï¼Œå†³å®šä¸æ‰§è¡Œäº‹åŠ¡</li><li>å‘ç°å‘½ä»¤é”™è¯¯ï¼Œä¸»åŠ¨å–æ¶ˆ</li><li>å¼‚å¸¸æƒ…å†µä¸‹çš„å›æ»šæ“ä½œ</li></ul><h4 id="7-2-4-WATCH-ç›‘è§†é”®"><a href="#7-2-4-WATCH-ç›‘è§†é”®" class="headerlink" title="7.2.4 WATCH - ç›‘è§†é”®"></a>7.2.4 WATCH - ç›‘è§†é”®</h4><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WATCH key [key ...]</span><br></pre></td></tr></table></figure><p><strong>åŠŸèƒ½</strong>ï¼šç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªkeyï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œå‰è¿™äº›keyè¢«æ”¹åŠ¨ï¼Œäº‹åŠ¡å°†è¢«æ‰“æ–­ï¼ˆè¿”å›nilï¼‰ã€‚</p><p><strong>è¿”å›å€¼</strong>ï¼šæ€»æ˜¯è¿”å› <code>OK</code></p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¢æˆ·ç«¯1</span></span><br><span class="line">127.0.0.1:6379&gt; SET balance 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; WATCH balance</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECRBY balance 50</span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶å®¢æˆ·ç«¯2ä¿®æ”¹äº†balance</span></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯2: SET balance 200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯1ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">(nil)    <span class="comment"># äº‹åŠ¡è¢«æ‰“æ–­ï¼Œå› ä¸ºbalanceè¢«ä¿®æ”¹äº†</span></span><br></pre></td></tr></table></figure><p><strong>å·¥ä½œåŸç†</strong>ï¼ˆä¹è§‚é”ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. WATCH balance       â†’ è®°å½•balanceçš„ç‰ˆæœ¬å·</span><br><span class="line">2. MULTI              â†’ å¼€å¯äº‹åŠ¡</span><br><span class="line">3. DECRBY balance 50  â†’ å‘½ä»¤å…¥é˜Ÿ</span><br><span class="line">4. [å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹]    â†’ balanceç‰ˆæœ¬å·æ”¹å˜</span><br><span class="line">5. EXEC               â†’ æ£€æŸ¥ç‰ˆæœ¬å·ï¼Œå‘ç°ä¸ä¸€è‡´ï¼Œäº‹åŠ¡å¤±è´¥</span><br></pre></td></tr></table></figure><h4 id="7-2-5-UNWATCH-å–æ¶ˆç›‘è§†"><a href="#7-2-5-UNWATCH-å–æ¶ˆç›‘è§†" class="headerlink" title="7.2.5 UNWATCH - å–æ¶ˆç›‘è§†"></a>7.2.5 UNWATCH - å–æ¶ˆç›‘è§†</h4><p><strong>å‘½ä»¤æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNWATCH</span><br></pre></td></tr></table></figure><p><strong>åŠŸèƒ½</strong>ï¼šå–æ¶ˆWATCHå‘½ä»¤å¯¹æ‰€æœ‰keyçš„ç›‘è§†ã€‚</p><p><strong>è¿”å›å€¼</strong>ï¼šæ€»æ˜¯è¿”å› <code>OK</code></p><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>æ‰§è¡Œ<code>EXEC</code>æˆ–<code>DISCARD</code>åï¼Œä¼š<strong>è‡ªåŠ¨å–æ¶ˆç›‘è§†</strong></li><li>é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨<code>UNWATCH</code></li><li>ä»…åœ¨éœ€è¦æå‰è§£é™¤ç›‘è§†æ—¶ä½¿ç”¨</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; WATCH key1 key2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; UNWATCH</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET key1 value1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) OK    <span class="comment"># å³ä½¿key1ä¹‹å‰è¢«ç›‘è§†ï¼ŒUNWATCHåä¸å†ç›‘è§†ï¼Œäº‹åŠ¡æˆåŠŸæ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><h3 id="7-3-Redisäº‹åŠ¡æ‰§è¡Œæµç¨‹"><a href="#7-3-Redisäº‹åŠ¡æ‰§è¡Œæµç¨‹" class="headerlink" title="7.3 Redisäº‹åŠ¡æ‰§è¡Œæµç¨‹"></a>7.3 Redisäº‹åŠ¡æ‰§è¡Œæµç¨‹</h3><h4 id="7-3-1-äº‹åŠ¡æ‰§è¡Œçš„ä¸‰ä¸ªé˜¶æ®µ"><a href="#7-3-1-äº‹åŠ¡æ‰§è¡Œçš„ä¸‰ä¸ªé˜¶æ®µ" class="headerlink" title="7.3.1 äº‹åŠ¡æ‰§è¡Œçš„ä¸‰ä¸ªé˜¶æ®µ"></a>7.3.1 äº‹åŠ¡æ‰§è¡Œçš„ä¸‰ä¸ªé˜¶æ®µ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[1. å¼€å¯é˜¶æ®µ]</span><br><span class="line">    â†“ MULTI</span><br><span class="line">[2. ç»„é˜Ÿé˜¶æ®µ]</span><br><span class="line">    â†“ å‘½ä»¤å…¥é˜Ÿï¼ˆQUEUEDï¼‰</span><br><span class="line">    â†“ å‘½ä»¤å…¥é˜Ÿï¼ˆQUEUEDï¼‰</span><br><span class="line">    â†“ å‘½ä»¤å…¥é˜Ÿï¼ˆQUEUEDï¼‰</span><br><span class="line">[3. æ‰§è¡Œé˜¶æ®µ]</span><br><span class="line">    â†“ EXEC</span><br><span class="line">[è¿”å›ç»“æœ]</span><br></pre></td></tr></table></figure><p><strong>æµç¨‹å›¾</strong>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/redis%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D%E5%9B%BE.png" alt="Redisäº‹åŠ¡æµç¨‹"></p><h4 id="7-3-2-äº‹åŠ¡æ‰§è¡Œæ¡ˆä¾‹"><a href="#7-3-2-äº‹åŠ¡æ‰§è¡Œæ¡ˆä¾‹" class="headerlink" title="7.3.2 äº‹åŠ¡æ‰§è¡Œæ¡ˆä¾‹"></a>7.3.2 äº‹åŠ¡æ‰§è¡Œæ¡ˆä¾‹</h4><h5 id="æ¡ˆä¾‹1ï¼šç»„é˜ŸæˆåŠŸï¼Œæäº¤æˆåŠŸ-âœ…"><a href="#æ¡ˆä¾‹1ï¼šç»„é˜ŸæˆåŠŸï¼Œæäº¤æˆåŠŸ-âœ…" class="headerlink" title="æ¡ˆä¾‹1ï¼šç»„é˜ŸæˆåŠŸï¼Œæäº¤æˆåŠŸ âœ…"></a>æ¡ˆä¾‹1ï¼šç»„é˜ŸæˆåŠŸï¼Œæäº¤æˆåŠŸ âœ…</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET name <span class="string">&quot;å¼ ä¸‰&quot;</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; SET age 25</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCR age</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; GET name</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) OK              <span class="comment"># SET name</span></span><br><span class="line">2) OK              <span class="comment"># SET age</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 26    <span class="comment"># INCR age</span></span><br><span class="line">4) <span class="string">&quot;å¼ ä¸‰&quot;</span>           <span class="comment"># GET name</span></span><br></pre></td></tr></table></figure><p><strong>ç»“æœ</strong>ï¼šâœ… æ‰€æœ‰å‘½ä»¤æˆåŠŸæ‰§è¡Œ</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/%E6%8F%90%E4%BA%A4%E6%88%90%E5%8A%9F.png" alt="ç»„é˜ŸæˆåŠŸæäº¤æˆåŠŸ"></p><h5 id="æ¡ˆä¾‹2ï¼šç»„é˜Ÿé˜¶æ®µæŠ¥é”™ï¼Œæäº¤å¤±è´¥-âŒ"><a href="#æ¡ˆä¾‹2ï¼šç»„é˜Ÿé˜¶æ®µæŠ¥é”™ï¼Œæäº¤å¤±è´¥-âŒ" class="headerlink" title="æ¡ˆä¾‹2ï¼šç»„é˜Ÿé˜¶æ®µæŠ¥é”™ï¼Œæäº¤å¤±è´¥ âŒ"></a>æ¡ˆä¾‹2ï¼šç»„é˜Ÿé˜¶æ®µæŠ¥é”™ï¼Œæäº¤å¤±è´¥ âŒ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET key1 value1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; SETXX key2 value2    <span class="comment"># é”™è¯¯çš„å‘½ä»¤ï¼ˆä¸å­˜åœ¨SETXXï¼‰</span></span><br><span class="line">(error) ERR unknown <span class="built_in">command</span> <span class="string">&#x27;SETXX&#x27;</span></span><br><span class="line">127.0.0.1:6379&gt; SET key3 value3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br></pre></td></tr></table></figure><p><strong>ç»“æœ</strong>ï¼šâŒ <strong>æ•´ä¸ªäº‹åŠ¡è¢«å–æ¶ˆ</strong>ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¸ä¼šæ‰§è¡Œï¼ˆåŒ…æ‹¬æ­£ç¡®çš„å‘½ä»¤ï¼‰</p><p><strong>åŸå› </strong>ï¼šç»„é˜Ÿé˜¶æ®µå‘ç°<strong>è¯­æ³•é”™è¯¯</strong>ï¼ˆå‘½ä»¤ä¸å­˜åœ¨ï¼‰ï¼ŒRedisç›´æ¥æ”¾å¼ƒæ•´ä¸ªäº‹åŠ¡</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/%E6%8F%90%E4%BA%A4%E5%A4%B1%E8%B4%A5.png" alt="ç»„é˜Ÿé˜¶æ®µæŠ¥é”™"></p><h5 id="æ¡ˆä¾‹3ï¼šç»„é˜ŸæˆåŠŸï¼Œæ‰§è¡Œé˜¶æ®µéƒ¨åˆ†å¤±è´¥-âš ï¸"><a href="#æ¡ˆä¾‹3ï¼šç»„é˜ŸæˆåŠŸï¼Œæ‰§è¡Œé˜¶æ®µéƒ¨åˆ†å¤±è´¥-âš ï¸" class="headerlink" title="æ¡ˆä¾‹3ï¼šç»„é˜ŸæˆåŠŸï¼Œæ‰§è¡Œé˜¶æ®µéƒ¨åˆ†å¤±è´¥ âš ï¸"></a>æ¡ˆä¾‹3ï¼šç»„é˜ŸæˆåŠŸï¼Œæ‰§è¡Œé˜¶æ®µéƒ¨åˆ†å¤±è´¥ âš ï¸</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SET balance 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET name <span class="string">&quot;æå››&quot;</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCR balance</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCR name    <span class="comment"># å¯¹å­—ç¬¦ä¸²æ‰§è¡ŒINCRï¼ˆç±»å‹é”™è¯¯ï¼‰</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; SET age 30</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) OK                                                    <span class="comment"># SET name æˆåŠŸ âœ…</span></span><br><span class="line">2) (<span class="built_in">integer</span>) 101                                        <span class="comment"># INCR balance æˆåŠŸ âœ…</span></span><br><span class="line">3) (error) ERR value is not an <span class="built_in">integer</span> or out of range  <span class="comment"># INCR name å¤±è´¥ âŒ</span></span><br><span class="line">4) OK                                                    <span class="comment"># SET age æˆåŠŸ âœ…</span></span><br></pre></td></tr></table></figure><p><strong>ç»“æœ</strong>ï¼šâš ï¸ <strong>éƒ¨åˆ†æˆåŠŸï¼Œéƒ¨åˆ†å¤±è´¥</strong></p><ul><li>æ­£ç¡®çš„å‘½ä»¤ï¼šæ­£å¸¸æ‰§è¡Œ âœ…</li><li>é”™è¯¯çš„å‘½ä»¤ï¼šæ‰§è¡Œå¤±è´¥ âŒ</li><li><strong>ä¸ä¼šå›æ»š</strong>ï¼šå…¶ä»–å‘½ä»¤ä¸å—å½±å“</li></ul><p><strong>åŸå› </strong>ï¼šç»„é˜Ÿé˜¶æ®µè¯­æ³•æ­£ç¡®ï¼Œä½†æ‰§è¡Œé˜¶æ®µå‘ç”Ÿ<strong>è¿è¡Œæ—¶é”™è¯¯</strong>ï¼ˆç±»å‹é”™è¯¯ï¼‰</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/%E6%9C%89%E6%88%90%E5%8A%9F%E6%9C%89%E5%A4%B1%E8%B4%A5.png" alt="éƒ¨åˆ†æˆåŠŸéƒ¨åˆ†å¤±è´¥"></p><h3 id="7-4-äº‹åŠ¡é”™è¯¯å¤„ç†"><a href="#7-4-äº‹åŠ¡é”™è¯¯å¤„ç†" class="headerlink" title="7.4 äº‹åŠ¡é”™è¯¯å¤„ç†"></a>7.4 äº‹åŠ¡é”™è¯¯å¤„ç†</h3><h4 id="ä¸¤ç§é”™è¯¯ç±»å‹"><a href="#ä¸¤ç§é”™è¯¯ç±»å‹" class="headerlink" title="ä¸¤ç§é”™è¯¯ç±»å‹"></a>ä¸¤ç§é”™è¯¯ç±»å‹</h4><table><thead><tr><th>é”™è¯¯ç±»å‹</th><th>å‘ç”Ÿé˜¶æ®µ</th><th>é”™è¯¯ç¤ºä¾‹</th><th>å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td><strong>è¯­æ³•é”™è¯¯</strong><br>(Syntax Error)</td><td><strong>ç»„é˜Ÿé˜¶æ®µ</strong></td><td>å‘½ä»¤ä¸å­˜åœ¨ã€å‚æ•°æ•°é‡é”™è¯¯</td><td>âŒ <strong>æ•´ä¸ªäº‹åŠ¡å–æ¶ˆ</strong><br>æ‰€æœ‰å‘½ä»¤éƒ½ä¸æ‰§è¡Œ</td></tr><tr><td><strong>è¿è¡Œæ—¶é”™è¯¯</strong><br>(Runtime Error)</td><td><strong>æ‰§è¡Œé˜¶æ®µ</strong></td><td>ç±»å‹é”™è¯¯ã€èŒƒå›´é”™è¯¯</td><td>âš ï¸ <strong>é”™è¯¯å‘½ä»¤ä¸æ‰§è¡Œ</strong><br>å…¶ä»–å‘½ä»¤æ­£å¸¸æ‰§è¡Œ<br><strong>ä¸ä¼šå›æ»š</strong></td></tr></tbody></table><h4 id="é”™è¯¯å¤„ç†è¯¦è§£"><a href="#é”™è¯¯å¤„ç†è¯¦è§£" class="headerlink" title="é”™è¯¯å¤„ç†è¯¦è§£"></a>é”™è¯¯å¤„ç†è¯¦è§£</h4><p><strong>1. ç»„é˜Ÿé˜¶æ®µé”™è¯¯ï¼ˆSyntax Errorï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MULTI</span><br><span class="line">SET key1 value1        <span class="comment"># âœ… æ­£ç¡®</span></span><br><span class="line">UNKNOWN_COMMAND        <span class="comment"># âŒ è¯­æ³•é”™è¯¯ï¼ˆå‘½ä»¤ä¸å­˜åœ¨ï¼‰</span></span><br><span class="line">SET key2 value2        <span class="comment"># âœ… æ­£ç¡®</span></span><br><span class="line">EXEC                   <span class="comment"># âŒ æ•´ä¸ªäº‹åŠ¡è¢«å–æ¶ˆ</span></span><br></pre></td></tr></table></figure><p><strong>å¤„ç†æ–¹å¼</strong>ï¼š</p><ul><li>Redisæ£€æµ‹åˆ°<strong>è¯­æ³•é”™è¯¯</strong></li><li>æ ‡è®°äº‹åŠ¡ä¸º<strong>å¤±è´¥çŠ¶æ€</strong></li><li>æ‰§è¡Œ<code>EXEC</code>æ—¶ï¼Œè¿”å›é”™è¯¯ï¼Œ<strong>æ‰€æœ‰å‘½ä»¤éƒ½ä¸æ‰§è¡Œ</strong></li></ul><p><strong>2. æ‰§è¡Œé˜¶æ®µé”™è¯¯ï¼ˆRuntime Errorï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SET name <span class="string">&quot;å¼ ä¸‰&quot;</span>         <span class="comment"># nameæ˜¯å­—ç¬¦ä¸²</span></span><br><span class="line">MULTI</span><br><span class="line">INCR counter          <span class="comment"># âœ… æˆåŠŸï¼ˆcounterä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸º0å†åŠ 1ï¼‰</span></span><br><span class="line">INCR name             <span class="comment"># âŒ å¤±è´¥ï¼ˆnameæ˜¯å­—ç¬¦ä¸²ï¼Œä¸èƒ½INCRï¼‰</span></span><br><span class="line">SET age 25            <span class="comment"># âœ… æˆåŠŸï¼ˆä¸å—INCR nameå½±å“ï¼‰</span></span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure><p><strong>å¤„ç†æ–¹å¼</strong>ï¼š</p><ul><li>é”™è¯¯å‘½ä»¤ï¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œ<strong>ä¸æ‰§è¡Œ</strong></li><li>å…¶ä»–å‘½ä»¤ï¼š<strong>æ­£å¸¸æ‰§è¡Œ</strong></li><li><strong>ä¸ä¼šå›æ»š</strong>ï¼šå·²æ‰§è¡Œçš„å‘½ä»¤ä¸ä¼šæ’¤é”€</li></ul><h4 id="Redisäº‹åŠ¡-vs-ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡"><a href="#Redisäº‹åŠ¡-vs-ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡" class="headerlink" title="Redisäº‹åŠ¡ vs ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡"></a>Redisäº‹åŠ¡ vs ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡</h4><table><thead><tr><th>ç‰¹æ€§</th><th>Redisäº‹åŠ¡</th><th>ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡ï¼ˆå¦‚MySQLï¼‰</th></tr></thead><tbody><tr><td><strong>åŸå­æ€§</strong></td><td>âš ï¸ <strong>éƒ¨åˆ†åŸå­æ€§</strong><br>è¯­æ³•é”™è¯¯ï¼šå…¨éƒ¨å–æ¶ˆ<br>è¿è¡Œæ—¶é”™è¯¯ï¼šä¸å›æ»š</td><td>âœ… <strong>å®Œå…¨åŸå­æ€§</strong><br>è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š</td></tr><tr><td><strong>å›æ»šæœºåˆ¶</strong></td><td>âŒ <strong>ä¸æ”¯æŒå›æ»š</strong></td><td>âœ… <strong>æ”¯æŒå›æ»š</strong>ï¼ˆROLLBACKï¼‰</td></tr><tr><td><strong>éš”ç¦»çº§åˆ«</strong></td><td>âœ… ä¸²è¡ŒåŒ–æ‰§è¡Œ</td><td>âœ… å¯é…ç½®éš”ç¦»çº§åˆ«</td></tr><tr><td><strong>ä¸€è‡´æ€§</strong></td><td>âš ï¸ å¼€å‘è€…ä¿è¯</td><td>âœ… æ•°æ®åº“ä¿è¯</td></tr><tr><td><strong>æŒä¹…æ€§</strong></td><td>âš ï¸ å–å†³äºæŒä¹…åŒ–é…ç½®</td><td>âœ… äº‹åŠ¡æäº¤åæŒä¹…åŒ–</td></tr></tbody></table><p><strong>ä¸ºä»€ä¹ˆRedisä¸æ”¯æŒå›æ»šï¼Ÿ</strong></p><ol><li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šå›æ»šæœºåˆ¶ä¼šæ˜¾è‘—é™ä½æ€§èƒ½</li><li><strong>è®¾è®¡å“²å­¦</strong>ï¼šRedisè¿½æ±‚ç®€å•å’Œé«˜æ€§èƒ½</li><li><strong>é”™è¯¯é¢„é˜²</strong>ï¼šè¿è¡Œæ—¶é”™è¯¯é€šå¸¸æ˜¯ç¨‹åºbugï¼Œåº”è¯¥åœ¨æµ‹è¯•é˜¶æ®µå‘ç°</li><li><strong>å•çº¿ç¨‹æ¨¡å‹</strong>ï¼šå•çº¿ç¨‹æ‰§è¡Œï¼Œä¸éœ€è¦å¤æ‚çš„äº‹åŠ¡ç®¡ç†</li></ol><h3 id="7-5-äº‹åŠ¡å†²çªé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#7-5-äº‹åŠ¡å†²çªé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="7.5 äº‹åŠ¡å†²çªé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a>7.5 äº‹åŠ¡å†²çªé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3><h4 id="7-5-1-äº‹åŠ¡å†²çªåœºæ™¯"><a href="#7-5-1-äº‹åŠ¡å†²çªåœºæ™¯" class="headerlink" title="7.5.1 äº‹åŠ¡å†²çªåœºæ™¯"></a>7.5.1 äº‹åŠ¡å†²çªåœºæ™¯</h4><p><strong>åœºæ™¯æè¿°</strong>ï¼šåŒåä¸€ç§’æ€ï¼Œå¤šä¸ªç”¨æˆ·åŒæ—¶æŠ¢è´­åŒä¸€å•†å“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åˆå§‹åº“å­˜ï¼š1000</span><br><span class="line">ç”¨æˆ·Aï¼šè´­ä¹°10ä»¶ï¼ˆå‡åº“å­˜10ï¼‰</span><br><span class="line">ç”¨æˆ·Bï¼šè´­ä¹°5ä»¶ï¼ˆå‡åº“å­˜5ï¼‰</span><br><span class="line">ç”¨æˆ·Cï¼šè´­ä¹°8ä»¶ï¼ˆå‡åº“å­˜8ï¼‰</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>å¹¶å‘é—®é¢˜</strong>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/%E6%8A%A2%E8%B4%AD%E4%BE%8B%E5%AD%90.png" alt="äº‹åŠ¡å†²çªç¤ºä¾‹"></p><p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p><table><thead><tr><th>æ—¶é—´ç‚¹</th><th>ç”¨æˆ·A</th><th>ç”¨æˆ·B</th><th>åº“å­˜</th></tr></thead><tbody><tr><td>T1</td><td>è¯»å–åº“å­˜ï¼š100</td><td>-</td><td>100</td></tr><tr><td>T2</td><td>-</td><td>è¯»å–åº“å­˜ï¼š100</td><td>100</td></tr><tr><td>T3</td><td>è®¡ç®—ï¼š100-10&#x3D;90</td><td>-</td><td>100</td></tr><tr><td>T4</td><td>-</td><td>è®¡ç®—ï¼š100-5&#x3D;95</td><td>100</td></tr><tr><td>T5</td><td>å†™å…¥ï¼š90</td><td>-</td><td>90</td></tr><tr><td>T6</td><td>-</td><td>å†™å…¥ï¼š95</td><td>95ï¼ˆé”™è¯¯ï¼ï¼‰</td></tr></tbody></table><p><strong>ç»“æœ</strong>ï¼šâŒ ç”¨æˆ·Açš„æ‰£å‡è¢«è¦†ç›–ï¼Œå®é™…åº”è¯¥æ˜¯85ï¼Œä½†ç»“æœæ˜¯95ï¼ˆ<strong>ä¸¢å¤±æ›´æ–°</strong>ï¼‰</p><h4 id="7-5-2-æ‚²è§‚é”ï¼ˆPessimistic-Lockï¼‰"><a href="#7-5-2-æ‚²è§‚é”ï¼ˆPessimistic-Lockï¼‰" class="headerlink" title="7.5.2 æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰"></a>7.5.2 æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰</h4><p><strong>å®šä¹‰</strong>ï¼šè®¤ä¸ºæ•°æ®å¾ˆå¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œå› æ­¤åœ¨æ“ä½œæ•°æ®å‰å…ˆåŠ é”ã€‚</p><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š<strong>å…ˆåŠ é”ï¼Œå†æ“ä½œ</strong></p><p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·Aè¯·æ±‚                ç”¨æˆ·Bè¯·æ±‚</span><br><span class="line">   â†“                       â†“</span><br><span class="line">è·å–é” âœ…                è·å–é” âŒï¼ˆç­‰å¾…ï¼‰</span><br><span class="line">   â†“                       |</span><br><span class="line">è¯»å–æ•°æ®                    |ï¼ˆé˜»å¡ï¼‰</span><br><span class="line">   â†“                       |</span><br><span class="line">ä¿®æ”¹æ•°æ®                    |</span><br><span class="line">   â†“                       |</span><br><span class="line">å†™å…¥æ•°æ®                    |</span><br><span class="line">   â†“                       |</span><br><span class="line">é‡Šæ”¾é”                      â†“</span><br><span class="line">   â†“                   è·å–é” âœ…</span><br><span class="line">ç»“æŸ                        â†“</span><br><span class="line">                        è¯»å–æ•°æ®</span><br><span class="line">                           â†“</span><br><span class="line">                        ä¿®æ”¹æ•°æ®</span><br><span class="line">                           â†“</span><br><span class="line">                        å†™å…¥æ•°æ®</span><br><span class="line">                           â†“</span><br><span class="line">                        é‡Šæ”¾é”</span><br><span class="line">                           â†“</span><br><span class="line">                        ç»“æŸ</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/%E6%82%B2%E8%A7%82%E9%94%81.png" alt="æ‚²è§‚é”æœºåˆ¶"></p><p><strong>ä¼ ç»Ÿæ•°æ®åº“å®ç°</strong>ï¼ˆMySQLï¼‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¼€å¯äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åŠ é”æŸ¥è¯¢ï¼ˆFOR UPDATEï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> stock <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1001</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¿®æ”¹åº“å­˜</span></span><br><span class="line"><span class="keyword">UPDATE</span> product <span class="keyword">SET</span> stock <span class="operator">=</span> stock <span class="operator">-</span> <span class="number">1</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1001</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æäº¤äº‹åŠ¡ï¼ˆé‡Šæ”¾é”ï¼‰</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>âœ… <strong>å¼ºä¸€è‡´æ€§</strong>ï¼šä¿è¯æ•°æ®ç»å¯¹æ­£ç¡®</li><li>âœ… <strong>é€‚åˆå†™å¤šè¯»å°‘</strong>ï¼šé¢‘ç¹ä¿®æ”¹çš„åœºæ™¯</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>âŒ <strong>æ€§èƒ½ä½</strong>ï¼šåŠ é”ã€ç­‰å¾…ã€é‡Šæ”¾é”çš„å¼€é”€å¤§</li><li>âŒ <strong>å¹¶å‘åº¦ä½</strong>ï¼šåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ“ä½œ</li><li>âŒ <strong>å¯èƒ½æ­»é”</strong>ï¼šå¤šä¸ªé”ç›¸äº’ç­‰å¾…</li></ul><h4 id="7-5-3-ä¹è§‚é”ï¼ˆOptimistic-Lockï¼‰"><a href="#7-5-3-ä¹è§‚é”ï¼ˆOptimistic-Lockï¼‰" class="headerlink" title="7.5.3 ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰"></a>7.5.3 ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰</h4><p><strong>å®šä¹‰</strong>ï¼šè®¤ä¸ºæ•°æ®å†²çªæ¦‚ç‡è¾ƒä½ï¼Œæ“ä½œæ—¶ä¸åŠ é”ï¼Œåªåœ¨æ›´æ–°æ—¶æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹ã€‚</p><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š<strong>å…ˆæ“ä½œï¼Œæäº¤æ—¶æ£€æŸ¥</strong>ï¼ˆCheck-And-Setæœºåˆ¶ï¼‰</p><p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·A                         ç”¨æˆ·B</span><br><span class="line">   â†“                           â†“</span><br><span class="line">è¯»å–æ•°æ®ï¼ˆversion=1ï¼‰         è¯»å–æ•°æ®ï¼ˆversion=1ï¼‰</span><br><span class="line">   â†“                           â†“</span><br><span class="line">ä¿®æ”¹æ•°æ®                      ä¿®æ”¹æ•°æ®</span><br><span class="line">   â†“                           â†“</span><br><span class="line">æäº¤ï¼šæ£€æŸ¥version=1? âœ…       æäº¤ï¼šæ£€æŸ¥version=1? âŒ</span><br><span class="line">   â†“                           â†“</span><br><span class="line">versionæ”¹ä¸º2ï¼Œæäº¤æˆåŠŸ âœ…     versionå·²å˜ä¸º2ï¼Œæäº¤å¤±è´¥ âŒ</span><br><span class="line">   â†“                           â†“</span><br><span class="line">ç»“æŸ                        é‡è¯•ï¼ˆé‡æ–°è¯»å–version=2ï¼‰</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/%E4%B9%90%E8%A7%82%E9%94%81.png" alt="ä¹è§‚é”æœºåˆ¶"></p><p><strong>å®ç°æ–¹å¼1ï¼šç‰ˆæœ¬å·æœºåˆ¶</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¯»å–æ•°æ®å’Œç‰ˆæœ¬å·</span></span><br><span class="line"><span class="keyword">SELECT</span> stock, version <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1001</span>;</span><br><span class="line"><span class="comment">-- stock=100, version=1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ›´æ–°æ—¶æ£€æŸ¥ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="keyword">UPDATE</span> product </span><br><span class="line"><span class="keyword">SET</span> stock <span class="operator">=</span> <span class="number">99</span>, version <span class="operator">=</span> <span class="number">2</span> </span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1001</span> <span class="keyword">AND</span> version <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- å¦‚æœversionä¸æ˜¯1ï¼ˆè¢«å…¶ä»–äººæ”¹è¿‡ï¼‰ï¼Œæ›´æ–°å¤±è´¥</span></span><br></pre></td></tr></table></figure><p><strong>å®ç°æ–¹å¼2ï¼šæ—¶é—´æˆ³æœºåˆ¶</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¯»å–æ•°æ®å’Œæ›´æ–°æ—¶é—´</span></span><br><span class="line"><span class="keyword">SELECT</span> stock, update_time <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1001</span>;</span><br><span class="line"><span class="comment">-- stock=100, update_time=&#x27;2025-11-17 10:00:00&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ›´æ–°æ—¶æ£€æŸ¥æ—¶é—´æˆ³</span></span><br><span class="line"><span class="keyword">UPDATE</span> product </span><br><span class="line"><span class="keyword">SET</span> stock <span class="operator">=</span> <span class="number">99</span>, update_time <span class="operator">=</span> NOW() </span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1001</span> <span class="keyword">AND</span> update_time <span class="operator">=</span> <span class="string">&#x27;2025-11-17 10:00:00&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>Redisä¸­çš„ä¹è§‚é”ï¼šWATCHæœºåˆ¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨æˆ·A</span></span><br><span class="line">127.0.0.1:6379&gt; WATCH stock</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; GET stock</span><br><span class="line"><span class="string">&quot;100&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECR stock</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) (<span class="built_in">integer</span>) 99    <span class="comment"># æˆåŠŸ âœ…</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·Bï¼ˆåŒæ—¶æ“ä½œï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; WATCH stock</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; GET stock</span><br><span class="line"><span class="string">&quot;100&quot;</span>    <span class="comment"># è¯»å–æ—¶stockè¿˜æ˜¯100</span></span><br><span class="line"><span class="comment"># ï¼ˆæ­¤æ—¶ç”¨æˆ·Aå·²ç»æŠŠstockæ”¹ä¸º99ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECR stock</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">(nil)    <span class="comment"># å¤±è´¥ âŒï¼Œå› ä¸ºstockè¢«ä¿®æ”¹äº†</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/watch%E6%9C%BA%E5%88%B6.png" alt="WATCHæœºåˆ¶"></p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>âœ… <strong>é«˜æ€§èƒ½</strong>ï¼šæ— é”æ“ä½œï¼Œæ— é˜»å¡</li><li>âœ… <strong>é«˜å¹¶å‘</strong>ï¼šå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶è¯»å–</li><li>âœ… <strong>æ— æ­»é”</strong>ï¼šä¸ä¼šå‡ºç°æ­»é”é—®é¢˜</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>âŒ <strong>å¯èƒ½å¤±è´¥</strong>ï¼šé«˜å¹¶å‘æ—¶å†²çªå¤šï¼Œéœ€è¦é‡è¯•</li><li>âŒ <strong>ABAé—®é¢˜</strong>ï¼šå€¼ä»Aå˜åˆ°Bå†å˜å›Aï¼Œä¹è§‚é”æ£€æµ‹ä¸åˆ°</li></ul><h4 id="7-5-4-æ‚²è§‚é”-vs-ä¹è§‚é”"><a href="#7-5-4-æ‚²è§‚é”-vs-ä¹è§‚é”" class="headerlink" title="7.5.4 æ‚²è§‚é” vs ä¹è§‚é”"></a>7.5.4 æ‚²è§‚é” vs ä¹è§‚é”</h4><table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>æ‚²è§‚é”</th><th>ä¹è§‚é”</th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒæ€æƒ³</strong></td><td>å…ˆåŠ é”ï¼Œå†æ“ä½œ</td><td>å…ˆæ“ä½œï¼Œæäº¤æ—¶æ£€æŸ¥</td></tr><tr><td><strong>å†²çªé¢„æœŸ</strong></td><td>è®¤ä¸ºå†²çªå¾ˆå¯èƒ½å‘ç”Ÿ</td><td>è®¤ä¸ºå†²çªæ¦‚ç‡è¾ƒä½</td></tr><tr><td><strong>åŠ é”æ—¶æœº</strong></td><td>è¯»å–æ•°æ®å‰</td><td>ä¸åŠ é”ï¼ˆæäº¤æ—¶æ£€æŸ¥ï¼‰</td></tr><tr><td><strong>å¹¶å‘æ€§èƒ½</strong></td><td>âŒ ä½ï¼ˆä¸²è¡Œæ‰§è¡Œï¼‰</td><td>âœ… é«˜ï¼ˆå¹¶å‘è¯»å–ï¼‰</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å†™å¤šè¯»å°‘ã€å†²çªé¢‘ç¹</td><td>è¯»å¤šå†™å°‘ã€å†²çªè¾ƒå°‘</td></tr><tr><td><strong>å…¸å‹å®ç°</strong></td><td>æ•°æ®åº“è¡Œé”ã€è¡¨é”</td><td>ç‰ˆæœ¬å·ã€WATCH</td></tr><tr><td><strong>Rediså®ç°</strong></td><td>SETNX + EXPIREï¼ˆåˆ†å¸ƒå¼é”ï¼‰</td><td>WATCH + MULTI + EXEC</td></tr></tbody></table><p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>è¯»å¤šå†™å°‘</strong>ï¼ˆå¦‚ç¼“å­˜ï¼‰</td><td>âœ… ä¹è§‚é”</td></tr><tr><td><strong>å†™å¤šè¯»å°‘</strong>ï¼ˆå¦‚ç§’æ€ï¼‰</td><td>âš ï¸ ä¹è§‚é” + é™æµ + é˜Ÿåˆ—</td></tr><tr><td><strong>é«˜å¹¶å‘ç§’æ€</strong></td><td>âœ… <strong>Luaè„šæœ¬</strong>ï¼ˆåŸå­æ€§æœ€å¼ºï¼‰</td></tr><tr><td><strong>åˆ†å¸ƒå¼é”åœºæ™¯</strong></td><td>âœ… æ‚²è§‚é”ï¼ˆSETNXï¼‰</td></tr></tbody></table><h3 id="7-6-Redisäº‹åŠ¡ä¸‰å¤§ç‰¹æ€§"><a href="#7-6-Redisäº‹åŠ¡ä¸‰å¤§ç‰¹æ€§" class="headerlink" title="7.6 Redisäº‹åŠ¡ä¸‰å¤§ç‰¹æ€§"></a>7.6 Redisäº‹åŠ¡ä¸‰å¤§ç‰¹æ€§</h3><h4 id="7-6-1-å•ç‹¬çš„éš”ç¦»æ“ä½œ"><a href="#7-6-1-å•ç‹¬çš„éš”ç¦»æ“ä½œ" class="headerlink" title="7.6.1 å•ç‹¬çš„éš”ç¦»æ“ä½œ"></a>7.6.1 å•ç‹¬çš„éš”ç¦»æ“ä½œ</h4><p><strong>ç‰¹æ€§è¯´æ˜</strong>ï¼š</p><ul><li>âœ… äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ä¼š<strong>åºåˆ—åŒ–</strong>ã€<strong>æŒ‰é¡ºåº</strong>æ‰§è¡Œ</li><li>âœ… äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œ<strong>ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘½ä»¤æ‰“æ–­</strong></li><li>âœ… Rediså•çº¿ç¨‹æ¨¡å‹ä¿è¯äº†ä¸²è¡ŒåŒ–æ‰§è¡Œ</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¢æˆ·ç«¯A</span></span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET key1 value1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCR counter</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; GET key1</span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶å®¢æˆ·ç«¯Bæ‰§è¡Œå‘½ä»¤ï¼ˆä¼šç­‰å¾…ï¼‰</span></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯B: SET key2 value2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯Aç»§ç»­</span></span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) OK</span><br><span class="line">2) (<span class="built_in">integer</span>) 1</span><br><span class="line">3) <span class="string">&quot;value1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯Açš„äº‹åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå®¢æˆ·ç«¯Bçš„å‘½ä»¤æ‰ä¼šæ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><p><strong>åº•å±‚åŸç†</strong>ï¼š</p><ul><li>Redisæ˜¯<strong>å•çº¿ç¨‹</strong>æ¨¡å‹</li><li>äº‹åŠ¡ä¸­çš„å‘½ä»¤ä¼š<strong>ä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§</strong>åœ°æ‰§è¡Œ</li><li>å‘½ä»¤æ‰§è¡ŒæœŸé—´ï¼Œ<strong>ä¸ä¼šåˆ‡æ¢åˆ°å…¶ä»–å®¢æˆ·ç«¯</strong></li></ul><h4 id="7-6-2-æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ"><a href="#7-6-2-æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ" class="headerlink" title="7.6.2 æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ"></a>7.6.2 æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ</h4><p><strong>ç‰¹æ€§è¯´æ˜</strong>ï¼š</p><ul><li>âš ï¸ Redisäº‹åŠ¡<strong>æ²¡æœ‰ä¼ ç»Ÿæ•°æ®åº“çš„éš”ç¦»çº§åˆ«æ¦‚å¿µ</strong></li><li>âš ï¸ é˜Ÿåˆ—ä¸­çš„å‘½ä»¤åœ¨<strong>æäº¤å‰éƒ½ä¸ä¼šå®é™…æ‰§è¡Œ</strong></li><li>âš ï¸ ä¸å­˜åœ¨<strong>è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</strong>ç­‰é—®é¢˜</li></ul><p><strong>å¯¹æ¯”ä¼ ç»Ÿæ•°æ®åº“</strong>ï¼š</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»è¯»</th><th>Redis</th></tr></thead><tbody><tr><td><strong>Read Uncommitted</strong></td><td>âŒ å¯èƒ½</td><td>âŒ å¯èƒ½</td><td>âŒ å¯èƒ½</td><td>-</td></tr><tr><td><strong>Read Committed</strong></td><td>âœ… ä¸ä¼š</td><td>âŒ å¯èƒ½</td><td>âŒ å¯èƒ½</td><td>-</td></tr><tr><td><strong>Repeatable Read</strong></td><td>âœ… ä¸ä¼š</td><td>âœ… ä¸ä¼š</td><td>âŒ å¯èƒ½</td><td>-</td></tr><tr><td><strong>Serializable</strong></td><td>âœ… ä¸ä¼š</td><td>âœ… ä¸ä¼š</td><td>âœ… ä¸ä¼š</td><td>âœ… ç±»ä¼¼</td></tr></tbody></table><p><strong>Redisçš„â€éš”ç¦»çº§åˆ«â€</strong>ï¼š</p><ul><li>Redisäº‹åŠ¡ç±»ä¼¼äº<strong>Serializableï¼ˆä¸²è¡ŒåŒ–ï¼‰</strong></li><li>å‘½ä»¤åœ¨<code>EXEC</code>å‰ä¸ä¼šæ‰§è¡Œï¼Œå› æ­¤<strong>ä¸ä¼šæœ‰è„è¯»</strong></li><li>å•çº¿ç¨‹æ¨¡å‹ä¿è¯äº†<strong>ä¸²è¡Œæ‰§è¡Œ</strong></li></ul><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li><code>WATCH</code>ç›‘è§†çš„keyåœ¨äº‹åŠ¡å¤–è¢«ä¿®æ”¹ï¼Œäº‹åŠ¡ä¼šå¤±è´¥</li><li>è¿™ä¸æ˜¯â€ä¸å¯é‡å¤è¯»â€ï¼Œè€Œæ˜¯<strong>ä¹è§‚é”æœºåˆ¶</strong></li></ul><h4 id="7-6-3-ä¸ä¿è¯åŸå­æ€§"><a href="#7-6-3-ä¸ä¿è¯åŸå­æ€§" class="headerlink" title="7.6.3 ä¸ä¿è¯åŸå­æ€§"></a>7.6.3 ä¸ä¿è¯åŸå­æ€§</h4><p><strong>ç‰¹æ€§è¯´æ˜</strong>ï¼š</p><ul><li>âŒ Redisäº‹åŠ¡<strong>ä¸ä¿è¯å®Œå…¨åŸå­æ€§</strong></li><li>âŒ å¦‚æœæœ‰å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œ<strong>ä¸ä¼šå›æ»š</strong></li><li>âš ï¸ å¤±è´¥çš„å‘½ä»¤ä¸æ‰§è¡Œï¼Œå…¶ä»–å‘½ä»¤ç»§ç»­æ‰§è¡Œ</li></ul><p><strong>å¯¹æ¯”ä¼ ç»Ÿæ•°æ®åº“</strong>ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th>ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡</th><th>Redisäº‹åŠ¡</th></tr></thead><tbody><tr><td><strong>åŸå­æ€§</strong></td><td>âœ… è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š</td><td>âš ï¸ éƒ¨åˆ†æˆåŠŸï¼Œéƒ¨åˆ†å¤±è´¥<br><strong>ä¸æ”¯æŒå›æ»š</strong></td></tr><tr><td><strong>å¤±è´¥å¤„ç†</strong></td><td>âœ… ROLLBACKå›æ»š</td><td>âŒ å¤±è´¥å‘½ä»¤ä¸æ‰§è¡Œ<br>æˆåŠŸå‘½ä»¤å·²ç”Ÿæ•ˆ</td></tr><tr><td><strong>é”™è¯¯ç±»å‹</strong></td><td>ç»Ÿä¸€å›æ»š</td><td>è¯­æ³•é”™è¯¯ï¼šå…¨éƒ¨å–æ¶ˆ<br>è¿è¡Œæ—¶é”™è¯¯ï¼šä¸å›æ»š</td></tr></tbody></table><p><strong>ç¤ºä¾‹ï¼ˆä¸ä¿è¯åŸå­æ€§ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SET balance 1000</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET name <span class="string">&quot;å¼ ä¸‰&quot;</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECRBY balance 500    <span class="comment"># âœ… æ­£ç¡®å‘½ä»¤</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCR name             <span class="comment"># âŒ é”™è¯¯å‘½ä»¤ï¼ˆnameæ˜¯å­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCRBY balance 300    <span class="comment"># âœ… æ­£ç¡®å‘½ä»¤</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) (<span class="built_in">integer</span>) 500                                        <span class="comment"># âœ… æˆåŠŸ</span></span><br><span class="line">2) (error) ERR value is not an <span class="built_in">integer</span> or out of range  <span class="comment"># âŒ å¤±è´¥</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 800                                        <span class="comment"># âœ… æˆåŠŸ</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; GET balance</span><br><span class="line"><span class="string">&quot;800&quot;</span>    <span class="comment"># balanceå·²è¢«ä¿®æ”¹ï¼Œä¸ä¼šå›æ»šåˆ°1000</span></span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆä¸æ”¯æŒå›æ»šï¼Ÿ</strong></p><ol><li><p><strong>æ€§èƒ½ä¼˜å…ˆ</strong>ï¼š</p><ul><li>å›æ»šæœºåˆ¶éœ€è¦è®°å½•æ“ä½œæ—¥å¿—</li><li>ä¼šå¤§å¹…é™ä½æ€§èƒ½</li></ul></li><li><p><strong>è®¾è®¡å“²å­¦</strong>ï¼š</p><ul><li>Redisè¿½æ±‚<strong>ç®€å•ã€é«˜æ•ˆ</strong></li><li>ä¸åƒä¼ ç»Ÿæ•°æ®åº“é‚£æ ·å¤æ‚</li></ul></li><li><p><strong>é”™è¯¯é¢„é˜²</strong>ï¼š</p><ul><li>è¿è¡Œæ—¶é”™è¯¯ï¼ˆå¦‚ç±»å‹é”™è¯¯ï¼‰é€šå¸¸æ˜¯<strong>ç¨‹åºbug</strong></li><li>åº”è¯¥åœ¨<strong>æµ‹è¯•é˜¶æ®µå‘ç°</strong>ï¼Œè€Œä¸æ˜¯ä¾èµ–å›æ»š</li></ul></li><li><p><strong>å•çº¿ç¨‹æ¨¡å‹</strong>ï¼š</p><ul><li>ä¸å­˜åœ¨å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜</li><li>ä¸éœ€è¦å¤æ‚çš„äº‹åŠ¡ç®¡ç†</li></ul></li></ol><p><strong>å¼€å‘å»ºè®®</strong>ï¼š</p><ul><li>âœ… åœ¨åº”ç”¨å±‚åšå¥½<strong>æ•°æ®éªŒè¯</strong></li><li>âœ… ç¡®ä¿äº‹åŠ¡ä¸­çš„å‘½ä»¤<strong>éƒ½æ˜¯åˆæ³•çš„</strong></li><li>âœ… å¯¹äºéœ€è¦ä¸¥æ ¼åŸå­æ€§çš„åœºæ™¯ï¼Œä½¿ç”¨<strong>Luaè„šæœ¬</strong></li></ul><h3 id="7-7-å®æˆ˜æ¡ˆä¾‹ï¼šRedisç§’æ€ç³»ç»Ÿ"><a href="#7-7-å®æˆ˜æ¡ˆä¾‹ï¼šRedisç§’æ€ç³»ç»Ÿ" class="headerlink" title="7.7 å®æˆ˜æ¡ˆä¾‹ï¼šRedisç§’æ€ç³»ç»Ÿ"></a>7.7 å®æˆ˜æ¡ˆä¾‹ï¼šRedisç§’æ€ç³»ç»Ÿ</h3><h4 id="7-7-1-ç§’æ€åœºæ™¯åˆ†æ"><a href="#7-7-1-ç§’æ€åœºæ™¯åˆ†æ" class="headerlink" title="7.7.1 ç§’æ€åœºæ™¯åˆ†æ"></a>7.7.1 ç§’æ€åœºæ™¯åˆ†æ</h4><p><strong>ä¸šåŠ¡éœ€æ±‚</strong>ï¼š</p><ul><li>å•†å“åº“å­˜æœ‰é™ï¼ˆå¦‚100ä»¶ï¼‰</li><li>å¤§é‡ç”¨æˆ·åŒæ—¶æŠ¢è´­ï¼ˆå¦‚10000äººï¼‰</li><li>æ¯ä¸ªç”¨æˆ·åªèƒ½è´­ä¹°ä¸€æ¬¡</li><li>åº“å­˜ä¸èƒ½è¶…å–</li></ul><p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼š</p><ol><li><strong>è¶…å–é—®é¢˜</strong>ï¼šå¹¶å‘æ‰£å‡åº“å­˜ï¼Œå¯èƒ½å¯¼è‡´åº“å­˜ä¸ºè´Ÿ</li><li><strong>é‡å¤è´­ä¹°</strong>ï¼šåŒä¸€ç”¨æˆ·å¤šæ¬¡è´­ä¹°</li><li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šé«˜å¹¶å‘ä¸‹çš„å“åº”é€Ÿåº¦</li></ol><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/%E7%A7%92%E6%9D%80%E6%A1%88%E4%BE%8B.png" alt="ç§’æ€æ¡ˆä¾‹"></p><h4 id="7-7-2-æ–¹æ¡ˆ1ï¼šåŸºç¡€äº‹åŠ¡æ–¹æ¡ˆï¼ˆæœ‰è¶…å–é—®é¢˜ï¼‰"><a href="#7-7-2-æ–¹æ¡ˆ1ï¼šåŸºç¡€äº‹åŠ¡æ–¹æ¡ˆï¼ˆæœ‰è¶…å–é—®é¢˜ï¼‰" class="headerlink" title="7.7.2 æ–¹æ¡ˆ1ï¼šåŸºç¡€äº‹åŠ¡æ–¹æ¡ˆï¼ˆæœ‰è¶…å–é—®é¢˜ï¼‰"></a>7.7.2 æ–¹æ¡ˆ1ï¼šåŸºç¡€äº‹åŠ¡æ–¹æ¡ˆï¼ˆæœ‰è¶…å–é—®é¢˜ï¼‰</h4><p><strong>å®ç°æ€è·¯</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">seckill</span><span class="params">(String userId, String productId)</span> &#123;</span><br><span class="line">    <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">stockKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + productId + <span class="string">&quot;:qt&quot;</span>;     <span class="comment">// åº“å­˜key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + productId + <span class="string">&quot;:usr&quot;</span>;      <span class="comment">// ç”¨æˆ·é›†åˆkey</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. æ£€æŸ¥åº“å­˜</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">stock</span> <span class="operator">=</span> jedis.get(stockKey);</span><br><span class="line">    <span class="keyword">if</span> (stock == <span class="literal">null</span> || Integer.parseInt(stock) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç§’æ€å·²ç»“æŸ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²è´­ä¹°</span></span><br><span class="line">    <span class="keyword">if</span> (jedis.sismember(userKey, userId)) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‚¨å·²å‚åŠ è¿‡ç§’æ€&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. å‡åº“å­˜ï¼Œè®°å½•ç”¨æˆ·</span></span><br><span class="line">    jedis.decr(stockKey);</span><br><span class="line">    jedis.sadd(userKey, userId);</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;ç§’æ€æˆåŠŸ&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜åˆ†æ</strong>ï¼šâŒ <strong>å­˜åœ¨è¶…å–é£é™©</strong></p><table><thead><tr><th>æ—¶é—´</th><th>çº¿ç¨‹A</th><th>çº¿ç¨‹B</th><th>åº“å­˜</th></tr></thead><tbody><tr><td>T1</td><td>è¯»å–åº“å­˜ï¼š1</td><td>-</td><td>1</td></tr><tr><td>T2</td><td>-</td><td>è¯»å–åº“å­˜ï¼š1</td><td>1</td></tr><tr><td>T3</td><td>åˆ¤æ–­ï¼š1 &gt; 0 âœ…</td><td>-</td><td>1</td></tr><tr><td>T4</td><td>-</td><td>åˆ¤æ–­ï¼š1 &gt; 0 âœ…</td><td>1</td></tr><tr><td>T5</td><td>æ‰£å‡åº“å­˜ï¼š0</td><td>-</td><td>0</td></tr><tr><td>T6</td><td>-</td><td>æ‰£å‡åº“å­˜ï¼š-1</td><td>-1ï¼ˆè¶…å–ï¼ï¼‰</td></tr></tbody></table><h4 id="7-7-3-æ–¹æ¡ˆ2ï¼šä¹è§‚é”æ–¹æ¡ˆï¼ˆWATCHï¼‰"><a href="#7-7-3-æ–¹æ¡ˆ2ï¼šä¹è§‚é”æ–¹æ¡ˆï¼ˆWATCHï¼‰" class="headerlink" title="7.7.3 æ–¹æ¡ˆ2ï¼šä¹è§‚é”æ–¹æ¡ˆï¼ˆWATCHï¼‰"></a>7.7.3 æ–¹æ¡ˆ2ï¼šä¹è§‚é”æ–¹æ¡ˆï¼ˆWATCHï¼‰</h4><p><strong>å®ç°æ€è·¯</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">seckillWithWatch</span><span class="params">(String userId, String productId)</span> &#123;</span><br><span class="line">    <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">stockKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + productId + <span class="string">&quot;:qt&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + productId + <span class="string">&quot;:usr&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤šé‡è¯•3æ¬¡ï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 1. ç›‘è§†åº“å­˜keyï¼ˆä¹è§‚é”ï¼‰</span></span><br><span class="line">        jedis.watch(stockKey);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ£€æŸ¥åº“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">stock</span> <span class="operator">=</span> jedis.get(stockKey);</span><br><span class="line">        <span class="keyword">if</span> (stock == <span class="literal">null</span> || Integer.parseInt(stock) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            jedis.unwatch();</span><br><span class="line">            System.out.println(<span class="string">&quot;ç§’æ€å·²ç»“æŸ&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²è´­ä¹°</span></span><br><span class="line">        <span class="keyword">if</span> (jedis.sismember(userKey, userId)) &#123;</span><br><span class="line">            jedis.unwatch();</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‚¨å·²å‚åŠ è¿‡ç§’æ€&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. å¼€å¯äº‹åŠ¡</span></span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">        tx.decr(stockKey);           <span class="comment">// å‡åº“å­˜</span></span><br><span class="line">        tx.sadd(userKey, userId);    <span class="comment">// è®°å½•ç”¨æˆ·</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. æäº¤äº‹åŠ¡</span></span><br><span class="line">        List&lt;Object&gt; result = tx.exec();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 6. åˆ¤æ–­äº‹åŠ¡æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span> (result != <span class="literal">null</span> &amp;&amp; !result.isEmpty()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç§’æ€æˆåŠŸ&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 7. äº‹åŠ¡å¤±è´¥ï¼Œé‡è¯•</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æŠ¢è´­å¤±è´¥ï¼Œæ­£åœ¨é‡è¯•...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;æŠ¢è´­å¤±è´¥ï¼Œè¯·ç¨åå†è¯•&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/%E8%B6%85%E5%8D%96%E9%97%AE%E9%A2%98.png" alt="ä¹è§‚é”è§£å†³è¶…å–"></p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>âœ… è§£å†³äº†è¶…å–é—®é¢˜</li><li>âœ… é«˜å¹¶å‘ä¸‹æ€§èƒ½è¾ƒå¥½</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>âŒ é«˜å¹¶å‘æ—¶<strong>å†²çªç‡é«˜</strong>ï¼Œå¤§é‡ç”¨æˆ·å¤±è´¥</li><li>âŒ éœ€è¦é‡è¯•æœºåˆ¶ï¼Œ<strong>ç”¨æˆ·ä½“éªŒå·®</strong></li><li>âŒ æç«¯æƒ…å†µä¸‹å¯èƒ½<strong>æ— æ³•ç§’æ€æˆåŠŸ</strong></li></ul><h4 id="7-7-4-æ–¹æ¡ˆ3ï¼šLuaè„šæœ¬æ–¹æ¡ˆï¼ˆæœ€ä¼˜ï¼‰"><a href="#7-7-4-æ–¹æ¡ˆ3ï¼šLuaè„šæœ¬æ–¹æ¡ˆï¼ˆæœ€ä¼˜ï¼‰" class="headerlink" title="7.7.4 æ–¹æ¡ˆ3ï¼šLuaè„šæœ¬æ–¹æ¡ˆï¼ˆæœ€ä¼˜ï¼‰"></a>7.7.4 æ–¹æ¡ˆ3ï¼šLuaè„šæœ¬æ–¹æ¡ˆï¼ˆæœ€ä¼˜ï¼‰</h4><p><strong>Luaè„šæœ¬ä»‹ç»</strong>ï¼š</p><p><strong>ä»€ä¹ˆæ˜¯Luaï¼Ÿ</strong></p><ul><li>Luaæ˜¯ä¸€ä¸ª<strong>å°å·§çš„è„šæœ¬è¯­è¨€</strong></li><li>å®Œæ•´çš„Luaè§£é‡Šå™¨ä»…<strong>200KB</strong></li><li>å¯ä»¥è¢«C&#x2F;C++è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨C&#x2F;C++å‡½æ•°</li><li>å¹¿æ³›ç”¨äº<strong>åµŒå…¥å¼è„šæœ¬</strong>ï¼ˆæ¸¸æˆã€åº”ç”¨é…ç½®ç­‰ï¼‰</li></ul><p><strong>åº”ç”¨æ¡ˆä¾‹</strong>ï¼š</p><ul><li>ğŸ® é­”å…½äº‰éœ¸åœ°å›¾</li><li>ğŸ® é­”å…½ä¸–ç•Œæ’ä»¶</li><li>ğŸ® åšå¾·ä¹‹é—¨</li><li>ğŸ® æ„¤æ€’çš„å°é¸Ÿ</li></ul><p><strong>Luaè„šæœ¬åœ¨Redisä¸­çš„ä¼˜åŠ¿</strong>ï¼š</p><table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åŸå­æ€§</strong></td><td>Luaè„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œï¼Œ<strong>ä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’é˜Ÿ</strong></td></tr><tr><td><strong>å‡å°‘ç½‘ç»œå¼€é”€</strong></td><td>å¤šä¸ªRediså‘½ä»¤æ‰“åŒ…æˆä¸€ä¸ªè„šæœ¬ï¼Œ<strong>å‡å°‘ç½‘ç»œå¾€è¿”</strong></td></tr><tr><td><strong>å¯å¤ç”¨</strong></td><td>è„šæœ¬å¯ä»¥é¢„å…ˆç¼–å†™ï¼Œå¤šæ¬¡è°ƒç”¨</td></tr><tr><td><strong>æœåŠ¡å™¨ç«¯æ‰§è¡Œ</strong></td><td>è„šæœ¬åœ¨RedisæœåŠ¡å™¨æ‰§è¡Œï¼Œ<strong>å‡å°‘å®¢æˆ·ç«¯å‹åŠ›</strong></td></tr></tbody></table><p><strong>ç‰ˆæœ¬è¦æ±‚</strong>ï¼šRedis 2.6+</p><h4 id="Luaè„šæœ¬ä¸ºä»€ä¹ˆèƒ½ä¿è¯åŸå­æ€§ï¼Ÿ"><a href="#Luaè„šæœ¬ä¸ºä»€ä¹ˆèƒ½ä¿è¯åŸå­æ€§ï¼Ÿ" class="headerlink" title="Luaè„šæœ¬ä¸ºä»€ä¹ˆèƒ½ä¿è¯åŸå­æ€§ï¼Ÿ"></a>Luaè„šæœ¬ä¸ºä»€ä¹ˆèƒ½ä¿è¯åŸå­æ€§ï¼Ÿ</h4><p><strong>æ ¸å¿ƒåŸç†ï¼šRediså•çº¿ç¨‹æ¨¡å‹ + è„šæœ¬æ‰§è¡Œæœºåˆ¶</strong></p><p><strong>1. Rediså•çº¿ç¨‹äº‹ä»¶å¾ªç¯</strong></p><p>Redisé‡‡ç”¨<strong>å•çº¿ç¨‹äº‹ä»¶å¾ªç¯æ¨¡å‹</strong>ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­é¡ºåºæ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®¢æˆ·ç«¯Aè¯·æ±‚ â†’ å‘½ä»¤é˜Ÿåˆ— â†’ Redisä¸»çº¿ç¨‹ï¼ˆå•çº¿ç¨‹ï¼‰â†’ æ‰§è¡Œå‘½ä»¤ â†’ è¿”å›ç»“æœ</span><br><span class="line">å®¢æˆ·ç«¯Bè¯·æ±‚ â†’ å‘½ä»¤é˜Ÿåˆ— â†’ Redisä¸»çº¿ç¨‹ï¼ˆå•çº¿ç¨‹ï¼‰â†’ æ‰§è¡Œå‘½ä»¤ â†’ è¿”å›ç»“æœ</span><br><span class="line">å®¢æˆ·ç«¯Cè¯·æ±‚ â†’ å‘½ä»¤é˜Ÿåˆ— â†’ Redisä¸»çº¿ç¨‹ï¼ˆå•çº¿ç¨‹ï¼‰â†’ æ‰§è¡Œå‘½ä»¤ â†’ è¿”å›ç»“æœ</span><br></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li>âœ… åŒä¸€æ—¶åˆ»<strong>åªæœ‰ä¸€ä¸ªå‘½ä»¤åœ¨æ‰§è¡Œ</strong></li><li>âœ… å‘½ä»¤ä¹‹é—´<strong>ä¸ä¼šå¹¶å‘æ‰§è¡Œ</strong></li><li>âœ… ä¸å­˜åœ¨<strong>çº¿ç¨‹åˆ‡æ¢</strong>å’Œ<strong>ç«æ€æ¡ä»¶</strong></li></ul><p><strong>2. Luaè„šæœ¬çš„æ‰§è¡Œæœºåˆ¶</strong></p><p>å½“Redisæ‰§è¡ŒLuaè„šæœ¬æ—¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[å®¢æˆ·ç«¯å‘é€Luaè„šæœ¬]</span><br><span class="line">    â†“</span><br><span class="line">[Redisæ¥æ”¶è„šæœ¬]</span><br><span class="line">    â†“</span><br><span class="line">[Redisè§£æè„šæœ¬]</span><br><span class="line">    â†“</span><br><span class="line">[Rediså°†æ•´ä¸ªè„šæœ¬ä½œä¸ºä¸€ä¸ªä»»åŠ¡æ”¾å…¥å‘½ä»¤é˜Ÿåˆ—]</span><br><span class="line">    â†“</span><br><span class="line">[Redisä¸»çº¿ç¨‹ä»é˜Ÿåˆ—å–å‡ºè„šæœ¬ä»»åŠ¡]</span><br><span class="line">    â†“</span><br><span class="line">[Redisæ‰§è¡Œè„šæœ¬ä¸­çš„æ‰€æœ‰å‘½ä»¤ï¼ˆè¿ç»­æ‰§è¡Œï¼Œä¸ä¸­æ–­ï¼‰]</span><br><span class="line">    â†“</span><br><span class="line">[è¿”å›è„šæœ¬æ‰§è¡Œç»“æœ]</span><br></pre></td></tr></table></figure><p><strong>å…³é”®ç‰¹æ€§</strong>ï¼š</p><ol><li><p><strong>è„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“</strong>ï¼š</p><ul><li>Luaè„šæœ¬è¢«Redisè§†ä¸º<strong>ä¸€ä¸ªå®Œæ•´çš„å‘½ä»¤å•å…ƒ</strong></li><li>è„šæœ¬ä¸­çš„æ‰€æœ‰Rediså‘½ä»¤ä¼š<strong>è¿ç»­æ‰§è¡Œ</strong>ï¼Œä¸­é—´ä¸ä¼šæ’å…¥å…¶ä»–å®¢æˆ·ç«¯çš„å‘½ä»¤</li></ul></li><li><p><strong>æ‰§è¡ŒæœŸé—´ä¸å“åº”å…¶ä»–è¯·æ±‚</strong>ï¼š</p><ul><li>è„šæœ¬æ‰§è¡ŒæœŸé—´ï¼ŒRedisä¸»çº¿ç¨‹<strong>ä¸ä¼šå¤„ç†å…¶ä»–å‘½ä»¤</strong></li><li>ç›´åˆ°è„šæœ¬æ‰§è¡Œå®Œæ¯•ï¼Œæ‰ä¼šå¤„ç†ä¸‹ä¸€ä¸ªå‘½ä»¤</li></ul></li><li><p><strong>è„šæœ¬å†…éƒ¨å‘½ä»¤çš„åŸå­æ€§</strong>ï¼š</p><ul><li>è„šæœ¬å†…çš„å¤šä¸ª<code>redis.call()</code>å‘½ä»¤ä¼š<strong>è¿ç»­æ‰§è¡Œ</strong></li><li>ä¸ä¼šåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«å…¶ä»–å‘½ä»¤æ‰“æ–­</li></ul></li></ol><p><strong>3. å¯¹æ¯”ï¼šMULTI&#x2F;EXEC vs Luaè„šæœ¬</strong></p><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>MULTI&#x2F;EXECäº‹åŠ¡</th><th>Luaè„šæœ¬</th></tr></thead><tbody><tr><td><strong>æ‰§è¡Œæ–¹å¼</strong></td><td>å‘½ä»¤å…ˆå…¥é˜Ÿï¼ŒEXECæ—¶æ‰¹é‡æ‰§è¡Œ</td><td>è„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“ç«‹å³æ‰§è¡Œ</td></tr><tr><td><strong>åŸå­æ€§ä¿è¯</strong></td><td>âš ï¸ éƒ¨åˆ†åŸå­æ€§ï¼ˆæ‰§è¡Œé˜¶æ®µå¯èƒ½éƒ¨åˆ†å¤±è´¥ï¼‰</td><td>âœ… <strong>å®Œå…¨åŸå­æ€§</strong>ï¼ˆè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼‰</td></tr><tr><td><strong>æ¡ä»¶åˆ¤æ–­</strong></td><td>âŒ ä¸æ”¯æŒï¼ˆæ— æ³•æ ¹æ®ä¸­é—´ç»“æœå†³å®šï¼‰</td><td>âœ… æ”¯æŒï¼ˆif&#x2F;else&#x2F;å¾ªç¯ï¼‰</td></tr><tr><td><strong>æ‰§è¡Œæ—¶æœº</strong></td><td>å»¶è¿Ÿæ‰§è¡Œï¼ˆEXECæ—¶ï¼‰</td><td>ç«‹å³æ‰§è¡Œ</td></tr><tr><td><strong>å¹¶å‘æ§åˆ¶</strong></td><td>éœ€è¦WATCHï¼ˆä¹è§‚é”ï¼‰</td><td>å•çº¿ç¨‹è‡ªç„¶ä¿è¯</td></tr><tr><td><strong>ä¸­é—´ç»“æœ</strong></td><td>âŒ æ— æ³•è·å–</td><td>âœ… å¯ä»¥è·å–å’Œä½¿ç”¨</td></tr></tbody></table><p><strong>4. æ‰§è¡Œæµç¨‹å¯¹æ¯”</strong></p><p><strong>MULTI&#x2F;EXECæ‰§è¡Œæµç¨‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ—¶é—´çº¿ï¼š</span><br><span class="line">T1: å®¢æˆ·ç«¯Aå‘é€ MULTI</span><br><span class="line">T2: å®¢æˆ·ç«¯Aå‘é€ SET key1 value1 â†’ QUEUEDï¼ˆå…¥é˜Ÿï¼‰</span><br><span class="line">T3: å®¢æˆ·ç«¯Bå‘é€ SET key2 value2 â†’ ç«‹å³æ‰§è¡Œ âœ…ï¼ˆå¯ä»¥æ’é˜Ÿï¼ï¼‰</span><br><span class="line">T4: å®¢æˆ·ç«¯Aå‘é€ SET key3 value3 â†’ QUEUEDï¼ˆå…¥é˜Ÿï¼‰</span><br><span class="line">T5: å®¢æˆ·ç«¯Aå‘é€ EXEC â†’ æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜</strong>ï¼šå®¢æˆ·ç«¯Bçš„å‘½ä»¤å¯ä»¥åœ¨å®¢æˆ·ç«¯Açš„äº‹åŠ¡ç»„é˜Ÿé˜¶æ®µæ‰§è¡Œï¼Œ<strong>å¯èƒ½å½±å“äº‹åŠ¡çš„ä¸€è‡´æ€§</strong>ã€‚</p><p><strong>Luaè„šæœ¬æ‰§è¡Œæµç¨‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æ—¶é—´çº¿ï¼š</span><br><span class="line">T1: å®¢æˆ·ç«¯Aå‘é€ Luaè„šæœ¬ï¼ˆåŒ…å«å¤šä¸ªredis.callï¼‰</span><br><span class="line">T2: Rediså¼€å§‹æ‰§è¡Œè„šæœ¬</span><br><span class="line">T3: è„šæœ¬å†…éƒ¨æ‰§è¡Œ redis.call(&quot;SET&quot;, &quot;key1&quot;, &quot;value1&quot;)</span><br><span class="line">T4: è„šæœ¬å†…éƒ¨æ‰§è¡Œ redis.call(&quot;SET&quot;, &quot;key2&quot;, &quot;value2&quot;)</span><br><span class="line">T5: è„šæœ¬å†…éƒ¨æ‰§è¡Œ redis.call(&quot;SET&quot;, &quot;key3&quot;, &quot;value3&quot;)</span><br><span class="line">T6: è„šæœ¬æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›ç»“æœ</span><br><span class="line">T7: å®¢æˆ·ç«¯Bå‘é€ SET key4 value4 â†’ ç°åœ¨æ‰æ‰§è¡Œ âœ…</span><br></pre></td></tr></table></figure><p><strong>å…³é”®</strong>ï¼šå®¢æˆ·ç«¯Bçš„å‘½ä»¤å¿…é¡»<strong>ç­‰å¾…è„šæœ¬æ‰§è¡Œå®Œæ¯•</strong>ï¼Œæ— æ³•åœ¨è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­æ’é˜Ÿã€‚</p><p><strong>5. å®é™…éªŒè¯ç¤ºä¾‹</strong></p><p><strong>åœºæ™¯ï¼šä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶æ“ä½œåŒä¸€ä¸ªkey</strong></p><p><strong>ä½¿ç”¨MULTI&#x2F;EXECï¼ˆå¯èƒ½æœ‰é—®é¢˜ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¢æˆ·ç«¯A</span></span><br><span class="line">127.0.0.1:6379&gt; WATCH balance</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; GET balance</span><br><span class="line"><span class="string">&quot;100&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECRBY balance 50</span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶å®¢æˆ·ç«¯Bå¯ä»¥ä¿®æ”¹balance</span></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯B: SET balance 200</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">(nil)    <span class="comment"># äº‹åŠ¡å¤±è´¥ï¼Œå› ä¸ºbalanceè¢«ä¿®æ”¹äº†</span></span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨Luaè„šæœ¬ï¼ˆå®Œå…¨åŸå­ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¢æˆ·ç«¯A</span></span><br><span class="line">127.0.0.1:6379&gt; EVAL <span class="string">&quot;local balance = redis.call(&#x27;get&#x27;, KEYS[1]); if tonumber(balance) &gt;= 50 then redis.call(&#x27;decrby&#x27;, KEYS[1], 50); return 1; else return 0; end;&quot;</span> 1 balance</span><br><span class="line">(<span class="built_in">integer</span>) 1    <span class="comment"># æˆåŠŸ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å³ä½¿å®¢æˆ·ç«¯BåŒæ—¶å‘é€å‘½ä»¤ï¼Œä¹Ÿå¿…é¡»ç­‰å¾…è„šæœ¬æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line"><span class="comment"># è„šæœ¬æ‰§è¡ŒæœŸé—´ï¼Œbalanceä¸ä¼šè¢«å…¶ä»–å‘½ä»¤ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><p><strong>6. åº•å±‚å®ç°åŸç†</strong></p><p><strong>Redisæºç å±‚é¢çš„ä¿è¯</strong>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Rediså¤„ç†Luaè„šæœ¬çš„ä¼ªä»£ç </span></span><br><span class="line"><span class="type">void</span> <span class="title function_">processLuaScript</span><span class="params">(lua_script)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. å°†è„šæœ¬æ”¾å…¥å‘½ä»¤é˜Ÿåˆ—</span></span><br><span class="line">    addToCommandQueue(lua_script);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. ä¸»çº¿ç¨‹ä»é˜Ÿåˆ—å–å‡ºè„šæœ¬</span></span><br><span class="line">    script = getFromCommandQueue();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. æ‰§è¡Œè„šæœ¬ï¼ˆå…³é”®ï¼šè¿™æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼‰</span></span><br><span class="line">    <span class="comment">// è„šæœ¬æ‰§è¡ŒæœŸé—´ï¼Œä¸»çº¿ç¨‹ä¸ä¼šå¤„ç†å…¶ä»–å‘½ä»¤</span></span><br><span class="line">    result = executeLuaScript(script);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. è„šæœ¬æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…³é”®æœºåˆ¶</strong>ï¼š</p><ol><li><p><strong>è„šæœ¬æ‰§è¡Œé”</strong>ï¼š</p><ul><li>Redisåœ¨æ‰§è¡ŒLuaè„šæœ¬æ—¶ï¼Œä¼š<strong>é”å®šä¸»çº¿ç¨‹</strong></li><li>ç¡®ä¿è„šæœ¬æ‰§è¡ŒæœŸé—´ä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ‰“æ–­</li></ul></li><li><p><strong>å‘½ä»¤é˜Ÿåˆ—é¡ºåº</strong>ï¼š</p><ul><li>æ‰€æœ‰å‘½ä»¤ï¼ˆåŒ…æ‹¬Luaè„šæœ¬ï¼‰éƒ½è¿›å…¥<strong>åŒä¸€ä¸ªå‘½ä»¤é˜Ÿåˆ—</strong></li><li>é˜Ÿåˆ—ä¿è¯**FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰**é¡ºåº</li><li>è„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä¸ä¼šè¢«æ‹†åˆ†</li></ul></li><li><p><strong>å•çº¿ç¨‹æ‰§è¡Œ</strong>ï¼š</p><ul><li>Redisä¸»çº¿ç¨‹æ˜¯<strong>å•çº¿ç¨‹</strong>çš„</li><li>åŒä¸€æ—¶åˆ»åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡</li><li>è„šæœ¬æ‰§è¡Œæ—¶ï¼Œå…¶ä»–ä»»åŠ¡å¿…é¡»ç­‰å¾…</li></ul></li></ol><p><strong>7. æ³¨æ„äº‹é¡¹</strong></p><p><strong>âš ï¸ è„šæœ¬æ‰§è¡Œæ—¶é—´é™åˆ¶</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redisé»˜è®¤è„šæœ¬æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼š5ç§’</span></span><br><span class="line"><span class="comment"># å¦‚æœè„šæœ¬æ‰§è¡Œè¶…è¿‡5ç§’ï¼ŒRedisä¼šä¸­æ–­è„šæœ¬æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥é€šè¿‡é…ç½®ä¿®æ”¹</span></span><br><span class="line">lua-time-limit 5000  <span class="comment"># å•ä½ï¼šæ¯«ç§’</span></span><br></pre></td></tr></table></figure><p><strong>âš ï¸ è„šæœ¬é˜»å¡é—®é¢˜</strong>ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- âŒ é”™è¯¯ï¼šè„šæœ¬ä¸­åŒ…å«é˜»å¡æ“ä½œ</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">    redis.call(<span class="string">&quot;get&quot;</span>, <span class="string">&quot;key&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¿™ä¼šå¯¼è‡´Redisä¸»çº¿ç¨‹è¢«é˜»å¡ï¼Œæ— æ³•å¤„ç†å…¶ä»–è¯·æ±‚</span></span><br></pre></td></tr></table></figure><p><strong>âš ï¸ è„šæœ¬ä¸­çš„é”™è¯¯å¤„ç†</strong>ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- âœ… å¥½çš„åšæ³•ï¼šè„šæœ¬å†…éƒ¨å¤„ç†é”™è¯¯</span></span><br><span class="line"><span class="keyword">local</span> result = redis.call(<span class="string">&quot;get&quot;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> result == <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>  <span class="comment">-- è¿”å›é”™è¯¯ç </span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">tonumber</span>(result)</span><br></pre></td></tr></table></figure><h4 id="Luaè„šæœ¬ä¼šå‡ºç°éƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å¤±è´¥å—ï¼Ÿ"><a href="#Luaè„šæœ¬ä¼šå‡ºç°éƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å¤±è´¥å—ï¼Ÿ" class="headerlink" title="Luaè„šæœ¬ä¼šå‡ºç°éƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å¤±è´¥å—ï¼Ÿ"></a>Luaè„šæœ¬ä¼šå‡ºç°éƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å¤±è´¥å—ï¼Ÿ</h4><p><strong>ç­”æ¡ˆï¼šå–å†³äºä½ ä½¿ç”¨çš„å‡½æ•°ï¼</strong></p><p><strong>å…³é”®åŒºåˆ«ï¼š<code>redis.call()</code> vs <code>redis.pcall()</code></strong></p><table><thead><tr><th>å‡½æ•°</th><th>é”™è¯¯å¤„ç†</th><th>è¡Œä¸º</th></tr></thead><tbody><tr><td><strong><code>redis.call()</code></strong></td><td>âŒ <strong>æŠ›å‡ºé”™è¯¯</strong></td><td>å‘½ä»¤å¤±è´¥æ—¶ï¼Œ<strong>ç«‹å³ä¸­æ–­è„šæœ¬æ‰§è¡Œ</strong>ï¼Œæ•´ä¸ªè„šæœ¬å¤±è´¥</td></tr><tr><td><strong><code>redis.pcall()</code></strong></td><td>âœ… <strong>æ•è·é”™è¯¯</strong></td><td>å‘½ä»¤å¤±è´¥æ—¶ï¼Œ<strong>è¿”å›é”™è¯¯å¯¹è±¡</strong>ï¼Œè„šæœ¬ç»§ç»­æ‰§è¡Œ</td></tr></tbody></table><p><strong>1. ä½¿ç”¨ <code>redis.call()</code> - å…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å¤±è´¥</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç¤ºä¾‹è„šæœ¬</span></span><br><span class="line"><span class="keyword">local</span> result1 = redis.call(<span class="string">&quot;set&quot;</span>, <span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>)  <span class="comment">-- âœ… æˆåŠŸ</span></span><br><span class="line"><span class="keyword">local</span> result2 = redis.call(<span class="string">&quot;incr&quot;</span>, <span class="string">&quot;key2&quot;</span>)            <span class="comment">-- âœ… æˆåŠŸï¼ˆkey2ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸º0å†åŠ 1ï¼‰</span></span><br><span class="line"><span class="keyword">local</span> result3 = redis.call(<span class="string">&quot;incr&quot;</span>, <span class="string">&quot;key1&quot;</span>)           <span class="comment">-- âŒ å¤±è´¥ï¼ˆkey1æ˜¯å­—ç¬¦ä¸²ï¼Œä¸èƒ½INCRï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¦‚æœresult3å¤±è´¥ï¼Œæ•´ä¸ªè„šæœ¬ä¼šä¸­æ–­ï¼Œkey1å’Œkey2çš„ä¿®æ”¹éƒ½ä¸ä¼šç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure><p><strong>å®é™…æµ‹è¯•</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆè®¾ç½®key1ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">127.0.0.1:6379&gt; SET key1 <span class="string">&quot;value1&quot;</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œè„šæœ¬ï¼ˆä½¿ç”¨redis.callï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; EVAL <span class="string">&quot;redis.call(&#x27;set&#x27;, &#x27;key1&#x27;, &#x27;value1&#x27;); redis.call(&#x27;incr&#x27;, &#x27;key2&#x27;); redis.call(&#x27;incr&#x27;, &#x27;key1&#x27;);&quot;</span> 0</span><br><span class="line">(error) ERR value is not an <span class="built_in">integer</span> or out of range</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç»“æœ</span></span><br><span class="line">127.0.0.1:6379&gt; GET key1</span><br><span class="line"><span class="string">&quot;value1&quot;</span>    <span class="comment"># âŒ ç¬¬ä¸€ä¸ªSETæ²¡æœ‰ç”Ÿæ•ˆï¼ˆå› ä¸ºè„šæœ¬å¤±è´¥ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; GET key2</span><br><span class="line">(nil)       <span class="comment"># âŒ key2ä¹Ÿæ²¡æœ‰åˆ›å»ºï¼ˆå› ä¸ºè„šæœ¬å¤±è´¥ï¼‰</span></span><br></pre></td></tr></table></figure><p><strong>ç»“è®º</strong>ï¼šä½¿ç”¨<code>redis.call()</code>æ—¶ï¼Œ<strong>ä»»ä½•å‘½ä»¤å¤±è´¥éƒ½ä¼šå¯¼è‡´æ•´ä¸ªè„šæœ¬å¤±è´¥</strong>ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¸ä¼šç”Ÿæ•ˆï¼ˆå…¨éƒ¨å›æ»šï¼‰ã€‚</p><p><strong>2. ä½¿ç”¨ <code>redis.pcall()</code> - å¯èƒ½å‡ºç°éƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å¤±è´¥</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç¤ºä¾‹è„šæœ¬</span></span><br><span class="line"><span class="keyword">local</span> result1 = redis.<span class="built_in">pcall</span>(<span class="string">&quot;set&quot;</span>, <span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>)  <span class="comment">-- âœ… æˆåŠŸ</span></span><br><span class="line"><span class="keyword">local</span> result2 = redis.<span class="built_in">pcall</span>(<span class="string">&quot;incr&quot;</span>, <span class="string">&quot;key2&quot;</span>)            <span class="comment">-- âœ… æˆåŠŸ</span></span><br><span class="line"><span class="keyword">local</span> result3 = redis.<span class="built_in">pcall</span>(<span class="string">&quot;incr&quot;</span>, <span class="string">&quot;key1&quot;</span>)            <span class="comment">-- âŒ å¤±è´¥ï¼Œä½†è¿”å›é”™è¯¯å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- result3ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼Œä½†è„šæœ¬ä¼šç»§ç»­æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">type</span>(result3) == <span class="string">&quot;table&quot;</span> <span class="keyword">and</span> result3.err <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- å¤„ç†é”™è¯¯</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p><strong>å®é™…æµ‹è¯•</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆè®¾ç½®key1ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">127.0.0.1:6379&gt; SET key1 <span class="string">&quot;value1&quot;</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œè„šæœ¬ï¼ˆä½¿ç”¨redis.pcallï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; EVAL <span class="string">&quot;redis.pcall(&#x27;set&#x27;, &#x27;key1&#x27;, &#x27;newvalue&#x27;); redis.pcall(&#x27;incr&#x27;, &#x27;key2&#x27;); local result = redis.pcall(&#x27;incr&#x27;, &#x27;key1&#x27;); return result;&quot;</span> 0</span><br><span class="line">(error) ERR value is not an <span class="built_in">integer</span> or out of range</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç»“æœ</span></span><br><span class="line">127.0.0.1:6379&gt; GET key1</span><br><span class="line"><span class="string">&quot;newvalue&quot;</span>  <span class="comment"># âœ… ç¬¬ä¸€ä¸ªSETæˆåŠŸäº†ï¼</span></span><br><span class="line">127.0.0.1:6379&gt; GET key2</span><br><span class="line"><span class="string">&quot;1&quot;</span>         <span class="comment"># âœ… key2ä¹Ÿåˆ›å»ºå¹¶è‡ªå¢äº†ï¼</span></span><br></pre></td></tr></table></figure><p><strong>ç»“è®º</strong>ï¼šä½¿ç”¨<code>redis.pcall()</code>æ—¶ï¼Œ<strong>å¤±è´¥çš„å‘½ä»¤ä¸ä¼šä¸­æ–­è„šæœ¬</strong>ï¼Œå·²æ‰§è¡Œçš„å‘½ä»¤ä¼šç”Ÿæ•ˆï¼ˆéƒ¨åˆ†æˆåŠŸï¼‰ã€‚</p><p><strong>3. å®Œæ•´çš„é”™è¯¯å¤„ç†ç¤ºä¾‹</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è½¬è´¦è„šæœ¬ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰</span></span><br><span class="line"><span class="keyword">local</span> balance1 = redis.<span class="built_in">pcall</span>(<span class="string">&quot;get&quot;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">local</span> balance2 = redis.<span class="built_in">pcall</span>(<span class="string">&quot;get&quot;</span>, KEYS[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ£€æŸ¥é”™è¯¯</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">type</span>(balance1) == <span class="string">&quot;table&quot;</span> <span class="keyword">and</span> balance1.err <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> &#123;err = <span class="string">&quot;è´¦æˆ·1ä¸å­˜åœ¨&quot;</span>&#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">type</span>(balance2) == <span class="string">&quot;table&quot;</span> <span class="keyword">and</span> balance2.err <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> &#123;err = <span class="string">&quot;è´¦æˆ·2ä¸å­˜åœ¨&quot;</span>&#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è½¬æ¢ä¸ºæ•°å­—</span></span><br><span class="line"><span class="keyword">local</span> bal1 = <span class="built_in">tonumber</span>(balance1) <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">local</span> bal2 = <span class="built_in">tonumber</span>(balance2) <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ£€æŸ¥ä½™é¢</span></span><br><span class="line"><span class="keyword">if</span> bal1 &lt; <span class="built_in">tonumber</span>(ARGV[<span class="number">1</span>]) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> &#123;err = <span class="string">&quot;ä½™é¢ä¸è¶³&quot;</span>&#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œè½¬è´¦</span></span><br><span class="line"><span class="keyword">local</span> result1 = redis.<span class="built_in">pcall</span>(<span class="string">&quot;decrby&quot;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">local</span> result2 = redis.<span class="built_in">pcall</span>(<span class="string">&quot;incrby&quot;</span>, KEYS[<span class="number">2</span>], ARGV[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ£€æŸ¥è½¬è´¦ç»“æœ</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">type</span>(result1) == <span class="string">&quot;table&quot;</span> <span class="keyword">and</span> result1.err <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> &#123;err = <span class="string">&quot;æ‰£æ¬¾å¤±è´¥: &quot;</span> .. result1.err&#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">type</span>(result2) == <span class="string">&quot;table&quot;</span> <span class="keyword">and</span> result2.err <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- æ‰£æ¬¾æˆåŠŸä½†åŠ æ¬¾å¤±è´¥ï¼Œéœ€è¦å›æ»š</span></span><br><span class="line">    redis.<span class="built_in">pcall</span>(<span class="string">&quot;incrby&quot;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">1</span>])  <span class="comment">-- å›æ»š</span></span><br><span class="line">    <span class="keyword">return</span> &#123;err = <span class="string">&quot;åŠ æ¬¾å¤±è´¥: &quot;</span> .. result2.err&#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123;ok = <span class="string">&quot;è½¬è´¦æˆåŠŸ&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><strong>4. å¯¹æ¯”æ€»ç»“</strong></p><table><thead><tr><th>åœºæ™¯</th><th>redis.call()</th><th>redis.pcall()</th></tr></thead><tbody><tr><td><strong>å‘½ä»¤æˆåŠŸ</strong></td><td>âœ… æ­£å¸¸æ‰§è¡Œ</td><td>âœ… æ­£å¸¸æ‰§è¡Œ</td></tr><tr><td><strong>å‘½ä»¤å¤±è´¥</strong></td><td>âŒ <strong>è„šæœ¬ä¸­æ–­</strong>ï¼Œæ‰€æœ‰å‘½ä»¤å›æ»š</td><td>âš ï¸ <strong>è¿”å›é”™è¯¯å¯¹è±¡</strong>ï¼Œå·²æ‰§è¡Œå‘½ä»¤ç”Ÿæ•ˆ</td></tr><tr><td><strong>åŸå­æ€§</strong></td><td>âœ… <strong>å®Œå…¨åŸå­æ€§</strong>ï¼ˆå…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å¤±è´¥ï¼‰</td><td>âš ï¸ <strong>éƒ¨åˆ†åŸå­æ€§</strong>ï¼ˆå¯èƒ½å‡ºç°éƒ¨åˆ†æˆåŠŸï¼‰</td></tr><tr><td><strong>é”™è¯¯å¤„ç†</strong></td><td>éœ€è¦try-catchï¼ˆLua 5.1+ï¼‰</td><td>å¯ä»¥æ£€æŸ¥è¿”å›å€¼</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>éœ€è¦ä¸¥æ ¼åŸå­æ€§çš„åœºæ™¯</td><td>éœ€è¦å®¹é”™å¤„ç†çš„åœºæ™¯</td></tr></tbody></table><p><strong>5. æœ€ä½³å®è·µå»ºè®®</strong></p><p><strong>âœ… æ¨èåšæ³•1ï¼šä½¿ç”¨ <code>redis.call()</code> + é”™è¯¯æ£€æŸ¥</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç§’æ€è„šæœ¬ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="keyword">local</span> stock = redis.call(<span class="string">&quot;get&quot;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> stock == <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>  <span class="comment">-- åº“å­˜ä¸å­˜åœ¨</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">tonumber</span>(stock) &lt;= <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>  <span class="comment">-- åº“å­˜ä¸è¶³</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¦‚æœè¿™é‡Œå¤±è´¥ï¼Œæ•´ä¸ªè„šæœ¬ä¼šå›æ»šï¼ˆç¬¦åˆä¸šåŠ¡é€»è¾‘ï¼‰</span></span><br><span class="line">redis.call(<span class="string">&quot;decr&quot;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line">redis.call(<span class="string">&quot;sadd&quot;</span>, KEYS[<span class="number">2</span>], ARGV[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p><strong>âœ… æ¨èåšæ³•2ï¼šä½¿ç”¨ <code>redis.pcall()</code> + æ‰‹åŠ¨å›æ»š</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è½¬è´¦è„šæœ¬ï¼ˆéœ€è¦å®¹é”™ï¼‰</span></span><br><span class="line"><span class="keyword">local</span> result1 = redis.<span class="built_in">pcall</span>(<span class="string">&quot;decrby&quot;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">type</span>(result1) == <span class="string">&quot;table&quot;</span> <span class="keyword">and</span> result1.err <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> &#123;err = <span class="string">&quot;æ‰£æ¬¾å¤±è´¥&quot;</span>&#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> result2 = redis.<span class="built_in">pcall</span>(<span class="string">&quot;incrby&quot;</span>, KEYS[<span class="number">2</span>], ARGV[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">type</span>(result2) == <span class="string">&quot;table&quot;</span> <span class="keyword">and</span> result2.err <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- åŠ æ¬¾å¤±è´¥ï¼Œå›æ»šæ‰£æ¬¾</span></span><br><span class="line">    redis.<span class="built_in">pcall</span>(<span class="string">&quot;incrby&quot;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> &#123;err = <span class="string">&quot;åŠ æ¬¾å¤±è´¥ï¼Œå·²å›æ»š&quot;</span>&#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123;ok = <span class="string">&quot;è½¬è´¦æˆåŠŸ&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><strong>âŒ ä¸æ¨èåšæ³•ï¼šæ··ç”¨ <code>redis.call()</code> å’Œ <code>redis.pcall()</code></strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- âŒ ä¸æ¨èï¼šæ··ç”¨ä¼šå¯¼è‡´è¡Œä¸ºä¸ä¸€è‡´</span></span><br><span class="line"><span class="keyword">local</span> result1 = redis.call(<span class="string">&quot;set&quot;</span>, <span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>)  <span class="comment">-- å¤±è´¥ä¼šä¸­æ–­</span></span><br><span class="line"><span class="keyword">local</span> result2 = redis.<span class="built_in">pcall</span>(<span class="string">&quot;incr&quot;</span>, <span class="string">&quot;key2&quot;</span>)          <span class="comment">-- å¤±è´¥ä¸ä¼šä¸­æ–­</span></span><br><span class="line"><span class="comment">-- è¡Œä¸ºä¸ä¸€è‡´ï¼Œéš¾ä»¥é¢„æµ‹</span></span><br></pre></td></tr></table></figure><p><strong>6. å®é™…åº”ç”¨åœºæ™¯é€‰æ‹©</strong></p><table><thead><tr><th>åœºæ™¯</th><th>æ¨èå‡½æ•°</th><th>åŸå› </th></tr></thead><tbody><tr><td><strong>ç§’æ€&#x2F;æŠ¢è´­</strong></td><td><code>redis.call()</code></td><td>éœ€è¦ä¸¥æ ¼åŸå­æ€§ï¼Œå¤±è´¥åº”è¯¥å…¨éƒ¨å›æ»š</td></tr><tr><td><strong>è½¬è´¦&#x2F;æ”¯ä»˜</strong></td><td><code>redis.pcall()</code> + å›æ»š</td><td>éœ€è¦å®¹é”™ï¼Œå¤±è´¥æ—¶éœ€è¦æ‰‹åŠ¨å›æ»š</td></tr><tr><td><strong>æ‰¹é‡æ“ä½œ</strong></td><td><code>redis.call()</code></td><td>è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥</td></tr><tr><td><strong>æ•°æ®è¿ç§»</strong></td><td><code>redis.pcall()</code></td><td>éƒ¨åˆ†å¤±è´¥ä¸å½±å“æ•´ä½“è¿›åº¦</td></tr></tbody></table><p><strong>7. æ€»ç»“</strong></p><p><strong>Luaè„šæœ¬çš„åŸå­æ€§ä¿è¯</strong>ï¼š</p><ol><li><strong>è„šæœ¬æ‰§è¡Œä¸è¢«ä¸­æ–­</strong>ï¼šâœ… è„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œï¼Œä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’é˜Ÿ</li><li><strong>å‘½ä»¤æ‰§è¡Œçš„åŸå­æ€§</strong>ï¼š<ul><li>ä½¿ç”¨<code>redis.call()</code>ï¼šâœ… <strong>å®Œå…¨åŸå­æ€§</strong>ï¼ˆå…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å¤±è´¥ï¼‰</li><li>ä½¿ç”¨<code>redis.pcall()</code>ï¼šâš ï¸ <strong>éƒ¨åˆ†åŸå­æ€§</strong>ï¼ˆå¯èƒ½å‡ºç°éƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å¤±è´¥ï¼‰</li></ul></li></ol><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li><code>redis.call()</code>ï¼š<strong>ä¸¥æ ¼åŸå­æ€§</strong>ï¼Œé€‚åˆéœ€è¦â€è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥â€çš„åœºæ™¯</li><li><code>redis.pcall()</code>ï¼š<strong>å®¹é”™å¤„ç†</strong>ï¼Œé€‚åˆéœ€è¦å¤„ç†éƒ¨åˆ†å¤±è´¥ã€æ‰‹åŠ¨å›æ»šçš„åœºæ™¯</li><li><strong>é€‰æ‹©å»ºè®®</strong>ï¼šå¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ä½¿ç”¨<code>redis.call()</code>ï¼Œéœ€è¦å®¹é”™æ—¶ä½¿ç”¨<code>redis.pcall()</code> + æ‰‹åŠ¨å›æ»š</li></ul><p><strong>8. æ€§èƒ½è€ƒè™‘</strong></p><p><strong>Luaè„šæœ¬ vs MULTI&#x2F;EXECæ€§èƒ½å¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>MULTI&#x2F;EXEC</th><th>Luaè„šæœ¬</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ç½‘ç»œå¾€è¿”</strong></td><td>Næ¬¡ï¼ˆNä¸ªå‘½ä»¤ï¼‰</td><td>1æ¬¡</td><td>Luaè„šæœ¬å‡å°‘ç½‘ç»œå¼€é”€</td></tr><tr><td><strong>æ‰§è¡Œé€Ÿåº¦</strong></td><td>è¾ƒå¿«</td><td>æœ€å¿«</td><td>Luaè„šæœ¬æœåŠ¡å™¨ç«¯æ‰§è¡Œ</td></tr><tr><td><strong>åŸå­æ€§</strong></td><td>éƒ¨åˆ†</td><td>å®Œå…¨ï¼ˆä½¿ç”¨redis.call()ï¼‰</td><td>Luaè„šæœ¬ä¿è¯æ›´å¼º</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>ç®€å•æ‰¹é‡æ“ä½œ</td><td>å¤æ‚é€»è¾‘</td><td>æ ¹æ®éœ€æ±‚é€‰æ‹©</td></tr></tbody></table><p><strong>æ€»ç»“</strong>ï¼š</p><p>Luaè„šæœ¬èƒ½ä¿è¯åŸå­æ€§çš„<strong>æ ¹æœ¬åŸå› </strong>ï¼š</p><ol><li>âœ… <strong>Rediså•çº¿ç¨‹æ¨¡å‹</strong>ï¼šåŒä¸€æ—¶åˆ»åªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡</li><li>âœ… <strong>è„šæœ¬ä½œä¸ºæ•´ä½“</strong>ï¼šè„šæœ¬è¢«è§†ä¸ºä¸€ä¸ªå®Œæ•´çš„å‘½ä»¤å•å…ƒ</li><li>âœ… <strong>æ‰§è¡ŒæœŸé—´ä¸ä¸­æ–­</strong>ï¼šè„šæœ¬æ‰§è¡ŒæœŸé—´ä¸ä¼šå¤„ç†å…¶ä»–å‘½ä»¤</li><li>âœ… <strong>é˜Ÿåˆ—é¡ºåºä¿è¯</strong>ï¼šå‘½ä»¤é˜Ÿåˆ—ä¿è¯FIFOé¡ºåº</li></ol><p>å› æ­¤ï¼ŒLuaè„šæœ¬åœ¨Redisä¸­å…·æœ‰<strong>æœ€å¼ºçš„åŸå­æ€§ä¿è¯</strong>ï¼Œæ˜¯å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘å’Œé«˜å¹¶å‘åœºæ™¯çš„<strong>æœ€ä½³é€‰æ‹©</strong>ï¼</p><p><strong>ç§’æ€Luaè„šæœ¬</strong>ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç§’æ€è„šæœ¬ï¼šseckill.lua</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">-- KEYS[1]: ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">-- KEYS[2]: å•†å“ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‹¼æ¥key</span></span><br><span class="line"><span class="keyword">local</span> userid = KEYS[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">local</span> prodid = KEYS[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">local</span> qtkey = <span class="string">&quot;sk:&quot;</span> .. prodid .. <span class="string">&quot;:qt&quot;</span>       <span class="comment">-- åº“å­˜key</span></span><br><span class="line"><span class="keyword">local</span> usersKey = <span class="string">&quot;sk:&quot;</span> .. prodid .. <span class="string">&quot;:usr&quot;</span>   <span class="comment">-- ç”¨æˆ·é›†åˆkey</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å‚ä¸</span></span><br><span class="line"><span class="keyword">local</span> userExists = redis.call(<span class="string">&quot;sismember&quot;</span>, usersKey, userid)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">tonumber</span>(userExists) == <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>    <span class="comment">-- è¿”å›2ï¼šç”¨æˆ·å·²å‚ä¸</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. æ£€æŸ¥åº“å­˜</span></span><br><span class="line"><span class="keyword">local</span> num = redis.call(<span class="string">&quot;get&quot;</span>, qtkey)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">tonumber</span>(num) &lt;= <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>    <span class="comment">-- è¿”å›0ï¼šåº“å­˜ä¸è¶³</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. æ‰£å‡åº“å­˜ï¼Œè®°å½•ç”¨æˆ·</span></span><br><span class="line">redis.call(<span class="string">&quot;decr&quot;</span>, qtkey)</span><br><span class="line">redis.call(<span class="string">&quot;sadd&quot;</span>, usersKey, userid)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>    <span class="comment">-- è¿”å›1ï¼šç§’æ€æˆåŠŸ</span></span><br></pre></td></tr></table></figure><p><strong>Javaè°ƒç”¨Luaè„šæœ¬</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeckillWithLua</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Luaè„šæœ¬å†…å®¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SECKILL_SCRIPT</span> <span class="operator">=</span> </span><br><span class="line">        <span class="string">&quot;local userid = KEYS[1]; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;local prodid = KEYS[2]; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;local qtkey = &#x27;sk:&#x27; .. prodid .. &#x27;:qt&#x27;; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;local usersKey = &#x27;sk:&#x27; .. prodid .. &#x27;:usr&#x27;; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;local userExists = redis.call(&#x27;sismember&#x27;, usersKey, userid); &quot;</span> +</span><br><span class="line">        <span class="string">&quot;if tonumber(userExists) == 1 then &quot;</span> +</span><br><span class="line">        <span class="string">&quot;    return 2; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;end; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;local num = redis.call(&#x27;get&#x27;, qtkey); &quot;</span> +</span><br><span class="line">        <span class="string">&quot;if tonumber(num) &lt;= 0 then &quot;</span> +</span><br><span class="line">        <span class="string">&quot;    return 0; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;else &quot;</span> +</span><br><span class="line">        <span class="string">&quot;    redis.call(&#x27;decr&#x27;, qtkey); &quot;</span> +</span><br><span class="line">        <span class="string">&quot;    redis.call(&#x27;sadd&#x27;, usersKey, userid); &quot;</span> +</span><br><span class="line">        <span class="string">&quot;end; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;return 1;&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰§è¡Œç§’æ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doSeckill</span><span class="params">(String userId, String productId)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡ŒLuaè„šæœ¬</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> jedis.eval(</span><br><span class="line">                SECKILL_SCRIPT,</span><br><span class="line">                <span class="number">2</span>,  <span class="comment">// keyæ•°é‡</span></span><br><span class="line">                userId,</span><br><span class="line">                productId</span><br><span class="line">            );</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è§£æè¿”å›å€¼</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">resultCode</span> <span class="operator">=</span> String.valueOf(result);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">switch</span> (resultCode) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;0&quot;</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;ç§’æ€å·²ç»“æŸ&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;1&quot;</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;ç§’æ€æˆåŠŸï¼&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;2&quot;</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ‚¨å·²å‚åŠ è¿‡ç§’æ€&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;ç§’æ€å¼‚å¸¸&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–ç§’æ€å•†å“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initSeckill</span><span class="params">(String productId, <span class="type">int</span> stock)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">stockKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + productId + <span class="string">&quot;:qt&quot;</span>;</span><br><span class="line">        jedis.set(stockKey, String.valueOf(stock));</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢ç§’æ€ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getSeckillResult</span><span class="params">(String productId)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">stockKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + productId + <span class="string">&quot;:qt&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + productId + <span class="string">&quot;:usr&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        result.put(<span class="string">&quot;remainStock&quot;</span>, jedis.get(stockKey));</span><br><span class="line">        result.put(<span class="string">&quot;successUsers&quot;</span>, jedis.smembers(userKey));</span><br><span class="line">        result.put(<span class="string">&quot;successCount&quot;</span>, jedis.scard(userKey));</span><br><span class="line">        </span><br><span class="line">        jedis.close();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ä»£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeckillTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">SeckillWithLua</span> <span class="variable">seckill</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SeckillWithLua</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. åˆå§‹åŒ–å•†å“åº“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">productId</span> <span class="operator">=</span> <span class="string">&quot;iphone15&quot;</span>;</span><br><span class="line">        seckill.initSeckill(productId, <span class="number">100</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆå§‹åŒ–åº“å­˜ï¼š100ä»¶&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ¨¡æ‹Ÿ1000ä¸ªç”¨æˆ·å¹¶å‘æŠ¢è´­</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">threadCount</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(threadCount);</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threadCount; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="string">&quot;user&quot;</span> + i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                seckill.doSeckill(userId, productId);</span><br><span class="line">                latch.countDown();</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        latch.await();  <span class="comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æŸ¥è¯¢ç§’æ€ç»“æœ</span></span><br><span class="line">        Map&lt;String, Object&gt; result = seckill.getSeckillResult(productId);</span><br><span class="line">        System.out.println(<span class="string">&quot;==================== ç§’æ€ç»“æœ ====================&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰©ä½™åº“å­˜: &quot;</span> + result.get(<span class="string">&quot;remainStock&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆåŠŸäººæ•°: &quot;</span> + result.get(<span class="string">&quot;successCount&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;è€—æ—¶: &quot;</span> + (endTime - startTime) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºç»“æœ</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">åˆå§‹åŒ–åº“å­˜ï¼š100ä»¶</span><br><span class="line">ç§’æ€æˆåŠŸï¼</span><br><span class="line">ç§’æ€æˆåŠŸï¼</span><br><span class="line">ç§’æ€å·²ç»“æŸ</span><br><span class="line">æ‚¨å·²å‚åŠ è¿‡ç§’æ€</span><br><span class="line">...</span><br><span class="line">==================== ç§’æ€ç»“æœ ====================</span><br><span class="line">å‰©ä½™åº“å­˜: 0</span><br><span class="line">æˆåŠŸäººæ•°: 100</span><br><span class="line">è€—æ—¶: 156ms</span><br><span class="line">===============================================</span><br></pre></td></tr></table></figure><h4 id="7-7-5-ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”"><a href="#7-7-5-ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”" class="headerlink" title="7.7.5 ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”"></a>7.7.5 ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”</h4><table><thead><tr><th>æ–¹æ¡ˆ</th><th>è¶…å–é—®é¢˜</th><th>æ€§èƒ½</th><th>å¹¶å‘èƒ½åŠ›</th><th>å®ç°å¤æ‚åº¦</th><th>æ¨èæŒ‡æ•°</th></tr></thead><tbody><tr><td><strong>åŸºç¡€äº‹åŠ¡</strong></td><td>âŒ å­˜åœ¨</td><td>â­â­â­â­</td><td>â­â­</td><td>â­ ç®€å•</td><td>â­</td></tr><tr><td><strong>ä¹è§‚é”ï¼ˆWATCHï¼‰</strong></td><td>âœ… è§£å†³</td><td>â­â­â­</td><td>â­â­â­</td><td>â­â­ ä¸­ç­‰</td><td>â­â­â­</td></tr><tr><td><strong>Luaè„šæœ¬</strong></td><td>âœ… è§£å†³</td><td>â­â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­ è¾ƒé«˜</td><td>â­â­â­â­â­</td></tr></tbody></table><p><strong>æ€§èƒ½æµ‹è¯•å¯¹æ¯”</strong>ï¼ˆ10000å¹¶å‘ï¼Œ100åº“å­˜ï¼‰ï¼š</p><table><thead><tr><th>æ–¹æ¡ˆ</th><th>è€—æ—¶</th><th>æˆåŠŸç‡</th><th>è¶…å–æƒ…å†µ</th></tr></thead><tbody><tr><td>åŸºç¡€äº‹åŠ¡</td><td>~50ms</td><td>100%</td><td>âŒ åº“å­˜-15ï¼ˆè¶…å–15ä»¶ï¼‰</td></tr><tr><td>ä¹è§‚é”</td><td>~800ms</td><td>1%</td><td>âœ… æ— è¶…å–</td></tr><tr><td>Luaè„šæœ¬</td><td>~150ms</td><td>1%</td><td>âœ… æ— è¶…å–</td></tr></tbody></table><p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p><ul><li>ğŸ† <strong>ç”Ÿäº§ç¯å¢ƒæ¨è</strong>ï¼šLuaè„šæœ¬æ–¹æ¡ˆ</li><li>ğŸ¯ <strong>å­¦ä¹ æ¨è</strong>ï¼šä¹è§‚é”æ–¹æ¡ˆï¼ˆç†è§£åŸç†ï¼‰</li><li>âŒ <strong>ä¸æ¨è</strong>ï¼šåŸºç¡€äº‹åŠ¡æ–¹æ¡ˆï¼ˆä»…ç”¨äºæ¼”ç¤ºï¼‰</li></ul><h3 id="7-8-Redisäº‹åŠ¡æœ€ä½³å®è·µ"><a href="#7-8-Redisäº‹åŠ¡æœ€ä½³å®è·µ" class="headerlink" title="7.8 Redisäº‹åŠ¡æœ€ä½³å®è·µ"></a>7.8 Redisäº‹åŠ¡æœ€ä½³å®è·µ</h3><h4 id="7-8-1-ä½•æ—¶ä½¿ç”¨äº‹åŠ¡"><a href="#7-8-1-ä½•æ—¶ä½¿ç”¨äº‹åŠ¡" class="headerlink" title="7.8.1 ä½•æ—¶ä½¿ç”¨äº‹åŠ¡"></a>7.8.1 ä½•æ—¶ä½¿ç”¨äº‹åŠ¡</h4><p><strong>âœ… é€‚åˆä½¿ç”¨äº‹åŠ¡çš„åœºæ™¯</strong>ï¼š</p><ol><li><p><strong>æ‰¹é‡æ“ä½œ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰¹é‡è®¾ç½®å¤šä¸ªkey</span></span><br><span class="line">MULTI</span><br><span class="line">SET user:1001 <span class="string">&quot;å¼ ä¸‰&quot;</span></span><br><span class="line">SET user:1002 <span class="string">&quot;æå››&quot;</span></span><br><span class="line">SET user:1003 <span class="string">&quot;ç‹äº”&quot;</span></span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure></li><li><p><strong>ç›¸å…³è”çš„å¤šä¸ªæ“ä½œ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è½¬è´¦ï¼šAè´¦æˆ·å‡100ï¼ŒBè´¦æˆ·åŠ 100</span></span><br><span class="line">MULTI</span><br><span class="line">DECRBY account:A 100</span><br><span class="line">INCRBY account:B 100</span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure></li><li><p><strong>éœ€è¦åŸå­æ€§çš„æ“ä½œ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å•†å“ç§’æ€ï¼šå‡åº“å­˜+è®°å½•ç”¨æˆ·</span></span><br><span class="line">WATCH stock</span><br><span class="line">MULTI</span><br><span class="line">DECR stock</span><br><span class="line">SADD buyers user123</span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure></li></ol><p><strong>âŒ ä¸é€‚åˆä½¿ç”¨äº‹åŠ¡çš„åœºæ™¯</strong>ï¼š</p><ol><li><p><strong>å•ä¸ªç®€å•å‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸éœ€è¦äº‹åŠ¡</span></span><br><span class="line">SET key value</span><br><span class="line"></span><br><span class="line"><span class="comment"># è€Œä¸æ˜¯</span></span><br><span class="line">MULTI</span><br><span class="line">SET key value</span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure></li><li><p><strong>éœ€è¦æ ¹æ®ä¸­é—´ç»“æœå†³å®šåç»­æ“ä½œ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># äº‹åŠ¡ä¸­æ— æ³•è·å–ä¸­é—´ç»“æœ</span></span><br><span class="line">MULTI</span><br><span class="line">GET balance</span><br><span class="line"><span class="comment"># âŒ æ— æ³•æ ¹æ®balanceçš„å€¼å†³å®šæ˜¯å¦æ‰§è¡Œä¸‹ä¸€æ­¥</span></span><br><span class="line">DECRBY balance 100</span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure></li><li><p><strong>éœ€è¦å¼ºä¸€è‡´æ€§å’Œå›æ»š</strong>ï¼š</p><ul><li>Redisäº‹åŠ¡ä¸æ”¯æŒå›æ»š</li><li>è€ƒè™‘ä½¿ç”¨Luaè„šæœ¬æˆ–ä¼ ç»Ÿæ•°æ®åº“</li></ul></li></ol><h4 id="7-8-2-äº‹åŠ¡ä¼˜åŒ–å»ºè®®"><a href="#7-8-2-äº‹åŠ¡ä¼˜åŒ–å»ºè®®" class="headerlink" title="7.8.2 äº‹åŠ¡ä¼˜åŒ–å»ºè®®"></a>7.8.2 äº‹åŠ¡ä¼˜åŒ–å»ºè®®</h4><p><strong>1. ä½¿ç”¨WATCHé¿å…å¹¶å‘å†²çª</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨WATCH</span></span><br><span class="line">jedis.watch(<span class="string">&quot;balance&quot;</span>);</span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">tx.decrby(<span class="string">&quot;balance&quot;</span>, <span class="number">100</span>);</span><br><span class="line">tx.exec();</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ ä¸å¥½çš„åšæ³•ï¼šä¸ä½¿ç”¨WATCH</span></span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">tx.decrby(<span class="string">&quot;balance&quot;</span>, <span class="number">100</span>);</span><br><span class="line">tx.exec();</span><br></pre></td></tr></table></figure><p><strong>2. å‡å°‘äº‹åŠ¡ä¸­çš„å‘½ä»¤æ•°é‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># âœ… å¥½çš„åšæ³•ï¼šåªåŒ…å«å¿…è¦çš„å‘½ä»¤</span></span><br><span class="line">MULTI</span><br><span class="line">DECR stock</span><br><span class="line">SADD buyers user123</span><br><span class="line">EXEC</span><br><span class="line"></span><br><span class="line"><span class="comment"># âŒ ä¸å¥½çš„åšæ³•ï¼šåŒ…å«è¿‡å¤šå‘½ä»¤</span></span><br><span class="line">MULTI</span><br><span class="line">GET key1</span><br><span class="line">GET key2</span><br><span class="line">GET key3</span><br><span class="line"><span class="comment"># ... æ›´å¤šå‘½ä»¤</span></span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure><p><strong>3. ä½¿ç”¨Luaè„šæœ¬æ›¿ä»£å¤æ‚äº‹åŠ¡</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- âœ… å¥½çš„åšæ³•ï¼šå¤æ‚é€»è¾‘ç”¨Luaè„šæœ¬</span></span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>, <span class="string">&quot;stock&quot;</span>) &gt; <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    redis.call(<span class="string">&quot;decr&quot;</span>, <span class="string">&quot;stock&quot;</span>)</span><br><span class="line">    redis.call(<span class="string">&quot;sadd&quot;</span>, <span class="string">&quot;buyers&quot;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p><strong>4. æ·»åŠ é‡è¯•æœºåˆ¶</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… å¥½çš„åšæ³•ï¼šæ·»åŠ é‡è¯•</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    jedis.watch(<span class="string">&quot;stock&quot;</span>);</span><br><span class="line">    <span class="comment">// ... äº‹åŠ¡æ“ä½œ</span></span><br><span class="line">    List&lt;Object&gt; result = tx.exec();</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  <span class="comment">// æˆåŠŸ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤±è´¥ï¼Œé‡è¯•</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><h4 id="7-8-3-å¸¸è§é”™è¯¯"><a href="#7-8-3-å¸¸è§é”™è¯¯" class="headerlink" title="7.8.3 å¸¸è§é”™è¯¯"></a>7.8.3 å¸¸è§é”™è¯¯</h4><p><strong>é”™è¯¯1ï¼šåœ¨äº‹åŠ¡ä¸­è·å–ä¸­é—´ç»“æœ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šæ— æ³•åœ¨äº‹åŠ¡ä¸­è·å–ç»“æœ</span></span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">Response&lt;String&gt; balance = tx.get(<span class="string">&quot;balance&quot;</span>);</span><br><span class="line"><span class="comment">// balance.get()ä¼šæŠ›å‡ºå¼‚å¸¸ï¼äº‹åŠ¡æœªæ‰§è¡Œï¼Œæ— æ³•è·å–ç»“æœ</span></span><br><span class="line">tx.exec();</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šå…ˆè·å–ï¼Œå†äº‹åŠ¡</span></span><br><span class="line"><span class="type">String</span> <span class="variable">balance</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;balance&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">balanceInt</span> <span class="operator">=</span> Integer.parseInt(balance);</span><br><span class="line"><span class="keyword">if</span> (balanceInt &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">    <span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">    tx.decrby(<span class="string">&quot;balance&quot;</span>, <span class="number">100</span>);</span><br><span class="line">    tx.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯2ï¼šå¿˜è®°è°ƒç”¨EXEC</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šå¿˜è®°EXEC</span></span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">tx.set(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line"><span class="comment">// å¿˜è®°è°ƒç”¨tx.exec()ï¼Œå‘½ä»¤ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šè°ƒç”¨EXEC</span></span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">tx.set(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">tx.exec();</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯3ï¼šWATCHåä¸æ£€æŸ¥EXECç»“æœ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šä¸æ£€æŸ¥ç»“æœ</span></span><br><span class="line">jedis.watch(<span class="string">&quot;key&quot;</span>);</span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">tx.set(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">tx.exec();  <span class="comment">// å¯èƒ½è¿”å›nullï¼ˆè¢«ä¿®æ”¹ï¼‰ï¼Œä½†æ²¡æœ‰æ£€æŸ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šæ£€æŸ¥ç»“æœ</span></span><br><span class="line">jedis.watch(<span class="string">&quot;key&quot;</span>);</span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">tx.set(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">List&lt;Object&gt; result = tx.exec();</span><br><span class="line"><span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// äº‹åŠ¡å¤±è´¥ï¼Œå¤„ç†é‡è¯•é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-9-æ€»ç»“"><a href="#7-9-æ€»ç»“" class="headerlink" title="7.9 æ€»ç»“"></a>7.9 æ€»ç»“</h3><h4 id="Redisäº‹åŠ¡æ ¸å¿ƒè¦ç‚¹"><a href="#Redisäº‹åŠ¡æ ¸å¿ƒè¦ç‚¹" class="headerlink" title="Redisäº‹åŠ¡æ ¸å¿ƒè¦ç‚¹"></a>Redisäº‹åŠ¡æ ¸å¿ƒè¦ç‚¹</h4><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å‘½ä»¤</strong></td><td>MULTIã€EXECã€DISCARDã€WATCHã€UNWATCH</td></tr><tr><td><strong>æ‰§è¡Œæµç¨‹</strong></td><td>å¼€å¯ â†’ ç»„é˜Ÿ â†’ æ‰§è¡Œ</td></tr><tr><td><strong>éš”ç¦»æ€§</strong></td><td>âœ… å•ç‹¬éš”ç¦»ï¼Œä¸ä¼šè¢«æ‰“æ–­</td></tr><tr><td><strong>åŸå­æ€§</strong></td><td>âš ï¸ éƒ¨åˆ†åŸå­æ€§ï¼Œä¸æ”¯æŒå›æ»š</td></tr><tr><td><strong>ä¸€è‡´æ€§</strong></td><td>âš ï¸ å¼€å‘è€…ä¿è¯</td></tr><tr><td><strong>å¹¶å‘æ§åˆ¶</strong></td><td>WATCHï¼ˆä¹è§‚é”ï¼‰</td></tr><tr><td><strong>æœ€ä½³æ–¹æ¡ˆ</strong></td><td>Luaè„šæœ¬ï¼ˆåŸå­æ€§æœ€å¼ºï¼‰</td></tr></tbody></table><h4 id="äº‹åŠ¡-vs-Luaè„šæœ¬"><a href="#äº‹åŠ¡-vs-Luaè„šæœ¬" class="headerlink" title="äº‹åŠ¡ vs Luaè„šæœ¬"></a>äº‹åŠ¡ vs Luaè„šæœ¬</h4><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>Redisäº‹åŠ¡</th><th>Luaè„šæœ¬</th></tr></thead><tbody><tr><td><strong>åŸå­æ€§</strong></td><td>âš ï¸ éƒ¨åˆ†åŸå­æ€§ï¼ˆä¸å›æ»šï¼‰</td><td>âœ… å®Œå…¨åŸå­æ€§</td></tr><tr><td><strong>å¤æ‚é€»è¾‘</strong></td><td>âŒ ä¸æ”¯æŒæ¡ä»¶åˆ¤æ–­</td><td>âœ… æ”¯æŒif&#x2F;else&#x2F;å¾ªç¯</td></tr><tr><td><strong>ä¸­é—´ç»“æœ</strong></td><td>âŒ æ— æ³•è·å–</td><td>âœ… å¯ä»¥è·å–å’Œä½¿ç”¨</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>â­â­â­â­</td><td>â­â­â­â­â­</td></tr><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>â­â­ ç®€å•</td><td>â­â­â­ è¾ƒé«˜</td></tr><tr><td><strong>æ¨èåœºæ™¯</strong></td><td>ç®€å•æ‰¹é‡æ“ä½œ</td><td>å¤æ‚ä¸šåŠ¡é€»è¾‘</td></tr></tbody></table><h4 id="å­¦ä¹ å»ºè®®"><a href="#å­¦ä¹ å»ºè®®" class="headerlink" title="å­¦ä¹ å»ºè®®"></a>å­¦ä¹ å»ºè®®</h4><ol><li><strong>ç†è§£åŸç†</strong>ï¼šæŒæ¡MULTI&#x2F;EXEC&#x2F;WATCHçš„å·¥ä½œæœºåˆ¶</li><li><strong>å®è·µæ¼”ç»ƒ</strong>ï¼šè‡ªå·±ç¼–å†™ç§’æ€æ¡ˆä¾‹ï¼Œç†è§£å¹¶å‘é—®é¢˜</li><li><strong>å­¦ä¹ Lua</strong>ï¼šæŒæ¡Luaè„šæœ¬ï¼Œç”¨äºå¤æ‚åœºæ™¯</li><li><strong>æ€§èƒ½æµ‹è¯•</strong>ï¼šå¯¹æ¯”ä¸åŒæ–¹æ¡ˆçš„æ€§èƒ½å·®å¼‚</li><li><strong>ç”Ÿäº§å®è·µ</strong>ï¼šåœ¨é¡¹ç›®ä¸­åˆç†é€‰æ‹©äº‹åŠ¡æˆ–Luaè„šæœ¬</li></ol><h2 id="8-RedisæŒä¹…åŒ–"><a href="#8-RedisæŒä¹…åŒ–" class="headerlink" title="8. RedisæŒä¹…åŒ–"></a>8. RedisæŒä¹…åŒ–</h2><h3 id="8-1-ä»€ä¹ˆæ˜¯æŒä¹…åŒ–"><a href="#8-1-ä»€ä¹ˆæ˜¯æŒä¹…åŒ–" class="headerlink" title="8.1 ä»€ä¹ˆæ˜¯æŒä¹…åŒ–"></a>8.1 ä»€ä¹ˆæ˜¯æŒä¹…åŒ–</h3><p><strong>æŒä¹…åŒ–å®šä¹‰</strong>ï¼š</p><ul><li>Redisæ˜¯<strong>å†…å­˜æ•°æ®åº“</strong>ï¼Œæ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­</li><li>æœåŠ¡å™¨é‡å¯æˆ–å®•æœºï¼Œå†…å­˜ä¸­çš„æ•°æ®ä¼š<strong>ä¸¢å¤±</strong></li><li><strong>æŒä¹…åŒ–</strong>å°±æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®<strong>ä¿å­˜åˆ°ç£ç›˜</strong>ï¼Œä»¥ä¾¿åœ¨Redisé‡å¯åèƒ½å¤Ÿæ¢å¤æ•°æ®</li></ul><p><strong>æŒä¹…åŒ–çš„å¿…è¦æ€§</strong>ï¼š</p><ul><li>âœ… <strong>æ•°æ®å®‰å…¨</strong>ï¼šé˜²æ­¢æ•°æ®ä¸¢å¤±</li><li>âœ… <strong>ç¾éš¾æ¢å¤</strong>ï¼šæœåŠ¡å™¨æ•…éšœåèƒ½å¤Ÿæ¢å¤æ•°æ®</li><li>âœ… <strong>æ•°æ®å¤‡ä»½</strong>ï¼šå¯ä»¥å®šæœŸå¤‡ä»½æ•°æ®</li></ul><p><strong>RedisæŒä¹…åŒ–æ–¹å¼</strong>ï¼š</p><table><thead><tr><th>æŒä¹…åŒ–æ–¹å¼</th><th>è¯´æ˜</th><th>ç‰ˆæœ¬è¦æ±‚</th></tr></thead><tbody><tr><td><strong>RDB</strong></td><td>å¿«ç…§æ–¹å¼ï¼Œå®šæœŸä¿å­˜æ•°æ®å¿«ç…§</td><td>Redis 1.0+</td></tr><tr><td><strong>AOF</strong></td><td>æ—¥å¿—æ–¹å¼ï¼Œè®°å½•æ¯ä¸ªå†™æ“ä½œ</td><td>Redis 1.1+</td></tr><tr><td><strong>æ··åˆæŒä¹…åŒ–</strong></td><td>RDB + AOFï¼Œç»“åˆä¸¤è€…ä¼˜åŠ¿</td><td>Redis 4.0+</td></tr></tbody></table><h3 id="8-2-RDBæŒä¹…åŒ–"><a href="#8-2-RDBæŒä¹…åŒ–" class="headerlink" title="8.2 RDBæŒä¹…åŒ–"></a>8.2 RDBæŒä¹…åŒ–</h3><h4 id="8-2-1-ä»€ä¹ˆæ˜¯RDB"><a href="#8-2-1-ä»€ä¹ˆæ˜¯RDB" class="headerlink" title="8.2.1 ä»€ä¹ˆæ˜¯RDB"></a>8.2.1 ä»€ä¹ˆæ˜¯RDB</h4><p><strong>RDBï¼ˆRedis Databaseï¼‰</strong>ï¼š</p><ul><li><strong>å…¨ç§°</strong>ï¼šRedis Database Backup file</li><li><strong>åŸç†</strong>ï¼šåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œå°†å†…å­˜ä¸­çš„**æ•°æ®é›†å¿«ç…§ï¼ˆSnapshotï¼‰**å†™å…¥ç£ç›˜</li><li><strong>æ¢å¤æ–¹å¼</strong>ï¼šå°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œ</li></ul><p><strong>RDBæ–‡ä»¶</strong>ï¼š</p><ul><li><strong>é»˜è®¤æ–‡ä»¶å</strong>ï¼š<code>dump.rdb</code></li><li><strong>æ–‡ä»¶æ ¼å¼</strong>ï¼šäºŒè¿›åˆ¶å‹ç¼©æ–‡ä»¶</li><li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šRediså·¥ä½œç›®å½•ï¼ˆå¯é€šè¿‡<code>dir</code>é…ç½®ï¼‰</li></ul><h4 id="8-2-2-RDBæŒä¹…åŒ–æµç¨‹"><a href="#8-2-2-RDBæŒä¹…åŒ–æµç¨‹" class="headerlink" title="8.2.2 RDBæŒä¹…åŒ–æµç¨‹"></a>8.2.2 RDBæŒä¹…åŒ–æµç¨‹</h4><p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[è§¦å‘RDBæŒä¹…åŒ–]</span><br><span class="line">    â†“</span><br><span class="line">[Redisä¸»è¿›ç¨‹forkå­è¿›ç¨‹]</span><br><span class="line">    â†“</span><br><span class="line">[å­è¿›ç¨‹å°†æ•°æ®å†™å…¥ä¸´æ—¶æ–‡ä»¶]</span><br><span class="line">    â†“</span><br><span class="line">[æŒä¹…åŒ–å®Œæˆï¼Œç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢æ—§æ–‡ä»¶]</span><br><span class="line">    â†“</span><br><span class="line">[ä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚]</span><br></pre></td></tr></table></figure><p><strong>å…³é”®ç‰¹ç‚¹</strong>ï¼š</p><ul><li>âœ… <strong>å¼‚æ­¥æ‰§è¡Œ</strong>ï¼šä¸»è¿›ç¨‹ä¸è¿›è¡ŒIOæ“ä½œï¼Œç¡®ä¿é«˜æ€§èƒ½</li><li>âœ… <strong>ä¸é˜»å¡</strong>ï¼šæŒä¹…åŒ–æœŸé—´å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚</li><li>âœ… <strong>åŸå­æ€§</strong>ï¼šä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§</li></ul><p><strong>æµç¨‹å›¾</strong>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/RDB%E5%B0%8F%E6%80%BB%E7%BB%93.png" alt="RDBæŒä¹…åŒ–æµç¨‹"></p><h4 id="8-2-3-Forkæœºåˆ¶è¯¦è§£"><a href="#8-2-3-Forkæœºåˆ¶è¯¦è§£" class="headerlink" title="8.2.3 Forkæœºåˆ¶è¯¦è§£"></a>8.2.3 Forkæœºåˆ¶è¯¦è§£</h4><p><strong>ä»€ä¹ˆæ˜¯Forkï¼Ÿ</strong></p><p>Forkæ˜¯Linux&#x2F;Unixç³»ç»Ÿä¸­çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äº<strong>å¤åˆ¶ä¸€ä¸ªä¸å½“å‰è¿›ç¨‹å®Œå…¨ç›¸åŒçš„å­è¿›ç¨‹</strong>ã€‚</p><p><strong>Forkçš„ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ–°è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®ï¼ˆå˜é‡ã€ç¯å¢ƒå˜é‡ã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰éƒ½å’ŒåŸè¿›ç¨‹ä¸€è‡´</li><li>æ˜¯ä¸€ä¸ª<strong>å…¨æ–°çš„è¿›ç¨‹</strong>ï¼Œå¹¶ä½œä¸ºåŸè¿›ç¨‹çš„<strong>å­è¿›ç¨‹</strong></li><li>çˆ¶å­è¿›ç¨‹<strong>ç‹¬ç«‹è¿è¡Œ</strong>ï¼Œäº’ä¸å½±å“</li></ul><p><strong>å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼ˆCopy-On-Writeï¼ŒCOWï¼‰</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">çˆ¶è¿›ç¨‹å†…å­˜ç©ºé—´</span><br><span class="line">    â†“</span><br><span class="line">Forkå­è¿›ç¨‹</span><br><span class="line">    â†“</span><br><span class="line">çˆ¶å­è¿›ç¨‹å…±äº«åŒä¸€æ®µç‰©ç†å†…å­˜ï¼ˆåˆå§‹çŠ¶æ€ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">å½“çˆ¶è¿›ç¨‹æˆ–å­è¿›ç¨‹ä¿®æ”¹æ•°æ®æ—¶</span><br><span class="line">    â†“</span><br><span class="line">Linuxå†…æ ¸å°†ä¿®æ”¹çš„é¡µé¢å¤åˆ¶ä¸€ä»½ç»™ä¿®æ”¹çš„è¿›ç¨‹</span><br><span class="line">    â†“</span><br><span class="line">çˆ¶å­è¿›ç¨‹å„è‡ªæ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>âœ… <strong>èŠ‚çœå†…å­˜</strong>ï¼šåˆå§‹æ—¶çˆ¶å­è¿›ç¨‹å…±äº«å†…å­˜</li><li>âœ… <strong>æé«˜æ€§èƒ½</strong>ï¼šåªæœ‰ä¿®æ”¹æ—¶æ‰å¤åˆ¶ï¼Œå‡å°‘å†…å­˜æ‹·è´</li><li>âœ… <strong>å¿«é€Ÿåˆ›å»º</strong>ï¼šforkæ“ä½œéå¸¸å¿«</li></ul><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>âš ï¸ Forkæ—¶ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´<strong>2å€çš„è†¨èƒ€æ€§</strong>éœ€è¦è€ƒè™‘</li><li>âš ï¸ å¦‚æœæ•°æ®åºå¤§ï¼Œforkæ“ä½œè¿˜æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½</li><li>âš ï¸ å†™æ—¶å¤åˆ¶æŠ€æœ¯è™½ç„¶ä¼˜åŒ–äº†å†…å­˜ä½¿ç”¨ï¼Œä½†å¤§é‡æ•°æ®ä¿®æ”¹æ—¶ä»ä¼šæœ‰æ€§èƒ½å½±å“</li></ul><h4 id="8-2-4-RDBè§¦å‘æ–¹å¼"><a href="#8-2-4-RDBè§¦å‘æ–¹å¼" class="headerlink" title="8.2.4 RDBè§¦å‘æ–¹å¼"></a>8.2.4 RDBè§¦å‘æ–¹å¼</h4><p><strong>1. è‡ªåŠ¨è§¦å‘ï¼ˆé…ç½®æ–‡ä»¶ï¼‰</strong></p><p><strong>é…ç½®æ ¼å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save &lt;seconds&gt; &lt;changes&gt;</span><br></pre></td></tr></table></figure><p><strong>é»˜è®¤é…ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1      <span class="comment"># 900ç§’ï¼ˆ15åˆ†é’Ÿï¼‰å†…è‡³å°‘1ä¸ªkeyå‘ç”Ÿå˜åŒ–</span></span><br><span class="line">save 300 10     <span class="comment"># 300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰å†…è‡³å°‘10ä¸ªkeyå‘ç”Ÿå˜åŒ–</span></span><br><span class="line">save 60 10000   <span class="comment"># 60ç§’ï¼ˆ1åˆ†é’Ÿï¼‰å†…è‡³å°‘10000ä¸ªkeyå‘ç”Ÿå˜åŒ–</span></span><br></pre></td></tr></table></figure><p><strong>é…ç½®è¯´æ˜</strong>ï¼š</p><ul><li>æ»¡è¶³<strong>ä»»æ„ä¸€ä¸ªæ¡ä»¶</strong>å°±ä¼šè§¦å‘RDBæŒä¹…åŒ–</li><li>å¤šä¸ªæ¡ä»¶ä¹‹é—´æ˜¯**æˆ–ï¼ˆORï¼‰**å…³ç³»</li><li>å¯ä»¥é…ç½®å¤šä¸ªsaveè§„åˆ™</li></ul><p><strong>ç¤ºä¾‹é…ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line">save 3600 1     <span class="comment"># 1å°æ—¶å†…è‡³å°‘1ä¸ªkeyå˜åŒ–</span></span><br><span class="line">save 1800 100   <span class="comment"># 30åˆ†é’Ÿå†…è‡³å°‘100ä¸ªkeyå˜åŒ–</span></span><br><span class="line">save 300 1000   <span class="comment"># 5åˆ†é’Ÿå†…è‡³å°‘1000ä¸ªkeyå˜åŒ–</span></span><br></pre></td></tr></table></figure><p><strong>ç¦ç”¨è‡ªåŠ¨è§¦å‘</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ³•1ï¼šæ³¨é‡Šæ‰æ‰€æœ‰saveé…ç½®</span></span><br><span class="line"><span class="comment"># save 900 1</span></span><br><span class="line"><span class="comment"># save 300 10</span></span><br><span class="line"><span class="comment"># save 60 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•2ï¼šè®¾ç½®ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">save <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><p><strong>2. æ‰‹åŠ¨è§¦å‘</strong></p><p><strong>SAVEå‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SAVE</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>âŒ <strong>é˜»å¡å¼</strong>ï¼šæ‰§è¡ŒSAVEæ—¶ï¼ŒRedis<strong>é˜»å¡æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚</strong></li><li>âŒ <strong>ä¸æ¨è</strong>ï¼šç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨</li><li>âœ… <strong>åŒæ­¥æ‰§è¡Œ</strong>ï¼šå‘½ä»¤æ‰§è¡Œå®Œæ¯•æ‰è¿”å›</li></ul><p><strong>BGSAVEå‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; BGSAVE</span><br><span class="line">Background saving started by pid 12345</span><br></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>âœ… <strong>éé˜»å¡</strong>ï¼šåå°å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡å®¢æˆ·ç«¯è¯·æ±‚</li><li>âœ… <strong>æ¨èä½¿ç”¨</strong>ï¼šç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨</li><li>âœ… <strong>è¿”å›è¿›ç¨‹ID</strong>ï¼šå¯ä»¥æŸ¥çœ‹æŒä¹…åŒ–è¿›ç¨‹</li></ul><p><strong>æŸ¥çœ‹æŒä¹…åŒ–çŠ¶æ€</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´</span></span><br><span class="line">127.0.0.1:6379&gt; LASTSAVE</span><br><span class="line">(<span class="built_in">integer</span>) 1699123456</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒä¹…åŒ–æ˜¯å¦æ­£åœ¨è¿›è¡Œ</span></span><br><span class="line">127.0.0.1:6379&gt; INFO persistence</span><br><span class="line"><span class="comment"># Persistence</span></span><br><span class="line">rdb_changes_since_last_save:0</span><br><span class="line">rdb_bgsave_in_progress:0    <span class="comment"># 0è¡¨ç¤ºæ²¡æœ‰è¿›è¡Œï¼Œ1è¡¨ç¤ºæ­£åœ¨è¿›è¡Œ</span></span><br><span class="line">rdb_last_save_time:1699123456</span><br><span class="line">rdb_last_bgsave_status:ok</span><br></pre></td></tr></table></figure><p><strong>3. ç‰¹æ®Šè§¦å‘</strong></p><p><strong>FLUSHALLå‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; FLUSHALL</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>âš ï¸ æ‰§è¡Œ<code>FLUSHALL</code>å‘½ä»¤ä¼š<strong>æ¸…ç©ºæ‰€æœ‰æ•°æ®</strong></li><li>âš ï¸ åŒæ—¶ä¼š<strong>è§¦å‘RDBæŒä¹…åŒ–</strong>ï¼Œä½†ç”Ÿæˆçš„<code>dump.rdb</code>æ–‡ä»¶æ˜¯<strong>ç©ºçš„</strong></li><li>âš ï¸ è¿™ä¸ªæ–‡ä»¶<strong>æ— æ„ä¹‰</strong>ï¼Œä¸è¦ç”¨äºæ¢å¤</li></ul><p><strong>SHUTDOWNå‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SHUTDOWN</span><br></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ‰§è¡Œ<code>SHUTDOWN</code>æ—¶ä¼š<strong>è‡ªåŠ¨æ‰§è¡ŒSAVE</strong>ï¼ˆå¦‚æœé…ç½®äº†RDBï¼‰</li><li>ç¡®ä¿æ•°æ®åœ¨å…³é—­å‰è¢«ä¿å­˜</li></ul><h4 id="8-2-5-RDBé…ç½®è¯¦è§£"><a href="#8-2-5-RDBé…ç½®è¯¦è§£" class="headerlink" title="8.2.5 RDBé…ç½®è¯¦è§£"></a>8.2.5 RDBé…ç½®è¯¦è§£</h4><p><strong>1. æ–‡ä»¶é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RDBæ–‡ä»¶å</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># RDBæ–‡ä»¶ä¿å­˜è·¯å¾„</span></span><br><span class="line"><span class="built_in">dir</span> /var/lib/redis/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹äºRediså¯åŠ¨ç›®å½•ï¼‰</span></span><br><span class="line"><span class="built_in">dir</span> ./</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹å½“å‰é…ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; CONFIG GET <span class="built_in">dir</span></span><br><span class="line">1) <span class="string">&quot;dir&quot;</span></span><br><span class="line">2) <span class="string">&quot;/var/lib/redis&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET dbfilename</span><br><span class="line">1) <span class="string">&quot;dbfilename&quot;</span></span><br><span class="line">2) <span class="string">&quot;dump.rdb&quot;</span></span><br></pre></td></tr></table></figure><p><strong>2. å‹ç¼©é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¯å¦å‹ç¼©RDBæ–‡ä»¶</span></span><br><span class="line">rdbcompression <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼š</p><ul><li><code>yes</code>ï¼šä½¿ç”¨<strong>LZFç®—æ³•</strong>å‹ç¼©RDBæ–‡ä»¶</li><li><code>no</code>ï¼šä¸å‹ç¼©ï¼Œæ–‡ä»¶æ›´å¤§ä½†CPUæ¶ˆè€—æ›´å°‘</li><li><strong>æ¨è</strong>ï¼š<code>yes</code>ï¼ˆå‹ç¼©å¯ä»¥æ˜¾è‘—å‡å°‘æ–‡ä»¶å¤§å°ï¼‰</li></ul><p><strong>å‹ç¼©æ•ˆæœ</strong>ï¼š</p><ul><li>å‹ç¼©å‰ï¼š100MB</li><li>å‹ç¼©åï¼šçº¦20-30MBï¼ˆå–å†³äºæ•°æ®ç‰¹å¾ï¼‰</li><li><strong>å‹ç¼©æ¯”</strong>ï¼šé€šå¸¸ä¸º3:1åˆ°5:1</li></ul><p><strong>3. å®Œæ•´æ€§æ ¡éªŒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¯å¦åœ¨RDBæ–‡ä»¶æœ«å°¾æ·»åŠ CRC64æ ¡éªŒå’Œ</span></span><br><span class="line">rdbchecksum <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼š</p><ul><li><code>yes</code>ï¼šä½¿ç”¨<strong>CRC64ç®—æ³•</strong>è¿›è¡Œæ•°æ®æ ¡éªŒ</li><li><code>no</code>ï¼šä¸æ ¡éªŒï¼Œæ€§èƒ½æå‡çº¦10%ï¼Œä½†æ•°æ®å®Œæ•´æ€§æ— æ³•ä¿è¯</li><li><strong>æ¨è</strong>ï¼š<code>yes</code>ï¼ˆç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼‰</li></ul><p><strong>4. é”™è¯¯å¤„ç†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“bgsaveå‡ºé”™æ—¶ï¼Œæ˜¯å¦åœæ­¢å†™å…¥</span></span><br><span class="line">stop-writes-on-bgsave-error <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼š</p><ul><li><code>yes</code>ï¼šå½“RDBæŒä¹…åŒ–å¤±è´¥æ—¶ï¼Œ<strong>åœæ­¢æ¥å—å†™æ“ä½œ</strong></li><li><code>no</code>ï¼šå³ä½¿RDBå¤±è´¥ï¼Œä¹Ÿç»§ç»­æ¥å—å†™æ“ä½œ</li><li><strong>æ¨è</strong>ï¼š<code>yes</code>ï¼ˆç¡®ä¿æ•°æ®å®‰å…¨ï¼‰</li></ul><p><strong>å®Œæ•´é…ç½®ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RDBé…ç½®</span></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"><span class="built_in">dir</span> /var/lib/redis/</span><br><span class="line"></span><br><span class="line">rdbcompression <span class="built_in">yes</span></span><br><span class="line">rdbchecksum <span class="built_in">yes</span></span><br><span class="line">stop-writes-on-bgsave-error <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><h4 id="8-2-6-RDBå¤‡ä»½ä¸æ¢å¤"><a href="#8-2-6-RDBå¤‡ä»½ä¸æ¢å¤" class="headerlink" title="8.2.6 RDBå¤‡ä»½ä¸æ¢å¤"></a>8.2.6 RDBå¤‡ä»½ä¸æ¢å¤</h4><p><strong>1. RDBå¤‡ä»½</strong></p><p><strong>æ­¥éª¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹RDBæ–‡ä»¶ç›®å½•</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET <span class="built_in">dir</span></span><br><span class="line">1) <span class="string">&quot;dir&quot;</span></span><br><span class="line">2) <span class="string">&quot;/var/lib/redis&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ‰‹åŠ¨è§¦å‘å¤‡ä»½ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; BGSAVE</span><br><span class="line">Background saving started by pid 12345</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ç­‰å¾…å¤‡ä»½å®Œæˆï¼ˆæŸ¥çœ‹çŠ¶æ€ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; INFO persistence</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ rdb_bgsave_in_progress:0 è¡¨ç¤ºå®Œæˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å¤åˆ¶RDBæ–‡ä»¶åˆ°å¤‡ä»½ç›®å½•</span></span><br><span class="line"><span class="built_in">cp</span> /var/lib/redis/dump.rdb /backup/redis/dump_$(<span class="built_in">date</span> +%Y%m%d_%H%M%S).rdb</span><br></pre></td></tr></table></figure><p><strong>è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># backup_rdb.sh</span></span><br><span class="line"></span><br><span class="line">REDIS_CLI=<span class="string">&quot;/usr/local/bin/redis-cli&quot;</span></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/backup/redis&quot;</span></span><br><span class="line">RDB_DIR=<span class="string">&quot;/var/lib/redis&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§¦å‘å¤‡ä»½</span></span><br><span class="line"><span class="variable">$REDIS_CLI</span> BGSAVE</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç­‰å¾…å¤‡ä»½å®Œæˆ</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="string">&quot;<span class="subst">$($REDIS_CLI INFO persistence | grep rdb_bgsave_in_progress | cut -d: -f2 | tr -d &#x27;\r&#x27;)</span>&quot;</span> != <span class="string">&quot;0&quot;</span> ]; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line">TIMESTAMP=$(<span class="built_in">date</span> +%Y%m%d_%H%M%S)</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$RDB_DIR</span>/dump.rdb <span class="variable">$BACKUP_DIR</span>/dump_<span class="variable">$TIMESTAMP</span>.rdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤7å¤©å‰çš„å¤‡ä»½</span></span><br><span class="line">find <span class="variable">$BACKUP_DIR</span> -name <span class="string">&quot;dump_*.rdb&quot;</span> -mtime +7 -delete</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Backup completed: dump_<span class="variable">$TIMESTAMP</span>.rdb&quot;</span></span><br></pre></td></tr></table></figure><p><strong>2. RDBæ¢å¤</strong></p><p><strong>æ­¥éª¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. åœæ­¢RedisæœåŠ¡</span></span><br><span class="line">redis-cli SHUTDOWN</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å¤‡ä»½å½“å‰RDBæ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰</span></span><br><span class="line"><span class="built_in">cp</span> /var/lib/redis/dump.rdb /var/lib/redis/dump.rdb.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å¤åˆ¶å¤‡ä»½æ–‡ä»¶åˆ°å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="built_in">cp</span> /backup/redis/dump_20231117_120000.rdb /var/lib/redis/dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. ç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®</span></span><br><span class="line"><span class="built_in">chown</span> redis:redis /var/lib/redis/dump.rdb</span><br><span class="line"><span class="built_in">chmod</span> 644 /var/lib/redis/dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. å¯åŠ¨Redis</span></span><br><span class="line">redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. éªŒè¯æ•°æ®</span></span><br><span class="line">redis-cli</span><br><span class="line">127.0.0.1:6379&gt; DBSIZE</span><br><span class="line">(<span class="built_in">integer</span>) 1000</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>âš ï¸ æ¢å¤æ—¶<strong>å¿…é¡»åœæ­¢Redis</strong>ï¼Œå¦åˆ™å¯èƒ½è¦†ç›–æ•°æ®</li><li>âš ï¸ ç¡®ä¿å¤‡ä»½æ–‡ä»¶çš„<strong>æƒé™æ­£ç¡®</strong></li><li>âš ï¸ æ¢å¤å<strong>éªŒè¯æ•°æ®å®Œæ•´æ€§</strong></li></ul><h4 id="8-2-7-RDBä¼˜ç¼ºç‚¹åˆ†æ"><a href="#8-2-7-RDBä¼˜ç¼ºç‚¹åˆ†æ" class="headerlink" title="8.2.7 RDBä¼˜ç¼ºç‚¹åˆ†æ"></a>8.2.7 RDBä¼˜ç¼ºç‚¹åˆ†æ</h4><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>é€‚åˆå¤§è§„æ¨¡æ•°æ®æ¢å¤</strong></td><td>æ¢å¤é€Ÿåº¦å¿«ï¼Œé€‚åˆå¤§æ•°æ®é‡åœºæ™¯</td></tr><tr><td><strong>æ–‡ä»¶ä½“ç§¯å°</strong></td><td>å‹ç¼©åæ–‡ä»¶å°ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´</td></tr><tr><td><strong>æ¢å¤é€Ÿåº¦å¿«</strong></td><td>ç›´æ¥åŠ è½½åˆ°å†…å­˜ï¼Œæ¯”AOFå¿«å¾ˆå¤š</td></tr><tr><td><strong>å¯¹æ€§èƒ½å½±å“å°</strong></td><td>å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»è¿›ç¨‹</td></tr><tr><td><strong>é€‚åˆå¤‡ä»½</strong></td><td>å¯ä»¥å®šæœŸå¤‡ä»½ï¼Œä¾¿äºç¾éš¾æ¢å¤</td></tr></tbody></table><p><strong>åŠ£åŠ¿</strong>ï¼š</p><table><thead><tr><th>åŠ£åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ•°æ®å¯èƒ½ä¸¢å¤±</strong></td><td>æœ€åä¸€æ¬¡å¿«ç…§åçš„æ•°æ®ä¼šä¸¢å¤±</td></tr><tr><td><strong>Forkæ¶ˆè€—æ€§èƒ½</strong></td><td>å¤§æ•°æ®é‡æ—¶forkæ“ä½œè€—æ—¶</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>Forkæ—¶å†…å­˜å¯èƒ½è†¨èƒ€åˆ°2å€</td></tr><tr><td><strong>ä¸é€‚åˆå®æ—¶å¤‡ä»½</strong></td><td>åªèƒ½å®šæœŸå¤‡ä»½ï¼Œä¸èƒ½å®æ—¶ä¿å­˜</td></tr></tbody></table><p><strong>æ•°æ®ä¸¢å¤±é£é™©</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ—¶é—´çº¿ï¼š</span><br><span class="line">T1: æ‰§è¡ŒRDBå¿«ç…§ï¼ˆä¿å­˜äº†T1æ—¶åˆ»çš„æ•°æ®ï¼‰</span><br><span class="line">T2: æ•°æ®ä¿®æ”¹ï¼ˆæœªä¿å­˜ï¼‰</span><br><span class="line">T3: æ•°æ®ä¿®æ”¹ï¼ˆæœªä¿å­˜ï¼‰</span><br><span class="line">T4: Rediså®•æœº âŒ</span><br><span class="line"></span><br><span class="line">ç»“æœï¼šT1åˆ°T4ä¹‹é—´çš„æ•°æ®å…¨éƒ¨ä¸¢å¤±</span><br></pre></td></tr></table></figure><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>æ˜¯å¦é€‚åˆ</th><th>åŸå› </th></tr></thead><tbody><tr><td><strong>æ•°æ®å¤‡ä»½</strong></td><td>âœ… é€‚åˆ</td><td>å®šæœŸå¤‡ä»½ï¼Œæ–‡ä»¶å°</td></tr><tr><td><strong>ç¾éš¾æ¢å¤</strong></td><td>âœ… é€‚åˆ</td><td>æ¢å¤é€Ÿåº¦å¿«</td></tr><tr><td><strong>æ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜</strong></td><td>âŒ ä¸é€‚åˆ</td><td>å¯èƒ½ä¸¢å¤±æ•°æ®</td></tr><tr><td><strong>å®æ—¶æ€§è¦æ±‚é«˜</strong></td><td>âŒ ä¸é€‚åˆ</td><td>åªèƒ½å®šæœŸä¿å­˜</td></tr><tr><td><strong>å¤§è§„æ¨¡æ•°æ®</strong></td><td>âœ… é€‚åˆ</td><td>æ¢å¤é€Ÿåº¦å¿«</td></tr></tbody></table><h4 id="8-2-8-åŠ¨æ€åœæ­¢RDB"><a href="#8-2-8-åŠ¨æ€åœæ­¢RDB" class="headerlink" title="8.2.8 åŠ¨æ€åœæ­¢RDB"></a>8.2.8 åŠ¨æ€åœæ­¢RDB</h4><p><strong>æ–¹æ³•1ï¼šæ¸…ç©ºsaveé…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; CONFIG SET save <span class="string">&quot;&quot;</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•2ï¼šæ³¨é‡Šé…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¾‘redis.conf</span></span><br><span class="line"><span class="comment"># save 900 1</span></span><br><span class="line"><span class="comment"># save 300 10</span></span><br><span class="line"><span class="comment"># save 60 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯Redisæˆ–æ‰§è¡Œ</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG REWRITE</span><br></pre></td></tr></table></figure><p><strong>éªŒè¯</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; CONFIG GET save</span><br><span class="line">1) <span class="string">&quot;save&quot;</span></span><br><span class="line">2) <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="8-3-AOFæŒä¹…åŒ–"><a href="#8-3-AOFæŒä¹…åŒ–" class="headerlink" title="8.3 AOFæŒä¹…åŒ–"></a>8.3 AOFæŒä¹…åŒ–</h3><h4 id="8-3-1-ä»€ä¹ˆæ˜¯AOF"><a href="#8-3-1-ä»€ä¹ˆæ˜¯AOF" class="headerlink" title="8.3.1 ä»€ä¹ˆæ˜¯AOF"></a>8.3.1 ä»€ä¹ˆæ˜¯AOF</h4><p><strong>AOFï¼ˆAppend Only Fileï¼‰</strong>ï¼š</p><ul><li><strong>å…¨ç§°</strong>ï¼šAppend Only Fileï¼ˆåªè¿½åŠ æ–‡ä»¶ï¼‰</li><li><strong>åŸç†</strong>ï¼šä»¥<strong>æ—¥å¿—å½¢å¼</strong>è®°å½•æ¯ä¸ª<strong>å†™æ“ä½œ</strong>ï¼ˆå¢é‡ä¿å­˜ï¼‰</li><li><strong>ç‰¹ç‚¹</strong>ï¼šåªè¿½åŠ æ–‡ä»¶ï¼Œ<strong>ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶</strong></li><li><strong>æ¢å¤æ–¹å¼</strong>ï¼šRediså¯åŠ¨æ—¶è¯»å–AOFæ–‡ä»¶ï¼Œé‡æ–°æ‰§è¡Œæ‰€æœ‰å†™æ“ä½œ</li></ul><p><strong>AOFæ–‡ä»¶</strong>ï¼š</p><ul><li><strong>é»˜è®¤æ–‡ä»¶å</strong>ï¼š<code>appendonly.aof</code></li><li><strong>æ–‡ä»¶æ ¼å¼</strong>ï¼šæ–‡æœ¬æ–‡ä»¶ï¼ˆå¯è¯»ï¼‰</li><li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šä¸RDBæ–‡ä»¶åœ¨åŒä¸€ç›®å½•ï¼ˆé€šè¿‡<code>dir</code>é…ç½®ï¼‰</li></ul><p><strong>AOF vs RDB</strong>ï¼š</p><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>RDB</th><th>AOF</th></tr></thead><tbody><tr><td><strong>è®°å½•æ–¹å¼</strong></td><td>å¿«ç…§ï¼ˆSnapshotï¼‰</td><td>æ—¥å¿—ï¼ˆLogï¼‰</td></tr><tr><td><strong>æ–‡ä»¶æ ¼å¼</strong></td><td>äºŒè¿›åˆ¶å‹ç¼©</td><td>æ–‡æœ¬æ–‡ä»¶</td></tr><tr><td><strong>è®°å½•å†…å®¹</strong></td><td>æ•°æ®æœ¬èº«</td><td>å†™æ“ä½œå‘½ä»¤</td></tr><tr><td><strong>æ–‡ä»¶å¤§å°</strong></td><td>å°</td><td>å¤§</td></tr><tr><td><strong>æ¢å¤é€Ÿåº¦</strong></td><td>å¿«</td><td>æ…¢</td></tr><tr><td><strong>æ•°æ®ä¸¢å¤±</strong></td><td>å¯èƒ½ä¸¢å¤±</td><td>å‡ ä¹ä¸ä¸¢å¤±</td></tr></tbody></table><h4 id="8-3-2-AOFæŒä¹…åŒ–æµç¨‹"><a href="#8-3-2-AOFæŒä¹…åŒ–æµç¨‹" class="headerlink" title="8.3.2 AOFæŒä¹…åŒ–æµç¨‹"></a>8.3.2 AOFæŒä¹…åŒ–æµç¨‹</h4><p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[å®¢æˆ·ç«¯å‘é€å†™å‘½ä»¤]</span><br><span class="line">    â†“</span><br><span class="line">[å‘½ä»¤è¿½åŠ åˆ°AOFç¼“å†²åŒº]</span><br><span class="line">    â†“</span><br><span class="line">[æ ¹æ®åŒæ­¥ç­–ç•¥åŒæ­¥åˆ°ç£ç›˜]</span><br><span class="line">    â†“</span><br><span class="line">[AOFæ–‡ä»¶å¤§å°è¶…è¿‡é˜ˆå€¼]</span><br><span class="line">    â†“</span><br><span class="line">[è§¦å‘AOFé‡å†™ï¼ˆå‹ç¼©ï¼‰]</span><br><span class="line">    â†“</span><br><span class="line">[Redisé‡å¯æ—¶åŠ è½½AOFæ–‡ä»¶]</span><br><span class="line">    â†“</span><br><span class="line">[é‡æ–°æ‰§è¡Œæ‰€æœ‰å†™æ“ä½œæ¢å¤æ•°æ®]</span><br></pre></td></tr></table></figure><p><strong>è¯¦ç»†æ­¥éª¤</strong>ï¼š</p><ol><li><strong>å‘½ä»¤è¿½åŠ </strong>ï¼šå®¢æˆ·ç«¯çš„è¯·æ±‚å†™å‘½ä»¤ä¼šè¢«<code>append</code>è¿½åŠ åˆ°AOFç¼“å†²åŒºå†…</li><li><strong>åŒæ­¥åˆ°ç£ç›˜</strong>ï¼šAOFç¼“å†²åŒºæ ¹æ®AOFæŒä¹…åŒ–ç­–ç•¥ï¼ˆalways&#x2F;everysec&#x2F;noï¼‰å°†æ“ä½œ<code>sync</code>åŒæ­¥åˆ°ç£ç›˜çš„AOFæ–‡ä»¶ä¸­</li><li><strong>AOFé‡å†™</strong>ï¼šAOFæ–‡ä»¶å¤§å°è¶…è¿‡é‡å†™ç­–ç•¥æˆ–æ‰‹åŠ¨é‡å†™æ—¶ï¼Œä¼šå¯¹AOFæ–‡ä»¶<code>rewrite</code>é‡å†™ï¼Œå‹ç¼©AOFæ–‡ä»¶å®¹é‡</li><li><strong>æ•°æ®æ¢å¤</strong>ï¼šRedisæœåŠ¡é‡å¯æ—¶ï¼Œä¼šé‡æ–°<code>load</code>åŠ è½½AOFæ–‡ä»¶ä¸­çš„å†™æ“ä½œè¾¾åˆ°æ•°æ®æ¢å¤çš„ç›®çš„</li></ol><p><strong>æµç¨‹å›¾</strong>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/AOF%E6%B5%81%E7%A8%8B.png" alt="AOFæŒä¹…åŒ–æµç¨‹"></p><h4 id="8-3-3-AOFé…ç½®"><a href="#8-3-3-AOFé…ç½®" class="headerlink" title="8.3.3 AOFé…ç½®"></a>8.3.3 AOFé…ç½®</h4><p><strong>1. å¼€å¯AOF</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯AOFæŒä¹…åŒ–</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># AOFæ–‡ä»¶å</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># AOFæ–‡ä»¶ä¿å­˜è·¯å¾„ï¼ˆä¸RDBç›¸åŒï¼‰</span></span><br><span class="line"><span class="built_in">dir</span> /var/lib/redis/</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹é…ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; CONFIG GET appendonly</span><br><span class="line">1) <span class="string">&quot;appendonly&quot;</span></span><br><span class="line">2) <span class="string">&quot;yes&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET appendfilename</span><br><span class="line">1) <span class="string">&quot;appendfilename&quot;</span></span><br><span class="line">2) <span class="string">&quot;appendonly.aof&quot;</span></span><br></pre></td></tr></table></figure><p><strong>2. AOFåŒæ­¥é¢‘ç‡</strong></p><p><strong>é…ç½®é€‰é¡¹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line">appendfsync always    <span class="comment"># å§‹ç»ˆåŒæ­¥</span></span><br><span class="line">appendfsync everysec  <span class="comment"># æ¯ç§’åŒæ­¥ï¼ˆæ¨èï¼‰</span></span><br><span class="line">appendfsync no        <span class="comment"># ä¸ä¸»åŠ¨åŒæ­¥</span></span><br></pre></td></tr></table></figure><p><strong>ä¸‰ç§ç­–ç•¥å¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th>ç­–ç•¥</th><th>åŒæ­¥æ—¶æœº</th><th>æ€§èƒ½</th><th>æ•°æ®å®‰å…¨æ€§</th><th>æ¨èåº¦</th></tr></thead><tbody><tr><td><strong>always</strong></td><td>æ¯æ¬¡å†™å…¥éƒ½åŒæ­¥</td><td>âŒ æœ€æ…¢</td><td>âœ… æœ€é«˜ï¼ˆå‡ ä¹ä¸ä¸¢æ•°æ®ï¼‰</td><td>â­â­</td></tr><tr><td><strong>everysec</strong></td><td>æ¯ç§’åŒæ­¥ä¸€æ¬¡</td><td>âœ… è¾ƒå¿«</td><td>âœ… è¾ƒé«˜ï¼ˆæœ€å¤šä¸¢å¤±1ç§’æ•°æ®ï¼‰</td><td>â­â­â­â­â­</td></tr><tr><td><strong>no</strong></td><td>ç”±æ“ä½œç³»ç»Ÿå†³å®š</td><td>âœ… æœ€å¿«</td><td>âš ï¸ è¾ƒä½ï¼ˆå¯èƒ½ä¸¢å¤±è¾ƒå¤šæ•°æ®ï¼‰</td><td>â­â­</td></tr></tbody></table><p><strong>è¯¦ç»†è¯´æ˜</strong>ï¼š</p><p><strong>appendfsync always</strong>ï¼š</p><ul><li>âœ… <strong>æ•°æ®æœ€å®‰å…¨</strong>ï¼šæ¯æ¬¡Rediså†™å…¥éƒ½ä¼šç«‹åˆ»è®°å…¥æ—¥å¿—</li><li>âŒ <strong>æ€§èƒ½æœ€å·®</strong>ï¼šæ¯æ¬¡å†™å…¥éƒ½è¦è¿›è¡Œç£ç›˜IO</li><li>âš ï¸ <strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚æé«˜çš„åœºæ™¯</li></ul><p><strong>appendfsync everysec</strong>ï¼š</p><ul><li>âœ… <strong>æ€§èƒ½è¾ƒå¥½</strong>ï¼šæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œå¹³è¡¡äº†æ€§èƒ½å’Œæ•°æ®å®‰å…¨</li><li>âœ… <strong>æ¨èä½¿ç”¨</strong>ï¼šç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®</li><li>âš ï¸ <strong>å¯èƒ½ä¸¢å¤±</strong>ï¼šå¦‚æœå®•æœºï¼Œæœ¬ç§’çš„æ•°æ®å¯èƒ½ä¸¢å¤±</li></ul><p><strong>appendfsync no</strong>ï¼š</p><ul><li>âœ… <strong>æ€§èƒ½æœ€å¥½</strong>ï¼šRedisä¸ä¸»åŠ¨åŒæ­¥ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®š</li><li>âš ï¸ <strong>æ•°æ®é£é™©</strong>ï¼šå¯èƒ½ä¸¢å¤±è¾ƒå¤šæ•°æ®ï¼ˆå–å†³äºæ“ä½œç³»ç»Ÿï¼‰</li><li>âš ï¸ <strong>ä¸æ¨è</strong>ï¼šé™¤éå¯¹æ€§èƒ½è¦æ±‚æé«˜ä¸”å¯ä»¥æ¥å—æ•°æ®ä¸¢å¤±</li></ul><p><strong>3. AOFå’ŒRDBåŒæ—¶å¼€å¯</strong></p><p><strong>ä¼˜å…ˆçº§</strong>ï¼š</p><ul><li>âœ… <strong>AOFä¼˜å…ˆ</strong>ï¼šå¦‚æœAOFå’ŒRDBåŒæ—¶å¼€å¯ï¼ŒRedis<strong>é»˜è®¤ä½¿ç”¨AOF</strong>æ¢å¤æ•°æ®</li><li>âœ… <strong>æ•°æ®æ›´å®Œæ•´</strong>ï¼šAOFè®°å½•æ›´è¯¦ç»†ï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±</li></ul><p><strong>éªŒè¯</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒæ—¶å¼€å¯RDBå’ŒAOF</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">save 900 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯Redisåï¼Œä¼šä¼˜å…ˆåŠ è½½AOFæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h4 id="8-3-4-AOFé‡å†™ï¼ˆRewriteï¼‰"><a href="#8-3-4-AOFé‡å†™ï¼ˆRewriteï¼‰" class="headerlink" title="8.3.4 AOFé‡å†™ï¼ˆRewriteï¼‰"></a>8.3.4 AOFé‡å†™ï¼ˆRewriteï¼‰</h4><p><strong>1. ä»€ä¹ˆæ˜¯AOFé‡å†™</strong></p><p><strong>é—®é¢˜</strong>ï¼š</p><ul><li>AOFé‡‡ç”¨<strong>æ–‡ä»¶è¿½åŠ æ–¹å¼</strong>ï¼Œæ–‡ä»¶ä¼š<strong>è¶Šæ¥è¶Šå¤§</strong></li><li>ä¾‹å¦‚ï¼šå¯¹åŒä¸€ä¸ªkeyæ‰§è¡Œ100æ¬¡<code>INCR</code>ï¼ŒAOFæ–‡ä»¶ä¼šè®°å½•100æ¡å‘½ä»¤</li><li>å®é™…ä¸Šåªéœ€è¦ä¸€æ¡<code>SET key 100</code>å°±å¯ä»¥æ¢å¤</li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><strong>AOFé‡å†™</strong>ï¼šå½“AOFæ–‡ä»¶å¤§å°è¶…è¿‡é˜ˆå€¼æ—¶ï¼ŒRedisä¼šå¯åŠ¨AOFæ–‡ä»¶å†…å®¹å‹ç¼©</li><li><strong>ç›®çš„</strong>ï¼šåªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„<strong>æœ€å°æŒ‡ä»¤é›†</strong></li><li><strong>æ•ˆæœ</strong>ï¼šå¯ä»¥æ˜¾è‘—å‡å°‘AOFæ–‡ä»¶å¤§å°</li></ul><p><strong>2. AOFé‡å†™åŸç†</strong></p><p><strong>Redis 4.0ä¹‹å‰</strong>ï¼š</p><ul><li>é‡å†™æ—¶ï¼Œéå†å†…å­˜ä¸­çš„æ•°æ®ï¼Œç”Ÿæˆå¯¹åº”çš„å†™å‘½ä»¤</li><li>å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œæœ€åæ›¿æ¢åŸAOFæ–‡ä»¶</li></ul><p><strong>Redis 4.0ä¹‹åï¼ˆæ··åˆæŒä¹…åŒ–ï¼‰</strong>ï¼š</p><ul><li>é‡å†™æ—¶ï¼Œå°†<strong>RDBå¿«ç…§</strong>ä»¥äºŒè¿›åˆ¶å½¢å¼é™„åœ¨æ–°çš„AOFæ–‡ä»¶å¤´éƒ¨</li><li>ä½œä¸ºå·²æœ‰çš„å†å²æ•°æ®ï¼Œæ›¿æ¢æ‰åŸæ¥çš„æµæ°´è´¦æ“ä½œ</li><li><strong>ä¼˜åŠ¿</strong>ï¼šç»“åˆRDBå’ŒAOFçš„ä¼˜åŠ¿ï¼Œæ¢å¤æ›´å¿«</li></ul><p><strong>é‡å†™æµç¨‹</strong>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/AOF%E9%87%8D%E5%86%99%E6%B5%81%E7%A8%8B.png" alt="AOFé‡å†™æµç¨‹"></p><p><strong>è¯¦ç»†æ­¥éª¤</strong>ï¼š</p><ol><li><strong>è§¦å‘é‡å†™</strong>ï¼š<code>bgrewriteaof</code>è§¦å‘é‡å†™ï¼Œåˆ¤æ–­æ˜¯å¦å½“å‰æœ‰<code>bgsave</code>æˆ–<code>bgrewriteaof</code>åœ¨è¿è¡Œï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç­‰å¾…è¯¥å‘½ä»¤ç»“æŸåå†ç»§ç»­æ‰§è¡Œ</li><li><strong>Forkå­è¿›ç¨‹</strong>ï¼šä¸»è¿›ç¨‹forkå‡ºå­è¿›ç¨‹æ‰§è¡Œé‡å†™æ“ä½œï¼Œä¿è¯ä¸»è¿›ç¨‹ä¸ä¼šé˜»å¡</li><li><strong>å†™å…¥ä¸´æ—¶æ–‡ä»¶</strong>ï¼šå­è¿›ç¨‹éå†rediså†…å­˜ä¸­æ•°æ®åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯çš„å†™è¯·æ±‚åŒæ—¶å†™å…¥<code>aof_buf</code>ç¼“å†²åŒºå’Œ<code>aof_rewrite_buf</code>é‡å†™ç¼“å†²åŒºï¼Œä¿è¯åŸAOFæ–‡ä»¶å®Œæ•´ä»¥åŠæ–°AOFæ–‡ä»¶ç”ŸæˆæœŸé—´çš„æ–°çš„æ•°æ®ä¿®æ”¹åŠ¨ä½œä¸ä¼šä¸¢å¤±</li><li><strong>åˆå¹¶ç¼“å†²åŒº</strong>ï¼šå­è¿›ç¨‹å†™å®Œæ–°çš„AOFæ–‡ä»¶åï¼Œå‘ä¸»è¿›ç¨‹å‘ä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼›ä¸»è¿›ç¨‹æŠŠ<code>aof_rewrite_buf</code>ä¸­çš„æ•°æ®å†™å…¥åˆ°æ–°çš„AOFæ–‡ä»¶</li><li><strong>æ›¿æ¢æ–‡ä»¶</strong>ï¼šä½¿ç”¨æ–°çš„AOFæ–‡ä»¶è¦†ç›–æ—§çš„AOFæ–‡ä»¶ï¼Œå®ŒæˆAOFé‡å†™</li></ol><p><strong>3. AOFé‡å†™è§¦å‘æœºåˆ¶</strong></p><p><strong>è‡ªåŠ¨è§¦å‘</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å†™åŸºå‡†å€¼ï¼šæ–‡ä»¶è¾¾åˆ°ä¸Šæ¬¡é‡å†™åå¤§å°çš„100%æ—¶å¼€å§‹é‡å†™</span></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å†™åŸºå‡†å€¼ï¼šæœ€å°æ–‡ä»¶64MB</span></span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼š</p><ul><li>Redisä¼šè®°å½•ä¸Šæ¬¡é‡å†™æ—¶çš„AOFå¤§å°ï¼Œè®¾ä¸º<code>base_size</code></li><li>å¦‚æœRedisçš„AOFå½“å‰å¤§å° &gt;&#x3D; <code>base_size + base_size * 100%</code>ï¼ˆé»˜è®¤ï¼‰</li><li><strong>ä¸”</strong>å½“å‰å¤§å° &gt;&#x3D; 64MBï¼ˆé»˜è®¤ï¼‰</li><li>åˆ™Redisä¼šå¯¹AOFè¿›è¡Œé‡å†™</li></ul><p><strong>ç¤ºä¾‹è®¡ç®—</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">åœºæ™¯ï¼šæ–‡ä»¶è¾¾åˆ°70MBå¼€å§‹é‡å†™ï¼Œé™åˆ°50MBï¼Œä¸‹æ¬¡ä»€ä¹ˆæ—¶å€™å¼€å§‹é‡å†™ï¼Ÿ</span><br><span class="line"></span><br><span class="line">base_size = 50MBï¼ˆä¸Šæ¬¡é‡å†™åçš„å¤§å°ï¼‰</span><br><span class="line">å½“å‰å¤§å° = 50MB</span><br><span class="line"></span><br><span class="line">è§¦å‘æ¡ä»¶ï¼š</span><br><span class="line">å½“å‰å¤§å° &gt;= base_size + base_size * 100%</span><br><span class="line">50MB &gt;= 50MB + 50MB * 100%</span><br><span class="line">50MB &gt;= 100MB âŒï¼ˆä¸æ»¡è¶³ï¼‰</span><br><span class="line"></span><br><span class="line">å½“æ–‡ä»¶è¾¾åˆ°100MBæ—¶ï¼š</span><br><span class="line">100MB &gt;= 50MB + 50MB * 100%</span><br><span class="line">100MB &gt;= 100MB âœ…ï¼ˆæ»¡è¶³ï¼‰</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š100MBæ—¶å¼€å§‹é‡å†™</span><br></pre></td></tr></table></figure><p><strong>æ‰‹åŠ¨è§¦å‘</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; BGREWRITEAOF</span><br><span class="line">Background append only file rewriting started</span><br></pre></td></tr></table></figure><p><strong>4. AOFé‡å†™é…ç½®</strong></p><p><strong>no-appendfsync-on-rewrite</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line">no-appendfsync-on-rewrite no</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼š</p><table><thead><tr><th>é…ç½®å€¼</th><th>è¡Œä¸º</th><th>æ•°æ®å®‰å…¨æ€§</th><th>æ€§èƒ½</th><th>æ¨è</th></tr></thead><tbody><tr><td><strong>yes</strong></td><td>é‡å†™æœŸé—´ä¸å†™å…¥AOFæ–‡ä»¶ï¼Œåªå†™å…¥ç¼“å­˜</td><td>âš ï¸ é™ä½ï¼ˆå¯èƒ½ä¸¢å¤±ç¼“å­˜æ•°æ®ï¼‰</td><td>âœ… æé«˜ï¼ˆä¸é˜»å¡ï¼‰</td><td>â­â­â­</td></tr><tr><td><strong>no</strong></td><td>é‡å†™æœŸé—´ç»§ç»­å†™å…¥AOFæ–‡ä»¶</td><td>âœ… æé«˜ï¼ˆæ•°æ®å®‰å…¨ï¼‰</td><td>âš ï¸ é™ä½ï¼ˆå¯èƒ½é˜»å¡ï¼‰</td><td>â­â­â­â­</td></tr></tbody></table><p><strong>æ¨èé…ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿäº§ç¯å¢ƒæ¨è</span></span><br><span class="line">no-appendfsync-on-rewrite no  <span class="comment"># æ•°æ®å®‰å…¨ä¼˜å…ˆ</span></span><br></pre></td></tr></table></figure><h4 id="8-3-5-AOFå¤‡ä»½ä¸æ¢å¤"><a href="#8-3-5-AOFå¤‡ä»½ä¸æ¢å¤" class="headerlink" title="8.3.5 AOFå¤‡ä»½ä¸æ¢å¤"></a>8.3.5 AOFå¤‡ä»½ä¸æ¢å¤</h4><p><strong>1. AOFå¤‡ä»½</strong></p><p><strong>æ­¥éª¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹AOFæ–‡ä»¶ç›®å½•</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET <span class="built_in">dir</span></span><br><span class="line">1) <span class="string">&quot;dir&quot;</span></span><br><span class="line">2) <span class="string">&quot;/var/lib/redis&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ‰‹åŠ¨è§¦å‘é‡å†™ï¼ˆå¯é€‰ï¼Œå‹ç¼©æ–‡ä»¶ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; BGREWRITEAOF</span><br><span class="line">Background append only file rewriting started</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å¤åˆ¶AOFæ–‡ä»¶åˆ°å¤‡ä»½ç›®å½•</span></span><br><span class="line"><span class="built_in">cp</span> /var/lib/redis/appendonly.aof /backup/redis/appendonly_$(<span class="built_in">date</span> +%Y%m%d_%H%M%S).aof</span><br></pre></td></tr></table></figure><p><strong>è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># backup_aof.sh</span></span><br><span class="line"></span><br><span class="line">REDIS_CLI=<span class="string">&quot;/usr/local/bin/redis-cli&quot;</span></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/backup/redis&quot;</span></span><br><span class="line">AOF_DIR=<span class="string">&quot;/var/lib/redis&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§¦å‘é‡å†™ï¼ˆå‹ç¼©ï¼‰</span></span><br><span class="line"><span class="variable">$REDIS_CLI</span> BGREWRITEAOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç­‰å¾…é‡å†™å®Œæˆ</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="string">&quot;<span class="subst">$($REDIS_CLI INFO persistence | grep aof_rewrite_in_progress | cut -d: -f2 | tr -d &#x27;\r&#x27;)</span>&quot;</span> != <span class="string">&quot;0&quot;</span> ]; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line">TIMESTAMP=$(<span class="built_in">date</span> +%Y%m%d_%H%M%S)</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$AOF_DIR</span>/appendonly.aof <span class="variable">$BACKUP_DIR</span>/appendonly_<span class="variable">$TIMESTAMP</span>.aof</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤7å¤©å‰çš„å¤‡ä»½</span></span><br><span class="line">find <span class="variable">$BACKUP_DIR</span> -name <span class="string">&quot;appendonly_*.aof&quot;</span> -mtime +7 -delete</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Backup completed: appendonly_<span class="variable">$TIMESTAMP</span>.aof&quot;</span></span><br></pre></td></tr></table></figure><p><strong>2. AOFæ¢å¤</strong></p><p><strong>æ­£å¸¸æ¢å¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. ä¿®æ”¹é…ç½®ï¼Œå¼€å¯AOF</span></span><br><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å°†æœ‰æ•°æ®çš„aofæ–‡ä»¶å¤åˆ¶åˆ°å¯¹åº”ç›®å½•</span></span><br><span class="line"><span class="built_in">cp</span> /backup/redis/appendonly_20231117_120000.aof /var/lib/redis/appendonly.aof</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ç¡®ä¿æ–‡ä»¶æƒé™</span></span><br><span class="line"><span class="built_in">chown</span> redis:redis /var/lib/redis/appendonly.aof</span><br><span class="line"><span class="built_in">chmod</span> 644 /var/lib/redis/appendonly.aof</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å¯åŠ¨Redis</span></span><br><span class="line">redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. éªŒè¯æ•°æ®</span></span><br><span class="line">redis-cli</span><br><span class="line">127.0.0.1:6379&gt; DBSIZE</span><br><span class="line">(<span class="built_in">integer</span>) 1000</span><br></pre></td></tr></table></figure><p><strong>å¼‚å¸¸æ¢å¤ï¼ˆAOFæ–‡ä»¶æŸåï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. å¤‡ä»½æŸåçš„AOFæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cp</span> /var/lib/redis/appendonly.aof /var/lib/redis/appendonly.aof.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ä½¿ç”¨redis-check-aofä¿®å¤</span></span><br><span class="line">redis-check-aof --fix /var/lib/redis/appendonly.aof</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment"># 0x              8b: Expected prefix &#x27;*&#x27;, got: &#x27;A&#x27;</span></span><br><span class="line"><span class="comment"># AOF analyzed: size=123, ok_up_to=100, diff=23</span></span><br><span class="line"><span class="comment"># This will shrink the AOF from 123 bytes, with 23 bytes, to 100 bytes</span></span><br><span class="line"><span class="comment"># Continue? [y/N]: y</span></span><br><span class="line"><span class="comment"># Successfully truncated AOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å¯åŠ¨Redis</span></span><br><span class="line">redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. éªŒè¯æ•°æ®</span></span><br><span class="line">redis-cli</span><br><span class="line">127.0.0.1:6379&gt; DBSIZE</span><br><span class="line">(<span class="built_in">integer</span>) 950  <span class="comment"># å¯èƒ½æ¯”åŸæ¥å°‘ï¼ˆä¸¢å¤±äº†æŸåéƒ¨åˆ†çš„æ•°æ®ï¼‰</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>âš ï¸ ä¿®å¤AOFæ–‡ä»¶å¯èƒ½ä¼š<strong>ä¸¢å¤±éƒ¨åˆ†æ•°æ®</strong>ï¼ˆæŸåéƒ¨åˆ†ï¼‰</li><li>âš ï¸ ä¿®å¤å‰<strong>åŠ¡å¿…å¤‡ä»½</strong>åŸæ–‡ä»¶</li><li>âš ï¸ ä¿®å¤å<strong>éªŒè¯æ•°æ®å®Œæ•´æ€§</strong></li></ul><h4 id="8-3-6-AOFä¼˜ç¼ºç‚¹åˆ†æ"><a href="#8-3-6-AOFä¼˜ç¼ºç‚¹åˆ†æ" class="headerlink" title="8.3.6 AOFä¼˜ç¼ºç‚¹åˆ†æ"></a>8.3.6 AOFä¼˜ç¼ºç‚¹åˆ†æ</h4><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å¤‡ä»½æœºåˆ¶æ›´ç¨³å¥</strong></td><td>ä¸¢å¤±æ•°æ®æ¦‚ç‡æ›´ä½ï¼Œæœ€å¤šä¸¢å¤±1ç§’æ•°æ®ï¼ˆeverysecï¼‰</td></tr><tr><td><strong>å¯è¯»çš„æ—¥å¿—æ–‡æœ¬</strong></td><td>AOFæ–‡ä»¶æ˜¯æ–‡æœ¬æ ¼å¼ï¼Œå¯ä»¥æŸ¥çœ‹å’Œç¼–è¾‘</td></tr><tr><td><strong>å¯ä»¥å¤„ç†è¯¯æ“ä½œ</strong></td><td>å¯ä»¥é€šè¿‡ç¼–è¾‘AOFæ–‡ä»¶æ¢å¤è¯¯åˆ é™¤çš„æ•°æ®</td></tr><tr><td><strong>æ•°æ®å®Œæ•´æ€§é«˜</strong></td><td>è®°å½•æ¯ä¸ªå†™æ“ä½œï¼Œæ•°æ®å‡ ä¹ä¸ä¸¢å¤±</td></tr><tr><td><strong>æ”¯æŒé‡å†™å‹ç¼©</strong></td><td>å¯ä»¥å‹ç¼©AOFæ–‡ä»¶ï¼Œå‡å°‘ç£ç›˜å ç”¨</td></tr></tbody></table><p><strong>åŠ£åŠ¿</strong>ï¼š</p><table><thead><tr><th>åŠ£åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å ç”¨æ›´å¤šç£ç›˜ç©ºé—´</strong></td><td>AOFæ–‡ä»¶é€šå¸¸æ¯”RDBæ–‡ä»¶å¤§</td></tr><tr><td><strong>æ¢å¤é€Ÿåº¦æ…¢</strong></td><td>éœ€è¦é‡æ–°æ‰§è¡Œæ‰€æœ‰å†™æ“ä½œï¼Œæ¯”RDBæ…¢</td></tr><tr><td><strong>æ€§èƒ½å‹åŠ›</strong></td><td>æ¯æ¬¡å†™æ“ä½œéƒ½è¦è®°å½•ï¼Œæœ‰ä¸€å®šæ€§èƒ½å½±å“</td></tr><tr><td><strong>å­˜åœ¨ä¸ªåˆ«Bug</strong></td><td>æå°‘æ•°æƒ…å†µä¸‹å¯èƒ½é€ æˆæ¢å¤å¤±è´¥</td></tr></tbody></table><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>æ˜¯å¦é€‚åˆ</th><th>åŸå› </th></tr></thead><tbody><tr><td><strong>æ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜</strong></td><td>âœ… é€‚åˆ</td><td>å‡ ä¹ä¸ä¸¢å¤±æ•°æ®</td></tr><tr><td><strong>å¯ä»¥æ¥å—æ¢å¤æ…¢</strong></td><td>âœ… é€‚åˆ</td><td>æ¢å¤é€Ÿåº¦å¯ä»¥æ¥å—</td></tr><tr><td><strong>éœ€è¦å¤„ç†è¯¯æ“ä½œ</strong></td><td>âœ… é€‚åˆ</td><td>å¯ä»¥ç¼–è¾‘AOFæ–‡ä»¶</td></tr><tr><td><strong>å¤§è§„æ¨¡æ•°æ®æ¢å¤</strong></td><td>âŒ ä¸é€‚åˆ</td><td>æ¢å¤é€Ÿåº¦æ…¢</td></tr><tr><td><strong>ç£ç›˜ç©ºé—´æœ‰é™</strong></td><td>âŒ ä¸é€‚åˆ</td><td>æ–‡ä»¶å ç”¨ç©ºé—´å¤§</td></tr></tbody></table><h3 id="8-4-æ··åˆæŒä¹…åŒ–ï¼ˆRedis-4-0-ï¼‰"><a href="#8-4-æ··åˆæŒä¹…åŒ–ï¼ˆRedis-4-0-ï¼‰" class="headerlink" title="8.4 æ··åˆæŒä¹…åŒ–ï¼ˆRedis 4.0+ï¼‰"></a>8.4 æ··åˆæŒä¹…åŒ–ï¼ˆRedis 4.0+ï¼‰</h3><h4 id="8-4-1-ä»€ä¹ˆæ˜¯æ··åˆæŒä¹…åŒ–"><a href="#8-4-1-ä»€ä¹ˆæ˜¯æ··åˆæŒä¹…åŒ–" class="headerlink" title="8.4.1 ä»€ä¹ˆæ˜¯æ··åˆæŒä¹…åŒ–"></a>8.4.1 ä»€ä¹ˆæ˜¯æ··åˆæŒä¹…åŒ–</h4><p><strong>æ··åˆæŒä¹…åŒ–ï¼ˆRDB + AOFï¼‰</strong>ï¼š</p><ul><li><strong>ç‰ˆæœ¬è¦æ±‚</strong>ï¼šRedis 4.0+</li><li><strong>åŸç†</strong>ï¼šç»“åˆRDBå’ŒAOFçš„ä¼˜åŠ¿</li><li><strong>æ–‡ä»¶æ ¼å¼</strong>ï¼šAOFæ–‡ä»¶å¤´éƒ¨æ˜¯RDBæ ¼å¼ï¼Œåé¢æ˜¯AOFæ ¼å¼</li></ul><p><strong>æ–‡ä»¶ç»“æ„</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[appendonly.aofæ–‡ä»¶]</span><br><span class="line">â”œâ”€â”€ [RDBæ ¼å¼æ•°æ®]ï¼ˆæ–‡ä»¶å¤´éƒ¨ï¼ŒäºŒè¿›åˆ¶ï¼‰</span><br><span class="line">â”‚   â””â”€â”€ å†å²æ•°æ®å¿«ç…§</span><br><span class="line">â””â”€â”€ [AOFæ ¼å¼æ•°æ®]ï¼ˆæ–‡ä»¶å°¾éƒ¨ï¼Œæ–‡æœ¬ï¼‰</span><br><span class="line">    â””â”€â”€ å¢é‡å†™æ“ä½œ</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>âœ… <strong>æ¢å¤é€Ÿåº¦å¿«</strong>ï¼šRDBéƒ¨åˆ†å¿«é€ŸåŠ è½½</li><li>âœ… <strong>æ•°æ®å®Œæ•´æ€§é«˜</strong>ï¼šAOFéƒ¨åˆ†ä¿è¯æ•°æ®ä¸ä¸¢å¤±</li><li>âœ… <strong>æ–‡ä»¶å¤§å°é€‚ä¸­</strong>ï¼šæ¯”çº¯AOFå°ï¼Œæ¯”çº¯RDBå¤§</li></ul><h4 id="8-4-2-æ··åˆæŒä¹…åŒ–é…ç½®"><a href="#8-4-2-æ··åˆæŒä¹…åŒ–é…ç½®" class="headerlink" title="8.4.2 æ··åˆæŒä¹…åŒ–é…ç½®"></a>8.4.2 æ··åˆæŒä¹…åŒ–é…ç½®</h4><p><strong>å¼€å¯æ··åˆæŒä¹…åŒ–</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯AOF</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯æ··åˆæŒä¹…åŒ–ï¼ˆRedis 4.0+ï¼‰</span></span><br><span class="line">aof-use-rdb-preamble <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p><strong>éªŒè¯é…ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; CONFIG GET aof-use-rdb-preamble</span><br><span class="line">1) <span class="string">&quot;aof-use-rdb-preamble&quot;</span></span><br><span class="line">2) <span class="string">&quot;yes&quot;</span></span><br></pre></td></tr></table></figure><h4 id="8-4-3-æ··åˆæŒä¹…åŒ–å·¥ä½œæµç¨‹"><a href="#8-4-3-æ··åˆæŒä¹…åŒ–å·¥ä½œæµç¨‹" class="headerlink" title="8.4.3 æ··åˆæŒä¹…åŒ–å·¥ä½œæµç¨‹"></a>8.4.3 æ··åˆæŒä¹…åŒ–å·¥ä½œæµç¨‹</h4><p><strong>AOFé‡å†™æ—¶çš„æµç¨‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[è§¦å‘AOFé‡å†™]</span><br><span class="line">    â†“</span><br><span class="line">[Forkå­è¿›ç¨‹]</span><br><span class="line">    â†“</span><br><span class="line">[å­è¿›ç¨‹å°†å†…å­˜æ•°æ®å†™å…¥RDBæ ¼å¼ï¼ˆæ–‡ä»¶å¤´éƒ¨ï¼‰]</span><br><span class="line">    â†“</span><br><span class="line">[å­è¿›ç¨‹ç»§ç»­å†™å…¥AOFæ ¼å¼ï¼ˆå¢é‡æ“ä½œï¼‰]</span><br><span class="line">    â†“</span><br><span class="line">[ä¸»è¿›ç¨‹å°†é‡å†™æœŸé—´çš„å†™æ“ä½œè¿½åŠ åˆ°æ–°æ–‡ä»¶]</span><br><span class="line">    â†“</span><br><span class="line">[ç”¨æ–°æ–‡ä»¶æ›¿æ¢æ—§AOFæ–‡ä»¶]</span><br></pre></td></tr></table></figure><p><strong>æ–‡ä»¶ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># AOFæ–‡ä»¶å†…å®¹ï¼ˆæ··åˆæ ¼å¼ï¼‰</span><br><span class="line"></span><br><span class="line"># RDBéƒ¨åˆ†ï¼ˆäºŒè¿›åˆ¶ï¼Œä¸å¯è¯»ï¼‰</span><br><span class="line">REDIS0009...</span><br><span class="line"></span><br><span class="line"># AOFéƒ¨åˆ†ï¼ˆæ–‡æœ¬ï¼Œå¯è¯»ï¼‰</span><br><span class="line">*2</span><br><span class="line">$6</span><br><span class="line">SELECT</span><br><span class="line">$1</span><br><span class="line">0</span><br><span class="line">*3</span><br><span class="line">$3</span><br><span class="line">SET</span><br><span class="line">$3</span><br><span class="line">key</span><br><span class="line">$5</span><br><span class="line">value</span><br></pre></td></tr></table></figure><h4 id="8-4-4-æ··åˆæŒä¹…åŒ–ä¼˜åŠ¿"><a href="#8-4-4-æ··åˆæŒä¹…åŒ–ä¼˜åŠ¿" class="headerlink" title="8.4.4 æ··åˆæŒä¹…åŒ–ä¼˜åŠ¿"></a>8.4.4 æ··åˆæŒä¹…åŒ–ä¼˜åŠ¿</h4><p><strong>å¯¹æ¯”çº¯RDBå’Œçº¯AOF</strong>ï¼š</p><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>RDB</th><th>AOF</th><th>æ··åˆæŒä¹…åŒ–</th></tr></thead><tbody><tr><td><strong>æ¢å¤é€Ÿåº¦</strong></td><td>â­â­â­â­â­ æœ€å¿«</td><td>â­â­ æœ€æ…¢</td><td>â­â­â­â­ è¾ƒå¿«</td></tr><tr><td><strong>æ•°æ®å®Œæ•´æ€§</strong></td><td>â­â­ å¯èƒ½ä¸¢å¤±</td><td>â­â­â­â­â­ å‡ ä¹ä¸ä¸¢å¤±</td><td>â­â­â­â­â­ å‡ ä¹ä¸ä¸¢å¤±</td></tr><tr><td><strong>æ–‡ä»¶å¤§å°</strong></td><td>â­â­â­â­â­ æœ€å°</td><td>â­â­ æœ€å¤§</td><td>â­â­â­ ä¸­ç­‰</td></tr><tr><td><strong>æ€§èƒ½å½±å“</strong></td><td>â­â­â­â­ è¾ƒå°</td><td>â­â­â­ ä¸­ç­‰</td><td>â­â­â­ ä¸­ç­‰</td></tr><tr><td><strong>æ¨èåº¦</strong></td><td>â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­â­</td></tr></tbody></table><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>âœ… <strong>ç”Ÿäº§ç¯å¢ƒæ¨è</strong>ï¼šç»“åˆäº†RDBå’ŒAOFçš„ä¼˜åŠ¿</li><li>âœ… <strong>æ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜</strong>ï¼šå‡ ä¹ä¸ä¸¢å¤±æ•°æ®</li><li>âœ… <strong>æ¢å¤é€Ÿåº¦è¦æ±‚</strong>ï¼šæ¯”çº¯AOFæ¢å¤å¿«</li><li>âœ… <strong>Redis 4.0+</strong>ï¼šå¿…é¡»ä½¿ç”¨Redis 4.0åŠä»¥ä¸Šç‰ˆæœ¬</li></ul><h3 id="8-5-æŒä¹…åŒ–ç­–ç•¥é€‰æ‹©"><a href="#8-5-æŒä¹…åŒ–ç­–ç•¥é€‰æ‹©" class="headerlink" title="8.5 æŒä¹…åŒ–ç­–ç•¥é€‰æ‹©"></a>8.5 æŒä¹…åŒ–ç­–ç•¥é€‰æ‹©</h3><h4 id="8-5-1-RDB-vs-AOF-vs-æ··åˆæŒä¹…åŒ–"><a href="#8-5-1-RDB-vs-AOF-vs-æ··åˆæŒä¹…åŒ–" class="headerlink" title="8.5.1 RDB vs AOF vs æ··åˆæŒä¹…åŒ–"></a>8.5.1 RDB vs AOF vs æ··åˆæŒä¹…åŒ–</h4><p><strong>å…¨é¢å¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>RDB</th><th>AOF</th><th>æ··åˆæŒä¹…åŒ–</th></tr></thead><tbody><tr><td><strong>æŒä¹…åŒ–æ–¹å¼</strong></td><td>å¿«ç…§</td><td>æ—¥å¿—</td><td>RDB + AOF</td></tr><tr><td><strong>æ–‡ä»¶æ ¼å¼</strong></td><td>äºŒè¿›åˆ¶å‹ç¼©</td><td>æ–‡æœ¬</td><td>äºŒè¿›åˆ¶ + æ–‡æœ¬</td></tr><tr><td><strong>æ–‡ä»¶å¤§å°</strong></td><td>å°ï¼ˆå‹ç¼©åï¼‰</td><td>å¤§</td><td>ä¸­ç­‰</td></tr><tr><td><strong>æ¢å¤é€Ÿåº¦</strong></td><td>å¿«</td><td>æ…¢</td><td>è¾ƒå¿«</td></tr><tr><td><strong>æ•°æ®ä¸¢å¤±é£é™©</strong></td><td>é«˜ï¼ˆå¯èƒ½ä¸¢å¤±ï¼‰</td><td>ä½ï¼ˆå‡ ä¹ä¸ä¸¢å¤±ï¼‰</td><td>ä½ï¼ˆå‡ ä¹ä¸ä¸¢å¤±ï¼‰</td></tr><tr><td><strong>æ€§èƒ½å½±å“</strong></td><td>å°ï¼ˆå¼‚æ­¥ï¼‰</td><td>ä¸­ç­‰ï¼ˆåŒæ­¥ï¼‰</td><td>ä¸­ç­‰ï¼ˆåŒæ­¥ï¼‰</td></tr><tr><td><strong>å¯è¯»æ€§</strong></td><td>âŒ ä¸å¯è¯»</td><td>âœ… å¯è¯»</td><td>âš ï¸ éƒ¨åˆ†å¯è¯»</td></tr><tr><td><strong>ç‰ˆæœ¬è¦æ±‚</strong></td><td>Redis 1.0+</td><td>Redis 1.1+</td><td>Redis 4.0+</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å¤‡ä»½ã€ç¾éš¾æ¢å¤</td><td>æ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜</td><td>ç”Ÿäº§ç¯å¢ƒæ¨è</td></tr></tbody></table><h4 id="8-5-2-é€‰æ‹©å»ºè®®"><a href="#8-5-2-é€‰æ‹©å»ºè®®" class="headerlink" title="8.5.2 é€‰æ‹©å»ºè®®"></a>8.5.2 é€‰æ‹©å»ºè®®</h4><p><strong>åœºæ™¯1ï¼šæ•°æ®å¤‡ä»½å’Œç¾éš¾æ¢å¤</strong></p><p><strong>æ¨è</strong>ï¼šRDB</p><p><strong>åŸå› </strong>ï¼š</p><ul><li>âœ… æ–‡ä»¶å°ï¼Œä¾¿äºå¤‡ä»½</li><li>âœ… æ¢å¤é€Ÿåº¦å¿«</li><li>âœ… å¯ä»¥æ¥å—å°‘é‡æ•°æ®ä¸¢å¤±</li></ul><p><strong>é…ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªå¼€å¯RDB</span></span><br><span class="line">appendonly no</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure><p><strong>åœºæ™¯2ï¼šæ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜</strong></p><p><strong>æ¨è</strong>ï¼šAOFï¼ˆeverysecï¼‰æˆ–æ··åˆæŒä¹…åŒ–</p><p><strong>åŸå› </strong>ï¼š</p><ul><li>âœ… æ•°æ®å‡ ä¹ä¸ä¸¢å¤±</li><li>âœ… å¯ä»¥å¤„ç†è¯¯æ“ä½œ</li><li>âœ… é€‚åˆå…³é”®ä¸šåŠ¡æ•°æ®</li></ul><p><strong>é…ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AOFé…ç½®</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfsync everysec</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–æ··åˆæŒä¹…åŒ–ï¼ˆæ¨èï¼‰</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfsync everysec</span><br><span class="line">aof-use-rdb-preamble <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p><strong>åœºæ™¯3ï¼šç”Ÿäº§ç¯å¢ƒï¼ˆé€šç”¨ï¼‰</strong></p><p><strong>æ¨è</strong>ï¼šæ··åˆæŒä¹…åŒ–</p><p><strong>åŸå› </strong>ï¼š</p><ul><li>âœ… ç»“åˆRDBå’ŒAOFçš„ä¼˜åŠ¿</li><li>âœ… æ¢å¤é€Ÿåº¦å¿«</li><li>âœ… æ•°æ®å®Œæ•´æ€§é«˜</li></ul><p><strong>é…ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ··åˆæŒä¹…åŒ–é…ç½®</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfsync everysec</span><br><span class="line">aof-use-rdb-preamble <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒæ—¶ä¿ç•™RDBä½œä¸ºé¢å¤–å¤‡ä»½</span></span><br><span class="line">save 3600 1</span><br><span class="line">save 1800 100</span><br></pre></td></tr></table></figure><p><strong>åœºæ™¯4ï¼šæ€§èƒ½ä¼˜å…ˆï¼Œå¯æ¥å—æ•°æ®ä¸¢å¤±</strong></p><p><strong>æ¨è</strong>ï¼šRDB</p><p><strong>åŸå› </strong>ï¼š</p><ul><li>âœ… æ€§èƒ½å½±å“æœ€å°</li><li>âœ… æ¢å¤é€Ÿåº¦å¿«</li><li>âš ï¸ å¯ä»¥æ¥å—æ•°æ®ä¸¢å¤±</li></ul><p><strong>é…ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">appendonly no</span><br><span class="line">save 3600 1  <span class="comment"># 1å°æ—¶å¤‡ä»½ä¸€æ¬¡</span></span><br></pre></td></tr></table></figure><h4 id="8-5-3-ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®"><a href="#8-5-3-ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®" class="headerlink" title="8.5.3 ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®"></a>8.5.3 ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®</h4><p><strong>å®Œæ•´é…ç½®ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== RDBé…ç½® ==========</span></span><br><span class="line"><span class="comment"># å®šæœŸå¤‡ä»½ï¼ˆä½œä¸ºé¢å¤–å¤‡ä»½ï¼‰</span></span><br><span class="line">save 3600 1      <span class="comment"># 1å°æ—¶å†…è‡³å°‘1ä¸ªkeyå˜åŒ–</span></span><br><span class="line">save 1800 100    <span class="comment"># 30åˆ†é’Ÿå†…è‡³å°‘100ä¸ªkeyå˜åŒ–</span></span><br><span class="line">save 300 1000    <span class="comment"># 5åˆ†é’Ÿå†…è‡³å°‘1000ä¸ªkeyå˜åŒ–</span></span><br><span class="line"></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"><span class="built_in">dir</span> /var/lib/redis/</span><br><span class="line"></span><br><span class="line">rdbcompression <span class="built_in">yes</span></span><br><span class="line">rdbchecksum <span class="built_in">yes</span></span><br><span class="line">stop-writes-on-bgsave-error <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== AOFé…ç½® ==========</span></span><br><span class="line"><span class="comment"># å¼€å¯AOF</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒæ­¥ç­–ç•¥ï¼ˆæ¨èeverysecï¼‰</span></span><br><span class="line">appendfsync everysec</span><br><span class="line"></span><br><span class="line"><span class="comment"># AOFé‡å†™é…ç½®</span></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== æ··åˆæŒä¹…åŒ– ==========</span></span><br><span class="line"><span class="comment"># å¼€å¯æ··åˆæŒä¹…åŒ–ï¼ˆRedis 4.0+ï¼‰</span></span><br><span class="line">aof-use-rdb-preamble <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p><strong>é…ç½®è¯´æ˜</strong>ï¼š</p><ul><li>âœ… <strong>RDB</strong>ï¼šä½œä¸ºå®šæœŸå¤‡ä»½ï¼Œç”¨äºç¾éš¾æ¢å¤</li><li>âœ… <strong>AOF</strong>ï¼šä½œä¸ºä¸»è¦æŒä¹…åŒ–æ–¹å¼ï¼Œä¿è¯æ•°æ®å®Œæ•´æ€§</li><li>âœ… <strong>æ··åˆæŒä¹…åŒ–</strong>ï¼šç»“åˆä¸¤è€…ä¼˜åŠ¿ï¼Œæ¢å¤é€Ÿåº¦å¿«ä¸”æ•°æ®å®Œæ•´</li></ul><h4 id="8-5-4-æŒä¹…åŒ–ç›‘æ§"><a href="#8-5-4-æŒä¹…åŒ–ç›‘æ§" class="headerlink" title="8.5.4 æŒä¹…åŒ–ç›‘æ§"></a>8.5.4 æŒä¹…åŒ–ç›‘æ§</h4><p><strong>æŸ¥çœ‹æŒä¹…åŒ–çŠ¶æ€</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; INFO persistence</span><br><span class="line"><span class="comment"># Persistence</span></span><br><span class="line">loading:0</span><br><span class="line">rdb_changes_since_last_save:0</span><br><span class="line">rdb_bgsave_in_progress:0</span><br><span class="line">rdb_last_save_time:1699123456</span><br><span class="line">rdb_last_bgsave_status:ok</span><br><span class="line">rdb_last_bgsave_time_sec:2</span><br><span class="line">rdb_current_bgsave_time_sec:-1</span><br><span class="line">aof_enabled:1</span><br><span class="line">aof_rewrite_in_progress:0</span><br><span class="line">aof_last_rewrite_time_sec:1</span><br><span class="line">aof_current_rewrite_time_sec:-1</span><br><span class="line">aof_last_bgrewrite_status:ok</span><br><span class="line">aof_last_write_status:ok</span><br><span class="line">aof_last_size:1234567</span><br><span class="line">aof_base_size:1000000</span><br><span class="line">aof_pending_rewrite:0</span><br><span class="line">aof_buffer_length:0</span><br><span class="line">aof_rewrite_buffer_length:0</span><br><span class="line">aof_pending_bio_fsync:0</span><br><span class="line">aof_delayed_fsync:0</span><br></pre></td></tr></table></figure><p><strong>å…³é”®æŒ‡æ ‡</strong>ï¼š</p><ul><li><code>rdb_bgsave_in_progress</code>ï¼šRDBæ˜¯å¦æ­£åœ¨æ‰§è¡Œï¼ˆ0&#x3D;å¦ï¼Œ1&#x3D;æ˜¯ï¼‰</li><li><code>aof_rewrite_in_progress</code>ï¼šAOFæ˜¯å¦æ­£åœ¨é‡å†™ï¼ˆ0&#x3D;å¦ï¼Œ1&#x3D;æ˜¯ï¼‰</li><li><code>aof_last_write_status</code>ï¼šæœ€åä¸€æ¬¡AOFå†™å…¥çŠ¶æ€ï¼ˆok&#x3D;æˆåŠŸï¼‰</li><li><code>aof_last_size</code>ï¼šå½“å‰AOFæ–‡ä»¶å¤§å°</li><li><code>aof_base_size</code>ï¼šä¸Šæ¬¡é‡å†™æ—¶çš„AOFæ–‡ä»¶å¤§å°</li></ul><h4 id="8-5-5-æŒä¹…åŒ–æœ€ä½³å®è·µ"><a href="#8-5-5-æŒä¹…åŒ–æœ€ä½³å®è·µ" class="headerlink" title="8.5.5 æŒä¹…åŒ–æœ€ä½³å®è·µ"></a>8.5.5 æŒä¹…åŒ–æœ€ä½³å®è·µ</h4><p><strong>1. å®šæœŸå¤‡ä»½</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯å¤©å¤‡ä»½ä¸€æ¬¡RDBå’ŒAOFæ–‡ä»¶</span></span><br><span class="line">0 2 * * * /path/to/backup_redis.sh</span><br></pre></td></tr></table></figure><p><strong>2. ç›‘æ§æŒä¹…åŒ–çŠ¶æ€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘æ§è„šæœ¬</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">REDIS_CLI=<span class="string">&quot;/usr/local/bin/redis-cli&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥AOFå†™å…¥çŠ¶æ€</span></span><br><span class="line">AOF_STATUS=$(<span class="variable">$REDIS_CLI</span> INFO persistence | grep aof_last_write_status | <span class="built_in">cut</span> -d: -f2 | <span class="built_in">tr</span> -d <span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$AOF_STATUS</span>&quot;</span> != <span class="string">&quot;ok&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;WARNING: AOF write failed!&quot;</span></span><br><span class="line">    <span class="comment"># å‘é€å‘Šè­¦</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥RDBçŠ¶æ€</span></span><br><span class="line">RDB_STATUS=$(<span class="variable">$REDIS_CLI</span> INFO persistence | grep rdb_last_bgsave_status | <span class="built_in">cut</span> -d: -f2 | <span class="built_in">tr</span> -d <span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$RDB_STATUS</span>&quot;</span> != <span class="string">&quot;ok&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;WARNING: RDB save failed!&quot;</span></span><br><span class="line">    <span class="comment"># å‘é€å‘Šè­¦</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p><strong>3. æ€§èƒ½ä¼˜åŒ–</strong></p><ul><li>âœ… ä½¿ç”¨<code>everysec</code>åŒæ­¥ç­–ç•¥ï¼ˆå¹³è¡¡æ€§èƒ½å’Œæ•°æ®å®‰å…¨ï¼‰</li><li>âœ… åˆç†è®¾ç½®AOFé‡å†™é˜ˆå€¼ï¼ˆé¿å…é¢‘ç¹é‡å†™ï¼‰</li><li>âœ… ä½¿ç”¨æ··åˆæŒä¹…åŒ–ï¼ˆRedis 4.0+ï¼‰</li><li>âœ… å®šæœŸæ¸…ç†æ—§çš„å¤‡ä»½æ–‡ä»¶</li></ul><p><strong>4. ç¾éš¾æ¢å¤é¢„æ¡ˆ</strong></p><ul><li>âœ… å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹</li><li>âœ… ä¿ç•™å¤šä¸ªæ—¶é—´ç‚¹çš„å¤‡ä»½</li><li>âœ… å¤‡ä»½æ–‡ä»¶å­˜å‚¨åˆ°ä¸åŒä½ç½®</li><li>âœ… æ–‡æ¡£åŒ–æ¢å¤æ­¥éª¤</li></ul><h3 id="8-6-æ€»ç»“"><a href="#8-6-æ€»ç»“" class="headerlink" title="8.6 æ€»ç»“"></a>8.6 æ€»ç»“</h3><p><strong>æŒä¹…åŒ–é€‰æ‹©å»ºè®®</strong>ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>é…ç½®è¦ç‚¹</th></tr></thead><tbody><tr><td><strong>ç”Ÿäº§ç¯å¢ƒï¼ˆé€šç”¨ï¼‰</strong></td><td>æ··åˆæŒä¹…åŒ–</td><td>AOF + RDBï¼ŒeverysecåŒæ­¥</td></tr><tr><td><strong>æ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜</strong></td><td>AOFï¼ˆeverysecï¼‰</td><td>å¼€å¯AOFï¼ŒeverysecåŒæ­¥</td></tr><tr><td><strong>æ€§èƒ½ä¼˜å…ˆ</strong></td><td>RDB</td><td>å…³é—­AOFï¼Œå®šæœŸRDBå¤‡ä»½</td></tr><tr><td><strong>å¤‡ä»½å’Œç¾éš¾æ¢å¤</strong></td><td>RDB</td><td>å®šæœŸRDBå¤‡ä»½ï¼Œæ–‡ä»¶å°æ¢å¤å¿«</td></tr></tbody></table><p><strong>æ ¸å¿ƒè¦ç‚¹</strong>ï¼š</p><ol><li>âœ… <strong>æ··åˆæŒä¹…åŒ–</strong>æ˜¯ç”Ÿäº§ç¯å¢ƒçš„æœ€ä½³é€‰æ‹©ï¼ˆRedis 4.0+ï¼‰</li><li>âœ… <strong>AOF everysec</strong>æ˜¯æ•°æ®å®‰å…¨æ€§å’Œæ€§èƒ½çš„å¹³è¡¡ç‚¹</li><li>âœ… <strong>å®šæœŸå¤‡ä»½</strong>æ˜¯ç¾éš¾æ¢å¤çš„å…³é”®</li><li>âœ… <strong>ç›‘æ§æŒä¹…åŒ–çŠ¶æ€</strong>å¯ä»¥åŠæ—¶å‘ç°é—®é¢˜</li></ol><hr><h2 id="7-Redisäº‹åŠ¡"><a href="#7-Redisäº‹åŠ¡" class="headerlink" title="7. Redisäº‹åŠ¡"></a>7. Redisäº‹åŠ¡</h2><h3 id="7-1-äº‹åŠ¡åŸºç¡€"><a href="#7-1-äº‹åŠ¡åŸºç¡€" class="headerlink" title="7.1 äº‹åŠ¡åŸºç¡€"></a>7.1 äº‹åŠ¡åŸºç¡€</h3><p>å¾…è¡¥å……â€¦</p><h3 id="7-2-äº‹åŠ¡å‘½ä»¤"><a href="#7-2-äº‹åŠ¡å‘½ä»¤" class="headerlink" title="7.2 äº‹åŠ¡å‘½ä»¤"></a>7.2 äº‹åŠ¡å‘½ä»¤</h3><p>å¾…è¡¥å……â€¦</p><h3 id="7-3-Watchæœºåˆ¶"><a href="#7-3-Watchæœºåˆ¶" class="headerlink" title="7.3 Watchæœºåˆ¶"></a>7.3 Watchæœºåˆ¶</h3><p>å¾…è¡¥å……â€¦</p><h3 id="7-4-äº‹åŠ¡æ³¨æ„äº‹é¡¹"><a href="#7-4-äº‹åŠ¡æ³¨æ„äº‹é¡¹" class="headerlink" title="7.4 äº‹åŠ¡æ³¨æ„äº‹é¡¹"></a>7.4 äº‹åŠ¡æ³¨æ„äº‹é¡¹</h3><p>å¾…è¡¥å……â€¦</p><hr><h2 id="8-Rediså‘å¸ƒè®¢é˜…"><a href="#8-Rediså‘å¸ƒè®¢é˜…" class="headerlink" title="8. Rediså‘å¸ƒè®¢é˜…"></a>8. Rediså‘å¸ƒè®¢é˜…</h2><h3 id="8-1-å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#8-1-å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="8.1 å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>8.1 å‘å¸ƒè®¢é˜…æ¨¡å¼</h3><p>å¾…è¡¥å……â€¦</p><h3 id="8-2-ç›¸å…³å‘½ä»¤"><a href="#8-2-ç›¸å…³å‘½ä»¤" class="headerlink" title="8.2 ç›¸å…³å‘½ä»¤"></a>8.2 ç›¸å…³å‘½ä»¤</h3><p>å¾…è¡¥å……â€¦</p><h3 id="8-3-åº”ç”¨åœºæ™¯"><a href="#8-3-åº”ç”¨åœºæ™¯" class="headerlink" title="8.3 åº”ç”¨åœºæ™¯"></a>8.3 åº”ç”¨åœºæ™¯</h3><p>å¾…è¡¥å……â€¦</p><hr><h2 id="9-Redisä¸»ä»å¤åˆ¶"><a href="#9-Redisä¸»ä»å¤åˆ¶" class="headerlink" title="9. Redisä¸»ä»å¤åˆ¶"></a>9. Redisä¸»ä»å¤åˆ¶</h2><h3 id="9-1-ä¸»ä»å¤åˆ¶åŸç†"><a href="#9-1-ä¸»ä»å¤åˆ¶åŸç†" class="headerlink" title="9.1 ä¸»ä»å¤åˆ¶åŸç†"></a>9.1 ä¸»ä»å¤åˆ¶åŸç†</h3><p>å¾…è¡¥å……â€¦</p><h3 id="9-2-é…ç½®ä¸»ä»å¤åˆ¶"><a href="#9-2-é…ç½®ä¸»ä»å¤åˆ¶" class="headerlink" title="9.2 é…ç½®ä¸»ä»å¤åˆ¶"></a>9.2 é…ç½®ä¸»ä»å¤åˆ¶</h3><p>å¾…è¡¥å……â€¦</p><h3 id="9-3-å…¨é‡å¤åˆ¶ä¸å¢é‡å¤åˆ¶"><a href="#9-3-å…¨é‡å¤åˆ¶ä¸å¢é‡å¤åˆ¶" class="headerlink" title="9.3 å…¨é‡å¤åˆ¶ä¸å¢é‡å¤åˆ¶"></a>9.3 å…¨é‡å¤åˆ¶ä¸å¢é‡å¤åˆ¶</h3><p>å¾…è¡¥å……â€¦</p><h3 id="9-4-ä¸»ä»å¤åˆ¶æ³¨æ„äº‹é¡¹"><a href="#9-4-ä¸»ä»å¤åˆ¶æ³¨æ„äº‹é¡¹" class="headerlink" title="9.4 ä¸»ä»å¤åˆ¶æ³¨æ„äº‹é¡¹"></a>9.4 ä¸»ä»å¤åˆ¶æ³¨æ„äº‹é¡¹</h3><p>å¾…è¡¥å……â€¦</p><hr><h2 id="10-Rediså“¨å…µæ¨¡å¼"><a href="#10-Rediså“¨å…µæ¨¡å¼" class="headerlink" title="10. Rediså“¨å…µæ¨¡å¼"></a>10. Rediså“¨å…µæ¨¡å¼</h2><h3 id="10-1-å“¨å…µæ¨¡å¼ä»‹ç»"><a href="#10-1-å“¨å…µæ¨¡å¼ä»‹ç»" class="headerlink" title="10.1 å“¨å…µæ¨¡å¼ä»‹ç»"></a>10.1 å“¨å…µæ¨¡å¼ä»‹ç»</h3><p>å¾…è¡¥å……â€¦</p><h3 id="10-2-å“¨å…µé…ç½®"><a href="#10-2-å“¨å…µé…ç½®" class="headerlink" title="10.2 å“¨å…µé…ç½®"></a>10.2 å“¨å…µé…ç½®</h3><p>å¾…è¡¥å……â€¦</p><h3 id="10-3-æ•…éšœè½¬ç§»"><a href="#10-3-æ•…éšœè½¬ç§»" class="headerlink" title="10.3 æ•…éšœè½¬ç§»"></a>10.3 æ•…éšœè½¬ç§»</h3><p>å¾…è¡¥å……â€¦</p><h3 id="10-4-å“¨å…µé›†ç¾¤"><a href="#10-4-å“¨å…µé›†ç¾¤" class="headerlink" title="10.4 å“¨å…µé›†ç¾¤"></a>10.4 å“¨å…µé›†ç¾¤</h3><p>å¾…è¡¥å……â€¦</p><hr><h2 id="11-Redisé›†ç¾¤"><a href="#11-Redisé›†ç¾¤" class="headerlink" title="11. Redisé›†ç¾¤"></a>11. Redisé›†ç¾¤</h2><h3 id="11-1-é›†ç¾¤æ¶æ„"><a href="#11-1-é›†ç¾¤æ¶æ„" class="headerlink" title="11.1 é›†ç¾¤æ¶æ„"></a>11.1 é›†ç¾¤æ¶æ„</h3><p>å¾…è¡¥å……â€¦</p><h3 id="11-2-æ•°æ®åˆ†ç‰‡"><a href="#11-2-æ•°æ®åˆ†ç‰‡" class="headerlink" title="11.2 æ•°æ®åˆ†ç‰‡"></a>11.2 æ•°æ®åˆ†ç‰‡</h3><p>å¾…è¡¥å……â€¦</p><h3 id="11-3-é›†ç¾¤æ­å»º"><a href="#11-3-é›†ç¾¤æ­å»º" class="headerlink" title="11.3 é›†ç¾¤æ­å»º"></a>11.3 é›†ç¾¤æ­å»º</h3><p>å¾…è¡¥å……â€¦</p><h3 id="11-4-é›†ç¾¤æ‰©å®¹ä¸ç¼©å®¹"><a href="#11-4-é›†ç¾¤æ‰©å®¹ä¸ç¼©å®¹" class="headerlink" title="11.4 é›†ç¾¤æ‰©å®¹ä¸ç¼©å®¹"></a>11.4 é›†ç¾¤æ‰©å®¹ä¸ç¼©å®¹</h3><p>å¾…è¡¥å……â€¦</p><hr><h2 id="12-Rediså®æˆ˜åº”ç”¨"><a href="#12-Rediså®æˆ˜åº”ç”¨" class="headerlink" title="12. Rediså®æˆ˜åº”ç”¨"></a>12. Rediså®æˆ˜åº”ç”¨</h2><h3 id="12-1-ç¼“å­˜è®¾è®¡"><a href="#12-1-ç¼“å­˜è®¾è®¡" class="headerlink" title="12.1 ç¼“å­˜è®¾è®¡"></a>12.1 ç¼“å­˜è®¾è®¡</h3><p>å¾…è¡¥å……â€¦</p><h3 id="12-2-åˆ†å¸ƒå¼é”"><a href="#12-2-åˆ†å¸ƒå¼é”" class="headerlink" title="12.2 åˆ†å¸ƒå¼é”"></a>12.2 åˆ†å¸ƒå¼é”</h3><p>å¾…è¡¥å……â€¦</p><h3 id="12-3-å»¶æ—¶é˜Ÿåˆ—"><a href="#12-3-å»¶æ—¶é˜Ÿåˆ—" class="headerlink" title="12.3 å»¶æ—¶é˜Ÿåˆ—"></a>12.3 å»¶æ—¶é˜Ÿåˆ—</h3><p>å¾…è¡¥å……â€¦</p><h3 id="12-4-æ’è¡Œæ¦œ"><a href="#12-4-æ’è¡Œæ¦œ" class="headerlink" title="12.4 æ’è¡Œæ¦œ"></a>12.4 æ’è¡Œæ¦œ</h3><p>å¾…è¡¥å……â€¦</p><h3 id="12-5-é™æµ"><a href="#12-5-é™æµ" class="headerlink" title="12.5 é™æµ"></a>12.5 é™æµ</h3><p>å¾…è¡¥å……â€¦</p><hr><h2 id="13-Redisæ€§èƒ½ä¼˜åŒ–"><a href="#13-Redisæ€§èƒ½ä¼˜åŒ–" class="headerlink" title="13. Redisæ€§èƒ½ä¼˜åŒ–"></a>13. Redisæ€§èƒ½ä¼˜åŒ–</h2><h3 id="13-1-å†…å­˜ä¼˜åŒ–"><a href="#13-1-å†…å­˜ä¼˜åŒ–" class="headerlink" title="13.1 å†…å­˜ä¼˜åŒ–"></a>13.1 å†…å­˜ä¼˜åŒ–</h3><p>å¾…è¡¥å……â€¦</p><h3 id="13-2-å‘½ä»¤ä¼˜åŒ–"><a href="#13-2-å‘½ä»¤ä¼˜åŒ–" class="headerlink" title="13.2 å‘½ä»¤ä¼˜åŒ–"></a>13.2 å‘½ä»¤ä¼˜åŒ–</h3><p>å¾…è¡¥å……â€¦</p><h3 id="13-3-ç½‘ç»œä¼˜åŒ–"><a href="#13-3-ç½‘ç»œä¼˜åŒ–" class="headerlink" title="13.3 ç½‘ç»œä¼˜åŒ–"></a>13.3 ç½‘ç»œä¼˜åŒ–</h3><p>å¾…è¡¥å……â€¦</p><h3 id="13-4-æ…¢æŸ¥è¯¢åˆ†æ"><a href="#13-4-æ…¢æŸ¥è¯¢åˆ†æ" class="headerlink" title="13.4 æ…¢æŸ¥è¯¢åˆ†æ"></a>13.4 æ…¢æŸ¥è¯¢åˆ†æ</h3><p>å¾…è¡¥å……â€¦</p><hr><h2 id="14-Rediså¸¸è§é—®é¢˜"><a href="#14-Rediså¸¸è§é—®é¢˜" class="headerlink" title="14. Rediså¸¸è§é—®é¢˜"></a>14. Rediså¸¸è§é—®é¢˜</h2><h3 id="14-1-ç¼“å­˜ç©¿é€"><a href="#14-1-ç¼“å­˜ç©¿é€" class="headerlink" title="14.1 ç¼“å­˜ç©¿é€"></a>14.1 ç¼“å­˜ç©¿é€</h3><p>å¾…è¡¥å……â€¦</p><h3 id="14-2-ç¼“å­˜å‡»ç©¿"><a href="#14-2-ç¼“å­˜å‡»ç©¿" class="headerlink" title="14.2 ç¼“å­˜å‡»ç©¿"></a>14.2 ç¼“å­˜å‡»ç©¿</h3><p>å¾…è¡¥å……â€¦</p><h3 id="14-3-ç¼“å­˜é›ªå´©"><a href="#14-3-ç¼“å­˜é›ªå´©" class="headerlink" title="14.3 ç¼“å­˜é›ªå´©"></a>14.3 ç¼“å­˜é›ªå´©</h3><p>å¾…è¡¥å……â€¦</p><h3 id="14-4-æ•°æ®ä¸€è‡´æ€§"><a href="#14-4-æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="14.4 æ•°æ®ä¸€è‡´æ€§"></a>14.4 æ•°æ®ä¸€è‡´æ€§</h3><p>å¾…è¡¥å……â€¦</p><hr><h2 id="15-Javaæ•´åˆRedis"><a href="#15-Javaæ•´åˆRedis" class="headerlink" title="15. Javaæ•´åˆRedis"></a>15. Javaæ•´åˆRedis</h2><h3 id="15-1-Jediså®¢æˆ·ç«¯"><a href="#15-1-Jediså®¢æˆ·ç«¯" class="headerlink" title="15.1 Jediså®¢æˆ·ç«¯"></a>15.1 Jediså®¢æˆ·ç«¯</h3><p>å¾…è¡¥å……â€¦</p><h3 id="15-2-Lettuceå®¢æˆ·ç«¯"><a href="#15-2-Lettuceå®¢æˆ·ç«¯" class="headerlink" title="15.2 Lettuceå®¢æˆ·ç«¯"></a>15.2 Lettuceå®¢æˆ·ç«¯</h3><p>å¾…è¡¥å……â€¦</p><h3 id="15-3-Spring-Data-Redis"><a href="#15-3-Spring-Data-Redis" class="headerlink" title="15.3 Spring Data Redis"></a>15.3 Spring Data Redis</h3><p>å¾…è¡¥å……â€¦</p><h3 id="15-4-RedisTemplateä½¿ç”¨"><a href="#15-4-RedisTemplateä½¿ç”¨" class="headerlink" title="15.4 RedisTemplateä½¿ç”¨"></a>15.4 RedisTemplateä½¿ç”¨</h3><p>å¾…è¡¥å……â€¦</p><hr><h2 id="16-å­¦ä¹ èµ„æºæ¨è"><a href="#16-å­¦ä¹ èµ„æºæ¨è" class="headerlink" title="16. å­¦ä¹ èµ„æºæ¨è"></a>16. å­¦ä¹ èµ„æºæ¨è</h2><h3 id="å®˜æ–¹èµ„æº"><a href="#å®˜æ–¹èµ„æº" class="headerlink" title="å®˜æ–¹èµ„æº"></a>å®˜æ–¹èµ„æº</h3><ul><li><a target="_blank" rel="noopener" href="https://redis.io/documentation">Rediså®˜æ–¹æ–‡æ¡£</a> - æœ€æƒå¨çš„å­¦ä¹ èµ„æ–™</li><li><a target="_blank" rel="noopener" href="http://www.redis.cn/">Redisä¸­æ–‡ç½‘</a> - ä¸­æ–‡ç¤¾åŒº</li><li><a target="_blank" rel="noopener" href="http://doc.redisfans.com/">Rediså‘½ä»¤å‚è€ƒ</a> - å‘½ä»¤é€ŸæŸ¥</li></ul><h3 id="å­¦ä¹ å·¥å…·"><a href="#å­¦ä¹ å·¥å…·" class="headerlink" title="å­¦ä¹ å·¥å…·"></a>å­¦ä¹ å·¥å…·</h3><ul><li><strong>RedisInsight</strong> - Rediså®˜æ–¹å¯è§†åŒ–å·¥å…·</li><li><strong>Another Redis Desktop Manager</strong> - å¼€æºRediså®¢æˆ·ç«¯</li><li><strong>Redisåœ¨çº¿æµ‹è¯•</strong> - åœ¨çº¿ä½“éªŒRediså‘½ä»¤</li></ul><h3 id="å®æˆ˜é¡¹ç›®"><a href="#å®æˆ˜é¡¹ç›®" class="headerlink" title="å®æˆ˜é¡¹ç›®"></a>å®æˆ˜é¡¹ç›®</h3><ul><li>ç¼“å­˜ç³»ç»Ÿè®¾è®¡</li><li>åˆ†å¸ƒå¼é”å®ç°</li><li>æ’è¡Œæ¦œç³»ç»Ÿ</li><li>ç§’æ€ç³»ç»Ÿ</li></ul><hr><p><strong>æœ€åæ›´æ–°</strong>: 2025-11-09<br><strong>ä½œè€…</strong>: Suo<br><strong>æ ‡ç­¾</strong>: Redis, ä¸­é—´ä»¶, ç¼“å­˜, NoSQL, åˆ†å¸ƒå¼</p><blockquote><p>ğŸ’¡ <strong>æç¤º</strong>ï¼šæœ¬æ–‡æ¡£å°†æŒç»­æ›´æ–°ï¼Œæ¬¢è¿æ”¶è—ã€‚åç»­å°†è¡¥å……å®Œæ•´çš„å®æˆ˜æ¡ˆä¾‹å’Œä»£ç ç¤ºä¾‹ã€‚</p></blockquote></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://suochina.github.io">SuoL</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://suochina.github.io/redis-learning-guide/">https://suochina.github.io/redis-learning-guide/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://suochina.github.io" target="_blank">SuoL's Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a><a class="post-meta__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">ä¸­é—´ä»¶</a><a class="post-meta__tags" href="/tags/%E7%BC%93%E5%AD%98/">ç¼“å­˜</a><a class="post-meta__tags" href="/tags/NoSQL/">NoSQL</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a></div><div class="post-share"><div class="social-share" data-image="/images/redis/cover.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/programming-shortcuts-guide/" title="ç¼–ç¨‹å·¥å…·å¿«æ·é”®å¤§å…¨ - æ•ˆç‡æå‡å¿…å¤‡æŒ‡å—"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/shortcuts/cover.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">ç¼–ç¨‹å·¥å…·å¿«æ·é”®å¤§å…¨ - æ•ˆç‡æå‡å¿…å¤‡æŒ‡å—</div></div><div class="info-2"><div class="info-item-1">å…¨é¢æ”¶å½•ä¸»æµç¼–ç¨‹å·¥å…·çš„å¿«æ·é”®ï¼Œæ·±åº¦è§£æIntelliJ IDEA 100+å¿«æ·é”®ï¼Œæ¶µç›–ç¼–è¾‘ã€å¯¼èˆªã€é‡æ„ã€è°ƒè¯•å…¨æ–¹ä½æ“ä½œï¼Œå¸®åŠ©å¼€å‘è€…å¤§å¹…æå‡ç¼–ç æ•ˆç‡ï¼ˆæŒç»­æ›´æ–°ä¸­ï¼‰</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/my_cat.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">SuoL</div><div class="author-info-description">çƒ­çˆ±æŠ€æœ¯çš„å¼€å‘è€…ï¼Œä¸“æ³¨äºå‰ç«¯å¼€å‘å’Œå…¨æ ˆå¼€å‘</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">32</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/suoChina"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æ¬¢è¿æ¥åˆ°æˆ‘çš„æŠ€æœ¯åšå®¢ï¼è¿™é‡Œåˆ†äº«æŠ€æœ¯å­¦ä¹ ä¸æˆé•¿å¿ƒå¾— ğŸš€</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97-%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98-%F0%9F%9A%80"><span class="toc-number">1.</span> <span class="toc-text">Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜ ğŸš€</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8B-%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.</span> <span class="toc-text">ğŸ“‹ ç›®å½•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Redis%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.</span> <span class="toc-text">1. Redisç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AFRedis"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.1 ä»€ä¹ˆæ˜¯Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Redis%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2 Redisçš„ç‰¹ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8A%BF"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">æ€§èƒ½ä¼˜åŠ¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">ä½¿ç”¨åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Redis%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.3 Redisçš„åº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">å¸¸è§åº”ç”¨åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-Redis-vs-%E5%85%B6%E4%BB%96%E7%BC%93%E5%AD%98"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.4 Redis vs å…¶ä»–ç¼“å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-vs-Memcached"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">Redis vs Memcached</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-vs-Ehcache"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">Redis vs Ehcache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%BC%93%E5%AD%98%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">å…¶ä»–ç¼“å­˜æ–¹æ¡ˆå¯¹æ¯”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">å¤šçº§ç¼“å­˜æ¶æ„</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Redis%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">2. Rediså®‰è£…ä¸é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Linux%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.1.</span> <span class="toc-text">2.1 Linuxå®‰è£…</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A41%EF%BC%9A%E5%AE%89%E8%A3%85GCC%E7%BC%96%E8%AF%91%E5%99%A8"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">æ­¥éª¤1ï¼šå®‰è£…GCCç¼–è¯‘å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A42%EF%BC%9A%E4%B8%8B%E8%BD%BD%E5%B9%B6%E8%A7%A3%E5%8E%8BRedis"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">æ­¥éª¤2ï¼šä¸‹è½½å¹¶è§£å‹Redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A43%EF%BC%9A%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">æ­¥éª¤3ï¼šç¼–è¯‘å®‰è£…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A44%EF%BC%9A%E6%9F%A5%E7%9C%8B%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">æ­¥éª¤4ï¼šæŸ¥çœ‹å®‰è£…æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A45%EF%BC%9A%E5%90%AF%E5%8A%A8Redis"><span class="toc-number">1.3.1.5.</span> <span class="toc-text">æ­¥éª¤5ï¼šå¯åŠ¨Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F1%EF%BC%9A%E5%89%8D%E5%8F%B0%E5%90%AF%E5%8A%A8%EF%BC%88%E4%B8%8D%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-number">1.3.1.5.1.</span> <span class="toc-text">æ–¹å¼1ï¼šå‰å°å¯åŠ¨ï¼ˆä¸æ¨èï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F2%EF%BC%9A%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-number">1.3.1.5.2.</span> <span class="toc-text">æ–¹å¼2ï¼šåå°å¯åŠ¨ï¼ˆæ¨èï¼‰</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A46%EF%BC%9A%E5%85%B3%E9%97%ADRedis"><span class="toc-number">1.3.1.6.</span> <span class="toc-text">æ­¥éª¤6ï¼šå…³é—­Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E5%AE%9E%E4%BE%8B%E5%85%B3%E9%97%AD"><span class="toc-number">1.3.1.6.1.</span> <span class="toc-text">å•å®ä¾‹å…³é—­</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E5%AE%9E%E4%BE%8B%E5%85%B3%E9%97%AD"><span class="toc-number">1.3.1.6.2.</span> <span class="toc-text">å¤šå®ä¾‹å…³é—­</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.2 åŸºç¡€é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">é»˜è®¤ç«¯å£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">æ•°æ®åº“é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">å¯†ç é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%87%8D%E8%A6%81%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">å…¶ä»–é‡è¦é…ç½®</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Redis%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">3. RedisåŸºç¡€æ•°æ®ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E9%94%AE-key-%E9%80%9A%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.1.</span> <span class="toc-text">Redisé”®(key)é€šç”¨å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8Key%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">å¸¸ç”¨Keyå‘½ä»¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-String%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89"><span class="toc-number">1.4.2.</span> <span class="toc-text">3.1 Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">ç±»å‹ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">åŸºæœ¬å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.2.2.1.</span> <span class="toc-text">1. åŸºç¡€æ“ä½œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%95%B0%E5%80%BC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.2.2.2.</span> <span class="toc-text">2. æ•°å€¼æ“ä½œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.2.2.3.</span> <span class="toc-text">3. æ‰¹é‡æ“ä½œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E8%8C%83%E5%9B%B4%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.2.2.4.</span> <span class="toc-text">4. èŒƒå›´æ“ä½œ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%AD%90%E6%80%A7%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">åŸå­æ€§è¯´æ˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">æ•°æ®ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89"><span class="toc-number">1.4.3.</span> <span class="toc-text">3.2 Hashï¼ˆå“ˆå¸Œï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">ç±»å‹ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">å¸¸ç”¨å‘½ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">æ“ä½œç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-1"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">æ•°æ®ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89"><span class="toc-number">1.4.4.</span> <span class="toc-text">3.3 Listï¼ˆåˆ—è¡¨ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">ç±»å‹ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-1"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">å¸¸ç”¨å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.4.2.1.</span> <span class="toc-text">1. æ’å…¥æ“ä½œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%BC%B9%E5%87%BA%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.4.2.2.</span> <span class="toc-text">2. å¼¹å‡ºæ“ä½œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.4.2.3.</span> <span class="toc-text">3. æŸ¥è¯¢æ“ä½œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E4%BF%AE%E6%94%B9-%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.4.2.4.</span> <span class="toc-text">4. ä¿®æ”¹&#x2F;åˆ é™¤æ“ä½œ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">æ“ä½œç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-2"><span class="toc-number">1.4.4.4.</span> <span class="toc-text">æ•°æ®ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-number">1.4.5.</span> <span class="toc-text">3.4 Setï¼ˆé›†åˆï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D-3"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">ç±»å‹ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-2"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">å¸¸ç”¨å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C-1"><span class="toc-number">1.4.5.2.1.</span> <span class="toc-text">1. åŸºç¡€æ“ä½œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97"><span class="toc-number">1.4.5.2.2.</span> <span class="toc-text">2. é›†åˆè¿ç®—</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%A4%BA%E4%BE%8B-2"><span class="toc-number">1.4.5.3.</span> <span class="toc-text">æ“ä½œç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">1.4.5.4.</span> <span class="toc-text">å®é™…åº”ç”¨æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B1%EF%BC%9A%E5%85%B1%E5%90%8C%E5%A5%BD%E5%8F%8B"><span class="toc-number">1.4.5.4.1.</span> <span class="toc-text">æ¡ˆä¾‹1ï¼šå…±åŒå¥½å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B2%EF%BC%9A%E6%8A%BD%E5%A5%96%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.4.5.4.2.</span> <span class="toc-text">æ¡ˆä¾‹2ï¼šæŠ½å¥–ç³»ç»Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B3%EF%BC%9A%E6%A0%87%E7%AD%BE%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.4.5.4.3.</span> <span class="toc-text">æ¡ˆä¾‹3ï¼šæ ‡ç­¾ç³»ç»Ÿ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-3"><span class="toc-number">1.4.5.5.</span> <span class="toc-text">æ•°æ®ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-ZSet%EF%BC%88%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-number">1.4.6.</span> <span class="toc-text">3.5 ZSetï¼ˆæœ‰åºé›†åˆï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D-4"><span class="toc-number">1.4.6.1.</span> <span class="toc-text">ç±»å‹ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-3"><span class="toc-number">1.4.6.2.</span> <span class="toc-text">å¸¸ç”¨å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C-2"><span class="toc-number">1.4.6.2.1.</span> <span class="toc-text">1. åŸºç¡€æ“ä½œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2%EF%BC%88%E6%8C%89%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="toc-number">1.4.6.2.2.</span> <span class="toc-text">2. èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰ç´¢å¼•ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2%EF%BC%88%E6%8C%89%E5%88%86%E6%95%B0%EF%BC%89"><span class="toc-number">1.4.6.2.3.</span> <span class="toc-text">3. èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åˆ†æ•°ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%A4%BA%E4%BE%8B-3"><span class="toc-number">1.4.6.3.</span> <span class="toc-text">æ“ä½œç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B-1"><span class="toc-number">1.4.6.4.</span> <span class="toc-text">å®é™…åº”ç”¨æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B1%EF%BC%9A%E6%96%87%E7%AB%A0%E8%AE%BF%E9%97%AE%E9%87%8F%E6%8E%92%E8%A1%8C%E6%A6%9C"><span class="toc-number">1.4.6.4.1.</span> <span class="toc-text">æ¡ˆä¾‹1ï¼šæ–‡ç« è®¿é—®é‡æ’è¡Œæ¦œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B2%EF%BC%9A%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97"><span class="toc-number">1.4.6.4.2.</span> <span class="toc-text">æ¡ˆä¾‹2ï¼šå»¶è¿Ÿé˜Ÿåˆ—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B3%EF%BC%9A%E5%B7%A5%E8%B5%84%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.6.4.3.</span> <span class="toc-text">æ¡ˆä¾‹3ï¼šå·¥èµ„èŒƒå›´æŸ¥è¯¢</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-4"><span class="toc-number">1.4.6.5.</span> <span class="toc-text">æ•°æ®ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-Hash%EF%BC%88%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%89"><span class="toc-number">1.4.6.5.1.</span> <span class="toc-text">1. Hashï¼ˆå“ˆå¸Œè¡¨ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Skip-List%EF%BC%88%E8%B7%B3%E8%B7%83%E8%A1%A8%EF%BC%89"><span class="toc-number">1.4.6.5.2.</span> <span class="toc-text">2. Skip Listï¼ˆè·³è·ƒè¡¨ï¼‰</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.5.</span> <span class="toc-text">4. Redisé…ç½®æ–‡ä»¶è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-Units%EF%BC%88%E5%8D%95%E4%BD%8D%EF%BC%89"><span class="toc-number">1.5.1.</span> <span class="toc-text">4.1 Unitsï¼ˆå•ä½ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-INCLUDES%EF%BC%88%E5%8C%85%E5%90%AB%EF%BC%89"><span class="toc-number">1.5.2.</span> <span class="toc-text">4.2 INCLUDESï¼ˆåŒ…å«ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-NETWORK%EF%BC%88%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%EF%BC%89"><span class="toc-number">1.5.3.</span> <span class="toc-text">4.3 NETWORKï¼ˆç½‘ç»œé…ç½®ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">å¸¸ç”¨ç½‘ç»œé…ç½®é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">è¯¦ç»†è¯´æ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bind%EF%BC%88IP%E7%BB%91%E5%AE%9A%EF%BC%89"><span class="toc-number">1.5.3.2.1.</span> <span class="toc-text">bindï¼ˆIPç»‘å®šï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#protected-mode%EF%BC%88%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-number">1.5.3.2.2.</span> <span class="toc-text">protected-modeï¼ˆä¿æŠ¤æ¨¡å¼ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#port%EF%BC%88%E7%AB%AF%E5%8F%A3%EF%BC%89"><span class="toc-number">1.5.3.2.3.</span> <span class="toc-text">portï¼ˆç«¯å£ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tcp-backlog%EF%BC%88TCP%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97%EF%BC%89"><span class="toc-number">1.5.3.2.4.</span> <span class="toc-text">tcp-backlogï¼ˆTCPè¿æ¥é˜Ÿåˆ—ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#timeout%EF%BC%88%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B6%85%E6%97%B6%EF%BC%89"><span class="toc-number">1.5.3.2.5.</span> <span class="toc-text">timeoutï¼ˆå®¢æˆ·ç«¯è¶…æ—¶ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tcp-keepalive%EF%BC%88%E5%BF%83%E8%B7%B3%E6%A3%80%E6%B5%8B%EF%BC%89"><span class="toc-number">1.5.3.2.6.</span> <span class="toc-text">tcp-keepaliveï¼ˆå¿ƒè·³æ£€æµ‹ï¼‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-GENERAL%EF%BC%88%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE%EF%BC%89"><span class="toc-number">1.5.4.</span> <span class="toc-text">4.4 GENERALï¼ˆé€šç”¨é…ç½®ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">å¸¸ç”¨é€šç”¨é…ç½®é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E-1"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">è¯¦ç»†è¯´æ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#daemonize%EF%BC%88%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%EF%BC%89"><span class="toc-number">1.5.4.2.1.</span> <span class="toc-text">daemonizeï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pidfile%EF%BC%88%E8%BF%9B%E7%A8%8BID%E6%96%87%E4%BB%B6%EF%BC%89"><span class="toc-number">1.5.4.2.2.</span> <span class="toc-text">pidfileï¼ˆè¿›ç¨‹IDæ–‡ä»¶ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#loglevel%EF%BC%88%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB%EF%BC%89"><span class="toc-number">1.5.4.2.3.</span> <span class="toc-text">loglevelï¼ˆæ—¥å¿—çº§åˆ«ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#logfile%EF%BC%88%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%EF%BC%89"><span class="toc-number">1.5.4.2.4.</span> <span class="toc-text">logfileï¼ˆæ—¥å¿—æ–‡ä»¶ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#databases%EF%BC%88%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E9%87%8F%EF%BC%89"><span class="toc-number">1.5.4.2.5.</span> <span class="toc-text">databasesï¼ˆæ•°æ®åº“æ•°é‡ï¼‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-SECURITY%EF%BC%88%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%EF%BC%89"><span class="toc-number">1.5.5.</span> <span class="toc-text">4.5 SECURITYï¼ˆå®‰å…¨é…ç½®ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">å¯†ç è®¾ç½®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-LIMITS%EF%BC%88%E9%99%90%E5%88%B6%E9%85%8D%E7%BD%AE%EF%BC%89"><span class="toc-number">1.5.6.</span> <span class="toc-text">4.6 LIMITSï¼ˆé™åˆ¶é…ç½®ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%99%90%E5%88%B6%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">å¸¸ç”¨é™åˆ¶é…ç½®é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E-2"><span class="toc-number">1.5.6.2.</span> <span class="toc-text">è¯¦ç»†è¯´æ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#maxclients%EF%BC%88%E6%9C%80%E5%A4%A7%E8%BF%9E%E6%8E%A5%E6%95%B0%EF%BC%89"><span class="toc-number">1.5.6.2.1.</span> <span class="toc-text">maxclientsï¼ˆæœ€å¤§è¿æ¥æ•°ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#maxmemory%EF%BC%88%E6%9C%80%E5%A4%A7%E5%86%85%E5%AD%98%EF%BC%89"><span class="toc-number">1.5.6.2.2.</span> <span class="toc-text">maxmemoryï¼ˆæœ€å¤§å†…å­˜ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#maxmemory-policy%EF%BC%88%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5%EF%BC%89"><span class="toc-number">1.5.6.2.3.</span> <span class="toc-text">maxmemory-policyï¼ˆå†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#maxmemory-samples%EF%BC%88LRU%E9%87%87%E6%A0%B7%E6%95%B0%E9%87%8F%EF%BC%89"><span class="toc-number">1.5.6.2.4.</span> <span class="toc-text">maxmemory-samplesï¼ˆLRUé‡‡æ ·æ•°é‡ï¼‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B%EF%BC%88%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-number">1.5.7.</span> <span class="toc-text">é…ç½®ç¤ºä¾‹ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%EF%BC%88Pub-Sub%EF%BC%89"><span class="toc-number">1.6.</span> <span class="toc-text">5. Rediså‘å¸ƒè®¢é˜…ï¼ˆPub&#x2F;Subï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="toc-number">1.6.1.</span> <span class="toc-text">5.1 ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.6.2.</span> <span class="toc-text">5.2 å‘å¸ƒè®¢é˜…æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.3.</span> <span class="toc-text">5.3 å¸¸ç”¨å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">è®¢é˜…å‘½ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">å‘å¸ƒå‘½ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">æŸ¥è¯¢å‘½ä»¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.4.</span> <span class="toc-text">5.4 ä½¿ç”¨ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%8D%95%E9%A2%91%E9%81%93%E9%80%9A%E4%BF%A1"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">åŸºç¡€ç¤ºä¾‹ï¼šå•é¢‘é“é€šä¿¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%A4%9A%E9%A2%91%E9%81%93%E8%AE%A2%E9%98%85"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">è¿›é˜¶ç¤ºä¾‹ï¼šå¤šé¢‘é“è®¢é˜…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.4.3.</span> <span class="toc-text">æ¨¡å¼åŒ¹é…ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.6.5.</span> <span class="toc-text">5.5 åº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9E%E6%97%B6%E6%B6%88%E6%81%AF%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">1. å®æ—¶æ¶ˆæ¯ç³»ç»Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%9E%E6%97%B6%E9%80%9A%E7%9F%A5"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">2. å®æ—¶é€šçŸ¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7"><span class="toc-number">1.6.5.3.</span> <span class="toc-text">3. æ—¥å¿—ç›‘æ§</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.6.6.</span> <span class="toc-text">5.6 æ³¨æ„äº‹é¡¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E7%89%B9%E6%80%A7"><span class="toc-number">1.6.6.1.</span> <span class="toc-text">é‡è¦ç‰¹æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.6.6.2.</span> <span class="toc-text">ä½¿ç”¨å»ºè®®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-%E5%AF%B9%E6%AF%94%E5%85%B6%E4%BB%96%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6"><span class="toc-number">1.6.7.</span> <span class="toc-text">5.7 å¯¹æ¯”å…¶ä»–æ¶ˆæ¯æœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B%EF%BC%88Java%EF%BC%89"><span class="toc-number">1.6.8.</span> <span class="toc-text">å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Redis%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.</span> <span class="toc-text">6. Redisé«˜çº§æ•°æ®ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-Bitmap%EF%BC%88%E4%BD%8D%E5%9B%BE%EF%BC%89"><span class="toc-number">1.7.1.</span> <span class="toc-text">6.1 Bitmapï¼ˆä½å›¾ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFBitmap"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯Bitmap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bitmap%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">Bitmapå¸¸ç”¨å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-SETBIT-%E8%AE%BE%E7%BD%AE%E4%BD%8D%E5%80%BC"><span class="toc-number">1.7.1.2.1.</span> <span class="toc-text">1. SETBIT - è®¾ç½®ä½å€¼</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-GETBIT-%E8%8E%B7%E5%8F%96%E4%BD%8D%E5%80%BC"><span class="toc-number">1.7.1.2.2.</span> <span class="toc-text">2. GETBIT - è·å–ä½å€¼</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-BITCOUNT-%E7%BB%9F%E8%AE%A1%E4%BD%8D%E5%80%BC%E4%B8%BA1%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">1.7.1.2.3.</span> <span class="toc-text">3. BITCOUNT - ç»Ÿè®¡ä½å€¼ä¸º1çš„æ•°é‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-BITOP-%E4%BD%8D%E8%BF%90%E7%AE%97"><span class="toc-number">1.7.1.2.4.</span> <span class="toc-text">4. BITOP - ä½è¿ç®—</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bitmap%E4%B8%8ESet%E5%AF%B9%E6%AF%94"><span class="toc-number">1.7.1.3.</span> <span class="toc-text">Bitmapä¸Setå¯¹æ¯”</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF1%EF%BC%9A%E5%A4%A7%E9%87%8F%E6%B4%BB%E8%B7%83%E7%94%A8%E6%88%B7%EF%BC%88Bitmap%E4%BC%98%E5%8A%BF%E6%98%8E%E6%98%BE%EF%BC%89"><span class="toc-number">1.7.1.3.1.</span> <span class="toc-text">åœºæ™¯1ï¼šå¤§é‡æ´»è·ƒç”¨æˆ·ï¼ˆBitmapä¼˜åŠ¿æ˜æ˜¾ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E5%B0%91%E9%87%8F%E6%B4%BB%E8%B7%83%E7%94%A8%E6%88%B7%EF%BC%88Bitmap%E5%8A%A3%E5%8A%BF%E6%98%8E%E6%98%BE%EF%BC%89"><span class="toc-number">1.7.1.3.2.</span> <span class="toc-text">åœºæ™¯2ï¼šå°‘é‡æ´»è·ƒç”¨æˆ·ï¼ˆBitmapåŠ£åŠ¿æ˜æ˜¾ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE-1"><span class="toc-number">1.7.1.4.</span> <span class="toc-text">ä½¿ç”¨å»ºè®®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B%EF%BC%88Java%EF%BC%89-1"><span class="toc-number">1.7.1.5.</span> <span class="toc-text">å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-HyperLogLog%EF%BC%88%E5%9F%BA%E6%95%B0%E7%BB%9F%E8%AE%A1%EF%BC%89"><span class="toc-number">1.7.2.</span> <span class="toc-text">6.2 HyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFHyperLogLog"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯HyperLogLog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%EF%BC%9A%E7%BB%9F%E8%AE%A1%E9%9C%80%E6%B1%82%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">ä¸šåŠ¡åœºæ™¯ï¼šç»Ÿè®¡éœ€æ±‚çš„æŒ‘æˆ˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%9F%BA%E6%95%B0%EF%BC%9F"><span class="toc-number">1.7.2.3.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯åŸºæ•°ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.7.2.4.</span> <span class="toc-text">ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆçš„é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"><span class="toc-number">1.7.2.4.1.</span> <span class="toc-text">æ–¹æ¡ˆå¯¹æ¯”</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HyperLogLog%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-number">1.7.2.5.</span> <span class="toc-text">HyperLogLogçš„ä¼˜åŠ¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HyperLogLog%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.7.2.6.</span> <span class="toc-text">HyperLogLogå¸¸ç”¨å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-PFADD-%E6%B7%BB%E5%8A%A0%E5%85%83%E7%B4%A0"><span class="toc-number">1.7.2.6.1.</span> <span class="toc-text">1. PFADD - æ·»åŠ å…ƒç´ </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-PFCOUNT-%E8%AE%A1%E7%AE%97%E5%9F%BA%E6%95%B0"><span class="toc-number">1.7.2.6.2.</span> <span class="toc-text">2. PFCOUNT - è®¡ç®—åŸºæ•°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-PFMERGE-%E5%90%88%E5%B9%B6HLL"><span class="toc-number">1.7.2.6.3.</span> <span class="toc-text">3. PFMERGE - åˆå¹¶HLL</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.2.7.</span> <span class="toc-text">åº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%BD%91%E7%AB%99UV%E7%BB%9F%E8%AE%A1"><span class="toc-number">1.7.2.7.1.</span> <span class="toc-text">1. ç½‘ç«™UVç»Ÿè®¡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%8B%AC%E7%AB%8BIP%E7%BB%9F%E8%AE%A1"><span class="toc-number">1.7.2.7.2.</span> <span class="toc-text">2. ç‹¬ç«‹IPç»Ÿè®¡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E8%AF%8D%E7%BB%9F%E8%AE%A1"><span class="toc-number">1.7.2.7.3.</span> <span class="toc-text">3. æœç´¢å…³é”®è¯ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-APP%E6%97%A5%E6%B4%BB-%E6%9C%88%E6%B4%BB%E7%BB%9F%E8%AE%A1"><span class="toc-number">1.7.2.7.4.</span> <span class="toc-text">4. APPæ—¥æ´»&#x2F;æœˆæ´»ç»Ÿè®¡</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HyperLogLog-vs-%E5%85%B6%E4%BB%96%E6%96%B9%E6%A1%88"><span class="toc-number">1.7.2.8.</span> <span class="toc-text">HyperLogLog vs å…¶ä»–æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E5%AF%B9%E6%AF%94%EF%BC%881%E4%BA%BF%E7%94%A8%E6%88%B7UV%E7%BB%9F%E8%AE%A1%EF%BC%89"><span class="toc-number">1.7.2.8.1.</span> <span class="toc-text">å†…å­˜å ç”¨å¯¹æ¯”ï¼ˆ1äº¿ç”¨æˆ·UVç»Ÿè®¡ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF%E5%AF%B9%E6%AF%94"><span class="toc-number">1.7.2.8.2.</span> <span class="toc-text">é€‚ç”¨åœºæ™¯å¯¹æ¯”</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE-2"><span class="toc-number">1.7.2.9.</span> <span class="toc-text">ä½¿ç”¨å»ºè®®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.7.2.10.</span> <span class="toc-text">æ³¨æ„äº‹é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B%EF%BC%88Java%EF%BC%89-2"><span class="toc-number">1.7.2.11.</span> <span class="toc-text">å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99UV%E7%BB%9F%E8%AE%A1%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.7.2.12.</span> <span class="toc-text">å®æˆ˜æ¡ˆä¾‹ï¼šå¤§å‹ç½‘ç«™UVç»Ÿè®¡ç³»ç»Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-GEO%EF%BC%88%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%EF%BC%89"><span class="toc-number">1.7.3.</span> <span class="toc-text">6.3 GEOï¼ˆåœ°ç†ä½ç½®ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFGEO"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯GEO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GEO%E5%9D%90%E6%A0%87%E7%B3%BB%E7%BB%9F%E8%AF%B4%E6%98%8E"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">GEOåæ ‡ç³»ç»Ÿè¯´æ˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GEO%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">GEOå¸¸ç”¨å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-GEOADD-%E6%B7%BB%E5%8A%A0%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.7.3.3.1.</span> <span class="toc-text">1. GEOADD - æ·»åŠ åœ°ç†ä½ç½®</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-GEOPOS-%E8%8E%B7%E5%8F%96%E5%9D%90%E6%A0%87"><span class="toc-number">1.7.3.3.2.</span> <span class="toc-text">2. GEOPOS - è·å–åæ ‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-GEODIST-%E8%AE%A1%E7%AE%97%E8%B7%9D%E7%A6%BB"><span class="toc-number">1.7.3.3.3.</span> <span class="toc-text">3. GEODIST - è®¡ç®—è·ç¦»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-GEORADIUS-%E5%8D%8A%E5%BE%84%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2%EF%BC%88%E6%8C%89%E5%9D%90%E6%A0%87%EF%BC%89"><span class="toc-number">1.7.3.3.4.</span> <span class="toc-text">4. GEORADIUS - åŠå¾„èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åæ ‡ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-GEORADIUSBYMEMBER-%E5%8D%8A%E5%BE%84%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2%EF%BC%88%E6%8C%89%E6%88%90%E5%91%98%EF%BC%89"><span class="toc-number">1.7.3.3.5.</span> <span class="toc-text">5. GEORADIUSBYMEMBER - åŠå¾„èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰æˆå‘˜ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-GEOHASH-%E8%8E%B7%E5%8F%96GeoHash%E5%80%BC"><span class="toc-number">1.7.3.3.6.</span> <span class="toc-text">6. GEOHASH - è·å–GeoHashå€¼</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="toc-number">1.7.3.4.</span> <span class="toc-text">åº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E9%99%84%E8%BF%91%E7%9A%84%E4%BA%BA-%E5%BA%97%E9%93%BA-%E8%AE%BE%E6%96%BD"><span class="toc-number">1.7.3.4.1.</span> <span class="toc-text">1. é™„è¿‘çš„äºº&#x2F;åº—é“º&#x2F;è®¾æ–½</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%A4%96%E5%8D%96%E9%85%8D%E9%80%81%E8%8C%83%E5%9B%B4"><span class="toc-number">1.7.3.4.2.</span> <span class="toc-text">2. å¤–å–é…é€èŒƒå›´</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%89%93%E8%BD%A6%E8%B7%9D%E7%A6%BB%E8%AE%A1%E7%AE%97"><span class="toc-number">1.7.3.4.3.</span> <span class="toc-text">3. æ‰“è½¦è·ç¦»è®¡ç®—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%85%B1%E4%BA%AB%E5%8D%95%E8%BD%A6%E5%88%86%E5%B8%83"><span class="toc-number">1.7.3.4.4.</span> <span class="toc-text">4. å…±äº«å•è½¦åˆ†å¸ƒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E7%89%A9%E6%B5%81%E9%85%8D%E9%80%81%E4%BC%98%E5%8C%96"><span class="toc-number">1.7.3.4.5.</span> <span class="toc-text">5. ç‰©æµé…é€ä¼˜åŒ–</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GEO%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">1.7.3.5.</span> <span class="toc-text">GEOåº•å±‚åŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-1"><span class="toc-number">1.7.3.6.</span> <span class="toc-text">æ³¨æ„äº‹é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B%EF%BC%88Java%EF%BC%89-3"><span class="toc-number">1.7.3.7.</span> <span class="toc-text">å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆJavaï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%A4%96%E5%8D%96%E9%85%8D%E9%80%81%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.7.3.8.</span> <span class="toc-text">å®æˆ˜æ¡ˆä¾‹ï¼šå¤–å–é…é€ç³»ç»Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Redis%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81%E6%9C%BA%E5%88%B6"><span class="toc-number">1.8.</span> <span class="toc-text">7. Redisäº‹åŠ¡ä¸é”æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%BB%80%E4%B9%88%E6%98%AFRedis%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.8.1.</span> <span class="toc-text">7.1 ä»€ä¹ˆæ˜¯Redisäº‹åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%AE%9A%E4%B9%89"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">äº‹åŠ¡å®šä¹‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">äº‹åŠ¡çš„åº”ç”¨åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-Redis%E4%BA%8B%E5%8A%A1%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.2.</span> <span class="toc-text">7.2 Redisäº‹åŠ¡å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-MULTI-%E5%BC%80%E5%90%AF%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">7.2.1 MULTI - å¼€å¯äº‹åŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-EXEC-%E6%89%A7%E8%A1%8C%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">7.2.2 EXEC - æ‰§è¡Œäº‹åŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-3-DISCARD-%E5%8F%96%E6%B6%88%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">7.2.3 DISCARD - å–æ¶ˆäº‹åŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-4-WATCH-%E7%9B%91%E8%A7%86%E9%94%AE"><span class="toc-number">1.8.2.4.</span> <span class="toc-text">7.2.4 WATCH - ç›‘è§†é”®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-5-UNWATCH-%E5%8F%96%E6%B6%88%E7%9B%91%E8%A7%86"><span class="toc-number">1.8.2.5.</span> <span class="toc-text">7.2.5 UNWATCH - å–æ¶ˆç›‘è§†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-Redis%E4%BA%8B%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.8.3.</span> <span class="toc-text">7.3 Redisäº‹åŠ¡æ‰§è¡Œæµç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-1-%E4%BA%8B%E5%8A%A1%E6%89%A7%E8%A1%8C%E7%9A%84%E4%B8%89%E4%B8%AA%E9%98%B6%E6%AE%B5"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">7.3.1 äº‹åŠ¡æ‰§è¡Œçš„ä¸‰ä¸ªé˜¶æ®µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-2-%E4%BA%8B%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%A1%88%E4%BE%8B"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">7.3.2 äº‹åŠ¡æ‰§è¡Œæ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B1%EF%BC%9A%E7%BB%84%E9%98%9F%E6%88%90%E5%8A%9F%EF%BC%8C%E6%8F%90%E4%BA%A4%E6%88%90%E5%8A%9F-%E2%9C%85"><span class="toc-number">1.8.3.2.1.</span> <span class="toc-text">æ¡ˆä¾‹1ï¼šç»„é˜ŸæˆåŠŸï¼Œæäº¤æˆåŠŸ âœ…</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B2%EF%BC%9A%E7%BB%84%E9%98%9F%E9%98%B6%E6%AE%B5%E6%8A%A5%E9%94%99%EF%BC%8C%E6%8F%90%E4%BA%A4%E5%A4%B1%E8%B4%A5-%E2%9D%8C"><span class="toc-number">1.8.3.2.2.</span> <span class="toc-text">æ¡ˆä¾‹2ï¼šç»„é˜Ÿé˜¶æ®µæŠ¥é”™ï¼Œæäº¤å¤±è´¥ âŒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B3%EF%BC%9A%E7%BB%84%E9%98%9F%E6%88%90%E5%8A%9F%EF%BC%8C%E6%89%A7%E8%A1%8C%E9%98%B6%E6%AE%B5%E9%83%A8%E5%88%86%E5%A4%B1%E8%B4%A5-%E2%9A%A0%EF%B8%8F"><span class="toc-number">1.8.3.2.3.</span> <span class="toc-text">æ¡ˆä¾‹3ï¼šç»„é˜ŸæˆåŠŸï¼Œæ‰§è¡Œé˜¶æ®µéƒ¨åˆ†å¤±è´¥ âš ï¸</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E4%BA%8B%E5%8A%A1%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.8.4.</span> <span class="toc-text">7.4 äº‹åŠ¡é”™è¯¯å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">ä¸¤ç§é”™è¯¯ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">é”™è¯¯å¤„ç†è¯¦è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E4%BA%8B%E5%8A%A1-vs-%E4%BC%A0%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.8.4.3.</span> <span class="toc-text">Redisäº‹åŠ¡ vs ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-%E4%BA%8B%E5%8A%A1%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.8.5.</span> <span class="toc-text">7.5 äº‹åŠ¡å†²çªé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-1-%E4%BA%8B%E5%8A%A1%E5%86%B2%E7%AA%81%E5%9C%BA%E6%99%AF"><span class="toc-number">1.8.5.1.</span> <span class="toc-text">7.5.1 äº‹åŠ¡å†²çªåœºæ™¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-2-%E6%82%B2%E8%A7%82%E9%94%81%EF%BC%88Pessimistic-Lock%EF%BC%89"><span class="toc-number">1.8.5.2.</span> <span class="toc-text">7.5.2 æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-3-%E4%B9%90%E8%A7%82%E9%94%81%EF%BC%88Optimistic-Lock%EF%BC%89"><span class="toc-number">1.8.5.3.</span> <span class="toc-text">7.5.3 ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-4-%E6%82%B2%E8%A7%82%E9%94%81-vs-%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">1.8.5.4.</span> <span class="toc-text">7.5.4 æ‚²è§‚é” vs ä¹è§‚é”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-Redis%E4%BA%8B%E5%8A%A1%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="toc-number">1.8.6.</span> <span class="toc-text">7.6 Redisäº‹åŠ¡ä¸‰å¤§ç‰¹æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-6-1-%E5%8D%95%E7%8B%AC%E7%9A%84%E9%9A%94%E7%A6%BB%E6%93%8D%E4%BD%9C"><span class="toc-number">1.8.6.1.</span> <span class="toc-text">7.6.1 å•ç‹¬çš„éš”ç¦»æ“ä½œ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-6-2-%E6%B2%A1%E6%9C%89%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">1.8.6.2.</span> <span class="toc-text">7.6.2 æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-6-3-%E4%B8%8D%E4%BF%9D%E8%AF%81%E5%8E%9F%E5%AD%90%E6%80%A7"><span class="toc-number">1.8.6.3.</span> <span class="toc-text">7.6.3 ä¸ä¿è¯åŸå­æ€§</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-7-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9ARedis%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.8.7.</span> <span class="toc-text">7.7 å®æˆ˜æ¡ˆä¾‹ï¼šRedisç§’æ€ç³»ç»Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-7-1-%E7%A7%92%E6%9D%80%E5%9C%BA%E6%99%AF%E5%88%86%E6%9E%90"><span class="toc-number">1.8.7.1.</span> <span class="toc-text">7.7.1 ç§’æ€åœºæ™¯åˆ†æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-7-2-%E6%96%B9%E6%A1%881%EF%BC%9A%E5%9F%BA%E7%A1%80%E4%BA%8B%E5%8A%A1%E6%96%B9%E6%A1%88%EF%BC%88%E6%9C%89%E8%B6%85%E5%8D%96%E9%97%AE%E9%A2%98%EF%BC%89"><span class="toc-number">1.8.7.2.</span> <span class="toc-text">7.7.2 æ–¹æ¡ˆ1ï¼šåŸºç¡€äº‹åŠ¡æ–¹æ¡ˆï¼ˆæœ‰è¶…å–é—®é¢˜ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-7-3-%E6%96%B9%E6%A1%882%EF%BC%9A%E4%B9%90%E8%A7%82%E9%94%81%E6%96%B9%E6%A1%88%EF%BC%88WATCH%EF%BC%89"><span class="toc-number">1.8.7.3.</span> <span class="toc-text">7.7.3 æ–¹æ¡ˆ2ï¼šä¹è§‚é”æ–¹æ¡ˆï¼ˆWATCHï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-7-4-%E6%96%B9%E6%A1%883%EF%BC%9ALua%E8%84%9A%E6%9C%AC%E6%96%B9%E6%A1%88%EF%BC%88%E6%9C%80%E4%BC%98%EF%BC%89"><span class="toc-number">1.8.7.4.</span> <span class="toc-text">7.7.4 æ–¹æ¡ˆ3ï¼šLuaè„šæœ¬æ–¹æ¡ˆï¼ˆæœ€ä¼˜ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Lua%E8%84%9A%E6%9C%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E8%83%BD%E4%BF%9D%E8%AF%81%E5%8E%9F%E5%AD%90%E6%80%A7%EF%BC%9F"><span class="toc-number">1.8.7.5.</span> <span class="toc-text">Luaè„šæœ¬ä¸ºä»€ä¹ˆèƒ½ä¿è¯åŸå­æ€§ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Lua%E8%84%9A%E6%9C%AC%E4%BC%9A%E5%87%BA%E7%8E%B0%E9%83%A8%E5%88%86%E6%88%90%E5%8A%9F%E3%80%81%E9%83%A8%E5%88%86%E5%A4%B1%E8%B4%A5%E5%90%97%EF%BC%9F"><span class="toc-number">1.8.7.6.</span> <span class="toc-text">Luaè„šæœ¬ä¼šå‡ºç°éƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å¤±è´¥å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-7-5-%E4%B8%89%E7%A7%8D%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"><span class="toc-number">1.8.7.7.</span> <span class="toc-text">7.7.5 ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-8-Redis%E4%BA%8B%E5%8A%A1%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.8.8.</span> <span class="toc-text">7.8 Redisäº‹åŠ¡æœ€ä½³å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-8-1-%E4%BD%95%E6%97%B6%E4%BD%BF%E7%94%A8%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.8.8.1.</span> <span class="toc-text">7.8.1 ä½•æ—¶ä½¿ç”¨äº‹åŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-8-2-%E4%BA%8B%E5%8A%A1%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.8.8.2.</span> <span class="toc-text">7.8.2 äº‹åŠ¡ä¼˜åŒ–å»ºè®®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-8-3-%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF"><span class="toc-number">1.8.8.3.</span> <span class="toc-text">7.8.3 å¸¸è§é”™è¯¯</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-9-%E6%80%BB%E7%BB%93"><span class="toc-number">1.8.9.</span> <span class="toc-text">7.9 æ€»ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E4%BA%8B%E5%8A%A1%E6%A0%B8%E5%BF%83%E8%A6%81%E7%82%B9"><span class="toc-number">1.8.9.1.</span> <span class="toc-text">Redisäº‹åŠ¡æ ¸å¿ƒè¦ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1-vs-Lua%E8%84%9A%E6%9C%AC"><span class="toc-number">1.8.9.2.</span> <span class="toc-text">äº‹åŠ¡ vs Luaè„šæœ¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.8.9.3.</span> <span class="toc-text">å­¦ä¹ å»ºè®®</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.9.</span> <span class="toc-text">8. RedisæŒä¹…åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.9.1.</span> <span class="toc-text">8.1 ä»€ä¹ˆæ˜¯æŒä¹…åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-RDB%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.9.2.</span> <span class="toc-text">8.2 RDBæŒä¹…åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-%E4%BB%80%E4%B9%88%E6%98%AFRDB"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">8.2.1 ä»€ä¹ˆæ˜¯RDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-RDB%E6%8C%81%E4%B9%85%E5%8C%96%E6%B5%81%E7%A8%8B"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">8.2.2 RDBæŒä¹…åŒ–æµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-3-Fork%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.9.2.3.</span> <span class="toc-text">8.2.3 Forkæœºåˆ¶è¯¦è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-4-RDB%E8%A7%A6%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="toc-number">1.9.2.4.</span> <span class="toc-text">8.2.4 RDBè§¦å‘æ–¹å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-5-RDB%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.9.2.5.</span> <span class="toc-text">8.2.5 RDBé…ç½®è¯¦è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-6-RDB%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="toc-number">1.9.2.6.</span> <span class="toc-text">8.2.6 RDBå¤‡ä»½ä¸æ¢å¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-7-RDB%E4%BC%98%E7%BC%BA%E7%82%B9%E5%88%86%E6%9E%90"><span class="toc-number">1.9.2.7.</span> <span class="toc-text">8.2.7 RDBä¼˜ç¼ºç‚¹åˆ†æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-8-%E5%8A%A8%E6%80%81%E5%81%9C%E6%AD%A2RDB"><span class="toc-number">1.9.2.8.</span> <span class="toc-text">8.2.8 åŠ¨æ€åœæ­¢RDB</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-AOF%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.9.3.</span> <span class="toc-text">8.3 AOFæŒä¹…åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-1-%E4%BB%80%E4%B9%88%E6%98%AFAOF"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">8.3.1 ä»€ä¹ˆæ˜¯AOF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-2-AOF%E6%8C%81%E4%B9%85%E5%8C%96%E6%B5%81%E7%A8%8B"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">8.3.2 AOFæŒä¹…åŒ–æµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-3-AOF%E9%85%8D%E7%BD%AE"><span class="toc-number">1.9.3.3.</span> <span class="toc-text">8.3.3 AOFé…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-4-AOF%E9%87%8D%E5%86%99%EF%BC%88Rewrite%EF%BC%89"><span class="toc-number">1.9.3.4.</span> <span class="toc-text">8.3.4 AOFé‡å†™ï¼ˆRewriteï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-5-AOF%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="toc-number">1.9.3.5.</span> <span class="toc-text">8.3.5 AOFå¤‡ä»½ä¸æ¢å¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-6-AOF%E4%BC%98%E7%BC%BA%E7%82%B9%E5%88%86%E6%9E%90"><span class="toc-number">1.9.3.6.</span> <span class="toc-text">8.3.6 AOFä¼˜ç¼ºç‚¹åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%88Redis-4-0-%EF%BC%89"><span class="toc-number">1.9.4.</span> <span class="toc-text">8.4 æ··åˆæŒä¹…åŒ–ï¼ˆRedis 4.0+ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.9.4.1.</span> <span class="toc-text">8.4.1 ä»€ä¹ˆæ˜¯æ··åˆæŒä¹…åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-2-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">1.9.4.2.</span> <span class="toc-text">8.4.2 æ··åˆæŒä¹…åŒ–é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-3-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.9.4.3.</span> <span class="toc-text">8.4.3 æ··åˆæŒä¹…åŒ–å·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-4-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E4%BC%98%E5%8A%BF"><span class="toc-number">1.9.4.4.</span> <span class="toc-text">8.4.4 æ··åˆæŒä¹…åŒ–ä¼˜åŠ¿</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-%E6%8C%81%E4%B9%85%E5%8C%96%E7%AD%96%E7%95%A5%E9%80%89%E6%8B%A9"><span class="toc-number">1.9.5.</span> <span class="toc-text">8.5 æŒä¹…åŒ–ç­–ç•¥é€‰æ‹©</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-1-RDB-vs-AOF-vs-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.9.5.1.</span> <span class="toc-text">8.5.1 RDB vs AOF vs æ··åˆæŒä¹…åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.9.5.2.</span> <span class="toc-text">8.5.2 é€‰æ‹©å»ºè®®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-3-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%8E%A8%E8%8D%90%E9%85%8D%E7%BD%AE"><span class="toc-number">1.9.5.3.</span> <span class="toc-text">8.5.3 ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-4-%E6%8C%81%E4%B9%85%E5%8C%96%E7%9B%91%E6%8E%A7"><span class="toc-number">1.9.5.4.</span> <span class="toc-text">8.5.4 æŒä¹…åŒ–ç›‘æ§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-5-%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.9.5.5.</span> <span class="toc-text">8.5.5 æŒä¹…åŒ–æœ€ä½³å®è·µ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-%E6%80%BB%E7%BB%93"><span class="toc-number">1.9.6.</span> <span class="toc-text">8.6 æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Redis%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.10.</span> <span class="toc-text">7. Redisäº‹åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%BA%8B%E5%8A%A1%E5%9F%BA%E7%A1%80"><span class="toc-number">1.10.1.</span> <span class="toc-text">7.1 äº‹åŠ¡åŸºç¡€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E4%BA%8B%E5%8A%A1%E5%91%BD%E4%BB%A4"><span class="toc-number">1.10.2.</span> <span class="toc-text">7.2 äº‹åŠ¡å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-Watch%E6%9C%BA%E5%88%B6"><span class="toc-number">1.10.3.</span> <span class="toc-text">7.3 Watchæœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E4%BA%8B%E5%8A%A1%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.10.4.</span> <span class="toc-text">7.4 äº‹åŠ¡æ³¨æ„äº‹é¡¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="toc-number">1.11.</span> <span class="toc-text">8. Rediså‘å¸ƒè®¢é˜…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.11.1.</span> <span class="toc-text">8.1 å‘å¸ƒè®¢é˜…æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">1.11.2.</span> <span class="toc-text">8.2 ç›¸å…³å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.11.3.</span> <span class="toc-text">8.3 åº”ç”¨åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">1.12.</span> <span class="toc-text">9. Redisä¸»ä»å¤åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86"><span class="toc-number">1.12.1.</span> <span class="toc-text">9.1 ä¸»ä»å¤åˆ¶åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">1.12.2.</span> <span class="toc-text">9.2 é…ç½®ä¸»ä»å¤åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E5%85%A8%E9%87%8F%E5%A4%8D%E5%88%B6%E4%B8%8E%E5%A2%9E%E9%87%8F%E5%A4%8D%E5%88%B6"><span class="toc-number">1.12.3.</span> <span class="toc-text">9.3 å…¨é‡å¤åˆ¶ä¸å¢é‡å¤åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.12.4.</span> <span class="toc-text">9.4 ä¸»ä»å¤åˆ¶æ³¨æ„äº‹é¡¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Redis%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.13.</span> <span class="toc-text">10. Rediså“¨å…µæ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.13.1.</span> <span class="toc-text">10.1 å“¨å…µæ¨¡å¼ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E5%93%A8%E5%85%B5%E9%85%8D%E7%BD%AE"><span class="toc-number">1.13.2.</span> <span class="toc-text">10.2 å“¨å…µé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB"><span class="toc-number">1.13.3.</span> <span class="toc-text">10.3 æ•…éšœè½¬ç§»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-%E5%93%A8%E5%85%B5%E9%9B%86%E7%BE%A4"><span class="toc-number">1.13.4.</span> <span class="toc-text">10.4 å“¨å…µé›†ç¾¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-Redis%E9%9B%86%E7%BE%A4"><span class="toc-number">1.14.</span> <span class="toc-text">11. Redisé›†ç¾¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84"><span class="toc-number">1.14.1.</span> <span class="toc-text">11.1 é›†ç¾¤æ¶æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87"><span class="toc-number">1.14.2.</span> <span class="toc-text">11.2 æ•°æ®åˆ†ç‰‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">1.14.3.</span> <span class="toc-text">11.3 é›†ç¾¤æ­å»º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-%E9%9B%86%E7%BE%A4%E6%89%A9%E5%AE%B9%E4%B8%8E%E7%BC%A9%E5%AE%B9"><span class="toc-number">1.14.4.</span> <span class="toc-text">11.4 é›†ç¾¤æ‰©å®¹ä¸ç¼©å®¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-Redis%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8"><span class="toc-number">1.15.</span> <span class="toc-text">12. Rediså®æˆ˜åº”ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.15.1.</span> <span class="toc-text">12.1 ç¼“å­˜è®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">1.15.2.</span> <span class="toc-text">12.2 åˆ†å¸ƒå¼é”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-3-%E5%BB%B6%E6%97%B6%E9%98%9F%E5%88%97"><span class="toc-number">1.15.3.</span> <span class="toc-text">12.3 å»¶æ—¶é˜Ÿåˆ—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-4-%E6%8E%92%E8%A1%8C%E6%A6%9C"><span class="toc-number">1.15.4.</span> <span class="toc-text">12.4 æ’è¡Œæ¦œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-5-%E9%99%90%E6%B5%81"><span class="toc-number">1.15.5.</span> <span class="toc-text">12.5 é™æµ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-Redis%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.16.</span> <span class="toc-text">13. Redisæ€§èƒ½ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96"><span class="toc-number">1.16.1.</span> <span class="toc-text">13.1 å†…å­˜ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-%E5%91%BD%E4%BB%A4%E4%BC%98%E5%8C%96"><span class="toc-number">1.16.2.</span> <span class="toc-text">13.2 å‘½ä»¤ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-3-%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96"><span class="toc-number">1.16.3.</span> <span class="toc-text">13.3 ç½‘ç»œä¼˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-4-%E6%85%A2%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90"><span class="toc-number">1.16.4.</span> <span class="toc-text">13.4 æ…¢æŸ¥è¯¢åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-Redis%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.17.</span> <span class="toc-text">14. Rediså¸¸è§é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="toc-number">1.17.1.</span> <span class="toc-text">14.1 ç¼“å­˜ç©¿é€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2-%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="toc-number">1.17.2.</span> <span class="toc-text">14.2 ç¼“å­˜å‡»ç©¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-3-%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="toc-number">1.17.3.</span> <span class="toc-text">14.3 ç¼“å­˜é›ªå´©</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-4-%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">1.17.4.</span> <span class="toc-text">14.4 æ•°æ®ä¸€è‡´æ€§</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-Java%E6%95%B4%E5%90%88Redis"><span class="toc-number">1.18.</span> <span class="toc-text">15. Javaæ•´åˆRedis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1-Jedis%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.18.1.</span> <span class="toc-text">15.1 Jediså®¢æˆ·ç«¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-2-Lettuce%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.18.2.</span> <span class="toc-text">15.2 Lettuceå®¢æˆ·ç«¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-3-Spring-Data-Redis"><span class="toc-number">1.18.3.</span> <span class="toc-text">15.3 Spring Data Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-4-RedisTemplate%E4%BD%BF%E7%94%A8"><span class="toc-number">1.18.4.</span> <span class="toc-text">15.4 RedisTemplateä½¿ç”¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90%E6%8E%A8%E8%8D%90"><span class="toc-number">1.19.</span> <span class="toc-text">16. å­¦ä¹ èµ„æºæ¨è</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E8%B5%84%E6%BA%90"><span class="toc-number">1.19.1.</span> <span class="toc-text">å®˜æ–¹èµ„æº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7"><span class="toc-number">1.19.2.</span> <span class="toc-text">å­¦ä¹ å·¥å…·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.19.3.</span> <span class="toc-text">å®æˆ˜é¡¹ç›®</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/redis-learning-guide/" title="Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/redis/cover.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜"></a><div class="content"><a class="title" href="/redis-learning-guide/" title="Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜">Redisä¸­é—´ä»¶å­¦ä¹ æŒ‡å— - ä»å…¥é—¨åˆ°å®æˆ˜</a><time datetime="2025-11-09T15:30:00.000Z" title="å‘è¡¨äº 2025-11-09 23:30:00">2025-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/programming-shortcuts-guide/" title="ç¼–ç¨‹å·¥å…·å¿«æ·é”®å¤§å…¨ - æ•ˆç‡æå‡å¿…å¤‡æŒ‡å—"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/shortcuts/cover.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="ç¼–ç¨‹å·¥å…·å¿«æ·é”®å¤§å…¨ - æ•ˆç‡æå‡å¿…å¤‡æŒ‡å—"></a><div class="content"><a class="title" href="/programming-shortcuts-guide/" title="ç¼–ç¨‹å·¥å…·å¿«æ·é”®å¤§å…¨ - æ•ˆç‡æå‡å¿…å¤‡æŒ‡å—">ç¼–ç¨‹å·¥å…·å¿«æ·é”®å¤§å…¨ - æ•ˆç‡æå‡å¿…å¤‡æŒ‡å—</a><time datetime="2025-11-09T15:00:00.000Z" title="å‘è¡¨äº 2025-11-09 23:00:00">2025-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/linux-basic-commands/" title="LinuxåŸºç¡€å‘½ä»¤ - ä»å…¥é—¨åˆ°ç²¾é€š"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/linux/Linux%20%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2%E5%9B%BE.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LinuxåŸºç¡€å‘½ä»¤ - ä»å…¥é—¨åˆ°ç²¾é€š"></a><div class="content"><a class="title" href="/linux-basic-commands/" title="LinuxåŸºç¡€å‘½ä»¤ - ä»å…¥é—¨åˆ°ç²¾é€š">LinuxåŸºç¡€å‘½ä»¤ - ä»å…¥é—¨åˆ°ç²¾é€š</a><time datetime="2025-11-03T14:00:00.000Z" title="å‘è¡¨äº 2025-11-03 22:00:00">2025-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mcp-tutorial/" title="MCPä½¿ç”¨æ•™ç¨‹ - æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ä»å…¥é—¨åˆ°ç²¾é€š"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/mcp/LLM%E4%B8%8EMCP.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="MCPä½¿ç”¨æ•™ç¨‹ - æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ä»å…¥é—¨åˆ°ç²¾é€š"></a><div class="content"><a class="title" href="/mcp-tutorial/" title="MCPä½¿ç”¨æ•™ç¨‹ - æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ä»å…¥é—¨åˆ°ç²¾é€š">MCPä½¿ç”¨æ•™ç¨‹ - æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ä»å…¥é—¨åˆ°ç²¾é€š</a><time datetime="2025-10-04T15:00:00.000Z" title="å‘è¡¨äº 2025-10-04 23:00:00">2025-10-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/cursor-tutorial/" title="Cursorä½¿ç”¨æ•™ç¨‹ - AIç¼–ç¨‹åŠ©æ‰‹ä»å…¥é—¨åˆ°ç²¾é€š"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/cursor/1749179465178.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Cursorä½¿ç”¨æ•™ç¨‹ - AIç¼–ç¨‹åŠ©æ‰‹ä»å…¥é—¨åˆ°ç²¾é€š"></a><div class="content"><a class="title" href="/cursor-tutorial/" title="Cursorä½¿ç”¨æ•™ç¨‹ - AIç¼–ç¨‹åŠ©æ‰‹ä»å…¥é—¨åˆ°ç²¾é€š">Cursorä½¿ç”¨æ•™ç¨‹ - AIç¼–ç¨‹åŠ©æ‰‹ä»å…¥é—¨åˆ°ç²¾é€š</a><time datetime="2025-10-04T04:00:00.000Z" title="å‘è¡¨äº 2025-10-04 12:00:00">2025-10-04</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By SuoL</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.2.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.0</a></span></div><div class="footer_custom_text">æ„Ÿè°¢è®¿é—®æˆ‘çš„æŠ€æœ¯åšå®¢ï¼å¦‚æœ‰é—®é¢˜æ¬¢è¿äº¤æµè®¨è®º ğŸš€</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script>const clickTexts=["âœ¨ å“‡ï¼","ğŸ’« å¤ªæ£’äº†ï¼","ğŸ‰ èµï¼","ğŸŒŸ ç²¾å½©ï¼","ğŸ’– å–œæ¬¢ï¼","ğŸš€ é…·ï¼","â­ æ£’ï¼","ğŸ’ ç¾ï¼","ğŸ”¥ çƒ­ï¼","ğŸ’¯ å®Œç¾ï¼","ğŸ˜Š å¼€å¿ƒï¼","ğŸŠ åº†ç¥ï¼","ğŸ’ æƒŠå–œï¼","ğŸŒˆ å½©è™¹ï¼","ğŸˆ æ°”çƒï¼","ğŸ€ å¹¸è¿ï¼","ğŸ ç¤¼ç‰©ï¼","ğŸ’ é²œèŠ±ï¼","ğŸµ éŸ³ä¹ï¼","ğŸ¨ è‰ºæœ¯ï¼"];function createClickEffect(e){const t=document.createElement("div");t.className="click-effect",t.textContent=clickTexts[Math.floor(Math.random()*clickTexts.length)],t.style.left=e.clientX+"px",t.style.top=e.clientY+"px",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},1e3),createRipple(e)}function createRipple(e){const t=document.createElement("div");t.className="ripple";t.style.width="20px",t.style.height="20px",t.style.left=e.clientX-10+"px",t.style.top=e.clientY-10+"px",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},600)}document.addEventListener("click",createClickEffect);let isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);isMobile&&document.addEventListener("touchstart",(function(e){1===e.touches.length&&createClickEffect(e.touches[0])}))</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> æ•°æ®åŠ è½½ä¸­</span></div><div class="local-search-input"><input placeholder="æœç´¢æ–‡ç« ..." type="text"></div><hr><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>